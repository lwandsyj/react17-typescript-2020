<html><body><div>
      <img alt="Pragmatic Bookshelf" src="/images/cover-image/images/cover.jpg" title="Pragmatic Bookshelf"/>
    </div>,<h1 class="titlepage tp-title">Programming Flutter</h1>
<h3 class="titlepage tp-subtitle">Native, Cross-Platform Apps the Easy Way</h3>
<h3 class="titlepage tp-authors">by Carmine Zaccagnino</h3>
<div class="titlepage tp-docinfo">Version: P1.0 (February 2020)</div>,<section class="pp-chunk tp-copyright"><p>Copyright © 2020 The Pragmatic Programmers, LLC.
        This book is licensed to
        the individual who purchased it. We don't copy-protect it
        because that would limit your ability to use it for your
        own purposes. Please don't break this trust—you can use
        this across all of your devices but please do not share this copy
        with other members of your team, with friends, or via
        file sharing services.  Thanks.
        </p><p>
             Many of the designations used by manufacturers and
             sellers to distinguish their products are claimed as
             trademarks. Where those designations appear in this book,
             and The Pragmatic Programmers, LLC was aware of a
             trademark claim, the designations have been printed in
             initial capital letters or in all capitals. The Pragmatic
             Starter Kit, The Pragmatic Programmer, Pragmatic
             Programming, Pragmatic Bookshelf and the linking <i>g</i>
             device are trademarks of The Pragmatic Programmers,
             LLC.
         </p><p>
           Every precaution was taken in the preparation of this book.
           However, the publisher assumes no responsibility for errors
           or omissions, or for damages that may result from the use
           of information (including program listings) contained
           herein.
         </p>


<section class="about-pb"><h2 class="pp-no-chunk">About the Pragmatic Bookshelf</h2><p>
           The Pragmatic Bookshelf is an agile publishing company.
           We’re here because we want to improve the lives of developers.
           We do this by creating timely, practical titles, written by programmers for programmers.
         </p><p>
           Our Pragmatic courses, workshops, and other products can
           help you and your team create better software and have more
           fun. For more information, as well as the latest Pragmatic
           titles, please visit us at <a href="http://pragprog.com">http://pragprog.com</a>.
         </p><p>
           Our ebooks do not contain any Digital Restrictions
           Management, and have always been DRM-free. We pioneered the
           beta book concept, where you can purchase and read a book
           while it’s still being written, and provide feedback to the
           author to help make a better book for everyone. Free
           resources for all purchasers include source code downloads
           (if applicable), errata and discussion forums, all
           available on the book's home page at pragprog.com. We’re
           here to make your life easier.
         </p><h3>New Book Announcements</h3><p>
           Want to keep up on our latest titles and announcements, and
           occasional special offers? Just create an account on
           <a href="https://pragprog.com">pragprog.com</a> (an email address and a password is all it takes)
           and select the checkbox to receive newsletters. You can
           also follow us on twitter as @pragprog.
         </p><h3>About Ebook Formats</h3><p>
             If you buy directly from
           <a href="https://pragprog.com">pragprog.com</a>, you get
           ebooks in all available formats for one price. You can
           synch your ebooks amongst all your devices (including
           iPhone/iPad, Android, laptops, etc.) via Dropbox.
           You get free updates for the life of the edition. And, of
           course, you can always come back and re-download your books
           when needed. Ebooks bought from the Amazon Kindle store are
           subject to Amazon's polices. Limitations in Amazon's file
           format may cause ebooks to display differently on different
           devices. For more information, please see our FAQ at
           <a href="https://pragprog.com/frequently-asked-questions/ebooks">pragprog.com/frequently-asked-questions/ebooks</a>. To learn
           more about this book and access the free resources, go to
           <a href="https://pragprog.com/book/czflutr">https://pragprog.com/book/czflutr</a>, the book's homepage.</p><p>
           Thanks for your continued support,
         </p><p>
           Andy Hunt<br/>
           The Pragmatic Programmers
         </p></section><section class="production-info"><p>The team that produced this book includes: <span class="production">Andy Hunt (Publisher)</span><span class="production">Janet Furlow (VP of Operations)</span><span class="production">Dave Rankin (Executive Editor)</span><span class="production">Michael Swaine (Development Editor)</span><span class="production">Jasmine Kwityn (Copy Editor)</span><span class="production">Potomac Indexing, LLC (Indexing)</span><span class="production">Gilson Graphics (Layout)</span></p><p>
             For customer support, please contact
             <a href="mailto:support@pragprog.com">support@pragprog.com</a>.
           </p><p>
             For international rights, please contact
             <a href="mailto:rights@pragprog.com">rights@pragprog.com</a>.
           </p></section></section>,<nav xmlns:epub="http://www.idpf.org/2007/ops" class="pp-chunk table-of-contents" epub:type="toc"><h1 class="pp-no-chunk">Table of Contents</h1><ol><li class="toc-chap"><a href="/links/f_0004/f_0004.xhtml#chp.acknowledgments"><span class="toc-secnum"> </span>Acknowledgments</a></li><li class="toc-chap"><a href="/links/f_0005/f_0005.xhtml#d24e136"><span class="toc-secnum"> </span>Preface</a><ol><li class="toc-sect"><a href="/links/f_0006/f_0006.xhtml#d24e184">A Brief History of Flutter</a></li><li class="toc-sect"><a href="/links/f_0007/f_0007.xhtml#d24e218">Why Flutter Matters and What We’ll See in This Book</a></li><li class="toc-sect"><a href="/links/f_0008/f_0008.xhtml#d24e253">Don’t Know Dart? Don’t Worry About It</a></li><li class="toc-sect"><a href="/links/f_0009/f_0009.xhtml#d24e266">Installing the SDK and the IDE Plugins</a></li><li class="toc-sect"><a href="/links/f_0010/f_0010.xhtml#d24e1274">Where We’re Going Next: Let’s Start Building Apps</a></li></ol></li><li class="toc-part"><a href="/links/f_0011/f_0011.xhtml#d24e1284">Part I. 
        Getting Started with Flutter
      </a><ol><li class="toc-chap"><a href="/links/f_0012/f_0012.xhtml#d24e1297"><span class="toc-secnum">1. </span>Making Your First Flutter App</a><ol><li class="toc-sect"><a href="/links/f_0013/f_0013.xhtml#d24e1303">Get Familiar with Dart Syntax and Flutter Classes</a></li><li class="toc-sect"><a href="/links/f_0014/f_0014.xhtml#d24e2792">Give the App Your Personal Touch</a></li><li class="toc-sect"><a href="/links/f_0015/f_0015.xhtml#d24e4652">Where We’re Going Next</a></li></ol></li><li class="toc-chap"><a href="/links/f_0016/f_0016.xhtml#chp.layout"><span class="toc-secnum">2. </span> Laying Out More Widgets </a><ol><li class="toc-sect"><a href="/links/f_0017/f_0017.xhtml#d24e4679">Introducing Layout Widgets</a></li><li class="toc-sect"><a href="/links/f_0018/f_0018.xhtml#d24e4794">Contain and Add Padding to Widgets Using Invisible Layout Widgets</a></li><li class="toc-sect"><a href="/links/f_0019/f_0019.xhtml#sec.layout.assets">Add Your Own Assets to the App</a></li><li class="toc-sect"><a href="/links/f_0020/f_0020.xhtml#d24e5694">Displaying Images</a></li><li class="toc-sect"><a href="/links/f_0021/f_0021.xhtml#d24e6318">Vertical Layout</a></li><li class="toc-sect"><a href="/links/f_0022/f_0022.xhtml#sec.layout.row">Horizontal Layout: The Row</a></li><li class="toc-sect"><a href="/links/f_0023/f_0023.xhtml#d24e8970">Making Grids</a></li><li class="toc-sect"><a href="/links/f_0024/f_0024.xhtml#sec.layout.card">The Card</a></li><li class="toc-sect"><a href="/links/f_0025/f_0025.xhtml#sec.layout.expanded">Fill the Space Available in the View Using Expanded</a></li><li class="toc-sect"><a href="/links/f_0026/f_0026.xhtml#sec.layout.slivers">Slivers, Custom Scrollables, and Collapsable App Bars</a></li><li class="toc-sect"><a href="/links/f_0027/f_0027.xhtml#sec.layout.key">The Key</a></li><li class="toc-sect"><a href="/links/f_0028/f_0028.xhtml#d24e10445">Where We’re Going Next</a></li></ol></li><li class="toc-chap"><a href="/links/f_0029/f_0029.xhtml#chp.calculator"><span class="toc-secnum">3. </span> Building a Calculator App </a><ol><li class="toc-sect"><a href="/links/f_0030/f_0030.xhtml#d24e10495">Importing Basic Dependencies</a></li><li class="toc-sect"><a href="/links/f_0031/f_0031.xhtml#d24e10530">Writing main</a></li><li class="toc-sect"><a href="/links/f_0032/f_0032.xhtml#d24e10698">The Calculator’s Home Page</a></li><li class="toc-sect"><a href="/links/f_0033/f_0033.xhtml#d24e10765">How the App Will Be Structured</a></li><li class="toc-sect"><a href="/links/f_0034/f_0034.xhtml#d24e10842">Implement the Basic Layout</a></li><li class="toc-sect"><a href="/links/f_0035/f_0035.xhtml#sec.calculator.screencard">Let’s Give the Calculator a Screen</a></li><li class="toc-sect"><a href="/links/f_0036/f_0036.xhtml#d24e11199">Add the Deletion Row</a></li><li class="toc-sect"><a href="/links/f_0037/f_0037.xhtml#d24e11349">The Third Row</a></li><li class="toc-sect"><a href="/links/f_0038/f_0038.xhtml#d24e12065">Why a GridView Wouldn’t Work</a></li><li class="toc-sect"><a href="/links/f_0039/f_0039.xhtml#sec.calculator.expanded">Make the App Look and Work Right with Expanded</a></li><li class="toc-sect"><a href="/links/f_0040/f_0040.xhtml#d24e12547">The Finished Layout</a></li><li class="toc-sect"><a href="/links/f_0041/f_0041.xhtml#sec.calculator.calculation">Implement the Calculations</a></li><li class="toc-sect"><a href="/links/f_0042/f_0042.xhtml#sec.calculator.usingCalc">Use the Calculation Inside the App</a></li><li class="toc-sect"><a href="/links/f_0043/f_0043.xhtml#d24e15548">Wrapping Up the Calculator</a></li><li class="toc-sect"><a href="/links/f_0044/f_0044.xhtml#d24e16643">What If We Try to Divide by 0?</a></li><li class="toc-sect"><a href="/links/f_0045/f_0045.xhtml#d24e17022">Where We’re Going Next</a></li></ol></li><li class="toc-chap"><a href="/links/f_0046/f_0046.xhtml#chp.packages"><span class="toc-secnum">4. </span> Beyond the Standard Library: Plugins and Packages </a><ol><li class="toc-sect"><a href="/links/f_0047/f_0047.xhtml#d24e17035">An Introduction to Packages</a></li><li class="toc-sect"><a href="/links/f_0048/f_0048.xhtml#d24e17374">Package Usage Example</a></li><li class="toc-sect"><a href="/links/f_0049/f_0049.xhtml#d24e18324">Making Your Own Packages</a></li><li class="toc-sect"><a href="/links/f_0050/f_0050.xhtml#sec.packages.publishing">Publishing a Package to Pub</a></li><li class="toc-sect"><a href="/links/f_0051/f_0051.xhtml#d24e19754">Packages for Windows, macOS, and Linux</a></li><li class="toc-sect"><a href="/links/f_0052/f_0052.xhtml#d24e19789">Where We’re Going Next</a></li></ol></li></ol></li><li class="toc-part"><a href="/links/f_0054/f_0054.xhtml#d24e19795">Part II. 
        Doing More with Flutter
      </a><ol><li class="toc-chap"><a href="/links/f_0055/f_0055.xhtml#chp.networking"><span class="toc-secnum">5. </span> Network and Storage I/O and Navigation </a><ol><li class="toc-sect"><a href="/links/f_0056/f_0056.xhtml#d24e19819">The API</a></li><li class="toc-sect"><a href="/links/f_0057/f_0057.xhtml#d24e20226">The http Package</a></li><li class="toc-sect"><a href="/links/f_0058/f_0058.xhtml#d24e20985">Writing Methods to Fetch Comics</a></li><li class="toc-sect"><a href="/links/f_0059/f_0059.xhtml#sec.networking.navigation">What You Need to Build the UI: Navigation and the InheritedWidget</a></li><li class="toc-sect"><a href="/links/f_0060/f_0060.xhtml#sec.xkcdapp.UI">Build the App’s Basic UI</a></li><li class="toc-sect"><a href="/links/f_0061/f_0061.xhtml#d24e24830">Building the Comic Page</a></li><li class="toc-sect"><a href="/links/f_0062/f_0062.xhtml#sec.networking.progress">Using the CircularProgressIndicator</a></li><li class="toc-sect"><a href="/links/f_0063/f_0063.xhtml#sec.networking.storage">Making Everything Faster by Caching to Local Storage</a></li><li class="toc-sect"><a href="/links/f_0064/f_0064.xhtml#d24e26774">Allowing the User to Click the Image and Go to the Website: The url_launcher Package</a></li><li class="toc-sect"><a href="/links/f_0065/f_0065.xhtml#d24e27141">Adding Comic Selection by Number</a></li><li class="toc-sect"><a href="/links/f_0066/f_0066.xhtml#d24e27700">Permanent Data I/O in Flutter: Adding “Starred” Comics</a></li><li class="toc-sect"><a href="/links/f_0067/f_0067.xhtml#d24e29155">Where We’re Going Next</a></li></ol></li><li class="toc-chap"><a href="/links/f_0068/f_0068.xhtml#d24e29162"><span class="toc-secnum">6. </span> Testing and Debugging Flutter Apps </a><ol><li class="toc-sect"><a href="/links/f_0069/f_0069.xhtml#d24e29170">Testing</a></li><li class="toc-sect"><a href="/links/f_0070/f_0070.xhtml#d24e30840">Testing the XKCD App: Using Mock Objects</a></li><li class="toc-sect"><a href="/links/f_0071/f_0071.xhtml#sec.testing.errors">Throwing and Catching Exceptions</a></li><li class="toc-sect"><a href="/links/f_0072/f_0072.xhtml#d24e35028">Assert Statements</a></li><li class="toc-sect"><a href="/links/f_0073/f_0073.xhtml#d24e35116">Where We’re Going Next</a></li></ol></li><li class="toc-chap"><a href="/links/f_0074/f_0074.xhtml#chp.firebase"><span class="toc-secnum">7. </span> Build a Chat App Using Firebase </a><ol><li class="toc-sect"><a href="/links/f_0075/f_0075.xhtml#d24e35136">What Is Firebase?</a></li><li class="toc-sect"><a href="/links/f_0076/f_0076.xhtml#d24e36245">Animations and Transistions</a></li><li class="toc-sect"><a href="/links/f_0077/f_0077.xhtml#d24e36823">Custom Shapes and Drawing in Flutter Apps Using Painters</a></li><li class="toc-sect"><a href="/links/f_0078/f_0078.xhtml#d24e38103">The StreamBuilder</a></li><li class="toc-sect"><a href="/links/f_0079/f_0079.xhtml#sec.firebase.chat">Building the Chat App</a></li><li class="toc-sect"><a href="/links/f_0080/f_0080.xhtml#d24e41642">Where You’re Going Next</a></li></ol></li></ol></li><li class="toc-chap"><a href="/links/f_0082/f_0082.xhtml#chp.dart"><span class="toc-secnum">A1. </span> Introduction to Dart </a><ol><li class="toc-sect"><a href="/links/f_0083/f_0083.xhtml#d24e41687">Comments in Dart</a></li><li class="toc-sect"><a href="/links/f_0084/f_0084.xhtml#sec.dart.variables">Variables and Conditions</a></li><li class="toc-sect"><a href="/links/f_0085/f_0085.xhtml#sec.dart.functions">Functions</a></li><li class="toc-sect"><a href="/links/f_0086/f_0086.xhtml#d24e44112">main</a></li><li class="toc-sect"><a href="/links/f_0087/f_0087.xhtml#sec.dart.async">Asynchronous Code in Dart: The dart:async Library</a></li><li class="toc-sect"><a href="/links/f_0088/f_0088.xhtml#sec.dart.conditionals">Conditional Constructs and Expressions</a></li><li class="toc-sect"><a href="/links/f_0089/f_0089.xhtml#sec.dart.loops">Loops: while, do while, and for</a></li><li class="toc-sect"><a href="/links/f_0090/f_0090.xhtml#sec.dart.classes">Classes</a></li><li class="toc-sect"><a href="/links/f_0091/f_0091.xhtml#sec.dart.typedef">Typedef and Callbacks</a></li><li class="toc-sect"><a href="/links/f_0092/f_0092.xhtml#sec.dart.import">Mastering import</a></li><li class="toc-sect"><a href="/links/f_0093/f_0093.xhtml#sec.dart.types.conversion">Conversion Between Native Java/Apple and Dart Data Types</a></li><li class="toc-sect"><a href="/links/f_0094/f_0094.xhtml#d24e47008">Where You’re Going Next</a></li></ol></li><li class="toc-chap"><a href="/links/f_0095/f_0095.xhtml#chp.pubspec"><span class="toc-secnum">A2. </span> Apple-Like Look and Additional App Configuration </a><ol><li class="toc-sect"><a href="/links/f_0096/f_0096.xhtml#d24e47028">Cupertino Widgets</a></li><li class="toc-sect"><a href="/links/f_0097/f_0097.xhtml#d24e48283">pubspec.yaml</a></li><li class="toc-sect"><a href="/links/f_0098/f_0098.xhtml#sec.appconfig.platspec">Platform-Specific Setup</a></li></ol></li></ol></nav><div class="copyright">Copyright © 2020, The Pragmatic Bookshelf.</div>,<h1>
    Early Praise for <em>Programming Flutter</em></h1><div style="margin-bottom:9px;margin-top:9px;"><div class="praise">
<p id="d24e58">
        I’m excited to read this book: ten years ago, I learned Android development reading a PragProg book, and this has changed my life forever. Now this book could change it again.
      </p></div><table class="praise"><tr><td style="width:5%">→ </td><td>Giordano Scalzo</td></tr><tr class="praise"><td class="praise">
</td><td class="praise">iOS Senior Software Engineer, NatWest Markets</td></tr></table></div><div style="margin-bottom:9px;margin-top:9px;"><div class="praise">
<p id="d24e69">
        Carmine’s book is a comprehensive journey into Flutter. He leads you through the basics like widgets, standard library, packages, and plugins, and helps you to understand the more advanced topics like network, I/O, navigation, testing, debugging, and firebase. His book is a reference for practical suggestions, useful tips, and solid advice, without sacrificing the details. What I liked the most is that each chapter starts with a premise, and ends with a conclusion and “where we’re going next,” building up a natural, logical, and consequential narrative.
      </p></div><table class="praise"><tr><td style="width:5%">→ </td><td>Alessio Salvadorini</td></tr><tr class="praise"><td class="praise">
</td><td class="praise">Creative Technologist, Nokia</td></tr></table></div><div style="margin-bottom:9px;margin-top:9px;"><div class="praise">
<p id="d24e80">
        Great book for anyone who wants to start grasping Flutter.
      </p></div><table class="praise"><tr><td style="width:5%">→ </td><td>Erdem Orman</td></tr><tr class="praise"><td class="praise">
</td><td class="praise">Software Development Engineer, Amazon</td></tr></table></div><div style="margin-bottom:9px;margin-top:9px;"><div class="praise">
<p id="d24e91">
        If you want or need to do cross-platform mobile app development, you should have this book at hand. <em>Programming Flutter</em>, by Carmine Zaccagnino, walks you systematically through this important Google platform for building full apps that work with Android, iOS, and Google Fuchsia.
      </p></div><table class="praise"><tr><td style="width:5%">→ </td><td>John Barry</td></tr><tr class="praise"><td class="praise">
</td><td class="praise">Independent Editorial Consultant, various</td></tr></table></div><div style="margin-bottom:9px;margin-top:9px;"><div class="praise">
<p id="d24e105">
        Carmine’s hands-on tutorial will help you understand Flutter and why it is the best solution to target iPhones and Androids with a single codebase. Great book for a great framework!
      </p></div><table class="praise"><tr><td style="width:5%">→ </td><td>Paul Freiberger</td></tr><tr class="praise"><td class="praise">
</td><td class="praise">Coauthor, <span class="emph">Fire in the Valley: The Birth and Death of the Personal Computer</span></td></tr></table></div>,<h1 class="chapter-title" id="chp.acknowledgments"><span class="chapter-number"/><br/><span class="chapter-name">Acknowledgments</span></h1>

<p id="d24e119">
This book exists because Flutter was released and such a revolutionary technology needed a way for people to know about it and learn it however they prefer. So, before even talking about the book, it’s necessary to remember how good it is for the developer community that Google has released Flutter and they’re continuing to invest in it to make it even more revolutionary and important every day that passes.
</p>
<p id="d24e121">
Talking about the book, it has to be said that working with the Pragmatic Bookshelf has been great. First of all, I want to thank Andy Hunt, who as a publisher has built a wonderful team: starting from my very first interactions with Brian MacDonald over my proposal to write this book everyone has been thorough, welcoming, and helpful.
</p>
<p id="d24e123">
In particular, I want to thank Michael Swaine who, as the editor of this book, has been encouraging, helpful, and understanding throughout the process, never making me feel pressured and always helping and encouraging me when any issues arose or when I had questions about anything related to the book.
</p>
<p id="d24e128">
When bigger and more technical issues arose, production manager Janet Furlow has fixed them, allowing me to keep working on the content of the book instead. The cover Gilson Graphics made for the book is very nice as a visual metaphor of Flutter’s multi-platform nature. In addition to those I have mentioned, I want to thank everyone else at the Pragmatic Bookshelf who has been involved in making the book as good as it is.
</p>
<p id="d24e130">
I want to thank everybody who has looked at the book and given me feedback, which I have taken on and tried to use to the best of my ability to make the book better for everyone. In particular, the technical reviewers who have been thorough and thoughtful in their feedback and the beta book readers who have taken their time to submit errata: it’s been very important and seeing how thorough they have been has encouraged me to do as much as I could for the book. Thank you Giordano Scalzo, Alessio Salvadorini, Erdem Orman, Paul Freiberger, and John Barry.
</p>
<p id="d24e132">
I want to thank everyone I know informally: my friends and family have all been very encouraging and supportive and have made this journey more pleasant than it could have ever been without their support. Knowing the people close to me were happy with the fact that I was doing this was invaluable. I would also like to mention the people who were less close to me, who knew me barely or not at all previously and who have reached out to ask about the book because they made the results of my work feel like something closer to me.
</p>

<div class="copyright">Copyright © 2020, The Pragmatic Bookshelf.</div>,<h1 class="chapter-title" id="d24e136"><span class="chapter-number"/><br/><span class="chapter-name">Preface</span></h1>

<p id="d24e140">This book is about Flutter, Google’s open source software development kit (SDK) that can be used to develop applications across a wide range of platforms. We’ll begin by taking a brief look at its history, followed by an overview of its features and what we will see during the course of this book.












</p>
<p id="d24e182">At the end of this Preface you’ll find information about the installation and usage of the Flutter SDK and integrated development environment (IDE) plugins.</p>,<h2 id="d24e184">A Brief History of Flutter</h2>
<p id="d24e187">
In 2015 Google unveiled Flutter, a new SDK based on the Dart language, as the next platform for Android development, and in 2017 an alpha version of it (0.0.6) was released to the public for the first time.</p>
<p id="d24e193">At I/O 2017 Google showed off using Flutter and its multi-platform capabilities, and continued promoting it at I/O 2018. Since then, Google has been investing in Flutter and recommending it as the way everyone should be developing mobile apps.</p>
<p id="d24e195">In December 2018 Flutter 1.0 was released and made available so that developers could begin using the SDK to make app creation easier.</p>
<p id="d24e197">
At Google I/O 2019, Flutter support for desktop and web platforms was publicly announced. Tools for developing Flutter apps for Windows, macOS, Linux, and the web were released.</p>
<p id="d24e203">In addition to being unstable and untested, desktop development is being held back further by the lack of plugin support, which is very limited mostly because, at the time of writing, plugin tooling is still in the process of being developed, meaning that binaries for the platform-specific code for each platform has to be manually built and linked by editing the Google-provided <span class="cf ic">Makefile</span>s that can be found in Google’s dedicated <span class="emph">flutter-desktop-embedding</span> GitHub repository.<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-1" id="FNPTR-1">[1]</a></sup></p>
<p id="d24e215">On the other hand, web support is progressing quickly and shouldn’t take much more than a rebuild of a working Flutter mobile project that doesn’t have any native plugins or platform-specific code.
</p>,<h2 id="d24e218">Why Flutter Matters and What We’ll See in This Book</h2>
<p id="d24e221">
Flutter’s entry into the mobile app development framework space is recent and, because of that, Flutter needs to carry significant improvements over existing frameworks and SDKs to actually be useful—and it does.</p>
<p id="d24e227">
For one thing, with Flutter you’ll be able to develop apps that work with Android, iOS, and Google Fuchsia,<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-2" id="FNPTR-2">[2]</a></sup> (which might replace Android and/or Chrome OS at some point in the future). Flutter is developed by Google, but it fully supports iOS, and this means you can now also run an iOS emulator and build for iOS in Android Studio. However, you won’t be able to build iOS apps on Linux or Windows because iOS emulation and compilation is still done through Xcode.</p>
<p id="d24e238">Flutter makes developing apps incredibly easy by allowing you to define the app’s UI declaratively but in the same place and language you define the app logic (no XML UI files required). You can instanly preview the changes you make to your app using stateful hot reload.</p>
<p id="d24e240">Additionally, its cross-platform nature doesn’t skimp on having a native look and feel, as the framework supports all of the typical native features of each of the operating systems (different app bar, different list drag to update, Material Design and Apple icons, etc.). The advantages compared to other cross-platform frameworks don’t end there: you’ll be able to run any native Kotlin/Java and Swift/Objective-C method using platform channels, as we’ll see in <a href="/links/f_0049/f_0049.xhtml#sec.packages.makingplugins">​<em>Integrating Native Code: Making Plugin Packages</em>​</a>.</p>
<p id="d24e244">Even though it’s really new, Flutter is already used by some big and established companies (as well as many smaller ones) to build cross-platform mobile apps, as you can see in Google’s Flutter Showcase Page.<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-3" id="FNPTR-3">[3]</a></sup></p>
<p id="d24e250">We’ll be using Flutter packages and plugins (many of them developed by Google) to build ever more useful apps, also introducing more advanced standard Flutter features such as navigation and animations.
</p>,<h2 id="d24e253">Don’t Know Dart? Don’t Worry About It</h2>
<p id="d24e256">
You might want to read Appendix 1, <a href="/links/f_0082/f_0082.xhtml#chp.dart">​<em> Introduction to Dart </em>​</a> if you don’t have much programming experience or find even the first chapter difficult to follow because of Dart’s syntax; many Dart-specific constructs will be explained during the course of the book, but you might want to consider going through that appendix first if you find yourself struggling to understand the code.</p>,<h2 id="d24e1274">Where We’re Going Next: Let’s Start Building Apps</h2>
<p id="d24e1277">Now that you’re set up with all you need to build Flutter apps, we can start building apps.</p>
<p id="d24e1279">You can begin by creating a new Flutter project and familiarizing yourself with the files generated by the SDK as well as the IDE’s UI for managing Flutter projects. Once you feel comfortable working with it, you can move on to the first chapter, in which we’ll learn the structure of a Flutter app and how to implement it.</p>

<div class="footnotes">
<h4>Footnotes</h4>
<dl>
<dt class="footnote-number"><a href="/links/f_0006/f_0006.xhtml#FNPTR-1" id="FOOTNOTE-1">[1]</a></dt><dd>
<p id="d24e212"><a href="https://github.com/google/flutter-desktop-embedding">https://github.com/google/flutter-desktop-embedding</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0007/f_0007.xhtml#FNPTR-2" id="FOOTNOTE-2">[2]</a></dt><dd>
<p id="d24e234"><a href="https://en.wikipedia.org/wiki/Google_Fuchsia">https://en.wikipedia.org/wiki/Google_Fuchsia</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0007/f_0007.xhtml#FNPTR-3" id="FOOTNOTE-3">[3]</a></dt><dd>
<p id="d24e247"><a href="https://flutter.dev/showcase">https://flutter.dev/showcase</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0009/f_0009.xhtml#FNPTR-4" id="FOOTNOTE-4">[4]</a></dt><dd>
<p id="d24e358"><a href="https://packages.gentoo.org/packages/dev-util/android-studio">https://packages.gentoo.org/packages/dev-util/android-studio</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0009/f_0009.xhtml#FNPTR-5" id="FOOTNOTE-5">[5]</a></dt><dd>
<p id="d24e371"><a href="https://aur.archlinux.org/packages/android-studio/">https://aur.archlinux.org/packages/android-studio/</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0009/f_0009.xhtml#FNPTR-6" id="FOOTNOTE-6">[6]</a></dt><dd>
<p id="d24e379"><a href="https://developer.android.com/studio#downloads">https://developer.android.com/studio#downloads</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0009/f_0009.xhtml#FNPTR-7" id="FOOTNOTE-7">[7]</a></dt><dd>
<p id="d24e471"><a href="https://aur.archlinux.org/packages/flutter/">https://aur.archlinux.org/packages/flutter/</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0009/f_0009.xhtml#FNPTR-8" id="FOOTNOTE-8">[8]</a></dt><dd>
<p id="d24e491"><a href="https://flutter.dev/docs/development/tools/sdk/archive?tab=linux">https://flutter.dev/docs/development/tools/sdk/archive?tab=linux</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0009/f_0009.xhtml#FNPTR-9" id="FOOTNOTE-9">[9]</a></dt><dd>
<p id="d24e579"><a href="https://en.wikipedia.org/wiki/Bash_(Unix_shell)">https://en.wikipedia.org/wiki/Bash_(Unix_shell)</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0009/f_0009.xhtml#FNPTR-10" id="FOOTNOTE-10">[10]</a></dt><dd>
<p id="d24e584"><a href="https://en.wikipedia.org/wiki/Tcsh">https://en.wikipedia.org/wiki/Tcsh</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0009/f_0009.xhtml#FNPTR-11" id="FOOTNOTE-11">[11]</a></dt><dd>
<p id="d24e589"><a href="https://en.wikipedia.org/wiki/KornShell">https://en.wikipedia.org/wiki/KornShell</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0009/f_0009.xhtml#FNPTR-12" id="FOOTNOTE-12">[12]</a></dt><dd>
<p id="d24e594"><a href="https://en.wikipedia.org/wiki/Almquist_shell">https://en.wikipedia.org/wiki/Almquist_shell</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0009/f_0009.xhtml#FNPTR-13" id="FOOTNOTE-13">[13]</a></dt><dd>
<p id="d24e600"><a href="https://en.wikipedia.org/wiki/Z_shell">https://en.wikipedia.org/wiki/Z_shell</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0009/f_0009.xhtml#FNPTR-14" id="FOOTNOTE-14">[14]</a></dt><dd>
<p id="d24e730"><a href="https://developer.android.com/studio#downloads">https://developer.android.com/studio#downloads</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0009/f_0009.xhtml#FNPTR-15" id="FOOTNOTE-15">[15]</a></dt><dd>
<p id="d24e749"><a href="https://git-scm.com/download/win">https://git-scm.com/download/win</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0009/f_0009.xhtml#FNPTR-16" id="FOOTNOTE-16">[16]</a></dt><dd>
<p id="d24e759"><a href="https://flutter.dev/docs/development/tools/sdk/archive">https://flutter.dev/docs/development/tools/sdk/archive</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0009/f_0009.xhtml#FNPTR-17" id="FOOTNOTE-17">[17]</a></dt><dd>
<p id="d24e804"><a href="https://developer.apple.com/xcode/">https://developer.apple.com/xcode/</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0009/f_0009.xhtml#FNPTR-18" id="FOOTNOTE-18">[18]</a></dt><dd>
<p id="d24e809"><a href="https://developer.apple.com/ios/">https://developer.apple.com/ios/</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0009/f_0009.xhtml#FNPTR-19" id="FOOTNOTE-19">[19]</a></dt><dd>
<p id="d24e828"><a href="https://developer.android.com/studio#downloads">https://developer.android.com/studio#downloads</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0009/f_0009.xhtml#FNPTR-20" id="FOOTNOTE-20">[20]</a></dt><dd>
<p id="d24e849"><a href="https://flutter.dev/docs/development/tools/sdk/archive?tab=macos">https://flutter.dev/docs/development/tools/sdk/archive?tab=macos</a></p></dd></dl></div>
<div class="copyright">Copyright © 2020, The Pragmatic Bookshelf.</div>,<h1 class="part-title" id="d24e1284"><span class="part-number">Part 1</span><br/>
        Getting Started with Flutter
      </h1><blockquote class="partintro" id="d24e1287">
<p id="d24e1288">
          Even though Flutter is very easy to pick up, we need to actually know
          what it can do for us and how it’s done.
        </p>
<p id="d24e1290">
          That’s what the chapters in this part are about: you’ll write your first app and in the process learn what Flutter
          widgets are and how they can be used to create user interfaces.
        </p>
<p id="d24e1292">
          After that, you’ll start combining more and more Flutter widgets together,
          and, at the end of Part I, you’ll learn how to use Dart packages
          to get Google-developed and third-party libraries to build more
          apps that use features not present in Flutter’s (or Dart’s) standard
          library.
        </p>
<p id="d24e1294">
          You’ll also learn how to run methods written in native Swift/Objective-C
          and Kotlin/Java to interact with low-level features that would otherwise
          be inacessible in Flutter.
        </p></blockquote>,<h1 class="chapter-title" id="d24e1297"><span class="chapter-number">
            Chapter
            1</span><br/><span class="chapter-name">Making Your First Flutter App</span></h1>

<p id="d24e1301">Let’s get started actually writing some code and making apps to learn what you can do with Flutter.</p>,<h2 id="d24e4652">Where We’re Going Next</h2>
<p id="d24e4655">

Now that we know how a simple Flutter app is made, how widgets are defined, and some basic Dart syntax, we can try to combine widgets to form a more complex UI composition, and that’s just we’ll learn to do in the next chapter.</p>

<div class="copyright">Copyright © 2020, The Pragmatic Bookshelf.</div>,<h1 class="chapter-title" id="chp.layout"><span class="chapter-number">
            Chapter
            2</span><br/><span class="chapter-name"> Laying Out More Widgets </span></h1>

<p id="d24e4666">We have built a simple Flutter app starting from an example. Now it’s time to start writing apps from scratch so that you’ll be able to build any kind of app a client or employer might request of you. In this chapter you will learn about the different Flutter layout and content widgets, and how to add your own custom assets to Flutter apps.</p>
<p id="d24e4668">After this chapter you should be able to create any Flutter layout and be able to apply the principles explained in the other feature-oriented chapters to the app you want to build.</p>
<p id="d24e4670">We’ll go through the different ways of laying out widgets with small examples to show them in action in a realistic context.</p>
<p id="d24e4672">
As an example of some of the different layout widgets that will be shown in this chapter, here are the widgets that we’ll be using to build a calculator in the next chapter:</p><div class="ss"><img alt="images/WidgetLayout/widgetcalc.png" class="" id="d24e4678" src="/images/img14/images/WidgetLayout/widgetcalc.png" style="width: 48%"/></div>,<h2 id="d24e4679">Introducing Layout Widgets</h2>
<p id="d24e4682">
There are multiple widgets that you can use for layout purposes, and some of them might look very similar.</p>
<p id="d24e4686">Starting from the widgets needed for the example shown above and explained in the next chapter, we will obviously be citing the simple vertical and horizontal visual layout structures:</p><ul><li>
<p id="d24e4690">The <span class="cf class">Column</span>, described in detail in <a href="/links/f_0021/f_0021.xhtml#sec.layout.column">​<em>The Column</em>​</a>, which allows you to stack widgets vertically, like we did in Chapter 1. It should not be confused with the <span class="cf class">Stack</span>, which is actually used to display widgets on top of others.
</p></li><li>
<p id="d24e4707">The <span class="cf class">ListView</span>, described in detail in <a href="/links/f_0021/f_0021.xhtml#sec.layout.listview">​<em>The ListView</em>​</a>, which allows you to create (potentially infinite) scrollable lists of widgets.
</p></li><li>
<p id="d24e4719">The <span class="cf class">Row</span>, described in detail in <a href="/links/f_0022/f_0022.xhtml#sec.layout.row">​<em>Horizontal Layout: The Row</em>​</a>, which allows you to display widgets side by side.
</p></li><li>
<p id="d24e4731">The <span class="cf class">GridView</span>, described in detail in <a href="/links/f_0023/f_0023.xhtml#sec.layout.gridview">​<em>The GridView</em>​</a>, which is used to create scrollable grids, a lot like <span class="cf class">ListView</span>’s are used to create scrollable mono-dimensional lists.
</p></li></ul>
<p id="d24e4747">
Additionally, this chapter will cover the <span class="cf class">Expanded</span> widget (in <a href="/links/f_0025/f_0025.xhtml#sec.layout.expanded">​<em>Fill the Space Available in the View Using Expanded</em>​</a>), which is used to create <span class="cf class">Column</span> or <span class="cf class">Row</span> children of different sizes.</p>
<p id="d24e4764">We’ll also talk about <span class="cf class">Sliver</span>s (in <a href="/links/f_0026/f_0026.xhtml#sec.layout.slivers">​<em>Slivers, Custom Scrollables, and Collapsable App Bars</em>​</a>), which are used for advanced scrolling, and the <span class="cf class">Key</span> (in <a href="/links/f_0027/f_0027.xhtml#sec.layout.key">​<em>The Key</em>​</a>), which I told you to ignore in the previous chapter.</p>
<p id="d24e4776">In the next chapter, we’ll combine together many of the widgets covered here (more on that in Chapter 3, <a href="/links/f_0029/f_0029.xhtml#chp.calculator">​<em> Building a Calculator App </em>​</a>).</p>
<p id="d24e4780">So let’s begin.
</p>
<p id="d24e4783">We’ll start with the simple and ubiquitous <span class="cf class">Padding</span> and <span class="cf class">Container</span>, as you’ll use them together with many other widgets when building apps, and then we’ll talk about how to <a href="/links/f_0019/f_0019.xhtml#sec.layout.assets">​<em>Add Your Own Assets to the App</em>​</a>.
</p>,<h2 id="d24e4794">Contain and Add Padding to Widgets Using Invisible Layout Widgets</h2>
<p id="d24e4797">Some widgets are not meant to add visible content to your app but instead are simply used to move other widgets inside the available space or change the shape and size of a widget in order to make the app look exactly how you want it to look.</p>
<p id="d24e4799">They all operate on a <span class="cf variable">child</span> widget, and you can use them to change the shape and size of that widget or to separate the widget from other widgets.</p><h3>Add Padding to a Widget</h3>
<p id="d24e4807">

There might be cases in which a widget in your app has to (or should) be a certain distance away from all or some other widgets—for example, if the widget has to be separated from other widgets in a list or grid, or if there are multiple small widgets used for interaction close to each other, or maybe just because it looks better with some empty space.</p>
<p id="d24e4820">The space that gets left empty is called <span class="emph">padding</span>, and is usually defined in terms of the amount of pixels for each direction that are left empty.</p>
<p id="d24e4825">You can add padding to the outside of a widget by wrapping it inside a <span class="cf class">Padding</span> widget.</p>
<p id="d24e4830"><span class="cf class">Padding</span> takes a <span class="cf variable">child</span> and the <span class="cf variable">padding</span> option as named arguments, so you can create a <span class="cf class">Text</span> with 20px padding the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  padding: EdgeInsets.all(20.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: Text(​<em class="string">"Example text"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e4859">The <span class="cf variable">padding</span> option takes an object of type <span class="cf class">EdgeInsetsGeometry</span>, which we’ll learn about in the next section.</p><h4>EdgeInsetsGeometry and EdgeInsets: Defining the Amount and Position of Padding</h4>
<p id="d24e4870">

You can generate objects of type <span class="cf class">EdgeInsetsGeometry</span> using the following constructors of the class <span class="cf class">EdgeInsets</span>:</p><ul><li>
<p id="d24e4889"><span class="cf methodname">EdgeInsets.all(paddingAmount)</span>, where <span class="cf variable">paddingAmount</span> is a <span class="cf class">double</span> value specifying the amount of padding, which adds padding everywhere around the content.</p></li><li>
<p id="d24e4902"><span class="cf methodname">EdgeInsets.symmetric(vertical: paddingAmountVertical, horizontal: paddingAmountHorizontal)</span>, where both arguments are optional and specify the amount of padding for each side in the respective axis.</p></li><li>
<p id="d24e4907"><span class="cf methodname">EdgeInsets.only(top: paddingAmountTop, bottom: paddingAmountBottom, left: paddingAmountLeft, right: paddingAmountRight)</span>, where all four arguments are optional and specify the amount of padding for the respective side of the content.</p></li></ul>
<p id="d24e4911">There are other constructors for <span class="cf class">EdgeInsets</span> (like <span class="cf methodname">EdgeInsets.fromWindowPadding</span> and <span class="cf methodname">EdgeInsets.fromLTRB</span>) but they are not really very useful with <span class="cf class">Padding</span>.</p>
<p id="d24e4925"><span class="cf methodname">EdgeInsetsDirectional.only</span> and <span class="cf methodname">EdgeInsetsDirectional.fromSTEB</span> also exist, and they are just like <span class="cf methodname">EdgeInsets.only</span> and <span class="cf methodname">EdgeInsets.fromLTRB</span>, but they use <span class="cf ic">start</span>, <span class="cf ic">top</span>, <span class="cf ic">bottom</span>, and <span class="cf ic">end</span> relative to the direction in which text is written and are useful when padding has to change whether the text goes from left to right (like when writing text in the Latin alphabet) or from right to left (like when writing text in the Arabic script or Hebrew alphabet).

</p><h3>The Container and the BoxDecoration</h3>
<p id="d24e4957">

The <span class="cf class">Container</span> is a generic containment widget, and it has multiple uses, depending on the options we decide to set:</p><ul><li>
<p id="d24e4975">We can choose to constrain the <span class="cf variable">child</span> to a set <span class="cf variable">width</span> and <span class="cf ic">height</span>.</p></li><li>
<p id="d24e4987">We can choose to add a background color to a widget or set of widgets.</p></li><li>
<p id="d24e4990">We can add <span class="cf ic">padding</span> to a widget.</p></li><li>
<p id="d24e4996">We can make the <span class="cf ic">Container</span> of a shape other than square or rectangular using <span class="cf class">BoxDecoration</span>.</p></li><li>
<p id="d24e5005">We can do all or some of these at the same time.</p></li></ul>
<p id="d24e5007">For example, we can create white text with a blue background and 20 pixel padding between the edges and the text, all limited to a 200x50 rectangle with the following code:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Container(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  color: Colors.blue,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  padding: EdgeInsets.all(20.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  width: 200.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  height: 50.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: Text(​<em class="string">"Prova"</em>​, style: TextStyle(color: Colors.white)),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table><h4>BoxDecoration</h4>
<p id="d24e5040">

<span class="cf class">BoxDecoration</span>, instead, is used to determine the <span class="cf class">Container</span>’s features.</p>
<p id="d24e5059">You can assign it to the <span class="cf class">Container</span>’s <span class="cf ic">decoration</span> option and you might be interested in the following options:</p><ul><li>
<p id="d24e5069"><span class="cf ic">padding</span>, which takes <span class="cf class">EdgeInsetsGeometry</span> and is the same as <span class="cf class">Padding</span><span class="cf ic">.padding</span>.</p></li><li>
<p id="d24e5082"><span class="cf ic">shape</span>, which can be <span class="cf ic">BoxShape.circle</span> or <span class="cf ic">BoxShape.rectangle</span>.</p></li><li>
<p id="d24e5093"><span class="cf ic">color</span>, <span class="cf ic">image</span>, or <span class="cf ic">gradient</span>, which are used to specify the background, since the <span class="cf class">BoxDecoration</span> isn’t actually used just for the shape and, if you decide to use the <span class="cf ic">Container.decoration</span>, you need to move arguments such as <span class="cf ic">color</span> to the <span class="cf class">BoxDecoration</span>’s constructor.</p></li><li>
<p id="d24e5117"><span class="cf ic">borderRadius</span> which, when set for a rectangle-shaped box, creates rounded edges of the set <span class="cf class">BorderRadius</span>, which can be set as the same for all edges using <span class="cf methodname">BorderRadius.circular(radius)</span> (where <span class="cf ic">radius</span> is a <span class="cf ic">double</span> number).</p></li></ul>
<p id="d24e5133">Using the following <span class="cf class">Container</span> and <span class="cf class">BoxDecoration</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Container(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  width: 300.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  height: 300.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  decoration: BoxDecoration(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    shape: BoxShape.circle,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    color: Colors.black,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<em class="string">"Test Text"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        style:TextStyle(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          color: Colors.yellowAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          fontSize: 30</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e5192">You can make a circle with yellow text in it like this:</p><div class="ss"><img alt="images/WidgetLayout/oneball.png" class="border " id="d24e5194" src="/images/img15/images/WidgetLayout/oneball.png" style="width: 30%"/></div>
<p id="d24e5195">And, just to show how they can work anywhere, you can have two in a <span class="cf class">Column</span> (explained a bit further later in <a href="/links/f_0021/f_0021.xhtml#sec.layout.column">​<em>The Column</em>​</a>) in the following way (also see the <a href="#fig.twoballs">figure</a>):</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  mainAxisAlignment: MainAxisAlignment.spaceEvenly,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Container(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      width: 300.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      height: 300.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      decoration: BoxDecoration(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        shape: BoxShape.circle,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        color: Colors.black,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"The First Text"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          style:TextStyle(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            color: Colors.yellowAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            fontSize: 30</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Container(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      width: 300.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      height: 300.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      decoration: BoxDecoration(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        shape: BoxShape.circle,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        color: Colors.black,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"The Second Text"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          style:TextStyle(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            color: Colors.lightBlueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            fontSize: 30</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table><div id="fig.twoballs"><div><img alt="images/WidgetLayout/twoballs.png" class="border " id="d24e5317" src="/images/img16/images/WidgetLayout/twoballs.png" style="width: 28%"/></div></div>
<p id="d24e5319">More detailed examples of the usage of a <span class="cf class">Container</span> and <span class="cf class">BoxDecoration</span> can be found in <a href="/links/f_0021/f_0021.xhtml#sec.layout.round">​<em>Make Round Widgets</em>​</a>.



</p>,<h2 id="sec.layout.assets">Add Your Own Assets to the App</h2>
<p id="d24e5340">

Flutter allows developers to ship files with apps to, for example, use custom icons instead of the ones provided by Flutter.
You can use this feature with any kind of file.</p><h3>Where to Put the Files</h3>
<p id="d24e5354">
In the root of the app’s source tree (where <span class="cf filename">pubspec.yaml</span> resides) you’ll create one or more directories and inside those directories is where you should put the files you want to ship with your app.</p><h3>Editing pubspec.yaml</h3>
<p id="d24e5366">
Inside <span class="cf filename">pubspec.yaml</span>, locate a line that starts with <span class="cf ic">flutter</span> (if you don’t have it yet, just add it at the end of the file) and, after that, indented inside it, add another called assets, in the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">...</strong>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">flutter:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  assets:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">...</strong>​</td></tr></table>
<p id="d24e5397">Inside it, add the directories you want to load assets from, prefaced with <span class="cf ic">- </span>.</p>
<p id="d24e5402">For example, if you wanted to add a directory called <span class="cf dir">icons</span>, that would look like:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">flutter:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  assets:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    - ​<em class="string">icons/</em>​</td></tr></table>
<p id="d24e5423">For multiple directories called, for example, <span class="cf dir">dir0</span>, <span class="cf dir">dir1</span>, and <span class="cf dir">dir2</span>, you would write something like this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">flutter:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  assets:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    - ​<em class="string">dir0/</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    - ​<em class="string">dir1/</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    - ​<em class="string">dir2/</em>​</td></tr></table><h3>Using the Assets</h3>
<p id="d24e5460">

Assets are used in different ways depending on what data you want to load from them.</p><h3>Loading Various Data from the Assets</h3>
<p id="d24e5471">
To load data from a text-based asset, it needs to be part of an <span class="cf class">AssetBundle</span>, so that you can access the data using the following methods:</p><ul><li><span class="cf methodname">AssetBundle.loadString</span>, which is used to load strings from text assets.</li><li><span class="cf methodname">AssetBundle.load</span>, which is used to load bytes from a file.</li><li><span class="cf methodname">AssetBundle.loadStructuredData</span>, which is used to load any Dart type of data from a file.</li></ul>
<p id="d24e5496">



All of these return <span class="cf class">Future</span>s, so you’ll need to use the facilities described in <a href="/links/f_0087/f_0087.xhtml#sec.dart.async">​<em>Asynchronous Code in Dart: The dart:async Library</em>​</a> to get the value of the string.</p><h4 id="sec.layout.assets.bundle">Where You Can Get an AssetBundle</h4>
<p id="d24e5529">
The basic <span class="cf class">AssetBundle</span> all Flutter apps get is the <span class="cf variable">rootBundle</span>, which contains all of the assets we added to <span class="cf filename">pubspec.yaml</span>.</p>
<p id="d24e5544">This means you can load a text file off the <span class="cf variable">rootBundle</span> directly in the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">rootBundle.loadString(​<em class="string">"path/to/file.txt"</em>​)</td></tr></table>
<p id="d24e5560">

Alternatively, you can use the <span class="cf class">DefaultAssetBundle</span>, which is actually inherited from the parent <span class="cf class">MaterialApp</span> and can be changed at runtime because it isn’t a <span class="cf ic">final</span> variable like the <span class="cf variable">rootBundle</span>. The <span class="cf class">DefaultAssetBundle</span> is accessed using the:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">DefaultAssetBundle.of(context)</td></tr></table>
<p id="d24e5594">we used for the <span class="cf class">Theme</span> in the previous chapter. This syntax will be clarified when we discover the full power of the <span class="cf class">InheritedWidget</span> in <a href="/links/f_0059/f_0059.xhtml#sec.networking.inheritedwidget">​<em>InheritedWidgets</em>​</a>.</p>
<p id="d24e5604">We can load data from it by using the usual:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">DefaultAssetBundle.of(context).loadString(​<em class="string">"path/to/file.txt"</em>​)</td></tr></table>
<p id="d24e5620">

syntax, but the characterizing feature of this kind of <span class="cf class">AssetBundle</span> is that it doesn’t necessarily have to be the <span class="cf ic">rootBundle</span> (by default the <span class="cf class">DefaultAssetBundle</span> is just the <span class="cf variable">rootBundle</span>): you can create your own class that extends the <span class="cf class">CachingAssetBundle</span> interface, for example, and cache some strings you think you might want to fetch multiple times during your app’s execution or replace it with a <span class="cf class">NetworkAssetBundle</span> that loads the assets over the network.</p>
<p id="d24e5650">
You can’t take advantage of either of those classes, though, if you don’t know how to use an <span class="cf class">InheritedWidget</span> first so I recommend you stick to using either the <span class="cf ic">rootBundle</span> directly or the <span class="cf class">DefaultAssetBundle</span> and only worry about replacing the asset bundle later, when perhaps you’re sure replacing the asset bundle is the best way to do what you’re trying to achieve. If you really need to know how to do that now, <a href="/links/f_0059/f_0059.xhtml#sec.networking.inheritedwidget">​<em>InheritedWidgets</em>​</a> is another reference to the section on <span class="cf class">InheritedWidget</span>s.
</p><h4>Images</h4>
<p id="d24e5675">

To use an image in the assets you can simply use the <span class="cf ic">Image.asset</span> as described in <a href="/links/f_0020/f_0020.xhtml#sec.layout.images.assets">​<em>Displaying Images from the Assets</em>​</a>.

</p>,<h2 id="d24e5694">Displaying Images</h2>
<p id="d24e5697">Images can have different usages and they can come from different places, so displaying images in Flutter varies depending on where you want to load the images and what you need to use them for.</p>
<p id="d24e5699">


There are two classes that are used for this purpose. One is the <span class="cf class">Image</span>, which is a widget like a <span class="cf class">Text</span>, an <span class="cf class">Icon</span>, or any other widget you’ve seen until now. The other is the <span class="cf ic">ImageProvider</span>, which is needed when you need to specify an image and externally manipulate its size or shape.</p>
<p id="d24e5728">An <span class="cf ic">Image</span> widget is a representation of the image and you can add it to an app’s layout anywhere, whereas the <span class="cf ic">ImageProvider</span> class is a source for an image and it is used to form widgets with that image.</p><h3>Displaying Images from the Network</h3>
<p id="d24e5739">



If you have a URL containing an image, in the form <span class="cf ic">http://example.com/image.png</span>, you can get its corresponding <span class="cf ic">Image</span> widget by using the <span class="cf ic">Image.network</span> constructor like this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Image.network(​<em class="string">"http://example.com/image.png"</em>​)</td></tr></table>
<p id="d24e5780">You can use it anywhere any other widget (like a <span class="cf ic">Text</span> or an <span class="cf ic">Icon</span>) can be used.</p><h4>Change the Image’s Attributes</h4>
<p id="d24e5791">
You can change the following options:</p><ul><li>
<p id="d24e5799">The <span class="cf ic">scale</span>, which is a <span class="cf ic">double</span> value, and you use it to set the scale at which the image is displayed.</p></li><li>
<p id="d24e5808">The maximum <span class="cf ic">width</span> and <span class="cf ic">height</span> in pixels.</p></li><li>
<p id="d24e5817"><span class="cf ic">repeat</span>, which controls whether the image will be repeated within the <span class="cf ic">width</span> and <span class="cf ic">height</span> and is of type <span class="cf ic">ImageRepeat</span>. By default, <span class="cf ic">ImageRepeat</span> is set to <span class="cf ic">ImageRepeat.noRepeat</span>, which leaves the remaining <span class="cf ic">width</span> and <span class="cf ic">height</span> as empty or transparent. The other options are <span class="cf ic">ImageRepeat.repeatX</span> and <span class="cf ic">ImageRepeat.repeatY</span> (which control whether the image can only be repeated along one axis or the other) and <span class="cf ic">ImageRepeat.repeat</span> (which enables the image to be repeated in all directions to fit the <span class="cf ic">width</span> and <span class="cf ic">height</span>).</p></li><li>
<p id="d24e5861">The <span class="cf ic">color</span> of the background of the widget, which is shown where there is transparency. This is also used around the image if the <span class="cf ic">width</span> and <span class="cf ic">height</span> are incompatible with the image’s and repetition is not allowed.</p></li><li>
<p id="d24e5873"><span class="cf ic">headers</span> sets the headers for the HTTP request using a <span class="cf ic">Map&lt;String, String&gt;</span>.</p></li><li>
<p id="d24e5881">A <span class="cf ic">semanticLabel</span> <span class="cf ic">String</span> for screen reading accessibility services and an <span class="cf ic">excludeFromSemantics</span> <span class="cf ic">bool</span> if it’s explicitly not needed.</p></li></ul><p><strong>Use Width, Height, and Repetition Attributes to Display Images the Way You Want Them</strong></p>
<p id="d24e5901">To further clarify how <span class="cf ic">width</span>, <span class="cf ic">height</span>, and <span class="cf ic">repeat</span> are used, we’ll look at a few screenshots showing different combinations of size and repetition settings.</p>
<p id="d24e5912">If you don’t set anything at all, and just give a URL, like this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Image.network(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  url</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e5925">the image will be fitted to the view, as you can see in the first <a href="#fig.layout.image_fit">screenshot</a>.</p><div id="fig.layout.image_fit"><div><img alt="images/WidgetLayout/image_fit.png" class="border " id="d24e5931" src="/images/img17/images/WidgetLayout/image_fit.png" style="width: 38%"/></div></div>
<p id="d24e5933">If you set a width lower than the view’s width, like this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Image.network(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  url,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  width: 200.0</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e5949">the image will scale down to fit within that width (see the second <a href="#fig.image_shrunk_width">screenshot</a>).</p><div id="fig.image_shrunk_width"><div><img alt="images/WidgetLayout/image_shrunk_width.png" class="border " id="d24e5955" src="/images/img18/images/WidgetLayout/image_shrunk_width.png" style="width: 38%"/></div></div>
<p id="d24e5959">Setting a width higher than the view’s width will have no effect: the result will be the same as on the first <a href="#fig.layout.image_fit">screenshot</a>. Setting a height higher or lower than the height the image will end up being normally (given that the image is width-restricted in this case) will have the same effect as the that we’ve seen when setting the width to a value higher or lower than the width of the view.</p>
<p id="d24e5964">Things change when we set <span class="cf ic">repeat</span> to anything other than the default <span class="cf ic">ImageRepeat.noRepeat</span>: allowing for repetition makes it possible to fill a width/height ratio that is different when compared to the aspect ratio of the image that we want to display.</p>
<p id="d24e5972">If we set both a width and an height the image will be repeated on the side ending up longer than the original image’s aspect ratio—for example, if you set the height to an high value and the width to a low value and you set repetition to either <span class="cf ic">ImageRepeat.repeat</span> or <span class="cf ic">ImageRepeat.repeatY</span>, this code:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Image.network(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  url,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  width: 412.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  height: 450.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  repeat: ImageRepeat.repeatY ​<em class="comment">// or ImageRepeat.repeat</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e6002">will yield the result as seen in the first <a href="#fig.image_repeat_height">screenshot</a>, with the image vertically repeated to fit the higher height.</p><div id="fig.image_repeat_height"><div><img alt="images/WidgetLayout/image_repeat_height.png" class="border " id="d24e6009" src="/images/img19/images/WidgetLayout/image_repeat_height.png" style="width: 38%"/></div></div>
<p id="d24e6011">If, instead, you set the height and width so that the image has more horizontal space than it has content (by constraining the height more), like in this example:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Image.network(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  url,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  width: 380.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  height: 180.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  repeat: ImageRepeat.repeatX ​<em class="comment">// or ImageRepeat.repeat</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e6035">you will get the result as seen in the second <a href="#fig.image_repeat_horiz">screenshot</a>.</p><div id="fig.image_repeat_horiz"><div><img alt="images/WidgetLayout/image_repeat_horiz.png" class="border " id="d24e6041" src="/images/img20/images/WidgetLayout/image_repeat_horiz.png" style="width: 38%"/></div></div>
<p id="d24e6043">If we had just limited the height the result would be very similar, but the image would fill the entire horizontal space available by showing a bigger portion of the image in the repeated portions.
</p><h4>ImageProvider for Images from the Network</h4>
<p id="d24e6051">

When we want to use the image from the network for an <span class="cf ic">ImageProvider</span> like, for example, we will when we discuss how to make round widgets in <a href="/links/f_0021/f_0021.xhtml#sec.layout.round">​<em>Make Round Widgets</em>​</a>, we need to use the <span class="cf ic">NetworkImage</span> class.
The <span class="cf ic">NetworkImage</span> is created by passing to its contructor the URL of the image:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ imageProv = NetworkImage(​<em class="string">"http://example.com/image.png"</em>​)</td></tr></table>
<p id="d24e6084">The <span class="cf ic">NetworkImage</span> constructor also allows for setting the <span class="cf ic">scale</span> of the image and the image GET request’s HTTP <span class="cf ic">headers</span>.



</p><h3 id="sec.layout.images.assets">Displaying Images from the Assets</h3>
<p id="d24e6106">

We learned how to add assets to your Flutter app in <a href="/links/f_0019/f_0019.xhtml#sec.layout.assets">​<em>Add Your Own Assets to the App</em>​</a>, but now you’ll see the classes that are used to take the images you add there and display them.</p>
<p id="d24e6119">
Given the name of the asset you display that image asset in the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Image.asset(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"imagename.png"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table><h4>ImageProvider for Asset Images</h4>
<p id="d24e6142">

You can use images as <span class="cf ic">ImageProvider</span>s using the <span class="cf ic">AssetImage</span> class:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">AssetImage(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"imagename.png"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table><h3>Displaying Images from Memory</h3>
<p id="d24e6175">

This is used when images are stored in memory as bytes using <span class="cf ic">Image.toByteData()</span>, which stores them as a <span class="cf ic">Uint8List</span> (we’ll discuss this further in <a href="/links/f_0084/f_0084.xhtml#sec.dart.typed">​<em>Lists of Bytes and More: the dart:typed_data library</em>​</a>).
For example, to store an image called <span class="cf ic">image</span> in a variable called <span class="cf ic">bytes</span>, you would use the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ bytes = image.toByteData();</td></tr></table>
<p id="d24e6210">After you have done that, you might write that to a file or just leave it in memory.</p>
<p id="d24e6212">
If you wanted to display those bytes as an image again, you would write the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Image.memory(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  bytes</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table><h4>ImageProvider for Memory Images</h4>
<p id="d24e6232">

You can use an image stored in memory as an <span class="cf ic">ImageProvider</span> using the <span class="cf ic">MemoryImage</span> class, which is used in the following way, as you might have predicted by now:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">MemoryImage(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  bytes</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table><h3>Using an ImageProvider Inside an Image Widget</h3>
<p id="d24e6262">
As an example, we’ll use the <span class="cf ic">ImageProvider</span> to create an <span class="cf ic">Image</span> widget by passing the <span class="cf ic">ImageProvider</span> as the named <span class="cf ic">image</span> argument. This adds unnecessary complexity in this case, but it is important to understand how to create <span class="cf ic">ImageProvider</span>s to be able to understand other examples throughout the book:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Image(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  image: NetworkImage(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"http://example.com/image.png"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e6301">along with any scale, width, height, repetition, or other modifications to the image.</p>
<p id="d24e6303">The same is also true for <span class="cf ic">AssetImage</span>s and <span class="cf ic">MemoryImage</span>s, and might help to explain the difference in the data contained in an <span class="cf ic">ImageProvider</span> when compared to an <span class="cf ic">Image</span> widget.</p>,<h2 id="d24e8970">Making Grids</h2>
<p id="d24e8973">

Depending on what you need to achieve with your app, a grid can be formed in two different ways: using the <span class="cf class">GridView</span> or nested <span class="cf class">Row</span>s and <span class="cf class">Column</span>s.</p><h3 id="sec.layout.gridview">The GridView</h3>
<p id="d24e8998">The <span class="cf class">GridView</span> is to grids what the <span class="cf class">ListView</span> is to vertical layout, and it is useful for grids similar to the ones seen in photo apps: long, scrollable grids of a variable number of fixed-size elements.
A lot like a <span class="cf class">ListView</span>, it can be created using multiple constructors.
The default constructor will be discussed in the section <a href="/links/f_0026/f_0026.xhtml#sec.layout.slivers">​<em>Slivers, Custom Scrollables, and Collapsable App Bars</em>​</a>.</p><h4>Grids with a Fixed Cross-Axis Count</h4>
<p id="d24e9014">
The <span class="cf methodname">GridView.count</span> constructor takes a <span class="cf class">List</span> of <span class="cf ic">children</span> <span class="cf class">Widget</span>s and the <span class="cf ic">crossAxisCount</span> as the basic arguments to build the grid, like in the following example:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">GridView.count(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  crossAxisCount: 3,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  crossAxisSpacing: 50.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  mainAxisSpacing: 100.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  padding: EdgeInsets.all(20.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              .map(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                (n) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ​<em class="string">"</em>​​<em class="string">$n</em>​​<em class="string">"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    style: Theme.of(context).textTheme.display1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ).toList(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e9094">which produces:</p><div class="ss"><img alt="images/WidgetLayout/GridView.count.png" class="border " id="fig.layout.gridviewcount" src="/images/img36/images/WidgetLayout/GridView.count.png" style="width: 30%"/></div><h4>Grids with a Maximum Per-Widget Cross-Axis Extent</h4>
<p id="d24e9100">
The <span class="cf ic">GridView.extent</span> constructor takes a <span class="cf class">List</span> of <span class="cf ic">children</span> <span class="cf class">Widget</span>s and the <span class="cf ic">maxCrossAxisExtent</span>, which is the maximum amount of pixels each child can take up on the cross-axis. The bigger the <span class="cf ic">maxCrossAxisExtent</span> is, the bigger each tile is going to be.</p>
<p id="d24e9125">For example, the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">GridView.extent(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  maxCrossAxisExtent: 50.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  crossAxisSpacing: 50.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  mainAxisSpacing: 100.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  padding: EdgeInsets.all(20.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              .map(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                (n) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ​<em class="string">"</em>​​<em class="string">$n</em>​​<em class="string">"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    style: Theme.of(context).textTheme.display1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ).toList(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e9186">produces, on a 2880x1440 560dpi screen with default Android scaling, the following grid:</p><div class="ss"><img alt="images/WidgetLayout/Gridview.extent50.png" class="border " id="fig.layout.gridviewextent" src="/images/img37/images/WidgetLayout/Gridview.extent50.png" style="width: 30%"/></div><h4>Grids Built Using Builder Functions</h4>
<p id="d24e9192">
The <span class="cf ic">GridView.builder</span> constructor which uses  an <span class="cf ic">itemBuilder</span> to build the children and a <span class="cf ic">gridDelegate</span> for the size and position of the widgets, like the following example, which produces the same grid as the <span class="cf ic">GridView.count</span> example (<a href="#fig.layout.gridviewcount">​here​</a>):</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">GridView.builder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  padding: EdgeInsets.all(20.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemCount: 15,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    crossAxisCount: 3,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    crossAxisSpacing: 50.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    mainAxisSpacing: 100.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemBuilder: (context, i) =&gt; Text(​<em class="string">"</em>​​<em class="string">${i+1}</em>​​<em class="string">"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e9252">Grid delegates have (unusually long) names such as <span class="cf class">SliverGridDelegateWithFixedCrossAxisCount</span> and <span class="cf class">SliverGridDelegateWithMaxCrossAxisExtent</span> to get, respectively, the <span class="cf ic">GridView.count</span> and <span class="cf ic">GridView.extent</span> properties. They take grid layout-related properties as named arguments.</p>
<p id="d24e9266">If you wanted to exactly replicate the behavior of the <span class="cf ic">GridView.extent</span> shown <a href="#fig.layout.gridviewextent">​here​</a> you would write the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">GridView.builder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  padding: EdgeInsets.all(20.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemCount: 15,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  gridDelegate: SliverGridDelegateWithMaxCrossAxisExtent(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    maxCrossAxisExtent: 50.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    crossAxisSpacing: 50.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    mainAxisSpacing: 100.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemBuilder: (context, i) =&gt; Text(​<em class="string">"</em>​​<em class="string">${i+1}</em>​​<em class="string">"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table><h4>The GridView’s Properties</h4>
<p id="d24e9315">Other grid properties are:</p><ul><li>
<p id="d24e9319"><span class="cf ic">childAspectRatio</span>, which is the ratio between cross-axis and main axis size of each of the grid’s <span class="cf ic">children</span>.</p></li><li>
<p id="d24e9327"><span class="cf ic">shrinkWrap</span>, which is the same as the <span class="cf ic">ListView</span>’s (in <a href="/links/f_0021/f_0021.xhtml#sec.layout.listview.usage">​<em>How You Use It</em>​</a>).</p></li><li>
<p id="d24e9338"><span class="cf ic">scrollDirection</span>, which sets the direction along which the grid scrolls (which also serves as the main axis of the grid).

</p></li></ul><h3 id="sec.layout.rowcolumngrid">Nested Rows and Columns</h3>
<p id="d24e9348">


If, instead, you need to create a (perhaps smaller) non-scrollable grid of a fixed number of widgets you would use a <span class="cf ic">Column</span> of <span class="cf ic">Row</span>s.</p>
<p id="d24e9384">A simple 2x2 grid would be implemented in the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Text(topLeftString),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Text(topRightString),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Text(bottomLeftString),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Text(bottomRightString),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>,<h2 id="sec.layout.card">The Card</h2>
<p id="d24e9424">


The <span class="cf class">Card</span> is a Material Design component<sup><a class="footnote" href="/links/f_0028/f_0028.xhtml#FOOTNOTE-24" id="FNPTR-24">[24]</a></sup> used to visually group together (or separate) widgets.</p>
<p id="d24e9452">You can use it as part of the overall layout of an app or inside lists or grids.</p>
<p id="d24e9454">For example, this code:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">GridView.builder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  padding: EdgeInsets.all(20.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemCount: 15,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    crossAxisCount: 3,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    crossAxisSpacing: 50.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    mainAxisSpacing: 100.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemBuilder: (context, i) =&gt; Card(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    child: Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Text(​<em class="string">"</em>​​<em class="string">${i+1}</em>​​<em class="string">"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e9503">nicely shows the space available for each <span class="cf ic">GridView</span> tile on those settings:</p><div><div><img alt="images/WidgetLayout/CardGrid.png" class="border " id="d24e9509" src="/images/img38/images/WidgetLayout/CardGrid.png" style="width: 38%"/></div></div>
<p id="d24e9511">But a <span class="cf class">Card</span> is used really often inside <span class="cf class">ListView</span>s.</p>
<p id="d24e9520">An example of the usage as a generic layout element will be given when we talk about making a calculator app in Chapter 3, <a href="/links/f_0029/f_0029.xhtml#chp.calculator">​<em> Building a Calculator App </em>​</a>.</p><h3>Using Buttons Specifically Designed for Cards</h3>
<p id="d24e9527">




<span class="cf methodname">ButtonTheme.bar</span> is meant specifically for use inside <span class="cf class">Card</span>s and <span class="cf class">ExpansionTile</span>s.</p>
<p id="d24e9573">It simply groups together buttons in a <span class="cf class">Row</span> and gives them an adequate theme, like in the following example (we’re generating pseudo-pseudo-random numbers around 3200 because it’s not worth it to generate <span class="emph">real</span> pseudo-random numbers and would have yielded a less realistic result):</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ListView.builder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemBuilder: (context, i) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">var</strong>​ n = 3231-i-i*23*(i%2)-1;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Card(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      margin: EdgeInsets.all(10.0),</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                padding: EdgeInsets.all(10.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                child: CircleAvatar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  backgroundImage: NetworkImage(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ​<em class="string">"http://www.carminezacc.com/manstick.png"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ​<em class="string">"A Bot"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                style: Theme.of(context).textTheme.title,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ​<em class="string">"  @iamarealhuman</em>​​<em class="string">$n</em>​​<em class="string">"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                style: Theme.of(context).textTheme.overline,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ​<em class="string">"It might not be a human,"</em>​ +</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ​<em class="string">"but it acts almost like it would if it were a human."</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              style: Theme.of(context).textTheme.body1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            padding: EdgeInsets.symmetric(vertical: 10.0, horizontal: 8.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ButtonTheme.bar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="comment">// OPTIONAL:buttonColor: Colors.X,</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="comment">// OPTIONAL:colorScheme:</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="comment">//          ColorScheme.fromSwatch(primarySwatch: Colors.X)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            child: Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  child: Text(​<em class="string">"Follow"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  onPressed: () =&gt; Scaffold.of(context).showSnackBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    SnackBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      content: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        ​<em class="string">"Now you follow @iamarealhuman</em>​​<em class="string">$n</em>​​<em class="string">"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  child: Text(​<em class="string">"Send Message"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  onPressed: () =&gt; Scaffold.of(context).showSnackBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    SnackBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      content: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        ​<em class="string">"You can't send messages to @iamarealhuman</em>​​<em class="string">$n</em>​​<em class="string">"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e9829">which produces the following list:</p><div class="ss"><img alt="images/WidgetLayout/cardwithbuttonbar.png" class="border " id="d24e9831" src="/images/img39/images/WidgetLayout/cardwithbuttonbar.png" style="width: 38%"/></div><h3>Another Material Design Element: The Chip</h3>
<p id="d24e9835">










Since we’re talking about Material Design components, another one that is integrated into Flutter and has similar uses to the <span class="cf class">Card</span> is the <span class="cf class">Chip</span>.<sup><a class="footnote" href="/links/f_0028/f_0028.xhtml#FOOTNOTE-25" id="FNPTR-25">[25]</a></sup></p>
<p id="d24e9883">They are used really often to display contact names inside some SMS or email apps, but also for filtering, making choices, and performing actions.</p>
<p id="d24e9885">They are very small and are usually made of a round image or icon (called an <span class="cf ic">avatar</span>) and some text (called a <span class="cf ic">label</span>). It can optionally have a <span class="cf ic">deleteIcon</span> that calls the <span class="cf class">VoidCallback</span> set as the <span class="cf ic">onDelete</span> option.</p>
<p id="d24e9902">
A <span class="cf class">Chip</span> with a simple round <span class="cf class">CircleAvatar</span> and a label can be built using the following code:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Chip(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  avatar: CircleAvatar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    backgroundImage: NetworkImage(​<em class="string">"http://www.carminezacc.com/manstick.png"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  label: Text(​<em class="string">"A Bot"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e9934">and, when centered using <span class="cf class">Center</span>, produces the following:</p><div class="ss"><img alt="images/WidgetLayout/chip.png" class="border " id="d24e9939" src="/images/img40/images/WidgetLayout/chip.png" style="width: 38%"/></div>,<h2 id="sec.layout.expanded">Fill the Space Available in the View Using Expanded</h2>
<p id="d24e9943">




When using <span class="cf class">Row</span>s and <span class="cf class">Column</span>s you only use as much space as you need to and two of the same widget will always take up the same amount of space.</p>
<p id="d24e9969">If you want to use all of the space in the view and split the space among the widgets in specific ways you need to use the <span class="cf ic">Expanded</span> widget.</p><h3>How You Use It</h3>
<p id="d24e9977">

An <span class="cf ic">Expanded</span> widget can only be used inside a <span class="cf ic">Row</span> or <span class="cf ic">Column</span>, and it takes a <span class="cf ic">child</span> argument for the widget to expand and an optional integer as the <span class="cf ic">flex</span> argument.</p>
<p id="d24e10012">The <span class="cf ic">child</span> will be expanded to fill as much space as possible, and if there is more than one <span class="cf ic">Expanded</span> on the same <span class="cf ic">Row</span> or <span class="cf ic">Column</span> the space they will take up is directly proportional to their <span class="cf ic">flex</span> value.</p>
<p id="d24e10029">For example, the following code:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      flex: 5,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: (</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ...</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      flex: 2,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: (</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ...</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e10066">Will space the widgets out like this:</p><div class="ss"><img alt="images/WidgetLayout/expanded.png" class="" id="d24e10068" src="/images/img41/images/WidgetLayout/expanded.png" style="width: 30%"/></div>
<p id="d24e10069">Excluding the app bar, every green or yellow rectangle represents 1/7 of the view, the yellow part (5/7 of the view) will be taken up by the first <span class="cf ic">Expanded</span>’s child, whereas the green part (the remaining 2/7) will be where the second <span class="cf ic">Expanded</span>’s child will reside.</p>
<p id="d24e10077">We are going to make extensive use of <span class="cf class">Expanded</span> in the next chapter when we build a calculator app.



</p>,<h2 id="sec.layout.slivers">Slivers, Custom Scrollables, and Collapsable App Bars</h2>
<p id="d24e10092">We’ve already covered most of what you need to know about scrollable widgets like <span class="cf ic">ListView</span>s and <span class="cf ic">GridView</span>s, but this section is going to be a deeper dive into the sea of <span class="cf ic">Scrollable</span>, <span class="cf ic">ScrollView</span>s, <span class="cf ic">SliverList</span>s, and other lower level, more customizable widgets.
You’ll also learn how to make the app bar collapsable when the user scrolls down.</p><h3>How Flutter Determines How Far to Scroll</h3>
<p id="d24e10112">
Flutter actually simulates scrolling using a <span class="cf class">Simulation</span> widget, which simulates the movement of a point to which some forces are being applied in one-dimensional space, and the state of the simulation is used to determine scrolling position.
These forces are changed depending on the desired scrolling behavior. This is set using the <span class="cf class">ScrollPhysics</span> class, which you can use for the <span class="cf ic">physics</span> option.</p><h4>primary in a ScrollView</h4>
<p id="d24e10130">
<span class="cf ic">primary</span> is a boolean option that can be set for <span class="cf class">ScrollView</span>s.
If it is set to <span class="cf ic">false</span>, the view will only scroll if there are enough children to require scrolling.</p><h3>Make a Collapsable App Bar</h3>
<p id="d24e10148">A common sight in scrollable apps is a collapsable app bar: it is especially visible in web browsers and, in another variant, in some profile pages of chat apps.</p>
<p id="d24e10151">Usually it consists in the appbar disappearing when the user scrolls down and reappearing when the user scrolls up, usually even if the user doesn’t scroll up to the top of the scrollable view.</p>
<p id="d24e10153">

It can be implemented using a <span class="cf class">CustomScrollView</span> that contains a <span class="cf class">SliverAppBar</span> and a <span class="cf class">SliverList</span> (or, alternatively, a <span class="cf class">SliverGrid</span>).</p>
<p id="d24e10176">
A <span class="cf class">SliverList</span> is actually just a <span class="cf class">ListView</span> that uses a <span class="cf class">SliverChildDelegate</span> to generate its children like you would with <span class="cf methodname">ListView.builder</span>, but with an important twist: it is meant to be used as part of a <span class="cf class">CustomScrollView</span>, which is a particular kind of widget that is used to create a custom scrollable widget using slivers like the <span class="cf class">SliverList</span> and <span class="cf class">SliverAppBar</span>.</p>
<p id="d24e10204">To build an app with a collapsable app bar you need a normal <span class="cf class">MaterialApp</span> with a <span class="cf class">Scaffold</span>.</p>
<p id="d24e10212">The difference is that you won’t be adding an <span class="cf class">AppBar</span> to the <span class="cf class">Scaffold</span> but just using its <span class="cf ic">body</span> option and assigning it to a <span class="cf class">CustomScrollView</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    body: CustomScrollView(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      slivers: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        SliverAppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          title: Text(​<em class="string">"A collapsable AppBar"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        SliverList(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          delegate: SliverChildBuilderDelegate(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            (context, i) =&gt; ListTile(title: Text(​<em class="string">"</em>​​<em class="string">$i</em>​​<em class="string">"</em>​),),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e10279">This doesn’t actually do what we want, though: the app bar only reappears when the user scrolls to the top of the list, but that isn’t the desired behavior, so we need to set the <span class="cf class">SliverAppBar</span>’s <span class="cf ic">floating</span> option to <span class="cf ic">true</span> so that it reappears when the user scrolls up from anywhere in the list:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">SliverAppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  title: Text(​<em class="string">"A collapsable AppBar"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  floating: ​<strong class="kw">true</strong>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e10307">But this isn’t even completely the desired behavior: we want the <span class="cf class">SliverAppBar</span> to appear even if we partially scroll up, so we also need to set <span class="cf ic">snap</span> to <span class="cf ic">true</span> (which only affects anything if <span class="cf ic">floating</span> is also set to <span class="cf ic">true</span>):</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">SliverAppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  title: Text(​<em class="string">"A collapsable AppBar"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  floating: ​<strong class="kw">true</strong>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  snap: ​<strong class="kw">true</strong>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>,<h2 id="sec.layout.key">The Key</h2>
<p id="d24e10348">



The Key is used to uniquely identify a widget and it is used by the framework to update the elements that actually need to be updated.</p>
<p id="d24e10360">You usually won’t be using keys, since the framework will take care of them by itself, but you can use them to have greater control of widget state and updates.</p>
<p id="d24e10362">In addition to that, there are widgets that explicitly ask for a key, like the <span class="cf class">Dismissible</span>s we encountered in <a href="/links/f_0021/f_0021.xhtml#sec.layout.dismissible">​<em>Dismissible ListTiles</em>​</a>.</p><h3>Many Keys for the Same Keyhole</h3>
<p id="d24e10372">There are many kinds of <span class="cf class">Key</span>s, and some are actually more useful than the plain <span class="cf ic">Key</span> constructor, which takes as a named argument a <span class="cf class">String</span> that must be unique within the widget’s parent.</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ExampleWidget(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  key: Key(​<em class="string">"example"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e10394"><span class="cf ic">GlobalKey</span>s also exist and, because of their global scope, they have to be absolutely unique.</p>
<p id="d24e10398"><span class="cf ic">GlobalKey</span>s allow for widgets to be moved to be a child of a completely different parent while preserving its state.</p>
<p id="d24e10402">There also are <span class="cf ic">LocalKey</span>s, which have the same scope as the normal <span class="cf ic">Key</span>s, but have a few different constructors:</p><ul><li>The <span class="cf ic">ValueKey</span>, which takes a value of any type, not just a <span class="cf ic">String</span>.</li><li>The <span class="cf ic">UniqueKey</span>, which takes no value at all and is always unique (what we used in <a href="/links/f_0021/f_0021.xhtml#sec.layout.dismissible">​<em>Dismissible ListTiles</em>​</a>).</li></ul><h3>Using Keys</h3>
<p id="d24e10431">Most of the time, you don’t need to use <span class="cf class">Key</span>s; they only become necessary when widgets require you to set a <span class="cf class">Key</span>, as happened when we talked about the <span class="cf class">Dismissible</span> in <a href="/links/f_0021/f_0021.xhtml#sec.layout.dismissible">​<em>Dismissible ListTiles</em>​</a>.
</p>,<h2 id="d24e10445">Where We’re Going Next</h2>
<p id="d24e10448">In the next chapter we’ll be using some of the layout widgets we’ve seen in this chapter together to build a calculator app.</p>

<div class="footnotes">
<h4>Footnotes</h4>
<dl>
<dt class="footnote-number"><a href="/links/f_0021/f_0021.xhtml#FNPTR-21" id="FOOTNOTE-21">[21]</a></dt><dd>
<p id="d24e6818"><a href="https://material.io/design/components/dividers.html">https://material.io/design/components/dividers.html</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0021/f_0021.xhtml#FNPTR-22" id="FOOTNOTE-22">[22]</a></dt><dd>
<p id="d24e7535"><a href="https://pragprog.com/favicon.png">https://pragprog.com/favicon.png</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0021/f_0021.xhtml#FNPTR-23" id="FOOTNOTE-23">[23]</a></dt><dd>
<p id="d24e8091"><a href="https://material.io/design/components/snackbars.html#anatomy">https://material.io/design/components/snackbars.html#anatomy</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0024/f_0024.xhtml#FNPTR-24" id="FOOTNOTE-24">[24]</a></dt><dd>
<p id="d24e9448"><a href="https://material.io/design/components/cards.html">https://material.io/design/components/cards.html</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0024/f_0024.xhtml#FNPTR-25" id="FOOTNOTE-25">[25]</a></dt><dd>
<p id="d24e9880"><a href="https://material.io/design/components/chips.html">https://material.io/design/components/chips.html</a></p></dd></dl></div>
<div class="copyright">Copyright © 2020, The Pragmatic Bookshelf.</div>,<h1 class="chapter-title" id="chp.calculator"><span class="chapter-number">
            Chapter
            3</span><br/><span class="chapter-name"> Building a Calculator App </span></h1>

<p id="d24e10456">Whew! You’ve learned a lot about the tools available to you in Flutter. Shall we put them to use? As promised, this chapter will focus on building a calculator app, using some of the structures and elements we saw throughout the previous chapter.</p>
<p id="d24e10458">We’ll start writing our app by showing you how to go from an empty file to a working Flutter app.</p>
<p id="d24e10460">




This time, create a Flutter project using the <span class="cf commandname">flutter create appname</span> command or your IDE of choice, but this time delete everything inside the generated <span class="cf filename">main.dart</span>.</p>,<h2 id="d24e10495">Importing Basic Dependencies</h2>
<p id="d24e10498">



The first thing you should always do is import the dependencies.</p>
<p id="d24e10519">In this case, we just need the same Flutter Material library that we used in the previous chapter:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/main.dart">layout/calculator/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">"package:flutter/material.dart"</em>​;</td></tr></table>,<h2 id="d24e10530">Writing main</h2>
<p id="d24e10533">
Let’s start from the simplest and least specific part of our app: the <span class="cf ic">main</span> function.</p><h3>Using a Wrapper Class</h3>
<p id="d24e10548">

In the previous chapter we defined a <span class="cf ic">MyApp</span> class and used <span class="cf ic">main</span> simply to run it, in the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">main</strong>​() =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  runApp(MyApp());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyApp ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build (BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ MaterialApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="comment">// Actual app content and data</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3>Skipping the Wrapper Class</h3>
<p id="d24e10605">The same effect would be achieved by simply writing:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">main</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  runApp(MaterialApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// other app content and data</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e10626">This looks a lot shorter, but in a larger app it isn’t really much by comparison.</p>
<p id="d24e10628">If your app is entirely contained in one view it doesn’t compromise app functionality, but if you need more views and need to have shared data you should consider writing a wrapper class for your app to keep things organized and clear.

</p>
<p id="d24e10633">And, in any case, you should only use the second form if you really need to keep your code compact or to save time to quickly write a small app.</p>
<p id="d24e10635">So we will write the following:


</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/main.dart">layout/calculator/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">main</strong>​() =&gt; runApp(MyApp());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyApp ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ MaterialApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      title: ​<em class="string">"Flutter Calculator"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      theme: ThemeData(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        primarySwatch: Colors.blue,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        backgroundColor: Colors.black26</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      home: CalculatorHomePage(title: ​<em class="string">"Flutter Calculator"</em>​, ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>,<h2 id="d24e10698">The Calculator’s Home Page</h2>
<p id="d24e10701">

The home page will be stateful because it will have to reflect user interactions and input, so we’ll define a simple <span class="cf ic">StatefulWidget</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/main.dart">layout/calculator/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ CalculatorHomePage ​<strong class="kw">extends</strong>​ StatefulWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  CalculatorHomePage({Key key, ​<strong class="kw">this</strong>​.title}) : ​<strong class="kw">super</strong>​(key: key);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ title;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  _CalculatorHomePageState createState() =&gt; _CalculatorHomePageState();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e10750">and its state:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/main.dart">layout/calculator/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ _CalculatorHomePageState ​<strong class="kw">extends</strong>​ State&lt;CalculatorHomePage&gt; {</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>,<h2 id="d24e10765">How the App Will Be Structured</h2>
<p id="d24e10768">We will be using a separate file with a separate <span class="cf ic">Calculation</span> class to actually carry out calculations—implementing, adding, and deleting numbers and operators and computing expressions.</p>
<p id="d24e10773">We will worry about that in <a href="/links/f_0041/f_0041.xhtml#sec.calculator.calculation">​<em>Implement the Calculations</em>​</a>.</p><h3>Layout</h3>
<p id="d24e10780">

The base layout of the app will be the following:</p><div class="ss"><img alt="images/WidgetLayout/calclayout.png" class="" id="d24e10791" src="/images/img42/images/WidgetLayout/calclayout.png" style="width: 27%"/></div>
<p id="d24e10792">It is a simple calculator, and it can be implemented using the following Flutter layout structures:</p><div class="ss"><img alt="images/WidgetLayout/calcstructure.png" class="" id="fig.layout.calcstructure" src="/images/img43/images/WidgetLayout/calcstructure.png"/></div>
<p id="d24e10795">Representing Flutter apps as trees is a very effective way to visualize the layout of a Flutter app.</p>
<p id="d24e10797">In this case, the app’s main structure will be a <span class="cf class">Column</span> with three children:</p><ul><li>
<p id="d24e10804">The calculator’s screen, which will a <span class="cf ic">Card</span> with some <span class="cf ic">Text</span> on it.</p></li><li>
<p id="d24e10813">A <span class="cf class">Row</span> containing the button that deletes the entire expression and the button that deletes one character at a time, which will be a couple of <span class="cf class">FlatButton</span>s.</p></li><li>
<p id="d24e10822">A <span class="cf class">Row</span> for the rest of the calculator’s buttons, which contains two <span class="cf class">Column</span> widgets: one for the three columns containg the numbers (which is made up of four <span class="cf class">Row</span>s of four buttons each), and one for the column containing the operator buttons.</p></li></ul>
<p id="d24e10833">To make the layout look and work better, we will be making expansive (no pun intended) use of the <span class="cf class">Expanded</span>, but that will come later on in <a href="/links/f_0039/f_0039.xhtml#sec.calculator.expanded">​<em>Make the App Look and Work Right with Expanded</em>​</a>.
</p>,<h2 id="d24e10842">Implement the Basic Layout</h2>
<p id="d24e10845">


Inside <span class="cf class">_CalculatorHomePageState</span>’s curly braces, we’ll define a <span class="cf ic">build</span> method with the usual <span class="cf class">Scaffold</span> and <span class="cf class">AppBar</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator_part1/lib/main.dart">layout/calculator_part1/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">return</strong>​ ​<strong class="kw">Scaffold</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    title: Text(widget.title),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e10908">



The <span class="cf ic">Scaffold</span>’s <span class="cf ic">body</span> will be the following:</p><table class="processedcode" id="code.layout.calculator.basiclayout"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">body: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  crossAxisAlignment: CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calculatorScreen,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      crossAxisAlignment: CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      crossAxisAlignment: CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          crossAxisAlignment: CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              crossAxisAlignment:  CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              crossAxisAlignment:  CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              children:&lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              crossAxisAlignment:  CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              crossAxisAlignment:  CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          crossAxisAlignment: CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e11073">The <span class="cf class">CrossAxisAlignment</span> options are meant to stretch the widgets out wherever possible.</p>
<p id="d24e11078">What that alone can’t do will be done by <span class="cf class">Expanded</span> (we’ll talk about <span class="cf class">Expanded</span> after we have defined the layout elements).





</p>,<h2 id="sec.calculator.screencard">Let’s Give the Calculator a Screen</h2>
<p id="d24e11101">
Obviously the <span class="cf ic">calculatorScreen</span> at the top of the <span class="cf ic">Column</span> is just a placeholder; we need to replace it with a real, working screen that will be composed of the following: a wrapping and a <span class="cf class">Card</span> and, inside it, a padded <span class="cf class">Text</span> displaying a <span class="cf class">String</span>, which represents the expression or result to be displayed.</p>
<p id="d24e11122">But, before adding that, we need to declare that <span class="cf class">String</span> inside the <span class="cf class">_CalculatorHomePageState</span> declaration, above the <span class="cf ic">@override</span> keyword preceding the build method declaration:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator_part1/lib/main.dart">layout/calculator_part1/lib/main.dart</a></div><table class="processedcode" id="code.layout.calculator.strDef"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ _str = ​<em class="string">"0"</em>​;</td></tr></table>
<p id="d24e11142">

After you’ve done that, replace <span class="cf ic">calculatorScreen</span> (from the <a href="/links/f_0034/f_0034.xhtml#code.layout.calculator.basiclayout">​code​</a><a href="/links/f_0034/f_0034.xhtml#code.layout.calculator.basiclayout">​​</a>) with:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator_part1/lib/main.dart">layout/calculator_part1/lib/main.dart</a></div><table class="processedcode" id="code.layout.calculator.screen"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Card(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  color: Colors.lightGreen[50],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    padding: EdgeInsets.all(15.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      _str,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      textScaleFactor: 2.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e11188">Where <span class="cf ic">Colors.lightGreen[50]</span> is a very low intensity light green.</p>
<p id="d24e11193">Color intensity (50, in this case) is specified on a scale where 500 is normal intensity (like using <span class="cf ic">Colors.lightGreen</span>) and higher numbers are higher intensity colors, usually used for accent color purposes.</p>,<h2 id="d24e11199">Add the Deletion Row</h2>
<p id="d24e11202">
The first <span class="cf ic">Row</span> widget is going to contain the button used to delete a single character and the button used to delete the entire expression.</p>
<p id="d24e11211">All of the buttons in the app are going to call <span class="cf class">_CalculatorHomePageState</span> methods, so we need to define them.
So, directly below <a href="/links/f_0035/f_0035.xhtml#code.layout.calculator.strDef">​code​</a><a href="/links/f_0035/f_0035.xhtml#code.layout.calculator.strDef">​​</a>, add the following empty method definitions, which we will fill up after we define the class to handle the calculations in <a href="/links/f_0042/f_0042.xhtml#sec.calculator.usingCalc">​<em>Use the Calculation Inside the App</em>​</a>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator_part1/lib/main.dart">layout/calculator_part1/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">add</strong>​(​<strong class="kw">String</strong>​ a) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">deleteAll</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">deleteOne</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">getResult</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e11264">

Going back to app layout definition, the buttons will be <span class="cf ic">FlatButton</span>s, which you’ll add to the first <span class="cf class">Row</span> widget you can see in the <a href="/links/f_0034/f_0034.xhtml#code.layout.calculator.basiclayout">​code​</a><a href="/links/f_0034/f_0034.xhtml#code.layout.calculator.basiclayout">​​</a> by inserting, inside the square brackets of that <span class="cf class">Row</span>’s <span class="cf variable">children</span> attribute, the following code:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator_part1/lib/main.dart">layout/calculator_part1/lib/main.dart</a></div><table class="processedcode" id="code.layout.calculator.delete"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">'C'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  onPressed: (){deleteAll();},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  color: Colors.black54,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">'&lt;-'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    style: TextStyle(color: Colors.white)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  onPressed: (){deleteOne();},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  color: Colors.black87,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e11345">Using this code will result in the button on the left (delete all) being gray and the one on the right (delete one character) being black.</p>
<p id="d24e11347">That is because the number after the color name (which is used in this manner only with black and white) specifies how transparent they are; a low number means that they are very transparent and almost invisible and a high number is used to make something very opaque.</p>,<h2 id="d24e12065">Why a GridView Wouldn’t Work</h2>
<p id="d24e12068">
<span class="cf class">GridView</span>s are meant for something completely different: building scrollable, probably variable grids that usually have more widgets than could be displayed comfortably in a non-scrollable grid.</p>
<p id="d24e12077">What we are doing here is simply displaying a small, fixed amount of I/O widgets in both the vertical and horizontal axis, which you should do using nested <span class="cf class">Row</span>s and <span class="cf class">Column</span>s.</p>,<h2 id="sec.calculator.expanded">Make the App Look and Work Right with Expanded</h2>
<p id="d24e12088">

Currently, the app wouldn’t look right if you ran it on a device.</p>
<p id="d24e12099">To make the buttons of the right shape and size, we need to wrap <span class="cf class">Row</span>s, <span class="cf class">Column</span>s, and the buttons themselves in <span class="cf class">Expanded</span>.</p><h3>Expand Elements to Divide the Space Inside the Main Column</h3>
<p id="d24e12113">We’ll expand some elements to make them exactly as big as we want them to be.</p>
<p id="d24e12116">In this case, the main <span class="cf class">Column</span> will be divided in the following way:</p><ul><li>2/7 of the space will be taken up by the calculator screen.</li><li>1/7 of the space will be taken up by the deletion row.</li><li>The remaining 4/7 of the space (four times as much as the deletion row) will be taken up by the numbers and operators, so that every button (including the delete buttons) is of the same height.</li></ul>
<p id="d24e12131">
As was explained in <a href="/links/f_0025/f_0025.xhtml#sec.layout.expanded">​<em>Fill the Space Available in the View Using Expanded</em>​</a>, the <span class="cf class">Expanded</span> widget makes this really simple, requiring you to replace the calculator screen shown in the <a href="/links/f_0035/f_0035.xhtml#code.layout.calculator.screen">​code​</a><a href="/links/f_0035/f_0035.xhtml#code.layout.calculator.screen">​​</a> with this:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator_part2/lib/main.dart">layout/calculator_part2/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  flex: 2,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: Card(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    color: Colors.lightGreen[50],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    child: Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      padding: EdgeInsets.all(15.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        _str,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        textScaleFactor: 2.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e12183">
Similarly, the first <span class="cf class">Row</span> widget (the one containing the delete buttons, shown in the <a href="/links/f_0036/f_0036.xhtml#code.layout.calculator.delete">​code​</a><a href="/links/f_0036/f_0036.xhtml#code.layout.calculator.delete">​​</a>) will have to be replaced with:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  flex: 1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ...</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e12212">and the one containing the number buttons (shown in the <a href="/links/f_0037/f_0037.xhtml#code.layout.calculator.numbers">​code​</a><a href="/links/f_0037/f_0037.xhtml#code.layout.calculator.numbers">​​</a>) will similarly have to be replaced with:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  flex: 4,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ...</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table><h3>Expand Elements to Divide the Space Inside the Deletion Row</h3>
<p id="d24e12234">
Three quarters of the space will be taken up by the <span class="emph">delete all</span> button and one quarter by the <span class="emph">delete one</span> button.</p>
<p id="d24e12250">This means that those two <span class="cf class">FlatButton</span>s will have to be expanded by replacing them with <span class="cf class">FlatButton</span>s wrapped in two <span class="cf class">Expanded</span> widgets with <span class="cf ic">flex</span> values of, respectively, 3 and 1:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator_part2/lib/main.dart">layout/calculator_part2/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  flex: 3,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="string">'C'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    onPressed: (){deleteAll();},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    color: Colors.black54,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  flex: 1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="string">'&lt;-'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      style: TextStyle(color: Colors.white)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    onPressed: (){deleteOne();},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    color: Colors.black87,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table><h3>Expand Elements to Divide the Space Inside the Number and Operator Grid</h3>
<p id="d24e12335">
Similarly, you will need to expand the numbers’ <span class="cf class">Column</span> with a <span class="cf ic">flex</span> of 3 and the operators’ <span class="cf class">Column</span> with a <span class="cf ic">flex</span> of 1 to make the buttons all of the same size.</p><h3>Create ExpandedRow and ExpandedButton for the Rest of the Buttons</h3>
<p id="d24e12360">
The number and operator buttons should all be of the same size, so they should all be wrapped in <span class="cf class">Expanded</span> widgets with the same <span class="cf ic">flex</span> which, for simplicity, we’ll set to the value 1.</p>
<p id="d24e12374">The same is true for the <span class="cf class">Row</span>s of number buttons: they all need to be expanded with the same <span class="cf ic">flex</span>.</p>
<p id="d24e12382">To avoid repetition and to speed up replacement of many widgets, we’ll build expanded <span class="cf class">FlatButton</span> and <span class="cf class">Row</span> classes, which will be called <span class="cf class">ExpandedButton</span> and <span class="cf class">ExpandedRow</span>.</p>
<p id="d24e12396">They need to take all of the arguments and options we currently use, and build the corresponding widgets wrapped in <span class="cf class">Expanded</span>.</p>
<p id="d24e12401">They are defined, very simply, above <span class="cf methodname">main</span>, in the following way:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator_part2/lib/main.dart">layout/calculator_part2/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ExpandedButton ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ExpandedButton({​<strong class="kw">this</strong>​.onPressed, ​<strong class="kw">this</strong>​.child, ​<strong class="kw">this</strong>​.color});</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ Widget child;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ VoidCallback onPressed;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ Color color;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      flex:1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        onPressed: onPressed,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: child,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        color: color,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ExpandedRow ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ExpandedRow({​<strong class="kw">this</strong>​.children, ​<strong class="kw">this</strong>​.crossAxisAlignment});</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ List&lt;Widget&gt; children;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ CrossAxisAlignment crossAxisAlignment;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      flex:1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        children: children,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        crossAxisAlignment: crossAxisAlignment,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e12534">After defining them, simply replace all of the operator button’s <span class="cf class">Row</span> widgets with <span class="cf class">ExpandedRow</span> widgets and all of the operator and number <span class="cf class">FlatButton</span>s and the calculator’s layout should be complete.
</p>,<h2 id="sec.calculator.usingCalc">Use the Calculation Inside the App</h2>
<p id="d24e15365">



Import the <span class="cf class">Calculation</span> into the main source code by adding, at the top of <span class="cf filename">main.dart</span>, the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">"calculator.dart"</em>​;</td></tr></table>
<p id="d24e15395">You need to define a <span class="cf class">Calculation</span> object for the <span class="cf class">_CalculatorHomePageState</span> so, below:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/main.dart">layout/calculator/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ _str = ​<em class="string">"0"</em>​;</td></tr></table>
<p id="d24e15412">You need to add:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/main.dart">layout/calculator/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ _calculation = Calculation();</td></tr></table>
<p id="d24e15420">You will also need to properly implement the <span class="cf class">_CalculatorHomePageState</span>’s <span class="cf methodname">add</span>, <span class="cf methodname">deleteOne</span>, and <span class="cf methodname">deleteAll</span> methods, which will have to be calls to <span class="cf methodname">setState</span> and the <span class="cf class">Calculation</span> methods, like this:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/main.dart">layout/calculator/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">add</strong>​(​<strong class="kw">String</strong>​ a) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  setState((){</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    _calculation.add(a);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    _str = _calculation.getString();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">deleteAll</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    _calculation.deleteAll();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    _str = _calculation.getString();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">deleteOne</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    _calculation.deleteOne();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    _str = _calculation.getString();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">getResult</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    _str = _calculation.getResult().toString();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  _calculation = ​<strong class="kw">new</strong>​ Calculation();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>,<h2 id="d24e16643">What If We Try to Divide by 0?</h2>
<p id="d24e16646">


We worried about the expression being malformed (syntax errors), but we didn’t worry about mathematical errors.</p>
<p id="d24e16658">When writing a calculator in most programming languages (especially if using integer arithmetic, which isn’t our case), making an app like ours (that doesn’t compute square root or trigonometric functions) leaves us exposed to one thing that could make it crash: dividing by 0.</p>
<p id="d24e16660">Dart, when using floating-point arithmetic like in our case, is smart enough to display the word <span class="emph">Infinity</span> instead of a result; this is nice because it doesn’t cause the app to crash, but some could argue that it isn’t really the correct answer in most cases: as the divisor approaches 0 the quotient approaches infinity, but division by zero in itself is impossible, so you might choose to display an error if you were making a calculator and were so inclined.</p>
<p id="d24e16665">If that is the case, you would need to add a condition to each calculation in <span class="cf methodname">Calculation.getResult</span> to check whether there is an attempt at division by 0, throw an exception and catch it in the calling method.</p><div class="sidebar"><div class="sidebar-title">
		Throwing and Catching Exceptions
	</div><div class="sidebar-content">
<p id="d24e16673">
		This section can be considered an anticipation of <a href="/links/f_0071/f_0071.xhtml#sec.testing.errors">​<em>Throwing and Catching Exceptions</em>​</a>, we are not going to cover the topic in detail and if you are not used to this kind of programming language feature, you should consider reading that first, and then reading this section.
	</p></div></div><h3>Define the Exception</h3>
<p id="d24e16681">

An exception in Dart is defined as a subclass of <span class="cf class">Exception</span>, in the following way:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator_error_if_divideby0/lib/calculator.dart">layout/calculator_error_if_divideby0/lib/calculator.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ DivideByZeroException ​<strong class="kw">implements</strong>​ Exception {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3>Throw the Exception</h3>
<p id="d24e16710">

That exception can be thrown by using:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">throw</strong>​ ​<strong class="kw">DivideByZeroException</strong>​();</td></tr></table>
<p id="d24e16730">In this specific case, inside the definition of <span class="cf methodname">Calculation.getResult</span> in <span class="cf filename">calculator.dart</span>, at the point where we handle divisions (where you find <span class="cf ic">else if(a[i] == "÷") {</span>), we’ll add:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator_error_if_divideby0/lib/calculator.dart">layout/calculator_error_if_divideby0/lib/calculator.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">if</strong>​(​<strong class="kw">double</strong>​.parse(a[i+1]) == 0)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">throw</strong>​ DivideByZeroException();</td></tr></table>
<p id="d24e16759">so the part of <span class="cf methodname">getResult</span> that handles divisions and multiplications becomes:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator_error_if_divideby0/lib/calculator.dart">layout/calculator_error_if_divideby0/lib/calculator.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">for</strong>​(​<strong class="kw">int</strong>​ i = 0; i &lt; a.length; i++) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(a[i] == ​<em class="string">"x"</em>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a[i-1] = ​<em class="string">"</em>​​<em class="string">${double.parse(a[i-1]) * double.parse(a[i+1])}</em>​​<em class="string">"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    i--;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  } ​<strong class="kw">else</strong>​ ​<strong class="kw">if</strong>​(a[i] == ​<em class="string">"÷"</em>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(​<strong class="kw">double</strong>​.parse(a[i+1]) == 0)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">throw</strong>​ DivideByZeroException();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a[i-1] = ​<em class="string">"</em>​​<em class="string">${double.parse(a[i-1]) / double.parse(a[i+1])}</em>​​<em class="string">"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    i--;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3>Catch the Exception</h3>
<p id="d24e16863">

Exceptions in Dart are caught using:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">try</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  code_that_might_generate_exceptions();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">} ​<strong class="kw">catch</strong>​(exception) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  print(​<em class="string">"</em>​​<em class="string">$exception</em>​​<em class="string">"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e16898">This code catches any kind of exception; if you wanted to catch only certain types of exceptions you would use:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">try</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  code_that_might_generate_exceptions();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">} on ExceptionClass ​<strong class="kw">catch</strong>​(exception) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  print(​<em class="string">"</em>​​<em class="string">$exception</em>​​<em class="string">"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e16924">And if you don’t need to use the value of the exception you would leave out the <span class="cf ic">catch(exception)</span> part:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">try</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  code_that_might_generate_exceptions();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">} on ExceptionClass {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  print(​<em class="string">"you did something bad"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e16946">In the specific case, the code that might generate exceptions is the <span class="cf ic">_str = _calculation.getResult().toString()</span> function call and assignment and we want to set <span class="cf ic">_str</span> to something like <span class="emph">You mustn’t divide by 0</span>.</p>
<p id="d24e16958">The <span class="cf methodname">getResult</span> method will therefore become:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator_error_if_divideby0/lib/main.dart">layout/calculator_error_if_divideby0/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">getResult</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">try</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      _str = _calculation.getResult().toString();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    on DivideByZeroException {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      _str = ​<em class="string">"You mustn't divide by 0"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    } ​<strong class="kw">finally</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      _calculation = ​<strong class="kw">new</strong>​ Calculation();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e17014">Adding a <span class="cf ic">finally</span> clause to reset the calculation regardless of whether or not the exception was thrown.

</p>,<h2 id="d24e17022">Where We’re Going Next</h2>
<p id="d24e17025">In the next chapter we’ll learn how to do things that go beyond the Flutter standard library using packages and plugins and how to make your own library and publish it on Dart Pub.</p>

<div class="footnotes">
<h4>Footnotes</h4>
<dl>
<dt class="footnote-number"><a href="/links/f_0037/f_0037.xhtml#FNPTR-26" id="FOOTNOTE-26">[26]</a></dt><dd>
<p id="d24e11866"><a href="http://www.carminezacc.com/divide.png">http://www.carminezacc.com/divide.png</a></p></dd></dl></div>
<div class="copyright">Copyright © 2020, The Pragmatic Bookshelf.</div>,<h1 class="chapter-title" id="chp.packages"><span class="chapter-number">
            Chapter
            4</span><br/><span class="chapter-name"> Beyond the Standard Library: Plugins and Packages </span></h1>

<p id="d24e17033">Up until now we’ve seen how to build apps using just Flutter’s standard library, but now we’ll discover that we can go beyond it, and do things that we would have had a hard time doing before, or that we couldn’t even do at all: let’s talk about Flutter packages.</p>,<h2 id="d24e17035">An Introduction to Packages</h2>
<p id="d24e17038">

Like many languages, Dart allows developers to share modular code, which can be used by other developers to easily get commonly needed functionality that would otherwise require a complicated solution.</p>
<p id="d24e17045">There are many generic Dart packages we can use to achieve functionality that is useful to both web applications and Flutter mobile apps, but there are also Flutter-specific packages, which use Flutter-specific features and only work with Flutter apps.</p>
<p id="d24e17047">

Generally, packages are written in Dart and are very similar to other languages’ packages and libraries, but can communicate with device-specific Android/iOS code, which would make them <span class="emph">plugin packages</span>.</p><h3>Finding Packages: Using Dart Pub</h3>
<p id="d24e17062">

You can find packages by going to the <span class="firstuseinline">Dart Pub</span> homepage<sup><a class="footnote" href="/links/f_0052/f_0052.xhtml#FOOTNOTE-27" id="FNPTR-27">[27]</a></sup> and searching in the “Flutter” and “All” categories.</p>
<p id="d24e17081">In the home page you will find the most commonly used packages, many of which are made by Google developers.
Clicking on a package allows you to find usage information, how to install the package and a changelog.</p><h3>Installing Packages</h3>
<p id="d24e17086">
Once you’ve found a package you think you might want, you need to install it.</p>
<p id="d24e17094">
Dart packages get installed when they are specified as a dependency of an app, and you can do this by editing the <span class="cf filename">pubspec.yaml</span> file.</p><h4>The Simple Way</h4>
<p id="d24e17106">Installing a package is very easy: you just need to edit the <span class="emph">dependencies</span> section of the <span class="cf filename">pubspec.yaml</span> file and add the string from the <span class="emph">Installing</span> section of the package in Pub.
The strings you find there look like this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">packagename: ​<em class="string">^version</em>​</td></tr></table>
<p id="d24e17125">
And need to be added in <span class="cf filename">pubspec.yaml</span>, indented on the same level as the <span class="cf ic">flutter:</span> line, after the lines that look like the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">dependencies:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  flutter:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    sdk: ​<em class="string">flutter</em>​</td></tr></table>
<p id="d24e17155">
The IDE plugins download the packages automatically when you edit the file, but you can make Flutter download or update the dependencies by running the following command:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">$ flutter packages get</td></tr></table>
<p id="d24e17167">

All that’s left to do is to import the package in your Dart file by adding, at the top of the file, the following line:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:packagename/filename.dart'</em>​;</td></tr></table>
<p id="d24e17188">The file name is the same as the package name in most cases, but it’s better to check on Pub, since it’s usually specified in the <span class="emph">README.md</span>, <span class="emph">Example</span>, or <span class="emph">Installing</span> sections. If you’re using the official IDE plugins the correct file name will also be suggested by the IDE.</p>
<p id="d24e17199"><span class="cf ic">import</span> also has more features, which are explained in <a href="/links/f_0092/f_0092.xhtml#sec.dart.import">​<em>Mastering import</em>​</a>.</p>
<p id="d24e17205">That’s all you need to know if the package developers are using semantic versioning correctly and you just want to get all of the updates for the package that won’t break your code, but there are cases in which simply copying and pasting from Pub to the dependencies isn’t ideal or doesn’t work at all.</p><h4>Specifying the Package Version Manually</h4>
<p id="d24e17210">
Understanding how to specify dependencies manually could be useful, for example, when you want to update to the next version, even if you need to change your code.</p>
<p id="d24e17216">It could also be useful when you want a specific package version or always the latest package version, like would happen when you are the package developer.</p><p><strong>Caret Syntax</strong></p>
<p id="d24e17221">

The line we saw before declares that the project is dependent on the latest version of the package from Pub that is declared to be compatible with the version specified.
For example, <span class="cf ic">^0.1.0</span> means any version in the 0.1 group, and <span class="cf ic">^1.2.3</span> means any version greater than or equal to 1.2.3 and less than 2.0.0.
This is the most common way to specify the package version, and it is called <span class="firstuseinline"> caret syntax </span>.</p><p><strong>Other Ways to Specify the Package Version</strong></p>
<p id="d24e17240">

The package versions can also be specified using mathematical comparison operators (for example, <span class="cf ic">&gt;=0.5.9</span> will use any version starting from 0.5.9).</p>
<p id="d24e17254">These operators can also be combined (for example, you can use something like <span class="cf ic">&gt;=0.5.9 &lt;2.5.3</span>).</p>
<p id="d24e17259">You can also use just:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">packagename:</td></tr></table>
<p id="d24e17267">or:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">packagename: ​<em class="string">any</em>​</td></tr></table>
<p id="d24e17277">if you want Flutter to download the latest version it can find, with no restrictions.

</p><h4 id="sec.packages.nopub">Fetching Packages from Locations Other Than Pub</h4>
<p id="d24e17285">The version isn’t the only thing that you can specify in the dependencies list: if you don’t want the package to be fetched from Pub, you can also specify where you want the package to be fetched from, which you might find useful, for example, when testing a new version that hasn’t yet been published or when using a package that isn’t on Pub at all.</p><p><strong>Fetching from Git</strong></p>
<p id="d24e17290">

For example, you can fetch the package from a Git repository:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">packagename:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  git:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    url: ​<em class="string">git://github.com/username/packagename.git</em>​</td></tr></table>
<p id="d24e17320">If the package isn’t in the root of the Git repository, you can specify a path within the repository where the package is located:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">packagename:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  git:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    url: ​<em class="string">git://github.com/username/packagename.git</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    path: ​<em class="string">path/to/pkg</em>​</td></tr></table><p><strong>Fetching from a Local Path</strong></p>
<p id="d24e17350">
You can also fetch the package from a path in your local development environment:


</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">packagename:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  path: ​<em class="string">../packagename/</em>​</td></tr></table>,<h2 id="sec.packages.publishing">Publishing a Package to Pub</h2>
<p id="d24e19694">

Before you publish a package, you need to make sure you’ve filled in the package name, version, description, and any other information that you want to specify in <span class="cf filename">pubspec.yaml</span>, using Appendix 2, <a href="/links/f_0095/f_0095.xhtml#chp.pubspec">​<em> Apple-Like Look and Additional App Configuration </em>​</a> as a reference.</p>
<p id="d24e19710">
A <span class="cf filename">LICENSE</span> file is also required.</p>
<p id="d24e19719">
If you don’t know what license to use, the Dart developers recommend the two-clause BSD license,<sup><a class="footnote" href="/links/f_0052/f_0052.xhtml#FOOTNOTE-30" id="FNPTR-30">[30]</a></sup> but there are many resources online to compare licenses, like choosealicense.com<sup><a class="footnote" href="/links/f_0052/f_0052.xhtml#FOOTNOTE-31" id="FNPTR-31">[31]</a></sup> by GitHub.</p>
<p id="d24e19733">
You should also create a <span class="cf filename">README.md</span> file, as this will be used as a home page for your package in Pub.</p>
<p id="d24e19742">
At this point, simply run:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">pub publish</td></tr></table>
<p id="d24e19752">in the command line and, if you have done everything correctly, your package will be publicly available on Pub.</p>,<h2 id="d24e19754">Packages for Windows, macOS, and Linux</h2>
<p id="d24e19757">



Flutter supports desktop platforms at an experimental stage. This means you could also develop Flutter plugins for desktop platforms.</p>
<p id="d24e19778">
For up-to-date information on the state of this feature, you should consult Google’s dedicated <span class="emph">flutter-desktop-embedding</span> GitHub repository.<sup><a class="footnote" href="/links/f_0052/f_0052.xhtml#FOOTNOTE-32" id="FNPTR-32">[32]</a></sup></p>,<h2 id="d24e19789">Where We’re Going Next</h2>
<p id="d24e19792">Now that we know how packages work, we’ll be able to use one of the most important features packages provide: HTTP networking, as we’ll see in the next chapter.</p>

<div class="footnotes">
<h4>Footnotes</h4>
<dl>
<dt class="footnote-number"><a href="/links/f_0047/f_0047.xhtml#FNPTR-27" id="FOOTNOTE-27">[27]</a></dt><dd>
<p id="d24e17077"><a href="https://pub.dartlang.org/flutter">https://pub.dartlang.org/flutter</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0048/f_0048.xhtml#FNPTR-28" id="FOOTNOTE-28">[28]</a></dt><dd>
<p id="d24e17401"><a href="https://pub.dartlang.org/packages/battery">https://pub.dartlang.org/packages/battery</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0048/f_0048.xhtml#FNPTR-29" id="FOOTNOTE-29">[29]</a></dt><dd>
<p id="d24e17408"><a href="https://pub.dartlang.org/packages/connectivity">https://pub.dartlang.org/packages/connectivity</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0050/f_0050.xhtml#FNPTR-30" id="FOOTNOTE-30">[30]</a></dt><dd>
<p id="d24e19724"><a href="https://en.wikipedia.org/wiki/BSD_licenses">https://en.wikipedia.org/wiki/BSD_licenses</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0050/f_0050.xhtml#FNPTR-31" id="FOOTNOTE-31">[31]</a></dt><dd>
<p id="d24e19729"><a href="https://choosealicense.com/licenses/">https://choosealicense.com/licenses/</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0051/f_0051.xhtml#FNPTR-32" id="FOOTNOTE-32">[32]</a></dt><dd>
<p id="d24e19786"><a href="https://github.com/google/flutter-desktop-embedding">https://github.com/google/flutter-desktop-embedding</a></p></dd></dl></div>
<div class="copyright">Copyright © 2020, The Pragmatic Bookshelf.</div>,<br class="pp-chunk end-of-part"/>,<h1 class="part-title" id="d24e19795"><span class="part-number">Part 2</span><br/>
        Doing More with Flutter
      </h1><blockquote class="partintro" id="d24e19798">
<p id="d24e19799">
          Flutter is expandable and flexible. We’ve already seen how it works, so
          now we’ll look at how Flutter’s many features can be used to actually
          build useful apps.
        </p>
<p id="d24e19801">
          In the chapters in this part you’ll learn how to make HTTP requests, how to
          test and handle exceptions in Flutter apps, and then how to use Firebase
          to create a chat app.
        </p>
<p id="d24e19803">
	  The appendices will be about Dart syntax, Cupertino (iOS-like) widgets, pubspec.yaml, and how to change app name and launcher icon.
	</p></blockquote>,<h1 class="chapter-title" id="chp.networking"><span class="chapter-number">
            Chapter
            5</span><br/><span class="chapter-name"> Network and Storage I/O and Navigation </span></h1>

<p id="d24e19810">Writing apps that are isolated to the user’s own phone is fine for some applications, but a great majority of apps need to interact with a web API or back end, which is what we’ll be doing in this chapter.</p>
<p id="d24e19812">Flutter’s standard library doesn’t include a standard networking component: even though you can actually use the network to fetch images, you can’t make standard HTTP requests using just the Flutter/Dart standard library.</p>
<p id="d24e19814">This is the reason why we are going to talk about it now: Flutter has a Google-developed package on Pub called <span class="emph">http</span>, which allows us to make HTTP requests and connect our app to a Web API.</p>,<h2 id="d24e19819">The API</h2>
<p id="d24e19822">


Since talking about actually creating a back end for your app would deviate significantly from the scope of this book, we’ll be using a simple HTTP API that requires no authentication: the popular comic site XKCD’s API.</p><h3>Why XKCD?</h3>
<p id="d24e19837">
You are probably already familiar with the XKCD website: its comics are often shared in engineering and computer-related communities (especially software development ones), and the XKCD API is very simple to use and requires no authentication, which means you will be able to use the code examples in this chapter without having to update placeholder API keys with ones you get by signing up for the usage of the API like you would if the example was about an API that requires authentication.</p><h3>How the XKCD API Works</h3>
<p id="d24e19844">The XKCD API, like is the case for most HTTP end-points, sends JSON responses to simple GET requests.</p><h4>Getting Data About XKCD Comics</h4>
<p id="d24e19849">





For example, sending a standard GET request to <span class="cf ic">https://xkcd.com/info.0.json</span> returns something like this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">{</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"month"</em>​: ​<em class="string">"1"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"num"</em>​: 2097,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"link"</em>​: ​<em class="string">""</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"year"</em>​: ​<em class="string">"2019"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"news"</em>​: ​<em class="string">""</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"safe_title"</em>​: ​<em class="string">"Thor Tools"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"transcript"</em>​: ​<em class="string">""</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"alt"</em>​: ​<em class="string">"CORRECTION: After careful evaluation,"</em>​ ​<strong class="kw">+</strong>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"we have determined that the"</em>​ ​<strong class="kw">+</strong>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"axis label on this chart was printed backward."</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"img"</em>​: ​<em class="string">"https://imgs.xkcd.com/comics/thor_tools.png"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"title"</em>​: ​<em class="string">"Thor Tools"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"day"</em>​: ​<em class="string">"11"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e19987">which describes the latest comic XKCD has published, and you can see the current result yourself by navigating to that page in the browser.</p><h4>The JSON Data</h4>
<p id="d24e19992">If you have never worked with JSON, it is just a way to describe an object from any object-oriented programming language (or, even more closely, a C-like struct) with a string: it is a single entity containing multiple fields, each one describing something different about the entity it’s describing.</p>
<p id="d24e19994">In this case, it’s the latest comic XKCD has published and the following information about it:</p><ul><li>Which month it was released on (1 for January).</li><li>The numerical ID for the comic (progressive, starting from 1 for the first ever XKCD comic).</li><li>The link clicking the comic image on the websites points to<sup><a class="footnote" href="/links/f_0067/f_0067.xhtml#FOOTNOTE-33" id="FNPTR-33">[33]</a></sup> (usually empty).</li><li>The year the comic was published.</li><li>A usually empty <span class="emph">news</span> field.</li><li>The text-only title of the comic (the normal <span class="emph">title</span> might contain HTML tags).</li><li>A textual transcript (a description) of what’s happening in the comic image, which hasn’t been added to comics since number 1674.</li><li><span class="emph">alt</span> is an explanation of the joke or additional text meant to be viewed after seeing the comic image itself. It has been included in the official website in two ways: the desktop version displays it when the mouse hovers over the image, and the mobile version displays it when a button below the image is tapped.</li><li>The comic image itself.</li><li>The comic title, potentially containing HTML tags.</li><li>The day of the month on which the comic was published.</li></ul>
<p id="d24e20046">








In Dart code, we can parse and decode the JSON data and store it in a Dart <span class="cf class">Map</span> using the <span class="cf ic">dart:convert</span> built-in Dart library, which provides the necessary <span class="cf methodname">json.decode(JSON)</span> method to convert a JSON <span class="cf class">String</span> to a Dart object, as well as a <span class="cf methodname">json.decode(var)</span> method (which we won’t use) that converts compatible Dart objects to JSON-formatted <span class="cf class">String</span>s.</p><div class="sidebar"><div class="sidebar-title"> How the Convert Library Works </div><div class="sidebar-content">
<p id="d24e20110">
		
        
		
		
        
		The <span class="emph">dart:convert</span> library provides the <span class="cf constant">json</span> constant,<sup><a class="footnote" href="/links/f_0067/f_0067.xhtml#FOOTNOTE-34" id="FNPTR-34">[34]</a></sup> which is of type <span class="cf class">JsonCodec</span>,<sup><a class="footnote" href="/links/f_0067/f_0067.xhtml#FOOTNOTE-35" id="FNPTR-35">[35]</a></sup> which has two methods: <span class="cf methodname">json.decode</span>, which takes a <span class="cf class">String</span> as an argument and can return any Dart object, as its return type is <span class="cf class">dynamic</span>, meaning it could be anything.
	</p>
<p id="d24e20171">
		
		The other method is <span class="cf methodname">json.encode</span>, which does the exact opposite: it takes any Dart <span class="cf class">Object</span> (again, it could be anything) and returns a <span class="cf class">String</span> that can be used—for example, as part of a POST request if that’s what we needed to do, and as we’ll do later in the book.
	</p></div></div><h4>Getting Previous Comics</h4>
<p id="d24e20193">

You can get the comics published prior to the current (and latest) one by sending a get request to <span class="cf ic">https://xkcd.com/num/info.0.json</span> where <span class="cf ic">num</span> is the comic number in chronological order (starting from 1); for example, you can get the first one by sending a GET request to <span class="cf ic">https://xkcd.com/1/info.0.json</span>.</p>
<p id="d24e20213">There is no way to get a list of the comics from the API, but we can make a list of comics in reverse chronological order (from the latest to the earliest) by simply fetching the latest comic, then using its ID number (let’s call it <span class="cf ic">latestNum</span>) to fetch the comics with numbers that go from <span class="cf ic">latestNum-1</span> to 1.


</p>,<h2 id="d24e20226">The http Package</h2>
<p id="d24e20229">






To make GET requests we need to use the <span class="emph">http</span> package. You can find the http package on Dart Pub.<sup><a class="footnote" href="/links/f_0067/f_0067.xhtml#FOOTNOTE-36" id="FNPTR-36">[36]</a></sup></p>
<p id="d24e20267">
Let’s start by creating a new Flutter app project using:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">$ flutter create xkcd_app</td></tr></table>
<p id="d24e20279">

and installing the HTTP package by adding the following to <span class="cf filename">pubspec.yaml</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/pubspec.yaml">networking/xkcd_app/pubspec.yaml</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">dependencies:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  http: ​<em class="string">"</em>​​<em class="string">^0.12.0+1"</em>​</td></tr></table>
<p id="d24e20308">
Run <span class="cf commandname">flutter packages get</span> to download and install the package if you aren’t using the IDE plugins (which will do it automatically for you after you make changes to <span class="cf filename">pubspec.yaml</span>).</p><h3>Using the http Package</h3>
<p id="d24e20323">The HTTP package can be used to make HTTP requests of all kinds.<sup><a class="footnote" href="/links/f_0067/f_0067.xhtml#FOOTNOTE-37" id="FNPTR-37">[37]</a></sup></p>
<p id="d24e20329">

All of them are asynchronous, which means that, by default, they are ran in a separate thread without affecting the rest of the app’s execution. You can choose to make them behave exactly like synchronous functions if their return value is vital to the prosecution of the app’s execution.</p><h4>Asynchronous Code in Dart</h4>
<p id="d24e20343">



There are many ways to run asynchronous code in Dart, outlined in <a href="/links/f_0087/f_0087.xhtml#sec.dart.async">​<em>Asynchronous Code in Dart: The dart:async Library</em>​</a>, but the basic concept has already been explained in the previous chapter: calls to functions that return a <span class="cf class">Future</span> (or <span class="cf class">Stream</span>, which we won’t be using in this chapter) and run in a separate thread are called asynchronous.</p>
<p id="d24e20377">
We can get the data returned by an asynchronous function by using an <span class="cf ic">await</span> expression:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">var returnedData = await asyncFunction();</td></tr></table>
<p id="d24e20390">This can only be done in <span class="cf ic">async</span> functions and <span class="cf ic">async</span> functions have to return <span class="cf class">Future</span>s, so asynchrony tends to propagate to all of the calling methods.</p><h4>Making GET Requests</h4>
<p id="d24e20404">





An HTTP request is made using <span class="cf methodname">http.get</span>, which is an <span class="cf ic">async</span> method that returns a <span class="cf class">Response</span> inside a <span class="cf class">Future</span>.</p>
<p id="d24e20446">
We can unwrap the inner <span class="cf class">Response</span> using <span class="cf ic">await</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ latestComicResponse = await http.get(​<em class="string">"https://xkcd.com/info.0.json"</em>​);</td></tr></table>
<p id="d24e20470">and we can get the body of the response as a <span class="cf ic">String</span> by querying its <span class="cf ic">body</span> attribute, like we will need to do when we build our XKCD app:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ latestComicString = latestComicResponse.body;</td></tr></table>
<p id="d24e20489">We could also do everything in one line, enclosing the <span class="cf ic">await</span> expression in parentheses:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ latestComicString = (await http.get(​<em class="string">"https://xkcd.com/info.0.json"</em>​)).body;</td></tr></table>
<p id="d24e20510">
HTTP headers can be set by setting the <span class="cf ic">headers</span> named arguments to a <span class="cf ic">Map&lt;String, String&gt;</span>, like in the following example:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">http.get(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"http://example.com/exampleGet?testAttr=</em>​​<em class="string">$val1</em>​​<em class="string">&amp;testAttr2=</em>​​<em class="string">$val2</em>​​<em class="string">"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  headers: {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"Accept"</em>​: ​<em class="string">"application/json"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"Accept-Charset"</em>​: ​<em class="string">"utf-8"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e20563">Wikipedia has a comprehensive list of standard HTTP headers.<sup><a class="footnote" href="/links/f_0067/f_0067.xhtml#FOOTNOTE-38" id="FNPTR-38">[38]</a></sup></p>
<p id="d24e20569">

The <span class="cf ic">http</span> package also provides <span class="cf ic">http.read()</span> and <span class="cf ic">http.readBytes()</span>, which are, respectively, just like <span class="cf methodname">http.get()</span>’s <span class="cf ic">body</span> and <span class="cf ic">bodyBytes</span> attributes.</p>
<p id="d24e20599">For example, you could go from calling:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ res = (await http.get(​<em class="string">"http://example.com"</em>​)).body;</td></tr></table>
<p id="d24e20616">to just:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ res = await http.read(​<em class="string">"http://example.com"</em>​);</td></tr></table>
<p id="d24e20631">or go from:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ res = (await http.get(​<em class="string">"http://example.com"</em>​)).bodyBytes;</td></tr></table>
<p id="d24e20648">to just:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ res = await http.readBytes(​<em class="string">"http://example.com"</em>​);</td></tr></table>
<p id="d24e20662">Be careful, though, as you lose other attributes of the <span class="cf class">Response</span> object (the type of data <span class="cf methodname">http.get</span> returns), such as:</p><ul><li><span class="cf ic">headers</span>, which is needed when you need to read the response’s headers;</li><li><span class="cf ic">contentLength</span>, which is the size (in bytes) of the response.




</li></ul><h4>Making Other Requests</h4>
<p id="d24e20693">Other kinds of HTTP requests are also supported, and all of them support setting headers in the way we’ve just seen and all of them return <span class="cf ic">Future&lt;Response&gt;</span> objects:















</p><ul><li>
<p id="d24e20774">A POST request is made using <span class="cf methodname">http.post</span>, the request URL is provided as a positional argument and you can set the request body by setting the <span class="cf ic">body</span> named argument to whatever you want.</p></li><li>
<p id="d24e20783">A PUT request is made using <span class="cf methodname">http.put</span>, the request URL is provided as a positional argument and you can set the request body by setting the <span class="cf ic">body</span> named argument to whatever you want.</p></li><li>
<p id="d24e20792">A DELETE request is made using <span class="cf methodname">http.delete</span>, the request URL is provided as a positional argument.</p></li><li>
<p id="d24e20798">A PATCH request is made using <span class="cf methodname">http.patch</span>, the request URL is provided as a positional argument and you can set the request body by setting the <span class="cf ic">body</span> named argument to whatever you want.</p></li><li>
<p id="d24e20807">A HEAD request is made using <span class="cf methodname">http.head</span>, the request URL is provided as a positional argument.</p></li></ul>
<p id="d24e20812">Whenever it’s possible to add a <span class="cf ic">body</span> attribute it’s also possible to add an <span class="cf ic">encoding</span> attribute, which is of type <span class="cf class">Econding</span> and is used to define the body’s encoding. Some <span class="cf class">Encoding</span> subclasses are <span class="cf class">AsciiCodec</span> and <span class="cf class">Utf8Codec</span>.

</p><h3>Parsing the JSON Response Body</h3>
<p id="d24e20839">






The HTTP response body is just a string, so it is not useful unless it is parsed.</p>
<p id="d24e20880">Manually parsing it would be incredibly time-consuming and pointless, since the <span class="cf ic">dart:convert</span> built-in library already provides a constant called <span class="cf ic">json</span>, which is of type <span class="cf class">JsonCodec</span>, meaning it exposes two methods:</p><ul><li><span class="cf methodname">json.encode(obj)</span>, which converts the <span class="cf ic">obj</span> object to a JSON string.</li><li><span class="cf methodname">json.decode(str)</span>, which converts the <span class="cf ic">str</span> JSON string to a Dart object.</li></ul>
<p id="d24e20908">In our specific case, we want to convert a JSON string to a <span class="cf ic">Map&lt;String, dynamic&gt;</span>, which allows us to access each of the comic’s attributes by name as we’ll see in the next section.</p>
<p id="d24e20913">Using <span class="cf ic">dart:convert</span>, if we had previously stored the response body of a call to XKCD’s API to a variable called <span class="cf ic">latestComicString</span>, we would be able to convert it to a <span class="cf ic">Map</span> by using:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt; latestComic = json.decode(latestComicString);</td></tr></table>
<p id="d24e20937">So the code we would add to our app if we needed to store the latest comic in a <span class="cf class">Map</span> variable is:









</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt; latestComic = json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  await http.read(​<em class="string">"https://xkcd.com/info.0.json"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">);</td></tr></table>,<h2 id="d24e20985">Writing Methods to Fetch Comics</h2>
<p id="d24e20988">







A consideration has to be done before continuing with the implementation: the optimal data type to store comics is <span class="cf ic">Map&lt;String, dynamic&gt;</span>, which handles JSON objects perfectly.</p>
<p id="d24e21033">Given that we know how to fetch comics, let’s start writing some code to use that knowledge to write methods to fetch comics that we can use in our app!</p><h3>Fetching the Latest Comic</h3>
<p id="d24e21038">
Wrapping the code we discussed earlier into an arrow function isn’t hard at all:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; fetchLatestComic() async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    await http.read(​<em class="string">"https://xkcd.com/info.0.json"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr></table>
<p id="d24e21071">We can access a <span class="cf class">Map</span>’s field a lot like we would access <span class="cf class">List</span> elements by using <span class="cf ic">varName["attrName"]</span> where <span class="cf ic">varName</span> is the name of the <span class="cf class">Map</span> variable and <span class="cf ic">attrName</span> is the name of the attributes.
This is exactly the same syntax used in Python to access dictionary elements.
This is how you access every attribute:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ comic = fetchLatestComic();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">int</strong>​ ​<strong class="kw">num</strong>​ = comic[​<em class="string">"num"</em>​];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ link = comic[​<em class="string">"link"</em>​];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ news = comic[​<em class="string">"news"</em>​];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ safe_title = comic[​<em class="string">"safe_title"</em>​];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ transcript = comic[​<em class="string">"transcript"</em>​];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ alt = comic[​<em class="string">"alt"</em>​];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ImageProvider img = NetworkImage(comic[​<em class="string">"img"</em>​]);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ title = comic[​<em class="string">"title"</em>​];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ MDYDate = ​<em class="string">"</em>​​<em class="string">${comic["month"]}</em>​​<em class="string">/</em>​​<em class="string">${comic["day"]}</em>​​<em class="string">/</em>​​<em class="string">${comic["year"]}</em>​​<em class="string">"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ DMYDate = ​<em class="string">"</em>​​<em class="string">${comic["day"]}</em>​​<em class="string">/</em>​​<em class="string">${comic["month"]}</em>​​<em class="string">/</em>​​<em class="string">${comic["year"]}</em>​​<em class="string">"</em>​;</td></tr></table><h3>Fetching Previous Comics</h3>
<p id="d24e21196">
Fetching by comic number is easy since the API is designed to do just that:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; fetchComic(​<strong class="kw">int</strong>​ n) async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    await http.read(​<em class="string">"https://xkcd.com/info.0.json"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr></table>
<p id="d24e21230">But sorting reverse chronological is a lot harder, as we need to know the latest comic number to get the previous, and so on:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; fetchComic(​<strong class="kw">int</strong>​ n) async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">int</strong>​ latestComicNum = ...;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    await http.read(​<em class="string">"https://xkcd.com/info.0.json"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e21270">The obvious way to do that would be to just call <span class="cf ic">fetchLatestComic</span> and get the num attribute, like this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">int</strong>​ latestComicNum = fetchLatestComic()[​<em class="string">"num"</em>​];</td></tr></table>
<p id="d24e21284">But doing it that way would require two different GET requests to fetch each comic, and many of them are going to be redundant and useless.</p><h3>Fetching the Latest Comic Number Just Once</h3>
<p id="d24e21289">Since we are going to use these methods inside an app, which will have a wrapper class around it (at least for the home screen), we can just pass it to that class when we run the app and then the <span class="cf methodname">fetchComic</span> method inside that class will be able to access it directly.</p><h4 id="sec.networking.fetchcomic.new">The New fetchComic</h4>
<p id="d24e21297">Fetching a comic is really simple this way, since we don’t need to worry about the latest comic number, which will be provided by the class in which we’ll define the method:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; fetchComic(​<strong class="kw">int</strong>​ n) async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    await http.read(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="string">"https://xkcd.com/</em>​​<em class="string">${latestComicNum-n}</em>​​<em class="string">/info.0.json"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr></table><h4 id="sec.networking.fetchcomic.latestnummethod">A Function to Get the Latest Comic Number</h4>
<p id="d24e21337">
We need to get the latest comic number when we run the app though, and to do that we need to define a function that will fetch that when we need it:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;​<strong class="kw">int</strong>​&gt; getLatestComicNumber() async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    await http.read(​<em class="string">'https://xkcd.com/info.0.json'</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> [​<em class="string">"num"</em>​];</td></tr></table><h4>What If There’s No Internet Connection?</h4>
<p id="d24e21373">









If there is no Internet connection, the app will not work. This is a problem but, since we are downloading all of the comics anyway, we should be able to fix it just by saving them to permanent local storage so that we can load them when there is no Internet connection.</p>
<p id="d24e21401">This has the added advantage of giving us the chance to optimize our app in a significant way: if we have the previous comics on local storage we don’t need to fetch them from the Internet, so we finally eliminate all the redundant GET requests and we can just focus on getting new data when we need it.</p>,<h2 id="sec.networking.progress">Using the CircularProgressIndicator</h2>
<p id="d24e25415">


In those screenshots you see what the app looks like when everything has finished loading, but we also need to think about what it looks like while it’s still in the process of loading: we currently display a <span class="cf class">Divider</span> when it’s loading each tile, but that isn’t really visually pleasing if the user is on a slow network and will therefore look at many dividers stacked on top of each other for a few seconds.</p>
<p id="d24e25431">There is a class specifically meant to be used for this placeholder task: the <span class="cf class">CircularProgressIndicator</span>.<sup><a class="footnote" href="/links/f_0067/f_0067.xhtml#FOOTNOTE-40" id="FNPTR-40">[40]</a></sup> It’s not the only progress indicator: there is also a <span class="cf class">LinearProgressIndicator</span>, but it’s less common and less flexible.</p>
<p id="d24e25444">You can just place its constructor (<span class="cf methodname">CircularProgressIndicator</span>) anywhere you want to display it (for example, instead of the <span class="cf class">Divider</span> placeholder for the <span class="cf class">ComicTile</span>), but that would make it stretch to fill the space given to it. This is fixed by restraining it to a <span class="cf class">Container</span> with a limited width.</p>
<p id="d24e25458">The <span class="cf ic">builder</span> for the <span class="cf class">FutureBuilder</span> inside the <span class="cf class">ListView.builder</span> in the <span class="cf class">HomeScreen</span> becomes the following:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">builder: (context, snapshot) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ snapshot.hasData ?</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ComicTile(comic: snapshot.data) :</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   Container(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      width: 30,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     child: CircularProgressIndicator()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">},</td></tr></table>,<h2 id="d24e26774">Allowing the User to Click the Image and Go to the Website: The url_launcher Package</h2>
<p id="d24e26777">




What if users want to see a comic on the XKCD website? Right now, the only way they could do that is by taking advantage of the comic number and title and searching the XKCD website themselves.</p>
<p id="d24e26803">It wouldn’t be too hard to provide users with the ability to do that with a tap in the app, so let’s do it!</p>
<p id="d24e26805">To launch URLs from Flutter apps, we’ll use a handy package on Pub called <span class="emph">url_launcher</span>.</p><h3>Using the url_launcher Package</h3>
<p id="d24e26813">Let’s add the <span class="cf ic">url_launcher</span> package to the dependencies in <span class="cf filename">pubspec.yaml</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/pubspec.yaml">networking/xkcd_app/pubspec.yaml</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">url_launcher: ​<em class="string">^5.0.2</em>​</td></tr></table>
<p id="d24e26829">and import it in our code in <span class="cf filename">main.dart</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:url_launcher/url_launcher.dart'</em>​;</td></tr></table>
<p id="d24e26843">The <span class="emph">url_launcher</span> package provides two functions: <span class="cf methodname">canLaunch(url)</span> and <span class="cf methodname">launch(url)</span>. The first returns a <span class="cf ic">bool</span> wrapped in a <span class="cf class">Future</span>, which will be <span class="cf ic">true</span> if there is an app that can handle the URL or <span class="cf ic">false</span> if there isn’t. The second actually launches the URL and returns the same value as the other function: if the launch was successfull, it returns <span class="cf ic">true</span>; if it wasn’t, it returns <span class="cf ic">false</span>.</p>
<p id="d24e26873">So we know how to launch the URL, but we don’t actually get the comic URL when we fetch the comic’s JSON. That’s not actually a problem, since the URL for each comic is just <span class="emph">https://xkcd.com/comic_number/</span>: the URL to reach comic #2019 is <span class="emph">https://xkcd.com/2019/</span>.</p>
<p id="d24e26881">This means that a method to launch comics, to be defined inside the <span class="cf class">ComicPage</span> class, can be written in the following way:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">_launchComic</strong>​(​<strong class="kw">int</strong>​ comicNumber) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  launch(​<em class="string">"https://xkcd.com/</em>​​<em class="string">$comicNumber</em>​​<em class="string">/"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3>Adding an onTap Event</h3>
<p id="d24e26912">

We know how to launch an URL, but the <span class="cf class">Image</span>’s constructors don’t provide an <span class="cf ic">onTap</span> argument, so we need to wrap it in a <span class="cf class">InkWell</span>, which is a lot like wrapping an <span class="cf ic">img</span> HTML image tag in an <span class="cf ic">a</span> link tag: the <span class="cf class">InkWell</span> needs two arguments: a <span class="cf ic">child</span> which, in this case, will be the <span class="cf class">Image</span>, and the <span class="cf ic">onTap</span> argument we wanted, along with a bunch of options to customize the inksplash effect you can check out on the official Flutter documentation.<sup><a class="footnote" href="/links/f_0067/f_0067.xhtml#FOOTNOTE-41" id="FNPTR-41">[41]</a></sup></p>
<p id="d24e26955">All that’s left to do is to find the place where we show the comic image in <span class="cf class">ComicPage</span> and wrap it in the <span class="cf class">InkWell</span>:




</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">InkWell(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  onTap: () {_launchComic(widget.comic[​<em class="string">"num"</em>​]);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   child: Image.file(File(widget.comic[​<em class="string">"img"</em>​])),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table><table class="simpletable outerlines"><thead><tr><th class="outerlines" colspan="2"><p class="last-para-in-cell">Showing Inksplash on the InkWell</p></th></tr></thead><tbody><tr class="tr zebra "><td style="valign: middle; width: 12%; ">
               <img alt="images/aside-icons/info.png" class="" id="d24e27008" src="/images/img66/images/aside-icons/info.png" style="width: 100%"/>
             </td><td style="valign: middle; width: 88%; ">

<p>

  One of <span class="cf class">InkWell</span>’s features is that it can show an inksplash effect when the user taps on the area where it is located, but that will not work in our app because of how visual effects like the inksplash are applied on Flutter widgets.
</p>
<p>
  A Flutter layout is made of widgets, but the inksplash is not applied to widgets: it is applied to <span class="cf class">Material</span>, which is
  the class that is also responsible for clipping and elevation effects. An <span class="cf class">Image</span> is drawn <span class="emph">over</span> a <span class="cf class">Material</span>, so the inksplash will be applied to the <span class="cf class">Material</span> <span class="emph">below</span> the image, which will make it invisible.
</p>
<p>

  To show the inksplash effect you’d need to overlap the <span class="cf class">Image</span> with a transparent <span class="cf class">Material</span> widget. The <span class="cf class">Ink</span> widget<sup><a class="footnote" href="/links/f_0067/f_0067.xhtml#FOOTNOTE-42" id="FNPTR-42">[42]</a></sup> makes that simpler: it provides a <span class="cf methodname">Ink.image</span> method that allows you to set the <span class="cf class">InkWell</span> as a <span class="cf variable">child</span>, making the image and the <span class="cf class">Material</span> on top of it an ancestor of the <span class="cf class">InkWell</span>.
</p>
<p>
  A disadvantage of the <span class="cf methodname">Ink</span> is that it requires setting a maximum width and height. For an example of code that correctly shows the inksplash over the image and that works when replacing the code we used above, take a look at this:
</p>
<div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/inkSplashComicLaunch.dart">networking/xkcd_app/lib/inkSplashComicLaunch.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Material(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: Ink.image(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    image: FileImage(File(widget.comic[​<em class="string">"img"</em>​])),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    height: 300,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    width: 200,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    child: InkWell(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      onTap: () {_launchComic(widget.comic[​<em class="string">"num"</em>​]);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>


<p class="last-para-in-cell">
  If you are not interested in the inskplash effect at all, you can use a <span class="cf class">GestureDetector</span> instead of the <span class="cf class">InkWell</span>. It works in the same way as the <span class="cf class">InkWell</span>, with the same arguments, but without applying an inksplash effect on any kind of widget.
</p>
</td></tr></tbody></table>,<h2 id="d24e29155">Where We’re Going Next</h2>
<p id="d24e29158">In this chapter we’ve seen how to interact with the network and local storage by building an XKCD comic browser app. In the next chapter, we’re going to explore how to test Flutter apps.</p>

<div class="footnotes">
<h4>Footnotes</h4>
<dl>
<dt class="footnote-number"><a href="/links/f_0056/f_0056.xhtml#FNPTR-33" id="FOOTNOTE-33">[33]</a></dt><dd>
<p id="d24e20009"><a href="https://xkcd.com/2050/">https://xkcd.com/2050/</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0056/f_0056.xhtml#FNPTR-34" id="FOOTNOTE-34">[34]</a></dt><dd>
<p id="d24e20149"><a href="https://api.dartlang.org/stable/2.1.0/dart-convert/json-constant.html">https://api.dartlang.org/stable/2.1.0/dart-convert/json-constant.html</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0056/f_0056.xhtml#FNPTR-35" id="FOOTNOTE-35">[35]</a></dt><dd>
<p id="d24e20157"><a href="https://api.dartlang.org/stable/2.1.0/dart-convert/JsonCodec-class.html">https://api.dartlang.org/stable/2.1.0/dart-convert/JsonCodec-class.html</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0057/f_0057.xhtml#FNPTR-36" id="FOOTNOTE-36">[36]</a></dt><dd>
<p id="d24e20264"><a href="https://pub.dartlang.org/packages/http">https://pub.dartlang.org/packages/http</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0057/f_0057.xhtml#FNPTR-37" id="FOOTNOTE-37">[37]</a></dt><dd>
<p id="d24e20326"><a href="https://pub.dartlang.org/documentation/http/latest/http/http-library.html">https://pub.dartlang.org/documentation/http/latest/http/http-library.html</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0057/f_0057.xhtml#FNPTR-38" id="FOOTNOTE-38">[38]</a></dt><dd>
<p id="d24e20566"><a href="https://en.wikipedia.org/wiki/List_of_HTTP_header_fields">https://en.wikipedia.org/wiki/List_of_HTTP_header_fields</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0059/f_0059.xhtml#FNPTR-39" id="FOOTNOTE-39">[39]</a></dt><dd>
<p id="d24e21764"><a href="https://material.io/design/components/navigation-drawer.html">https://material.io/design/components/navigation-drawer.html</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0062/f_0062.xhtml#FNPTR-40" id="FOOTNOTE-40">[40]</a></dt><dd>
<p id="d24e25437"><a href="https://material.io/design/components/progress-indicators.html#circular-progress-indicators">https://material.io/design/components/progress-indicators.html#circular-progress-indicators</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0064/f_0064.xhtml#FNPTR-41" id="FOOTNOTE-41">[41]</a></dt><dd>
<p id="d24e26952"><a href="https://docs.flutter.io/flutter/material/InkWell-class.html">https://docs.flutter.io/flutter/material/InkWell-class.html</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0064/f_0064.xhtml#FNPTR-42" id="FOOTNOTE-42">[42]</a></dt><dd>
<p id="d24e27062"><a href="https://docs.flutter.io/flutter/material/Ink-class.html">https://docs.flutter.io/flutter/material/Ink-class.html</a></p></dd></dl></div>
<div class="copyright">Copyright © 2020, The Pragmatic Bookshelf.</div>,<h1 class="chapter-title" id="d24e29162"><span class="chapter-number">
            Chapter
            6</span><br/><span class="chapter-name"> Testing and Debugging Flutter Apps </span></h1>

<p id="d24e29166">Up until now we have discussed how a Flutter app is built, with all the different UI, I/O, and state management features the framework offers. That’s all very nice when everything goes according to plan and the code does exactly what you think it will do, but that’s not always the case and testing can simplify the development process, especially on larger projects, by making sure each piece of code does what it’s supposed to.</p>
<p id="d24e29168">It’s not the only thing we’re going to talk about in this chapter: when things go wrong in your app and there’s nothing the method you’re writing can do about it, exceptions are there to make sure you can notify the rest of your app that something has gone wrong, letting a calling function make a decision about what to do about the issue. This is especially necessary when apps make I/O operations that, as they operate on things outside the control of the user and/or the developer, are bound to fail at some point if the required conditions to execute the operation aren’t met.</p>,<h2 id="sec.testing.errors">Throwing and Catching Exceptions</h2>
<p id="d24e34597">
We already used exceptions in some of the previous chapters, but we’ll go through the Flutter implementation in more detail in this section.</p>
<p id="d24e34601">Exceptions are used in a piece of code as a way to signal that something’s gone wrong, the current function(or <a href="/links/f_0085/f_0085.xhtml#sec.dart.functions.closures">​<em>Anonymous Functions and Closures</em>​</a>)’s execution is interrupted and the calling function is supposed to deal with it by catching it.</p><h3>Throwing an Exception</h3>
<p id="d24e34608">

In Dart exceptions are thrown using the <span class="cf keyword">throw</span> keyword (	in Python you’d call this raising an exception, in case you never got to see what the world looks like outside of Python). You can create your own exception by creating a class that <a href="/links/f_0090/f_0090.xhtml#sec.dart.implements">​<em>Writing a Class That implements an Interface</em>​</a> the <span class="cf class">Exception</span> class error:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyOwnPersonalException ​<strong class="kw">implements</strong>​ Exception {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  MyOwnPersonalException(​<strong class="kw">this</strong>​.myOwnPersonalMember);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ myOwnPersonalMember;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">double</strong>​ ​<strong class="kw">myPersonalDivision</strong>​(​<strong class="kw">double</strong>​ a, ​<strong class="kw">double</strong>​ b) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(b == 0) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">throw</strong>​ MyOwnPersonalException(​<em class="string">"Failed to divide a number by 0."</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ a/b;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3>Catching an Exception</h3>
<p id="d24e34692">

Whenever we call a function or use an operation that may fail under certain circumstances we’re not checking for, we should be catching the exception:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">responsibleFunction</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">int</strong>​ a, b;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">// ...</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  b = 0;</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">try</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">int</strong>​ d = myPersonalDivision(a, b);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// ...</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">catch</strong>​(exception) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// Deal with the exception</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">// ...</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e34757">You can substitute <span class="cf keyword">exception</span> in <span class="cf keyword">catch</span>’s parentheses with whatever you want (it is usually just <span class="cf ic">e</span>). It contains the name of the exception that was thrown. You can print it to the debug console by using <span class="cf ic">print(exception)</span>. Additionally, you can pass a stack trace of the source of the error, which you can also print.</p>
<p id="d24e34771">For example, the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">try</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">int</strong>​.parse(​<em class="string">"Flutter"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">} ​<strong class="kw">catch</strong>​(e, stacktrace) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  print(e);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  print(stacktrace);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e34802">will trigger a <span class="cf class">FormatException</span> and print the following to the debug console:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">FormatException: Invalid radix-10 number (at character 1)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Flutter</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">^</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">#0  int._throwFormatException (dart:core/runtime/lib/integers_patch.dart:131:5)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">#1  int._parseRadix (dart:core/runtime/lib/integers_patch.dart:142:16)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">#2  int._parse (dart:core/runtime/lib/integers_patch.dart:100:12)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">#3  int.parse (dart:core/runtime/lib/integers_patch.dart:63:12)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">#4  main (file:///home/carmine/flutter/example_app/lib/main.dart:21:9)</td></tr></table><h4>on SomeException catch()</h4>
<p id="d24e34828">What if that called function had thrown another kind of exception, which didn’t have <span class="cf ic">myOwnPersonalMember</span> or maybe you needed to deal with different exceptions in different ways? That’s what <span class="cf keyword">on</span> is for.</p>
<p id="d24e34836">For example, let’s say we have a function that takes two numbers in a string format, parses them, and performs integer division on them. This means two different kinds exceptions can be thrown during its execution: a <span class="cf class">FormatException</span> if it can’t parse the numbers, or a <span class="cf class">IntegerDivisionByZeroException</span> exception if we try to divide by zero.</p>
<p id="d24e34844">Dart by default performs floating-point division and returns a <span class="cf ic">double</span> number. To perform integer division we need to use the <span class="cf ic">~/</span> operator instead of just <span class="cf ic">/</span>. This means the function definition will be the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">int</strong>​ ​<strong class="kw">jsonDivide</strong>​(​<strong class="kw">String</strong>​ a, ​<strong class="kw">String</strong>​ b) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">int</strong>​.parse(a)~/​<strong class="kw">int</strong>​.parse(b);</td></tr></table>
<p id="d24e34884">Seen like that, it’s no wonder why a function like this is a good example: it is very short but it could throw two different kinds of exceptions: for example, calling it as <span class="cf methodname">jsonDivide("5", "0")</span> will return an <span class="cf class">IntegerDivisionByZeroException</span>, whereas calling it as <span class="cf methodname">jsonDivide("Flutter", "10")</span> will return a <span class="cf class">FormatException</span>. Let’s pretend we need to tell the user to correct the bad data they entered, so we need to handle each exception differently, which isn’t to hard to do in Dart:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">try</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  jsonDivide(firstString, secondString);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">on IntegerDivisionByZeroException {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// tell the user to not divide by 0</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">on FormatException {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// tell the user to insert valid numbers</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e34924">So that each of the two <span class="cf keyword">on</span> blocks will be executed only when the corresponding exception is thrown.</p>
<p id="d24e34929">An alternative syntax for <span class="cf keyword">on</span> blocks is <span class="cf ic">on ExceptionName catch(e) {}</span>, which will pass the exception to the block, just like what happens in regular <span class="cf keyword">catch</span> blocks.</p>
<p id="d24e34941">You can, optionally, add a <span class="cf keyword">catch</span> block after the <span class="cf keyword">on</span> blocks to handle any exceptions that aren’t handled by the <span class="cf keyword">on</span> blocks.</p><h3>Finally</h3>
<p id="d24e34955">
When using a regular <span class="cf keyword">try</span>-<span class="cf keyword">catch</span> construct without throwing new exceptions in the process, the execution will continue by executing the instructions placed after the end of the <span class="cf keyword">catch</span> block, but if you are only using <span class="cf keyword">on</span> blocks instead of generic <span class="cf keyword">catch</span> blocks or you’re throwing new exceptions inside <span class="cf keyword">catch</span> blocks, the execution will be interrupted and those instructions won’t be executed. If, instead, you want to execute some instructions regardless of anything that happens in the <span class="cf keyword">try</span> block and in the <span class="cf keyword">catch</span> and <span class="cf keyword">on</span> block, you’d use a <span class="cf keyword">finally</span> block:


</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">try</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// code that could fail</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">on SomeException {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// handle SomeExceptin</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">finally</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// code that will surely be executed</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>,<h2 id="d24e35028">Assert Statements</h2>
<p id="d24e35031">


Somewhere in the middle of the use case of testing and the use case of exceptions you’ll find <span class="cf methodname">assert</span> statements, which are a way for the developer to define conditions that must be met during the app’s execution or to have an effective way to test the result of a certain condition.</p>
<p id="d24e35054">An <span class="cf ic">assert</span> statement can be added anywhere inside an app’s code and will terminate the app’s execution by throwing an <span class="cf class">AssertionError</span> exception when a condition doesn’t return <span class="cf ic">true</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">int</strong>​ a = 3;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(a == 3);</td></tr></table>
<p id="d24e35075">These two lines of code will not affect the app’s execution and similar syntax is often used in documentation when demonstrating a programming language’s features in code examples, including Google’s official Dart Language Tour.<sup><a class="footnote" href="/links/f_0073/f_0073.xhtml#FOOTNOTE-45" id="FNPTR-45">[45]</a></sup></p>
<p id="d24e35081">On the other hand, having code such as this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">int</strong>​ a = (6+9/3)/3;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(a != 3);</td></tr></table>
<p id="d24e35093">will terminate the app’s execution by throwing an exception <span class="emph">while debugging</span>. Assert statements do <span class="emph">not</span> have any effect on production code and are only considered while debugging code.</p>
<p id="d24e35101">It is possible to include a string to desctibe the assertion by passing it as the second named argument to <span class="cf methodname">assert</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(condition, ​<em class="string">"The condition wasn't met"</em>​);</td></tr></table>,<h2 id="d24e35116">Where We’re Going Next</h2>
<p id="d24e35119">


In the next chapter we’re going to talk about Firebase and how it can make building a chat app very simple.</p>

<div class="footnotes">
<h4>Footnotes</h4>
<dl>
<dt class="footnote-number"><a href="/links/f_0069/f_0069.xhtml#FNPTR-43" id="FOOTNOTE-43">[43]</a></dt><dd>
<p id="d24e30343"><a href="https://docs.flutter.io/flutter/flutter_test/CommonFinders-class.html">https://docs.flutter.io/flutter/flutter_test/CommonFinders-class.html</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0070/f_0070.xhtml#FNPTR-44" id="FOOTNOTE-44">[44]</a></dt><dd>
<p id="d24e30886"><a href="https://pub.dartlang.org/packages/mockito">https://pub.dartlang.org/packages/mockito</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0072/f_0072.xhtml#FNPTR-45" id="FOOTNOTE-45">[45]</a></dt><dd>
<p id="d24e35078"><a href="https://www.dartlang.org/guides/language/language-tour">https://www.dartlang.org/guides/language/language-tour</a></p></dd></dl></div>
<div class="copyright">Copyright © 2020, The Pragmatic Bookshelf.</div>,<h1 class="chapter-title" id="chp.firebase"><span class="chapter-number">
            Chapter
            7</span><br/><span class="chapter-name"> Build a Chat App Using Firebase </span></h1>

<p id="d24e35132">Google Firebase is a collection of tools to ease the development of some kinds of apps. In this chapter, we are going to build a chat app using it.
</p>,<h2 id="d24e38103">The StreamBuilder</h2>
<p id="d24e38106">
The <span class="cf class">StreamBuilder</span> works just like a <span class="cf class">FutureBuilder</span>, but it updates its content in real time to match the content of a given <span class="cf ic">stream</span>, instead of simply displaying the result of a given <span class="cf ic">future</span> like the <span class="cf class">FutureBuilder</span> does:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">StreamBuilder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  stream: myStream(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  builder: (context, snapshot) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(!snapshot.hasData) ​<strong class="kw">return</strong>​ CircularProgressIndicator();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ MyWidget(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      data: snapshot.data</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>,<h2 id="d24e41642">Where You’re Going Next</h2>
<p id="d24e41645">



You’re done, congratulations! Now all that’s left to do is to apply the knowledge you’ve acquired to the real world. There is a great community of Flutter-related content online, starting from the great and comprehensive official API reference I mentioned so many times during the course of this book. Navigating that requires some knowledge of the overall structure and inner-workings of a Flutter app and I hope you’ve been able to get that from reading this book.</p>
<p id="d24e41654">If you don’t feel comfortable writing Flutter apps because you feel like you need to learn more about Dart, Appendix 1, <a href="/links/f_0082/f_0082.xhtml#chp.dart">​<em> Introduction to Dart </em>​</a> might be just what you need.</p>
<p id="d24e41658">Perhaps after that you will find something more interesting: the body of this book has been focused on building Material Design UIs, interacting with packages and plugins, and writing Dart code. In Appendix 2, <a href="/links/f_0095/f_0095.xhtml#chp.pubspec">​<em> Apple-Like Look and Additional App Configuration </em>​</a> you will find out how to write apps that look like native iOS apps using Cupertino widgets and how to make your app fit in with each OS’s typical style; it also contains some useful information regarding additional app configuration, contained in both <span class="cf filename">pubspec.yaml</span> and the platform-specific <span class="cf dir">android</span> and <span class="cf dir">ios</span> directories. For example, the platform-specific configuration allows you to change the launcher icon and the app name to whatever you want (since by default you can only set lowercase names without spaces with Flutter, but you can edit the platform-specific configuration to set the app name to be whatever can be a regular Android/iOS app name).</p>
<p id="d24e41671">Because of all of that, it’s strongly recommended that you read the second appendix.</p>
<p id="d24e41673">Anyway, this book can’t possibly contain all of the different widgets, features, and options that Flutter offers you: now it’s up to you to find what you need. After having seen so much of how Flutter works and what it can do, you’re well positioned to navigate the vast array of official and community-created content about whatever niche aspect of Flutter you’d like to explore next.</p>

<div class="footnotes">
<h4>Footnotes</h4>
<dl>
<dt class="footnote-number"><a href="/links/f_0075/f_0075.xhtml#FNPTR-46" id="FOOTNOTE-46">[46]</a></dt><dd>
<p id="d24e35171"><a href="https://console.firebase.google.com/">https://console.firebase.google.com/</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0075/f_0075.xhtml#FNPTR-47" id="FOOTNOTE-47">[47]</a></dt><dd>
<p id="d24e35216"><a href="https://pub.dartlang.org/packages/firebase_core">https://pub.dartlang.org/packages/firebase_core</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0075/f_0075.xhtml#FNPTR-48" id="FOOTNOTE-48">[48]</a></dt><dd>
<p id="d24e35228"><a href="https://github.com/flutter/plugins/blob/master/FlutterFire.md">https://github.com/flutter/plugins/blob/master/FlutterFire.md</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0075/f_0075.xhtml#FNPTR-49" id="FOOTNOTE-49">[49]</a></dt><dd>
<p id="d24e35778"><a href="https://pub.dartlang.org/packages/firebase_auth">https://pub.dartlang.org/packages/firebase_auth</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0075/f_0075.xhtml#FNPTR-50" id="FOOTNOTE-50">[50]</a></dt><dd>
<p id="d24e35994"><a href="https://pub.dev/documentation/firebase_auth/latest/firebase_auth/AuthCredential-class.html">https://pub.dev/documentation/firebase_auth/latest/firebase_auth/AuthCredential-class.html</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0076/f_0076.xhtml#FNPTR-51" id="FOOTNOTE-51">[51]</a></dt><dd>
<p id="d24e36317"><a href="https://docs.flutter.io/flutter/animation/Curves-class.html">https://docs.flutter.io/flutter/animation/Curves-class.html</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0077/f_0077.xhtml#FNPTR-52" id="FOOTNOTE-52">[52]</a></dt><dd>
<p id="d24e37045"><a href="https://api.flutter.dev/flutter/dart-ui/Size-class.html">https://api.flutter.dev/flutter/dart-ui/Size-class.html</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0077/f_0077.xhtml#FNPTR-53" id="FOOTNOTE-53">[53]</a></dt><dd>
<p id="d24e37192"><a href="https://api.flutter.dev/flutter/dart-ui/Image-class.html">https://api.flutter.dev/flutter/dart-ui/Image-class.html</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0077/f_0077.xhtml#FNPTR-54" id="FOOTNOTE-54">[54]</a></dt><dd>
<p id="d24e37286"><a href="https://api.flutter.dev/flutter/dart-ui/Canvas-class.html">https://api.flutter.dev/flutter/dart-ui/Canvas-class.html</a></p></dd></dl></div>
<div class="copyright">Copyright © 2020, The Pragmatic Bookshelf.</div>,<br class="pp-chunk end-of-part"/>,<h1 class="chapter-title" id="chp.dart"><span class="chapter-number">
            Appendix
            1</span><br/><span class="chapter-name"> Introduction to Dart </span></h1>

<p id="d24e41681">Dart is a new language, and you might not be aware of its syntax and some of its features. Here I’ll provide an overview of Dart so that you can have a better grasp on how it works.</p>
<p id="d24e41683">Dart, in many ways, resembles C, C++, and Java, so developers with good knowledge of those languages shouldn’t have too many issues understanding the code in the book, but there are also differences that I’ll point out along the way.</p>
<p id="d24e41685">This appendix is also a good starting point for people who don’t have much programming experience.</p>,<h2 id="d24e41687">Comments in Dart</h2>
<p id="d24e41690">





Comments are sections of code that won’t be evaluated by the compiler and won’t be executed. Just like in C, Java, JavaScript, and similar languages, comments are created in two ways:</p><ul><li>Single-line comments are created by adding <span class="cf ic">//</span> before the comment.</li><li>Multi-line comments are created by adding <span class="cf ic">/*</span> before the comment and <span class="cf ic">*/</span> after it.</li></ul>
<p id="d24e41735">For example:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">// this is a comment</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">int</strong>​ a = 3; ​<em class="comment">// this is also a comment</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">/* this is also</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   a long, long</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   comment */</em>​</td></tr></table>
<p id="d24e41757">where <span class="cf ic">int a = 3;</span> is regular code (not a comment) and will be evaluated by the compiler and executed.</p>,<h2 id="sec.dart.functions">Functions</h2>
<p id="d24e43742">


Dart supports top-level functions, meaning you can define functions outside any class definition that can be called from anywhere in the code.</p>
<p id="d24e43756">A Dart function is defined in the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">returnType ​<strong class="kw">functionName</strong>​(parameters) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  blockOfInstructions;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ returnValue;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e43774">where:</p><ul><li>
<p id="d24e43778"><span class="cf ic">returnType</span> is the data type, see the section <a href="/links/f_0093/f_0093.xhtml#sec.dart.types.conversion">​<em>Conversion Between Native Java/Apple and Dart Data Types</em>​</a>, the function will return.</p></li><li>
<p id="d24e43785">The parameters, explained in the next paragraph, which will be the data the function will use to do what it needs to do. Parameters are variables and their value is set using function call arguments. If you are not familiar with functions and function calls, the example that follows is designed to give a real, working example of a few functions that take advantage of other functions.</p></li><li>
<p id="d24e43788">In the curly braces is where you add the block of instructions (one or more lines) which, if the function has any return type other than <span class="cf ic">void</span>, includes a <span class="cf ic">return</span> instruction, which is used to return a value to the calling code.

</p></li></ul>
<p id="d24e43807">For example, the following function is very simple:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">double</strong>​ ​<strong class="kw">square</strong>​(​<strong class="kw">double</strong>​ n) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ n*n;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e43830">

but it can be used inside a function to calculate gravitational attraction, which is slightly more complex, with more parameters:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">// We'll see how to set all of those arguments soon</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">double</strong>​ ​<strong class="kw">calculateGravitationalAttraction</strong>​(​<strong class="kw">double</strong>​ mass1, ​<strong class="kw">double</strong>​ mass2, ​<strong class="kw">double</strong>​ distance)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">{</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">const</strong>​ G = 6.67e-11;  ​<em class="comment">// universal gravitation constant</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">/*</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   * Calling the square function using distance as</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   * the only argument (n will be equal to</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   * the value in the distance variable)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   * and saving the return value</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   * to the squaredDistance variable</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   */</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">const</strong>​ squaredDistance = square(distance);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ G*mass1*mass2/squaredDistance;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e43906">and it, in turn, can be used to calculate, for example, the force of attraction between the earth and the sun, potentially wrapped inside another function:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">double</strong>​ ​<strong class="kw">calculateSunEarthAttraction</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">const</strong>​ earthMass = 5.97e24; ​<em class="comment">// mass of the Earth</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">const</strong>​ sunMass = 1.99e30;  ​<em class="comment">// mass of the Sun</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">const</strong>​ dist = 1.496e8; ​<em class="comment">// distance between the Earth and the Sun</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">/*</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   * Calling the calculateGravitationalAttraction</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   * function setting the arguments one by one</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   * in the order of the parameters in the</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   * function's definition and returning</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   * its return value to any other function</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   * that needs the value of the force of</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   * attraction between the Sun and the Earth</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   */</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ calculateGravitationalAttraction(earthMass, sunMass, dist);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3 id="sec.dart.function.parameters">Function Parameters</h3>
<p id="d24e43977">Up until now, we have only used positional parameters: you define them like variables, one after another, and you set the arguments in the same way, following the same order.

</p>
<p id="d24e43982">



Now, though, you need to know about <span class="emph">named</span> parameters, which allow the calling function to set the arguments in a different order (or even for just some of the parameters) by specifying a name for each parameter.

If you wrap the parameters in curly braces, you’ll make them <span class="emph">named</span> and <span class="emph">optional</span>, like in the following example:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">double</strong>​ ​<strong class="kw">calculateSunPlanetAttraction</strong>​({})</td></tr></table><h3>The Arrow</h3>
<p id="d24e44027">


If the function will be simply composed of one instruction, you can use the arrow notation, so that:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">int</strong>​ ​<strong class="kw">square</strong>​(​<strong class="kw">int</strong>​ n) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ n*n;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e44062">becomes:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">int</strong>​ ​<strong class="kw">square</strong>​(​<strong class="kw">int</strong>​ n) =&gt; n*n;</td></tr></table>
<p id="d24e44076">usually written, especially when the expression is longer, as:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">int</strong>​ ​<strong class="kw">square</strong>​(​<strong class="kw">int</strong>​ n) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  n*n;</td></tr></table><h3 id="sec.dart.functions.closures">Anonymous Functions and Closures</h3>
<p id="d24e44095">

Closures are what we use to define callbacks. They are functions defined as variables or, more specifically, variables of type <span class="cf class">Function</span> or <a href="/links/f_0091/f_0091.xhtml#sec.dart.typedef">​<em>Typedef and Callbacks</em>​</a>.

</p>,<h2 id="d24e44112">main</h2>
<p id="d24e44115">

Main is the function  that gets called when we start any kind of Dart program, including Flutter apps. It has a <span class="cf ic">void</span> return type and it takes no arguments. It can be <span class="cf ic">async</span>.</p>,<h2 id="sec.dart.conditionals">Conditional Constructs and Expressions</h2>
<p id="d24e45135">

Some languages (such as Rust) treat conditional constructs as expressions. Dart only does this when they are inside a list literal; in other places you’d need to use a conditional expression with the conventional C-like syntax using the ternary <span class="cf ic">?:</span> operator.</p><h3>The if-else Construct</h3>
<p id="d24e45150">

The if-else construct in Dart is very similar to that of many other languages; it can be expressed using curly braces:

</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">if</strong>​(condition) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// Instructions to execute when the condition is true</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">} ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// Instructions to execute when the condition is false</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e45198">and, if there is only one instruction to execute for each, without curly braces (executing <span class="cf ic">true_instruction</span> when the condition is true and <span class="cf ic">false_instruction</span> when it is false), usually written without line breaks:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">if</strong>​(condition) true_instruction;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">else</strong>​          false_instruction;</td></tr></table><h4><span class="cf ic">else if</span></h4>
<p id="d24e45220">If there is a condition to check inside the else clause you can use the <span class="cf ic">else if</span> construct:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">int</strong>​ a;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">// (...)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">if</strong>​(a&gt;10) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// (...)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">} ​<strong class="kw">else</strong>​ ​<strong class="kw">if</strong>​(a == 10) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// (...)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">} ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// (...)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3>Conditional Expressions</h3>
<p id="d24e45268">

If you need to test a condition to decide between two values for an assignment, an expression or a return statement you can use a conditional expression. It is an expression containing the <span class="cf ic">?:</span> ternary operator, and it can be used in the following way:


</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ a = condition ? true_value : false_value;</td></tr></table>
<p id="d24e45298">in which the value of <span class="cf variable">a</span> will be <span class="cf ic">true_value</span> if the <span class="cf ic">condition</span> is <span class="cf ic">true</span> and <span class="cf ic">false_value</span> if the <span class="cf ic">condition</span> is <span class="cf ic">false</span>. This is extremely useful for replacing simple functions such as the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">num</strong>​ ​<strong class="kw">max</strong>​(​<strong class="kw">num</strong>​ a, ​<strong class="kw">num</strong>​ b) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(b &gt; a) ​<strong class="kw">return</strong>​ b;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">else</strong>​ ​<strong class="kw">return</strong>​ a;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e45355">with even simpler one-liners:

</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">num</strong>​ ​<strong class="kw">max</strong>​(​<strong class="kw">num</strong>​ a, ​<strong class="kw">num</strong>​ b) =&gt; b &gt; a ? b : a;</td></tr></table><h3 id="sec.dart.switch">Switch</h3>
<p id="d24e45378">

Switch is one of the features of Dart that might look most archaic: it works just like C’s or Java’s. They are used when you need to compare a variable to a certain number of constant values and are not recommended for use in Flutter apps.
Its structure is the following:
</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ a;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">// (...)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">switch</strong>​(a) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">case</strong>​ 1:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// instructions to execute if a is equal to 1</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">break</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">case</strong>​ 2:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// instructions to execute if a is equal to 2</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">break</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">default</strong>​:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// instructions to execute if a is neither equal to 1 nor 2</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e45448">
If you omit the <span class="cf keyword">break</span> instructions, the cases defined after the case triggered by the value of the variable will be executed as well. This effect (<span class="emph">fall-through</span>) allows for multiple values to be handled by a single <span class="cf ic">case</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">switch</strong>​(a) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">case</strong>​ 1: ​<em class="comment">// this is supposed to fall through</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">case</strong>​ 2:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// instructions for values 1 and 2</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">break</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">case</strong>​ 3:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// instructions for the value 3</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">break</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">default</strong>​:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// (...)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e45515">Fall-through obtained by omitting <span class="cf keyword">break</span> is not allowed if you have instructions in the <span class="cf ic">case</span> and will generate an error. If you mean to do that, you should use the <span class="cf keyword">continue</span> instruction with a label:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">switch</strong>​(a) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">case</strong>​ 1:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// additional instructions for 1</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">continue</strong>​ caseTwo;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  caseTwo:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">case</strong>​ 2:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// instructions for 1 and 2</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">break</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">default</strong>​:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// (...)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>,<h2 id="sec.dart.loops">Loops: while, do while, and for</h2>
<p id="d24e45577">







Dart supports the most common loop constructs, the <span class="cf keyword">for</span> loop supports the <span class="cf ic">for</span> <span class="cf ic">in</span> notation and it can be used inside list/collection literals starting from Dart 2.3:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ list1 = [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">for</strong>​(​<strong class="kw">int</strong>​ i = 0; i &lt; 100; i++)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    i,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">];</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ list2 = [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">for</strong>​(​<strong class="kw">var</strong>​ element ​<strong class="kw">in</strong>​ list1)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"#</em>​​<em class="string">$element</em>​​<em class="string">"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">];</td></tr></table>,<h2 id="sec.dart.typedef">Typedef and Callbacks</h2>
<p id="d24e46582">




<span class="cf keyword">typedef</span> is what is used to create callback types like <span class="cf class">VoidCallback</span>, which is a <span class="cf ic">void</span> callback type for functions that don’t require arguments. A callback is a kind of <span class="emph">closure</span> that is provided as an argument to a function to be called when some conditions are met. A closure is a function that is defined a lot like a variable. The <span class="cf class">VoidCallback</span> type is a special kind of <span class="cf class">Function</span> that takes no arguments and has a <span class="cf ic">void</span> return type and it can be defined in the following way using <span class="cf keyword">typedef</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">typedef</strong>​ VoidCallback = ​<strong class="kw">void</strong>​ Function();</td></tr></table>
<p id="d24e46639">If you wanted to define a callback of a different type that takes some sort of arguments, you’d write the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">typedef</strong>​ IntFunctionCallback = ​<strong class="kw">int</strong>​ Function(​<strong class="kw">int</strong>​ n);</td></tr></table>
<p id="d24e46653">or the following very common mathematical definition of a real function of a real variable:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">typedef</strong>​ RealFunctionOfARealVariable = ​<strong class="kw">double</strong>​ Function(​<strong class="kw">double</strong>​ n);</td></tr></table>
<p id="d24e46667">


Definitions can be type-independent (this kind of syntax can be used with anything in Dart):</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">typedef</strong>​ OneArgumentCallback&lt;T&gt; = T Function(T a);</td></tr></table>
<p id="d24e46688">After defining such a type or just using the generic <span class="cf class">Function</span> type, we can create functions just like we create variables. For example, if we wanted to recreate in Dart equivalent the <span class="emph">f(x) = e<sup>x</sup></span> exponential function (where <span class="cf constant">e</span> is Euler’s number, better known in some countries as Napier’s number), we would write the following, using <span class="cf methodname">pow</span> and <span class="cf constant">e</span> from <span class="cf ic">dart:math</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">RealFunctionOfARealVariable f = (x) =&gt; pow(e, x);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(f(2) == pow(e, 2));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(f(1) &gt; 2.71 &amp;&amp; f(1) &lt; 2.72);</td></tr></table>,<h2 id="sec.dart.import">Mastering import</h2>
<p id="d24e46728">



The <span class="cf keyword">import</span> directive in Dart, as is the case in many other modern language, doesn’t only handle inclusion of external library files in the code like the good old C <span class="cf ic">#include</span>: it can do more than that to make our life easier when dealing with libraries and packages.</p><h3>The Basics</h3>
<p id="d24e46754">We’ll start with the basics: importing an entire file to the current namespace.</p><h4>Importing a Local File</h4>
<p id="d24e46759">

You can import another local Dart file by using a relative path to it:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'filename.dart'</em>​;</td></tr></table><h4>Importing a Built-In Dart Library</h4>
<p id="d24e46778">


You can import a built-in Dart library by prefacing the name of the library with <span class="cf ic">dart:</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'dart:async'</em>​;</td></tr></table><h4>Importing from a Package</h4>
<p id="d24e46807">
You can import a file from a package by using:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:packagename/filename.dart'</em>​;</td></tr></table>
<p id="d24e46822">Which can be used to import files from the Flutter SDK by using <span class="cf ic">flutter</span> as the package name:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:flutter/services.dart'</em>​</td></tr></table>
<p id="d24e46835">This syntax can also be used to import files in the app’s <span class="cf dir">lib</span> directory by using the app’s package name as the package name.</p><h4>Using as to Import Under a Namespace</h4>
<p id="d24e46843">
You can also <span class="cf ic">import</span> under a namespace, by using the following syntax:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'customlib.dart'</em>​ ​<strong class="kw">as</strong>​ MyCustomLib;</td></tr></table>
<p id="d24e46865">So that, for example, if there is a <span class="cf class">CustomLibraryClass</span> class defined in that file, you can access it by using <span class="cf ic">MyCustomLib.CustomLibraryClass</span> instead of just <span class="cf ic">CustomLibraryClass</span>.</p>
<p id="d24e46876">This allows you to import many libraries without cluttering your main namespace, keeping each library separated, without risking having multiple classes with the same name.</p>
<p id="d24e46878">Another great advantage comes when you go back to your code after a while: you will know exactly which library that class is from, without having to figure that out first.</p><h4>Using show to Only Import Some Parts of a File</h4>
<p id="d24e46883"><span class="cf ic">import</span> can also be used to only import some classes inside a file.</p>
<p id="d24e46887">
For example, if you only need the <span class="cf class">CustomLibraryClass</span> from the <span class="cf ic">customlib.dart</span> file and don’t want to import other classes (maybe because they have the same name as other classes in your namespace and you don’t want to use <span class="cf ic">as</span> and deal with extra dot notation), which you can do with the following code:

</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'customlib.dart'</em>​ ​<strong class="kw">show</strong>​ CustomLibraryClass;</td></tr></table>,<h2 id="sec.dart.types.conversion">Conversion Between Native Java/Apple and Dart Data Types</h2>
<p id="d24e46922">
</p><table class="simpletable hlines"><thead><tr><th class="hlines">Type</th><th class="hlines">Dart</th><th class="hlines">Java</th><th class="hlines">Objective-C/Swift</th></tr></thead><tbody><tr class="tr "><td style=""><p class="last-para-in-cell">Integer number</p></td><td style=""><p class="last-para-in-cell">int</p></td><td style=""><p class="last-para-in-cell">Integer/Long depending on size</p></td><td style=""><p class="last-para-in-cell">NSNumber NumberWithInt:/NumberWithLong: depending on size</p></td></tr><tr class="tr line-on-top"><td style=""><p class="last-para-in-cell">Boolean value</p></td><td style=""><p class="last-para-in-cell">bool</p></td><td style=""><p class="last-para-in-cell">Boolean</p></td><td style=""><p class="last-para-in-cell">NSNumber NumberWithBool:</p></td></tr><tr class="tr line-on-top"><td style=""><p class="last-para-in-cell">String of characters</p></td><td style=""><p class="last-para-in-cell">String</p></td><td style=""><p class="last-para-in-cell">String</p></td><td style=""><p class="last-para-in-cell">NSString</p></td></tr><tr class="tr line-on-top"><td style=""><p class="last-para-in-cell">Monodimensional and uniform collection of elements</p></td><td style=""><p class="last-para-in-cell">List</p></td><td style=""><p class="last-para-in-cell">ArrayList</p></td><td style=""><p class="last-para-in-cell">NSArray</p></td></tr><tr class="tr line-on-top"><td style=""><p class="last-para-in-cell">Key-value pair list</p></td><td style=""><p class="last-para-in-cell">Map</p></td><td style=""><p class="last-para-in-cell">HashMap</p></td><td style=""><p class="last-para-in-cell">NSDictionary</p></td></tr></tbody></table>,<h2 id="d24e47008">Where You’re Going Next</h2>
<p id="d24e47011">If you have read this appendix before reading the book itself, go back to the beginning and get started! All of the stuff in this appendix will be really easy to apply to building user interfaces using Flutter’s great declarative UI syntax.</p>
<p id="d24e47013">If you’ve already read through the rest of the book, the next appendix will show you how to make your apps look native on iOS and how to use the platform-specific configuration to set a custom app name and app icon to prepare your app for distribution.</p>

<div class="footnotes">
<h4>Footnotes</h4>
<dl>
<dt class="footnote-number"><a href="/links/f_0084/f_0084.xhtml#FNPTR-55" id="FOOTNOTE-55">[55]</a></dt><dd>
<p id="d24e42642"><a href="https://api.dartlang.org/stable/2.3.2/dart-core/List-class.html">https://api.dartlang.org/stable/2.3.2/dart-core/List-class.html</a></p></dd></dl></div>
<div class="copyright">Copyright © 2020, The Pragmatic Bookshelf.</div>,<h1 class="chapter-title" id="chp.pubspec"><span class="chapter-number">
            Appendix
            2</span><br/><span class="chapter-name"> Apple-Like Look and Additional App Configuration </span></h1>

<p id="d24e47021">There are many things you can’t set in standard Flutter Dart code, like custom app names containing spaces and capitalized letters, as well as custom app icons. There also are many things to be learned about the various features of the <span class="cf filename">pubspec.yaml</span> file.</p>
<p id="d24e47026">But first, let’s talk about how you can make your app look more at home on an iPhone by discovering Cupertino widgets.</p>,<h2 id="d24e48283">pubspec.yaml</h2>
<p id="d24e48286">
<span class="cf filename">pubspec.yaml</span> is the file that defines all of the information that Dart needs to build the app.</p><h3>Basic Package Data</h3>
<p id="d24e48298">

The most basic data contained in <span class="cf filename">pubspec.yaml</span> is the <span class="cf ic">name</span> and the <span class="cf ic">description</span>. The <span class="cf ic">description</span> can contain upper and lower case characters as well as spaces and punctuation, whereas the <span class="cf ic">name</span> must only contain lower case letters and underscores.</p>
<p id="d24e48325">Given that the name you set when creating the app project is also the default app name, the user experience isn’t helped by having to select an app that only has lowercase letters and spaces in it, which isn’t really the style that is favored in the mobile industry at the moment (there aren’t many spaces being used, but names are usually capitalized). We’ll be solving this problem at <a href="/links/f_0098/f_0098.xhtml#sec.appconfig.platspec">​<em>Platform-Specific Setup</em>​</a>. In that section we’ll also be seeing how to change the app icon from the default Flutter logo.</p><h3>Setting the Version</h3>
<p id="d24e48332">
One of the things that can be set in <span class="cf filename">pubspec.yaml</span> is the <span class="cf ic">version</span>. If you’re building a package to be released on Pub, it’s obviously going to be used by your users when they are installing the package. In the case of apps, it is automatically added to the platform-specific configuration of each app so that you don’t need to change the app version in multiple files every time.</p><h4>Dependency Versions, Caret Syntax, and Semantic Versioning</h4>
<p id="d24e48347">



Versions of Dart dependencies can either be specified by providing just one version number, which will force the installation of that version of the package, as a range using comparison operators (for example, <span class="cf ic">&gt;=1.0.0 &lt; 1.7.3</span>) or by prefixing a version with the <span class="cf ic">^</span> character (for example, <span class="cf ic">^1.2.0</span>), which will allow all versions that are backwards compatible with calls that worked in that version of a library. This is called caret syntax. It was introduced in Dart 1.8.3, which is the reason why the <span class="cf ic">environment</span> section in <span class="cf filename">pubspec.yaml</span> is specified using traditional syntax: we need to make sure we can use it before we use it, and we make sure we can use it by depending on newer versions of Dart. That <span class="cf ic">environment</span> section should be kept in mind when changing the app using features that were only recently introduced to Dart.</p>
<p id="d24e48383">
This means the version can’t just be a number you make up: it should follow semantic versioning, which is a standard followed by most package managers and explained in detail in its own website.<sup><a class="footnote" href="/links/f_0098/f_0098.xhtml#FOOTNOTE-58" id="FNPTR-58">[58]</a></sup> In case you’re not aware, it is based on the idea that the version should follow the <span class="emph">MAJOR.MINOR.PATCH</span> template, meaning that the first number should be changed when making breaking changes, the second should be changed when adding new features without breaking compatibility, and the third should be changed when fixing bugs.</p>
<p id="d24e48400">Dart versions are made of the version specified according to semantic versioning and, optionally, a plus sign and a number called the <span class="emph">build number</span>, which is usually used when a new version only introduces documentation or configuration changes.

</p>,<h2 id="sec.appconfig.platspec">Platform-Specific Setup</h2>
<p id="d24e48411">
In this section we’ll see how to change the app name and launcher icon of a Flutter app by editing the platform-specific configuration.</p><h3>Setting a Custom App Name</h3>
<p id="d24e48418">
The Dart package name (which is also the default app name) has to be composed of just lowercase letters and underscore, which isn’t really much. That’s why we are going to set our own app name by digging into the platform-specific configuration.</p><h4>Setting the Android App Name</h4>
<p id="d24e48427">

The app name displayed on Android can be changed by changing the <span class="cf ic">android:label</span> attribute of the <span class="cf ic">application</span> tag in the <span class="cf filename">AndroidManifest.xml</span> file found in <span class="cf dir">appdir/android/app/src/main</span>. This is what it would look like if we were configuring the <span class="emph">Chat on Fire</span> app we built in the last chapter of the book:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire2/android/app/src/main/AndroidManifest.xml">firebase/chatonfire2/android/app/src/main/AndroidManifest.xml</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">&lt;application</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    android:name=​<em class="string">"io.flutter.app.FlutterApplication"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    android:label=​<em class="string">"Chat on Fire"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    android:icon=​<em class="string">"@mipmap/ic_launcher"</em>​&gt;</td></tr></table><h4>Setting the iOS App Name</h4>
<p id="d24e48482">

The app name displayed on iOS is usually changed by opening the <span class="cf dir">Runner.xcworkspace</span> Xcode project in the <span class="cf dir">ios</span> directory in Xcode and changing the <span class="emph">Display name</span> project-level setting. Alternatively, add a key called <span class="emph">CFBundleDisplayName</span> followed by a string to the <span class="cf filename">Info.plist</span> file in the <span class="cf dir">appdir/ios/Runner</span> directory, like in the following example:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire2/ios/Runner/Info.plist">firebase/chatonfire2/ios/Runner/Info.plist</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">&lt;​<strong class="kw">k</strong>​e​<strong class="kw">y</strong>​&gt;CFBundleDisplayName&lt;​<strong class="kw">/k</strong>​e​<strong class="kw">y</strong>​&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">&lt;​<strong class="kw">string</strong>​&gt;Chat on Fire&lt;​<strong class="kw">/string</strong>​&gt;</td></tr></table><h3>Setting the Launcher Icon</h3>
<p id="d24e48539">


Any decent app needs a custom icon, and Flutter apps certainly don’t make for an exception to that. There is a CLI tool on Pub called <span class="cf ic">flutter_launcher_icons</span> that simplifies this, but you may choose to do that manually. This section will cover both cases.</p><h4>Using Flutter Launcher Icons to Change the Launcher Icon</h4>
<p id="d24e48556">


The Flutter Launcher Icons package is the typical example of a package that should be added to the <span class="cf ic">dev_dependencies</span> section in <span class="cf filename">pubspec.yaml</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire2/pubspec.yaml">firebase/chatonfire2/pubspec.yaml</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">dev_dependencies:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  flutter_launcher_icons:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  flutter_test:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    sdk: ​<em class="string">flutter</em>​</td></tr></table>
<p id="d24e48602">After doing that and running:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">$ flutter packages get</td></tr></table>
<p id="d24e48610">it’s time to configure the package.</p><p><strong>A Quick and Simple Example</strong></p>
<p id="d24e48615">This can be done either in <span class="cf filename">pubspec.yaml</span> or in a new file by adding a <span class="cf ic">flutter_icons</span> section:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire2/pubspec.yaml">firebase/chatonfire2/pubspec.yaml</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">flutter_icons:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  image_path: ​<em class="string">"</em>​​<em class="string">icons/launcher_icon.png"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  android: true</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ios: true</td></tr></table>
<p id="d24e48648">This is what you’ll use most of the time: the <span class="cf ic">image_path</span> will be the path to the image that will be used to overwrite the default launcher image for both Android and iOS when you run:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">$ flutter packages run flutter_launcher_icons:main</td></tr></table><p><strong>Choosing a Different Path for the Configuration File</strong></p>
<p id="d24e48662">
That command will work if the configuration is either in <span class="cf filename">pubspec.yaml</span> or in a file you create called <span class="cf filename">flutter_launcher_icons.yaml</span>. If you want to use a custom file with a different name you can use the <span class="cf commandoption">-f</span> option in the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">$ flutter packages run flutter_launcher_icons:main -f filename.yaml</td></tr></table><p><strong>Using Different Files for Android and iOS</strong></p>
<p id="d24e48689">

Instead of providing one <span class="cf ic">image_path</span> for both Android and iOS, you might choose to set an <span class="cf ic">image_path_android</span> for Android and an <span class="cf ic">image_path_ios</span> for iOS. You might want to do that because, unlike Android, iOS will replace any transparency with black, meaning that iOS app icons have to fill the entire image and not have transparent borders, unlike Android icons.</p><h4>Changing the Launcher Icon Manually</h4>
<p id="d24e48712">Instead of using the <span class="cf ic">flutter_launcher_icons</span> package, you might want to change the launcher icon yourself. This is very time-consuming to do 100% manually: for Android, you can change the app icon by providing different resolutions of the launcher icon for devices with different pixel density values in the <span class="cf dir">appdir/android/app/src/main/res/mipmap-*dpi</span> (following the official Android Developer guidelines<sup><a class="footnote" href="#FOOTNOTE-59" id="FNPTR-59">[59]</a></sup>). A similar process is required for iOS icons to replace the ones in the <span class="cf dir">appdir/ios/Runner/Assets.xcassets/Appicon.appiconset</span>.</p>
<p id="d24e48728">A way to bypass some of that is by using Android Studio’s <span class="emph">Image Asset</span> creation tool that will automatically generate different resolutions of the icon, and by opening <span class="cf filename">Assets.xcassets</span> in <span class="cf dir">appdir/ios/Runner</span> with Xcode and using that to replace the default icons.</p>
<p id="d24e48739">With that, your app should be ready for distribution to your users, whatever operating system their phone runs on.


</p>

<div class="footnotes">
<h4>Footnotes</h4>
<dl>
<dt class="footnote-number"><a href="/links/f_0096/f_0096.xhtml#FNPTR-56" id="FOOTNOTE-56">[56]</a></dt><dd>
<p id="d24e47675"><a href="https://flutter.dev/docs/development/ui/widgets/cupertino">https://flutter.dev/docs/development/ui/widgets/cupertino</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0096/f_0096.xhtml#FNPTR-57" id="FOOTNOTE-57">[57]</a></dt><dd>
<p id="d24e48254"><a href="https://pub.dev/documentation/flutter_platform_widgets/latest/">https://pub.dev/documentation/flutter_platform_widgets/latest/</a></p></dd>
<dt class="footnote-number"><a href="/links/f_0097/f_0097.xhtml#FNPTR-58" id="FOOTNOTE-58">[58]</a></dt><dd>
<p id="d24e48391"><a href="https://semver.org/">https://semver.org/</a></p></dd>
<dt class="footnote-number"><a href="#FNPTR-59" id="FOOTNOTE-59">[59]</a></dt><dd>
<p id="d24e48721"><a href="https://developer.android.com/guide/topics/resources/providing-resources">https://developer.android.com/guide/topics/resources/providing-resources</a></p></dd></dl></div>
<div class="copyright">Copyright © 2020, The Pragmatic Bookshelf.</div>

<div class="backmatter-cover">Thank you!
<p id="d24e51359">
   How did you enjoy this book? Please let us know. Take a moment and email us at support@pragprog.com with your feedback. Tell us your story and you could win free ebooks. Please use the subject line “Book Feedback.”
   </p>
<p id="d24e51361">
   Ready for your next great Pragmatic Bookshelf book? Come on over to <a href="https://pragprog.com">https://pragprog.com</a> and use the coupon code BUYANOTHER2020 to save 30% on your next ebook.
   </p>
<p id="d24e51366">
   Void where prohibited, restricted, or otherwise unwelcome. Do not use ebooks near water. If rash persists, see a doctor. Doesn’t apply to <span class="emph">The Pragmatic Programmer</span> ebook because it’s older than the Pragmatic Bookshelf itself. Side effects may include increased knowledge and skill, increased marketability, and deep satisfaction. Increase dosage regularly.
   </p>
<p id="d24e51371">
   And thank you for your continued support,
   </p>
<p id="d24e51373">
   Andy Hunt, Publisher
   </p><div class="ss"><img alt="images/Coupon.png" class="" id="d24e51375" src="/images/img90/images/Coupon.png"/></div></div>,<h2>You May Be Interested In…</h2><p><em>Select a cover for more information</em></p><div class="backmatter-covers"><div class="backmatter-cover"><h3>Agile Web Development with Rails 6</h3><div class="cover-image"><a href="http://pragmaticprogrammer.com/titles/rails6"><img alt="" src="/images/cover-rails6/images/_covers/rails6.jpg"/></a></div><p>
      Learn Rails the way the Rails core team recommends it, along with the tens of thousands of developers who have used this broad, far-reaching tutorial and reference. If you’re new to Rails, you’ll get step-by-step guidance. If you’re an experienced developer, get the comprehensive, insider information you need for the latest version of Ruby on Rails. The new edition of this award-winning classic is completely updated for Rails 6 and Ruby 2.6, with information on processing email with Action Mailbox and managing rich text with Action Text.
    </p><p>Sam Ruby and David Bryant Copeland</p><p>(494 pages) ISBN: 9781680506709 $57.95</p></div><div class="backmatter-cover"><h3>Modern Systems Programming with Scala Native</h3><div class="cover-image"><a href="http://pragmaticprogrammer.com/titles/rwscala"><img alt="" src="/images/cover-rwscala/images/_covers/rwscala.jpg"/></a></div><p>
      Access the power of bare-metal systems programming with Scala Native, an ahead-of-time Scala compiler. Without the baggage of legacy frameworks and virtual machines, Scala Native lets you re-imagine how your programs interact with your operating system. Compile Scala code down to native machine instructions; seamlessly invoke operating system APIs for low-level networking and IO; control pointers, arrays, and other memory management techniques for extreme performance; and enjoy instant start-up times. Skip the JVM and improve your code performance by getting close to the metal.
    </p><p>Richard Whaling</p><p>(260 pages) ISBN: 9781680506228 $45.95</p></div><div class="backmatter-cover"><h3>Fixing Your Scrum</h3><div class="cover-image"><a href="http://pragmaticprogrammer.com/titles/rrscrum"><img alt="" src="/images/cover-rrscrum/images/_covers/rrscrum.jpg"/></a></div><p>
      Broken Scrum practices limit your organization’s ability to take full advantage of the agility Scrum should bring: The development team isn’t cross-functional or self-organizing, the product owner doesn’t get value for their investment, and stakeholders and customers are left wondering when something—anything—will get delivered. Learn how experienced Scrum masters balance the demands of these three levels of servant leadership, while removing organizational impediments and helping Scrum teams deliver real-world value. Discover how to visualize your work, resolve impediments, and empower your teams to self-organize and deliver using advanced coaching and facilitation techniques that honor and support the Scrum values and agile principles.
    </p><p>Ryan Ripley and Todd Miller</p><p>(240 pages) ISBN: 9781680506976 $45.95</p></div><div class="backmatter-cover"><h3>Software Estimation Without Guessing</h3><div class="cover-image"><a href="http://pragmaticprogrammer.com/titles/gdestimate"><img alt="" src="/images/cover-gdestimate/images/_covers/gdestimate.jpg"/></a></div><p>
      Developers hate estimation, and most managers fear disappointment with the results, but there is hope for both. You’ll have to give up some widely held misconceptions: let go of the notion that “an estimate is an estimate,” and estimate for your particular need. Realize that estimates have a limited shelf-life, and re-estimate frequently as needed. When reality differs from your estimate, don’t lament; mine that disappointment for the gold that can be the longer-term jackpot. We’ll show you how.
    </p><p>George Dinwiddie</p><p>(246 pages) ISBN: 9781680506983 $29.95</p></div><div class="backmatter-cover"><h3>Test-Driven React</h3><div class="cover-image"><a href="http://pragmaticprogrammer.com/titles/tbreact"><img alt="" src="/images/cover-tbreact/images/_covers/tbreact.jpg"/></a></div><p>
      You work in a loop: write code, get feedback, iterate. The faster you get feedback, the faster you can learn and become a more effective developer. Test-Driven React helps you refine your React workflow to give you the feedback you need as quickly as possible. Write strong tests and run them continuously as you work, split complex code up into manageable pieces, and stay focused on what’s important by automating away mundane, trivial tasks. Adopt these techniques and you’ll be able to avoid productivity traps and start building React components at a stunning pace!
    </p><p>Trevor Burnham</p><p>(190 pages) ISBN: 9781680506464 $45.95</p></div><div class="backmatter-cover"><h3>Seven Mobile Apps in Seven Weeks</h3><div class="cover-image"><a href="http://pragmaticprogrammer.com/titles/7apps"><img alt="" src="/images/cover-7apps/images/_covers/7apps.jpg"/></a></div><p>
      Answer the question “Can we build this for ALL the devices?” with a resounding YES. Learn how to build apps using seven different platforms: Mobile Web, iOS, Android, Windows, RubyMotion, React Native, and Xamarin.  Find out which cross-platform solution makes the most sense for your needs, whether you’re new to mobile or an experienced developer expanding your options. Start covering all of the mobile world today.
    </p><p>Tony Hillerson</p><p>(370 pages) ISBN: 9781680501483 $40</p></div><div class="backmatter-cover"><h3>Designing Elixir Systems with OTP</h3><div class="cover-image"><a href="http://pragmaticprogrammer.com/titles/jgotp"><img alt="" src="/images/cover-jgotp/images/_covers/jgotp.jpg"/></a></div><p>
      You know how to code in Elixir; now learn to think in it. Learn to design libraries with intelligent layers that shape the right data structures, flow from one function into the next, and present the right APIs. Embrace the same OTP that’s kept our telephone systems reliable and fast for over 30 years. Move beyond understanding the OTP functions to knowing what’s happening under the hood, and why that matters. Using that knowledge, instinctively know how to design systems that deliver fast and resilient services to your users, all with an Elixir focus.
    </p><p>James Edward Gray, II and Bruce A. Tate</p><p>(246 pages) ISBN: 9781680506617 $41.95</p></div><div class="backmatter-cover"><h3>Programming Phoenix 1.4</h3><div class="cover-image"><a href="http://pragmaticprogrammer.com/titles/phoenix14"><img alt="" src="/images/cover-phoenix14/images/_covers/phoenix14.jpg"/></a></div><p>
      Don’t accept the compromise between fast and beautiful: you can have it all. Phoenix creator Chris McCord, Elixir creator José Valim, and award-winning author Bruce Tate walk you through building an application that’s fast and reliable. At every step, you’ll learn from the Phoenix creators not just what to do, but why. Packed with insider insights and completely updated for Phoenix 1.4, this definitive guide will be your constant companion in your journey from Phoenix novice to expert as you build the next generation of web applications.
    </p><p>Chris McCord, Bruce Tate and José Valim</p><p>(356 pages) ISBN: 9781680502268 $45.95</p></div><div class="backmatter-cover"><h3>Programming Kotlin</h3><div class="cover-image"><a href="http://pragmaticprogrammer.com/titles/vskotlin"><img alt="" src="/images/cover-vskotlin/images/_covers/vskotlin.jpg"/></a></div><p>
      Programmers don’t just use Kotlin, they love it. Even Google has adopted it as a first-class language for Android development. With Kotlin, you can intermix imperative, functional, and object-oriented styles of programming and benefit from the approach that’s most suitable for the problem at hand. Learn to use the many features of this highly concise, fluent, elegant, and expressive statically typed language with easy-to-understand examples. Learn to write maintainable, high-performing JVM and Android applications, create DSLs, program asynchronously, and much more.
    </p><p>Venkat Subramaniam</p><p>(460 pages) ISBN: 9781680506358 $51.95</p></div><div class="backmatter-cover"><h3>Programming Elm</h3><div class="cover-image"><a href="http://pragmaticprogrammer.com/titles/jfelm"><img alt="" src="/images/cover-jfelm/images/_covers/jfelm.jpg"/></a></div><p>
      Elm brings the safety and stability of functional programing to front-end development, making it one of the most popular new languages. Elm’s functional nature and static typing means that runtime errors are nearly impossible, and it compiles to JavaScript for easy web deployment. This book helps you take advantage of this new language in your web site development. Learn how the Elm Architecture will help you create fast applications. Discover how to integrate Elm with JavaScript so you can update legacy applications. See how Elm tooling makes deployment quicker and easier.
    </p><p>Jeremy Fairbank</p><p>(308 pages) ISBN: 9781680502855 $40.95</p></div></div><hr class="backmatter-end"/>,<h2 id="d24e266">Installing the SDK and the IDE Plugins</h2>
<p id="d24e269">To use Flutter, you need to install its SDK, and to be able to get on with your programming in a quick and uncomplicated manner, you’ll probably want to install the IDE tools too.</p>
<p id="d24e271">If you prefer to use the command line (maybe because you want to use other, perhaps lighter, IDEs or text editors) there will be guidance on the usage of the <span class="cf ic">flutter</span> command throughout the book.</p><h3>Installing Flutter</h3>
<p id="d24e279">
The installation process for the Flutter SDK differs slightly for each operating system, so I’ll separate the instructions into three sections. Skip ahead to the instructions specific to your platform and, if you want to install them, the part that covers IDE plugin installation.</p>
<p id="d24e285">
At the time of writing, the latest stable version is 1.9.1 and requires a 495MB download on Linux (tar.xz archive), a 655MB download on Windows (zip archive), or a 786MB download on macOS (zip archive).</p><h4>Installing on Linux</h4>
<p id="d24e294">

On a Linux machine only Android development is supported, so we will install just the Android SDK and the Flutter SDK itself. You’ll receive guidance for both CLI and graphical installation methods.</p><p><strong>Installing the Android SDK on Linux</strong></p>
<p id="d24e304">

If you have never developed Android apps, you need to install the Android SDK, which includes the tools needed to build and debug Android apps.</p>
<p id="d24e315">

In order to use Flutter, you need to install Android Studio and the Android SDK tools. Flutter requires Android Studio to be installed, but you don’t have to use it for development.</p><table class="simpletable outerlines"><thead><tr><th class="outerlines" colspan="2"><p class="last-para-in-cell">Alternatives to the Official Zip File</p></th></tr></thead><tbody><tr class="tr zebra "><td style="valign: middle; width: 12%; ">
               <img alt="images/aside-icons/info.png" class="" id="d24e336" src="/images/img66/images/aside-icons/info.png" style="width: 100%"/>
             </td><td style="valign: middle; width: 88%; ">

<p>


	On Gentoo and Arch Linux you can use packages to install the Android SDK and/or Android Studio:
</p>
	<ul><li>
<p id="d24e355">
				On Gentoo, you can install the Android Studio package<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-4" id="FNPTR-4">[4]</a></sup>
				by running <span class="cf commandname">emerge --ask dev-util/android-studio</span>;
			</p></li><li>
<p id="d24e366">For Arch Linux there is an actively maintained and popular package available on the AUR called <span class="emph">android-studio</span><sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-5" id="FNPTR-5">[5]</a></sup>.</p></li></ul>
</td></tr></tbody></table>
<p id="d24e376">Start by heading over to the downloads page on the Android Developers page:<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-6" id="FNPTR-6">[6]</a></sup> there you’ll find links for the .zip download of Android Studio (around 1GB in size).</p>
<p id="d24e383">


Regardless of what you choose, you might need to install some 32-bit libraries to make the SDK work on a 64-bit operating system:</p><ul><li>
<p id="d24e401">On Debian/Ubuntu, run <span class="cf ic">sudo apt install libc6:i386 libncurses5:i386 libstdc++6:i386 lib32z1 libbz2-1.0:i386</span></p></li><li>
<p id="d24e406">On Fedora, run <span class="cf ic">sudo dnf install zlib.i686 ncurses-libs.i686 bzip2-libs.i686</span>.</p></li></ul>
<p id="d24e411">After that, we’re ready to actually install the Android SDK.</p>
<p id="d24e413">To do that using the full Android Studio installer, after extracting the zip file you downloaded from Google’s website, run the <span class="cf filename">studio.sh</span> script contained in the <span class="cf dir">bin</span> subdirectory. This will start a setup wizard. After you complete the setup of the SDK you can launch Android Studio by running that same <span class="cf filename">studio.sh</span> script.

</p><p><strong>Installing the Flutter SDK on Linux</strong></p>
<p id="d24e433">

This part will provide guidance for Linux installation aimed at beginners; if you are comfortable with the command line the CLI steps will be more predictable. (For complete Linux newbies it might be easier to follow GUI-oriented guidance since that’s usually more familiar.)</p><table class="simpletable outerlines"><thead><tr><th class="outerlines" colspan="2"><p class="last-para-in-cell">Alternatives to the Tarball</p></th></tr></thead><tbody><tr class="tr zebra "><td style="valign: middle; width: 12%; ">
               <img alt="images/aside-icons/info.png" class="" id="d24e454" src="/images/img66/images/aside-icons/info.png" style="width: 100%"/>
             </td><td style="valign: middle; width: 88%; ">

<p>
	
	There are alternatives to installing the official tarball:
</p>
	<ul><li>
<p id="d24e468">Arch Linux has an actively maintained package in the AUR to install Flutter.<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-7" id="FNPTR-7">[7]</a></sup>
			</p></li></ul>
</td></tr></tbody></table>
<p id="d24e477">The Linux download is a source tarball that also contains the script needed to run the <span class="cf ic">flutter</span> command, which means you just need to extract it and add the <span class="cf dir">bin</span> subdirectory of the extracted tarball to the <span class="cf ic">PATH</span> environment variable.</p>
<p id="d24e488">Before we can do that, we need to browse to the SDK archive<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-8" id="FNPTR-8">[8]</a></sup> page on Flutter’s official website and download the latest stable version.</p>
<p id="d24e495">Alternatively, in a CLI-only environment, you can download the 1.2.1 tarball using <span class="cf ic">curl https://storage.googleapis.com/flutter_infra/releases/stable/linux/flutter_linux_v1.2.1-stable.tar.xz -o flutter_linux_v1.2.1-stable.tar.xz</span>.</p>
<p id="d24e500">Extract the tarball you just downloaded with any GUI tool of your liking or by running the following command:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">$ tar -xf flutter_linux_v1.2.1-stable.tar.xz</td></tr></table>
<p id="d24e511">Now we need to add the executable script to the <span class="cf ic">PATH</span> environment variable.</p>
<p id="d24e516">Before doing this, you need to take note of the directory where you extracted the tarball. It contains a <span class="cf dir">flutter</span> directory, inside which there is a <span class="cf dir">bin</span> directory; we need to know the path to reach that <span class="cf dir">bin</span> directory.</p>
<p id="d24e528">If you are using the GUI, in most distribution it is available by browsing the directory’s properties. It will be something along the lines of <span class="cf dir">/home/username/Downloads/flutter_linux_v1.9.1-stable/flutter/bin</span> if you have gone with the default settings for each piece of software used in the steps we described earlier. I suggest moving this to a more permanent path; ideally one at which you’ll remember you have installed Flutter.</p>
<p id="d24e533">If you worked in the CLI using the commands just outlined, browse to your Flutter installation directory and then change the working directory to the <span class="cf dir">flutter/bin</span> subdirectory by running:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">$ cd flutter/bin</td></tr></table>
<p id="d24e544">and get the working directory by running:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">$ pwd</td></tr></table>
<p id="d24e552">which will return something along the lines of <span class="cf dir">/home/username/flutter/bin</span> (here you’ll see the path where you installed Flutter, so your mileage may vary significantly).</p><table class="simpletable outerlines"><thead><tr><th class="outerlines" colspan="2"><p class="last-para-in-cell">Know Your Shell</p></th></tr></thead><tbody><tr class="tr zebra "><td style="valign: middle; width: 12%; ">
               <img alt="images/aside-icons/info.png" class="" id="d24e567" src="/images/img66/images/aside-icons/info.png" style="width: 100%"/>
             </td><td style="valign: middle; width: 88%; ">

<p class="last-para-in-cell">

	This section supposes that your shell is Bash.<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-9" id="FNPTR-9">[9]</a></sup>
	This is the case for most Linux distributions (and Unix-like operating systems in general—some exceptions are the BSDs, which have tcsh,<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-10" id="FNPTR-10">[10]</a></sup>
	ksh,<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-11" id="FNPTR-11">[11]</a></sup>
	or ash,<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-12" id="FNPTR-12">[12]</a></sup>
	and Arch Linux’s installer, which runs on Zsh<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-13" id="FNPTR-13">[13]</a></sup>
	but installs Bash by default) and, since you would need to manually install and configure a different one, you probably would know how to add a directory to its <span class="cf variable">PATH</span>.
</p>
</td></tr></tbody></table>
<p id="d24e608">To add this to the <span class="cf variable">PATH</span> environment variable, we need to edit <span class="cf filename">~/.bash_profile</span>.</p>
<p id="d24e616">To do that using the GUI, you first need your file manager to display hidden files. If you can’t find a file named <span class="cf filename">.bash_profile</span> in your home directory, you need to toggle the option that makes the file manager show hidden files, and this depends on the file manager that you’re using:</p><ul><li>
<p id="d24e624">In Nautilus (a.k.a. GNOME Files, default in most distributions using the GNOME desktop like Ubuntu, RHEL, Fedora, and default SLED and Debian) you need to press <span class="keystroke">Ctrl</span>+<span class="keystroke">H</span>. This shortcut also works in PCManFM (part of the LXDE, as found in Lubuntu), Caja (part of Mate), and Thunar (part of the XFCE desktop, as found in Xubuntu).</p></li><li>
<p id="d24e633">If you are using the KDE desktop (for example when running Kubuntu or when choosing it when installing distributions like openSUSE or Debian) and its default Dolphin file manager, use <span class="keystroke">Alt</span>+<span class="keystroke">+</span>.</p></li></ul>
<p id="d24e641">Once you have located a file called <span class="cf filename">.bash_profile</span>, open it with any text editor and add the following line to the end of it, in a new line:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">export PATH=$PATH:/home/username/etc</td></tr></table>
<p id="d24e656">where you’ll replace <span class="emph">/home/username/etc</span> with the string you took note of earlier.</p>
<p id="d24e661">If you prefer using the command line or just want a copy-paste experience from this installation guide, you can instead open a terminal window or TTY and run the following command:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">$ echo ​<em class="string">"export PATH=</em>​$PATH​<em class="string">:/home/username/etc"</em>​ &gt;&gt; ~/.bash_profile</td></tr></table>
<p id="d24e676">replacing <span class="cf dir">/home/username/etc</span> with the path you found earlier for the extracted tarball’s <span class="cf dir">flutter/bin</span> directory.</p>
<p id="d24e684">To actually be able to run the <span class="cf ic">flutter</span> command, you need to refresh your terminal’s configuration by running:


</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">$ source ~/.bash_profile</td></tr></table><h4>Installing on Windows</h4>
<p id="d24e703">Just like on Linux, Windows-only Android development is supported, so we will install just the Android SDK with Android Studio and the Flutter SDK itself.</p><p><strong>Installing the Android SDK on Windows</strong></p>
<p id="d24e708">



All you need to do to install the Android SDK on Windows is to download and run the Android Studio installation file available on the official download page.<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-14" id="FNPTR-14">[14]</a></sup> This will also install the feature-rich Android Studio IDE. After installing Android Studio, you will be guided through the installation of the Android SDK.</p><p><strong>Installing the Flutter SDK on Windows</strong></p>
<p id="d24e737">

To install the Flutter SDK on Windows you need to install Git for Windows first. You can find the installation file for it on its official download page.<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-15" id="FNPTR-15">[15]</a></sup> During installation, you need to choose the <span class="emph">Use Git from the Windows Command Prompt</span> option.</p>
<p id="d24e756">After you have installed Git, download the latest version of Flutter from its official installation page.<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-16" id="FNPTR-16">[16]</a></sup> This, unlike what happens with most of the software available for Windows, will download a zip archive (a.k.a. a compressed folder) that contains a <span class="cf dir">flutter</span> folder: extract it wherever you want (this will be the SDK folder any IDE plugin will ask you to enter).</p>
<p id="d24e766">If you want to run a command on the Flutter Console, run the <span class="cf filename">flutter.bat</span> script contained in the <span class="cf dir">bin</span> subfolder.</p><h4>Installing on macOS</h4>
<p id="d24e777">The advantage macOS has is that it also supports iOS building and debugging. To take advantage of that, we also need to install Xcode and the iOS SDK.</p><p><strong>Installing Xcode and the iOS SDK</strong></p>
<p id="d24e782">



To be able to run Flutter and use it for iOS development you need to download Xcode<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-17" id="FNPTR-17">[17]</a></sup> and the iOS SDK<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-18" id="FNPTR-18">[18]</a></sup> from Apple’s official website.</p><p><strong>Installing the Android SDK on macOS</strong></p>
<p id="d24e816">

Installing the Android SDK on macOS is really simple: head over to the Android Studio downloads page<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-19" id="FNPTR-19">[19]</a></sup> to download the .dmg file that also includes the feature-rich but resource intensive Android Studio IDE.</p><p><strong>Installing the Flutter SDK on macOS</strong></p>
<p id="d24e835">

Installing Flutter on macOS is very similar to installing Flutter on Linux. The main differences are that macOS uses the zip archive format instead of the more efficient tar.xz format, and there are no OS or GUI differences among distributions to contend with.</p>
<p id="d24e846">Start by downloading the latest stable .zip from Flutter’s official website.<sup><a class="footnote" href="/links/f_0010/f_0010.xhtml#FOOTNOTE-20" id="FNPTR-20">[20]</a></sup></p>
<p id="d24e852">Unzip it to any directory, then open the <span class="cf dir">flutter</span> directory you just extracted. Press <span class="keystroke"><span style="font-family:Quivira;">⌘</span></span>+<span class="keystroke">I</span> and take note of the path that appears to the right of <span class="emph">Where:</span>.</p>
<p id="d24e866">Now, open a Terminal window and run the command:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">$ nano ~/.bash_profile</td></tr></table>
<p id="d24e874">After doing that, paste the following in the terminal window:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">export PATH=$PATH:/example/path/to/flutter/bin</td></tr></table>
<p id="d24e880">replacing <span class="cf ic">/example/path/to/flutter/bin</span> with the path you took note of earlier.</p>
<p id="d24e886">All that’s left to do is to close the file using <span class="keystroke">Ctrl</span>-<span class="keystroke">X</span> and confirming you want to save the file by pressing <span class="keystroke">Y</span>.</p>
<p id="d24e897">To actually be able to run the <span class="cf ic">flutter</span> command, you need to refresh your terminal’s configuration by running:


</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">$ source ~/.bash_profile</td></tr></table><h3>Installing the IDE Plugins</h3>
<p id="d24e916">

The Flutter IDE plugins for VSCode and Android Studio are installed using the canonical installation tools and techniques for each IDE. They also require the installation of the respective Dart plugin.</p>
<p id="d24e927">If you’re not familiar with that process, we’ll now discuss how to install the Flutter plugin on each IDE.</p><h4>VSCode</h4>
<p id="d24e932">
To install the Flutter plugin for Visual Studio Code you need to open Visual Studio Code itself, then use the keyboard shortcut <span class="keystroke">Ctrl</span>-<span class="keystroke">Shift</span>-<span class="keystroke">P</span> to open the command palette, then type “Install extensions” and press <span class="keystroke">Enter</span>.</p>
<p id="d24e950">On the panel that opens up on the left, type Flutter and press <span class="keystroke">Enter</span>.</p>
<p id="d24e955">Click the Install button in the Flutter entry in the list, this will install both the Flutter and the Dart plugins.</p>
<p id="d24e957">Unlike the Flutter plugin for Android Studio, the Flutter plugin for Visual Studio Code plugin will auto-detect the location where the Flutter SDK is installed.</p><h4>Android Studio</h4>
<p id="d24e962">
To install the Flutter plugin for Android Studio you need to navigate to File &gt; Settings &gt; Plugins, click <span class="emph">Browse repositories...</span>, type Flutter and click Install.</p>
<p id="d24e971">To create a Flutter Project in Android Studio you need to restart Android Studio if you haven’t since installing the Flutter plugin, navigate to File &gt; New Flutter Project, choose <span class="emph">Flutter Application</span> and give the app a name and a path, set the package name and you’re done.

</p><h3>Using the CLI and the Plugins</h3>
<p id="d24e982">There are two ways of interacting with the Flutter SDK: using the <span class="cf commandname">flutter</span> CLI command directly or through the IDE plugins. The plugins for Android Studio and VSCode are very different to use, as they adapt to the usual conventions of the respective IDE.</p><h4>Create a Flutter App Project</h4>
<p id="d24e990">

To create a Flutter app project, run the <span class="cf commandname">flutter create appname</span> command or follow the procedure corresponding to the IDE you want to use to develop your app:

</p><ul><li>
<p id="d24e1015">In Android Studio, click on <span class="emph">File &gt; New &gt; New Flutter Project...</span> and follow the instructions that will appear on screen;</p></li><li>
<p id="d24e1021">In Visual Studio Code, hit <span class="keystroke">Ctrl</span>+<span class="keystroke">Shift</span>+<span class="keystroke">P</span> to open the Command Menu and type New Project, <span class="emph">Flutter: New Project</span> should appear as an option in the menu, click on it and then type a name for your app project.</p></li></ul><h4>Building and Running</h4>
<p id="d24e1038">

You can build a Flutter app using the <span class="cf commandname">flutter</span> <span class="cf commandoption">build</span> command when the working directory is the project’s root directory (where <span class="cf filename">pubspec.yaml</span> is located):

</p><ul><li>
<p id="d24e1070">To build an APK for your app (standard Android installation file), use <span class="cf commandname">flutter build apk</span>.</p></li><li>
<p id="d24e1076">To build an iOS application bundle, use <span class="cf commandname">flutter build ios</span>.</p></li><li>
<p id="d24e1082">To build an Android App Bundle (the new generation Android installation file that reduces file size), use <span class="cf commandname">flutter build appbundle</span>.</p></li></ul>
<p id="d24e1087">

If you want to run the app directly on an open emulator or a device connected by USB (with USB Debugging turned on in the device’s settings), use <span class="cf commandname">flutter run</span>.</p>
<p id="d24e1103">

If you’re using an IDE, you can use the Flutter plugin to run apps directly from the IDE.</p>
<p id="d24e1114">To run an app on an open emulator or connected USB device:</p><ul><li>Using VSCode, press <span class="keystroke">F5</span> or click on <span class="emph">Debug &gt; Start Debug</span>.</li><li>Using Android Studio, press <span class="keystroke">Shift</span>-<span class="keystroke">F10</span> and click the button that looks like the one highlighted in the following image:</li></ul><div class="ss"><img alt="images/Preface/image7.png" class="" id="d24e1135" src="/images/img4/images/Preface/image7.png"/></div><h4>Hot Reload</h4>
<p id="d24e1139">

Flutter comes with a feature you might know from other frameworks: hot reload. If you’re not familiar with it, the hot reload feature allows you to update the app’s current view based on changes you’ve made to the code without rebuilding the entire app which, as anyone who has ever tried knows, is very painful when you are making many small changes and trying to see how they affect the app.</p>
<p id="d24e1148">This feature is accessible in both Android Studio and Visual Studio Code and, actually, also in the command line when you run an app using <span class="cf commandname">flutter run</span>: pressing <span class="keystroke">R</span> in the terminal when that command is running will reload the app.</p>
<p id="d24e1158">In Android Studio you need to find an icon like this in the <span class="emph">Run</span> menu at the bottom:</p><div class="ss"><img alt="images/Preface/studiohotreload.png" class="border " id="d24e1163" src="/images/img5/images/Preface/studiohotreload.png" style="width: 55%"/></div>
<p id="d24e1164">In Visual Studio Code you need to find an icon like this in the menu that appears at the top of the screen when you start debugging:</p><div class="ss"><img alt="images/Preface/codehotreload.png" class="border " id="d24e1166" src="/images/img6/images/Preface/codehotreload.png" style="width: 35%"/></div>
<p id="d24e1167">The app will immediately reload, showing any changes you’ve made to the app’s code immediately on the connected emulator or device.</p>
<p id="d24e1169">If you’re running a recent version of Android Studio and/or Visual Studio Code, you’ll have IDE access to two different but similar features: stateful hot reload and hot restart. The difference between the two is that the stateful hot reload (as the name implies) preserves each of the <span class="cf class">State</span> objects and is faster, but it won’t work with bigger changes that require those to be reloaded too, and for that there’s hot restart.</p>
<p id="d24e1174">When running an app using <span class="cf commandname">flutter run</span> from the CLI, stateful hot reload is associated to the lowercase <span class="cf ic">r</span> character, while hot restart is achieved with the uppercase <span class="cf ic">R</span> character.</p>
<p id="d24e1185">

In both IDEs you’ll find, next to the button shown above, a lightning bolt icon like the one you can see in the following VSCode screenshot:</p><div class="ss"><img alt="images/Preface/vscodeicons.png" class="" id="d24e1197" src="/images/img7/images/Preface/vscodeicons.png"/></div>
<p id="d24e1198">The lightning bolt performs the stateful hot reload, while the typical <span class="emph">restart</span> icon performs the hot restart.

</p><h4>Updating and Maintaining Your Flutter Installation</h4>
<p id="d24e1209">
You’ll know when you need to update your Flutter SDK installation because you’ll get a notice whenever you build or run an app.</p>
<p id="d24e1215">
To update your Flutter installation you need to run the <span class="cf commandname">flutter upgrade</span> command, which will check and download anything that’s needed using Git, so you need to have Git installed.</p>
<p id="d24e1224">

Flutter includes a tool called Flutter Doctor, available using the <span class="cf commandname">flutter doctor</span> command, which will list information about the installed Flutter version, the Android/iOS SDK, the IDE plugins, and connected devices.</p><h4>Other Flutter-Related Commands in the VSCode Plugins</h4>
<p id="d24e1241">
Once the VSCode Flutter plugin is installed, opening the command palette and typing <span class="cf commandname">flutter</span> will show all available commands.</p>
<p id="d24e1251">Among these you’ll want to get familiar with:</p><dl><dt class="force-newline" style="font-style:italic;">Flutter: Run Flutter Doctor</dt><dd>
<p id="d24e1257">Check if there are dependencies that need to be installed.</p></dd><dt class="force-newline" style="font-style:italic;">Flutter: New Project</dt><dd>
<p id="d24e1262">Creates a new Flutter project.</p></dd><dt class="force-newline" style="font-style:italic;">Flutter: Select Device</dt><dd>
<p id="d24e1267">Select the device on which you want to debug your app.</p></dd><dt class="force-newline" style="font-style:italic;">Flutter: Get Packages and Flutter: Upgrade Packages</dt><dd>
<p id="d24e1272">Commands for interacting with Flutter Packages (we’ll discuss packages in Chapter 4).</p></dd></dl>,<h2 id="sec.layout.row">Horizontal Layout: The Row</h2>
<p id="d24e8304">

The <span class="cf ic">Row</span> lays out widgets side by side, and is very similar to a <span class="cf ic">Column</span>, with the difference being that the main axis and cross axis are the other way around.</p><h3 id="sec.layout.row.usage">How You Use It and What You Use It For</h3>
<p id="d24e8326">You can use a <span class="cf ic">Row</span> simply the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Text(​<em class="string">"This will be the left side"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Text(​<em class="string">"This will be the right side"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e8351">The options are the same as the <span class="cf ic">Column</span>’s (with the cross axis becoming the vertical and the main axis becoming the horizontal) and you can find them in <a href="/links/f_0021/f_0021.xhtml#sec.layout.options">​<em>Layout Widget Options</em>​</a>.</p><h4 id="sec.layout.row.uses">Where You’ll Use the Row Together with Other Widgets</h4>
<p id="d24e8361">

<span class="cf ic">Row</span>s and <span class="cf ic">Column</span>s make for great bonding widgets: with them you can make your complex widgets made of simple elements.</p>
<p id="d24e8386">
For example, a simple social network post can be expressed with a <span class="cf ic">Column</span> with three elements: a Row showing the profile picture and the profile name, a big text in the middle, and at the bottom, a row showing the commands:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ProfilePicture(profileID),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Text(profileName),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Text(postText),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        LikeButton(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        CommentButton(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ShareButton()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e8432">
This combination of widgets, but also just a <span class="cf ic">Row</span> of widgets, is easily inserted inside a <span class="cf ic">ListView</span> or <span class="cf ic">GridView</span> which, to keep with the running example of a social network, could be a social network feed.</p>
<p id="d24e8454">This isn’t hard to do—we’ll start by making the respect the spaces and sizes needed for the different elements that compose it:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        CircleAvatar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          backgroundImage: ProfilePicture(profileID),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          padding: EdgeInsets.all(20),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(profileName),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Align(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      alignment: FractionalOffset.centerLeft,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        padding: EdgeInsets.all(5),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Text(postText),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Divider(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        LikeButton(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        CommentButton(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ShareButton()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e8530">And all that’s left to do to make this work is to replace the placeholder widgets with real widgets.</p>
<p id="d24e8532">For the profile picture we’ll use the same <span class="cf ic">NetworkImage("https://pragprog.com/favicon.png")</span> we used previously, whereas the like, comment, and share buttons will be simple <span class="cf ic">IconButton</span>s:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        CircleAvatar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          backgroundImage: NetworkImage(​<em class="string">"https://pragprog.com/favicon.png"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          padding: EdgeInsets.all(20),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(​<em class="string">"Short poster"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Align(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      alignment: FractionalOffset.centerLeft,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        padding: EdgeInsets.all(5),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Text(​<em class="string">"This is a short post, but that doesn't really matter"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Divider(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        IconButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          icon: Icon(Icons.thumb_up, color: Colors.redAccent),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          onPressed: () {},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        IconButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          icon: Icon(Icons.comment, color: Colors.greenAccent),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          onPressed: () {},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        IconButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          icon: Icon(Icons.share, color: Colors.blueAccent),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          onPressed: () {},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e8661">To create a complete view with a <span class="cf ic">ListView</span> of posts we should also store the post data separately in a <span class="cf ic">List</span>, since in a real app you’re never going to hard-code such data.</p>
<p id="d24e8669">To do that, we’ll start by creating a class to contain the post data:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ Post {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Post({​<strong class="kw">this</strong>​.profileName, ​<strong class="kw">this</strong>​.profilePicture, ​<strong class="kw">this</strong>​.postText});</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ImageProvider profilePicture;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ profileName;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ postText;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e8714">and a <span class="cf ic">List</span> of that class with some data:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">List&lt;Post&gt; posts = [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Post(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    postText: ​<em class="string">"This is a short post, but that doesn't really matter"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    profileName: ​<em class="string">"Short poster"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    profilePicture: NetworkImage(​<em class="string">"https://pragprog.com/favicon.png"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Post(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    postText: ​<em class="string">"This is a longer post, which really shows how the"</em>​ +</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"widgets will naturally expand when there is more content to display.</em>​​<em class="string">\n</em>​​<em class="string">"</em>​ +</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"At this, point, this line of text is just here because we need to"</em>​ +</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"make this post so much bigger than the other one."</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    profileName: ​<em class="string">"Long poster"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    profilePicture: NetworkImage(​<em class="string">"https://pragprog.com/favicon.png"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">];</td></tr></table>
<p id="d24e8783">At this point, the resulting <span class="cf ic">ListView</span> is quite straightforward:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ListView.builder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemCount: 2,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemBuilder: (context, i) =&gt; Card(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            CircleAvatar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              backgroundImage: posts[i].profilePicture,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                padding: EdgeInsets.all(20),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                child: Text(posts[i].profileName,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                style: Theme.of(context).textTheme.subhead),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Align(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          alignment: FractionalOffset.centerLeft,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                padding: EdgeInsets.all(5),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                child: Text(posts[i].postText,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                style: Theme.of(context).textTheme.body1),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Divider(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            IconButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              icon: Icon(Icons.thumb_up, color: Colors.redAccent),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              onPressed: () {},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            IconButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              icon: Icon(Icons.comment, color: Colors.greenAccent),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              onPressed: () {},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            IconButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              icon: Icon(Icons.share, color: Colors.blueAccent),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              onPressed: () {},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e8945">producing the following result:</p><div class="ss"><img alt="images/WidgetLayout/socialposts.png" class="border " id="d24e8947" src="/images/img35/images/WidgetLayout/socialposts.png" style="width: 38%"/></div>
<p id="d24e8948">Nested <span class="cf ic">Row</span>s and <span class="cf ic">Column</span>s can also be used to create grids, as described in <a href="/links/f_0023/f_0023.xhtml#sec.layout.rowcolumngrid">​<em>Nested Rows and Columns</em>​</a>.





</p>,<h2 id="d24e11349">The Third Row</h2>
<p id="d24e11352">We have one more <span class="cf ic">Row</span>, which might sound strange until you look back at the structure of the app in the figure <a href="/links/f_0033/f_0033.xhtml#fig.layout.calcstructure">​here​</a>. That row will have two children:</p><ul><li>On the left, the numbers and the <span class="emph">dot</span> and <span class="emph">equals</span> buttons.</li><li>On the right, the operator buttons.</li></ul><h3>Add the Number Buttons</h3>
<p id="d24e11375">
The number buttons will be spread out across four rows:</p><ul><li>The first will contain the numbers 7, 8, and 9.</li><li>The second will contain the numbers 4, 5, and 6.</li><li>The third will contain the numbers 1, 2, and 3.</li><li>The fourth will contain the number 0, the <span class="emph">dot</span>, and the button to calculate the result.</li></ul>
<p id="d24e11397">This means that, inside this <span class="cf ic">Row</span> we’ll need another <span class="cf ic">Column</span> with four <span class="cf ic">Row</span>s as its children just to display the number buttons.
The buttons will have white text on an intense blue background, except for the <span class="emph">=</span> button, which will have black text on a very light blue background.
So, as the first child of the third <span class="cf ic">Row</span> of our app, we’ll have the following:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator_part1/lib/main.dart">layout/calculator_part1/lib/main.dart</a></div><table class="processedcode" id="code.layout.calculator.numbers"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  crossAxisAlignment: CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      crossAxisAlignment:  CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">'7'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          onPressed: () {add(​<em class="string">'7'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">'8'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          onPressed: () {add(​<em class="string">'8'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">'9'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          onPressed: () {add(​<em class="string">'9'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      crossAxisAlignment:  CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children:&lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">'4'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          onPressed: () {add(​<em class="string">'4'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">'5'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          onPressed: () {add(​<em class="string">'5'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">'6'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          onPressed: () {add(​<em class="string">'6'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      crossAxisAlignment:  CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">'1'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          onPressed: () {add(​<em class="string">'1'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">'2'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          onPressed: () {add(​<em class="string">'2'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">'3'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            style: TextStyle(color: Colors.white)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          onPressed: () {add(​<em class="string">'3'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      crossAxisAlignment:  CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">'0'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          onPressed: () {add(​<em class="string">'0'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">'.'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          onPressed: () {add(​<em class="string">'.'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(​<em class="string">'='</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          onPressed: () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            getResult();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          },</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          color: Colors.blue[50],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e11819">As you can see, <span class="emph">=</span> calls <span class="cf methodname">getResult</span> and the numbers call the <span class="cf methodname">add(number)</span> method.
</p><h3>Add the Operators</h3>
<p id="d24e11834">
To the right of the numbers, we’ll add the operator buttons.</p>
<p id="d24e11840">
As an example, we’ll implement the <span class="emph">divide</span> button as a <span class="cf ic">FlatButton</span> with an image from the assets on it.</p>
<p id="d24e11852">To start, create a directory in the root of your project called <span class="cf dir">icons</span>.</p>
<p id="d24e11857">Inside it, create or copy a file called <span class="cf filename">divide.png</span>, which will be the icon used for the divide button. You can find a <span class="cf filename">divide.png</span> icon suitable for this in the book’s source code or on my website.<sup><a class="footnote" href="/links/f_0045/f_0045.xhtml#FOOTNOTE-26" id="FNPTR-26">[26]</a></sup></p>
<p id="d24e11869">After you’ve done that, edit <span class="cf filename">pubspec.yaml</span> and add the following at the bottom of it:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/pubspec.yaml">layout/calculator/pubspec.yaml</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">flutter:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  assets:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    - ​<em class="string">icons/</em>​</td></tr></table>
<p id="d24e11889">

Now we can use that image in our code.</p>
<p id="d24e11900">To use it, we need to use <span class="cf ic">Image.asset</span> as explained in <a href="/links/f_0020/f_0020.xhtml#sec.layout.images.assets">​<em>Displaying Images from the Assets</em>​</a>.</p>
<p id="d24e11907">More specifically for this example, the divide button will be implemented as follows:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator_part1/lib/main.dart">layout/calculator_part1/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: Image.asset(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"icons/divide.png"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    width: 10.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    height: 10.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  onPressed: () {add(​<em class="string">'÷'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  color: Colors.blue[50],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e11942">The entire <span class="cf ic">Column</span> of operator buttons (with the other ones being normal <span class="cf class">Text</span>-based buttons) will therefore be:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator_part1/lib/main.dart">layout/calculator_part1/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  crossAxisAlignment: CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Image.asset(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<em class="string">"icons/divide.png"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        width: 10.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        height: 10.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      onPressed: () {add(​<em class="string">'÷'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      color: Colors.blue[50],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Text(​<em class="string">'x'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      onPressed: () {add(​<em class="string">'x'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      color: Colors.blue[50],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Text(​<em class="string">'-'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      onPressed: () {add(​<em class="string">'-'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      color: Colors.blue[50],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Text(​<em class="string">'+'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      onPressed: () {add(​<em class="string">'+'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      color: Colors.blue[50],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e12055">The buttons are of the same color as the <span class="emph">=</span> button (a very light blue).


</p>,<h2 id="d24e24830">Building the Comic Page</h2>
<p id="d24e24833">

The <span class="cf class">ComicPage</span> is going to be the simplest of the widgets we talked about until now: we’re going to give it an <span class="cf class">AppBar</span> that shows the comic number, and the body is simply going to be a scrollable <span class="cf class">ListView</span> that shows the comic’s title, image and alt-text:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking_starting/xkcd_app/lib/main.dart">networking_starting/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ComicPage ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ComicPage(​<strong class="kw">this</strong>​.comic);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">final</strong>​ Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt; comic;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     appBar: AppBar(title: Text(​<em class="string">"#</em>​​<em class="string">${comic["num"]}</em>​​<em class="string">"</em>​)),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     body: ListView(children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           comic[​<em class="string">"title"</em>​],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           style: Theme.of(context).textTheme.display3,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       Image.network(comic[​<em class="string">"img"</em>​]),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        padding: EdgeInsets.all(8.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Text(comic[​<em class="string">"alt"</em>​])</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ],),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e24961">All of that adds up to the following <span class="cf filename">main.dart</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking_starting/xkcd_app/lib/main.dart">networking_starting/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:flutter/material.dart'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:http/http.dart'</em>​ ​<strong class="kw">as</strong>​ http;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'dart:async'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'dart:convert'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;​<strong class="kw">int</strong>​&gt; getLatestComicNumber() async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    await http.read(​<em class="string">'https://xkcd.com/info.0.json'</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> [​<em class="string">"num"</em>​];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">main</strong>​() async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> runApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">new</strong>​ MaterialApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     home: HomeScreen(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       title: ​<em class="string">'XKCD app'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       latestComic: await getLatestComicNumber(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ComicPage ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ComicPage(​<strong class="kw">this</strong>​.comic);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">final</strong>​ Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt; comic;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     appBar: AppBar(title: Text(​<em class="string">"#</em>​​<em class="string">${comic["num"]}</em>​​<em class="string">"</em>​)),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     body: ListView(children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           comic[​<em class="string">"title"</em>​],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           style: Theme.of(context).textTheme.display3,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       Image.network(comic[​<em class="string">"img"</em>​]),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        padding: EdgeInsets.all(8.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Text(comic[​<em class="string">"alt"</em>​])</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ],),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ComicTile ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ComicTile({​<strong class="kw">this</strong>​.comic});</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt; comic;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      leading: Image.network(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        comic[​<em class="string">"img"</em>​],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        height: 30,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        width: 30</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      title: Text(comic[​<em class="string">"title"</em>​]),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      onTap: () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Navigator.push(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            builder: (BuildContext context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ComicPage(comic)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      },</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ HomeScreen ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> HomeScreen({​<strong class="kw">this</strong>​.title, ​<strong class="kw">this</strong>​.latestComic});</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">final</strong>​ ​<strong class="kw">int</strong>​ latestComic;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ title;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; _fetchComic(​<strong class="kw">int</strong>​ n) async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      await http.read(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<em class="string">"https://xkcd.com/</em>​​<em class="string">${latestComic-n}</em>​​<em class="string">/info.0.json"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       title: Text(title),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     body: ListView.builder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       itemCount: latestComic,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       itemBuilder:(context, i) =&gt; FutureBuilder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         future: _fetchComic(i),</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         builder: (context, comicResult) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           comicResult.hasData ?</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           ComicTile(comic: comicResult.data) :</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           Divider();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e25388">


At this point we’re ready to run the app, which is going to look like this:</p><table class="simpletable "><tbody><tr class="tr "><td style="width: 50%; ">
      <img alt="images/Networking/home1.png" class="border " id="d24e25404" src="/images/img64/images/Networking/home1.png" style="width: 70%"/>
    </td><td style="width: 50%; ">
      <img alt="images/Networking/comic1.png" class="border " id="d24e25408" src="/images/img65/images/Networking/comic1.png" style="width: 71%"/>
    </td></tr></tbody></table>,<h2 id="sec.xkcdapp.UI">Build the App’s Basic UI</h2>
<p id="d24e23900">

We’ll build an app that is going to display a <span class="cf class">ListView</span> of <span class="cf class">ListTile</span>s. There will be a tile for each comic and tapping on a tile should display the details of that comic.</p>
<p id="d24e23915">The home is going to look like the <a href="#fig.home1">screenshot</a>.</p><div id="fig.home1"><div><img alt="images/Networking/home1.png" class="border " id="d24e23921" src="/images/img64/images/Networking/home1.png" style="width: 38%"/></div></div>
<p id="d24e23923">Let’s start by defining the classes we need for this app:</p><ul><li>A class for the home screen.</li><li>A custom <span class="cf class">ComicTile</span> class to make creating <span class="cf class">ListTile</span>s for the comics easier.</li><li>A class for the comic page.</li></ul>
<p id="d24e23941">For a change, we won’t be using an app class; the <span class="cf methodname">main</span> method will pass the needed data directly to the <span class="cf class">HomeScreen</span> class we’re going to create:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking_starting/xkcd_app/lib/main.dart">networking_starting/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">main</strong>​() async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> runApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">new</strong>​ MaterialApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     home: HomeScreen(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       title: ​<em class="string">'XKCD app'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       latestComic: await getLatestComicNumber(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> );</td></tr></table>
<p id="d24e23980">
The <span class="cf methodname">getLatestComicNumber</span> method is the one we created in <a href="/links/f_0058/f_0058.xhtml#sec.networking.fetchcomic.latestnummethod">​<em>A Function to Get the Latest Comic Number</em>​</a>, and we need to define it at the start of the file, after the library <span class="cf ic">import</span>s and outside any class definitions:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking_starting/xkcd_app/lib/main.dart">networking_starting/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;​<strong class="kw">int</strong>​&gt; getLatestComicNumber() async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    await http.read(​<em class="string">'https://xkcd.com/info.0.json'</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> [​<em class="string">"num"</em>​];</td></tr></table><h3>Define the Home Screen</h3>
<p id="d24e24025">
At this point we need to define the <span class="cf class">HomeScreen</span> widget. This time the app tree is very simple and we don’t need a figure to get the big picture: the <span class="cf class">HomeScreen</span> will be a normal <span class="cf class">Scaffold</span>, with an <span class="cf class">AppBar</span> (as always), and as a <span class="cf ic">body</span> it will have a <span class="cf class">ListView</span> made of <span class="cf class">ListTile</span>s.</p>
<p id="d24e24053">Since we need a <span class="cf class">ListTile</span> for each comic, we’ll use the <span class="cf methodname">ListView.builder</span> constructor, as seen in <a href="/links/f_0021/f_0021.xhtml#sec.layout.listview">​<em>The ListView</em>​</a>, which uses an <span class="cf ic">itemBuilder</span> function to generate each widget. In this case, the <span class="cf ic">itemBuilder</span> will be a call to a <span class="cf class">FutureBuilder</span>, which is a kind of item builder that builds widgets based on the contents of a <span class="cf class">Future</span>, which is what we need since <span class="cf methodname">http.get</span> is an asynchronous function that returns a <span class="cf class">Future</span>.</p>
<p id="d24e24083">Let’s start writing the class definition with the basics: it will be a <span class="cf class">StatelessWidget</span> and it needs two parameters—the title that should appear in the <span class="cf class">AppBar</span> and the latest comic number:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking_starting/xkcd_app/lib/main.dart">networking_starting/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ HomeScreen ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> HomeScreen({​<strong class="kw">this</strong>​.title, ​<strong class="kw">this</strong>​.latestComic});</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">final</strong>​ ​<strong class="kw">int</strong>​ latestComic;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ title;</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e24134">
At this point we’ll finish doing the preparatory work on the class by defining a <span class="cf methodname">_fetchComic</span> method, just like the one we talked about in <a href="/links/f_0058/f_0058.xhtml#sec.networking.fetchcomic.new">​<em>The New fetchComic</em>​</a>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking_starting/xkcd_app/lib/main.dart">networking_starting/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; _fetchComic(​<strong class="kw">int</strong>​ n) async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    await http.read(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="string">"https://xkcd.com/</em>​​<em class="string">${latestComic-n}</em>​​<em class="string">/info.0.json"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr></table>
<p id="d24e24181">Now all that’s left to do is the fun part: defining the UI we want for our app in the <span class="cf methodname">build</span> method. We’ll start by defining the <span class="cf class">Scaffold</span> and <span class="cf class">AppBar</span>, as we always do:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking_starting/xkcd_app/lib/main.dart">networking_starting/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      title: Text(title),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e24219">
The <span class="cf class">Scaffold</span>’s <span class="cf ic">body</span> will be, as we said, a <span class="cf methodname">ListView.builder</span>-built <span class="cf class">ListView</span>, and we need to give it two arguments:</p><ul><li>
<p id="d24e24243">An <span class="cf ic">itemCount</span>, which is the maximum number of items that will be built; in this case, it will be the <span class="cf ic">latestComic</span> number, since that’s also the number of comics that have ever been published.</p></li><li>
<p id="d24e24252">An <span class="cf ic">itemBuilder</span>, which is a function called with the <span class="cf class">BuildContext</span> and an <span class="cf ic">int</span> that starts from 0 at the top (we’ll call it <span class="cf variable">i</span>).</p></li></ul>
<p id="d24e24266">
In this case the <span class="cf ic">itemBuilder</span> is going to be, as we said before, a <span class="cf class">FutureBuilder</span>.</p>
<p id="d24e24278">
The <span class="cf class">FutureBuilder</span>, in turn, requires two arguments: a <span class="cf variable">future</span>, which is the <span class="cf class">Future</span> that will retrieve the data needed for each tile, and  a <span class="cf ic">builder</span> function, which builds the tile taking the <span class="cf class">BuildContext</span> and the result of the <span class="cf class">Future</span>.</p>
<p id="d24e24303">The <span class="cf variable">future</span> will be a call to <span class="cf methodname">fetchComic(i)</span> where <span class="cf variable">i</span> is the aforementioned progressive integer variable and the <span class="cf variable">itemBuilder</span> will return a <span class="cf class">ComicTile</span> that takes the comic data as an argument. We’ll worry about implementing the <span class="cf class">ComicTile</span> itself later.
</p><table class="simpletable outerlines"><thead><tr><th class="outerlines" colspan="2"><p class="last-para-in-cell">On the Correct Use of the FutureBuilder</p></th></tr></thead><tbody><tr class="tr zebra "><td style="valign: middle; width: 12%; ">
               <img alt="images/aside-icons/warning.png" class="" id="d24e24335" src="/images/img83/images/aside-icons/warning.png" style="width: 100%"/>
             </td><td style="valign: middle; width: 88%; ">

<p>
  
  The <span class="cf class">FutureBuilder</span>’s <span class="cf variable">future</span> shouldn’t be a function call: it should be a previously obtained <span class="cf class">Future</span> because setting it to a function call would result in the <span class="cf variable">future</span> being called every time the parent widget is rebuilt, but that doesn’t apply in our case: the parent widget is a <span class="cf class">StatelessWidget</span> and there are no <span class="cf class">StatefulWidgets</span> above. You need to remember this when you build your own Flutter apps though: forgetting this could make app interactions needlessly slow and clunky.
</p>
<p class="last-para-in-cell">
  Usually these <span class="cf class">Future</span>s should be obtained in the <span class="cf methodname">initState</span> method of <span class="cf class">StatefulWidget</span>s.
</p>
</td></tr></tbody></table>
<p id="d24e24382">Here is the full <span class="cf ic">body</span> of the <span class="cf class">HomeScreen</span>’s <span class="cf class">Scaffold</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking_starting/xkcd_app/lib/main.dart">networking_starting/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">body: ListView.builder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemCount: latestComic,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemBuilder:(context, i) =&gt; FutureBuilder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    future: _fetchComic(i),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    builder: (context, comicResult) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      comicResult.hasData ?</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ComicTile(comic: comicResult.data) :</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Divider();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e24424">The full <span class="cf class">HomeScreen</span> class definition, combining all of the pieces of code we saw earlier, is:

</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking_starting/xkcd_app/lib/main.dart">networking_starting/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ HomeScreen ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> HomeScreen({​<strong class="kw">this</strong>​.title, ​<strong class="kw">this</strong>​.latestComic});</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">final</strong>​ ​<strong class="kw">int</strong>​ latestComic;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ title;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; _fetchComic(​<strong class="kw">int</strong>​ n) async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      await http.read(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<em class="string">"https://xkcd.com/</em>​​<em class="string">${latestComic-n}</em>​​<em class="string">/info.0.json"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       title: Text(title),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     body: ListView.builder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       itemCount: latestComic,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       itemBuilder:(context, i) =&gt; FutureBuilder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         future: _fetchComic(i),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         builder: (context, comicResult) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           comicResult.hasData ?</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           ComicTile(comic: comicResult.data) :</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           Divider();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3>Define the ComicTile</h3>
<p id="d24e24561">

Now we need to define the <span class="cf class">ComicTile</span> class, which will be yet another <span class="cf class">StatelessWidget</span> and it will take the comic data it needs to display as its only argument:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking_starting/xkcd_app/lib/main.dart">networking_starting/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ComicTile ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ComicTile({​<strong class="kw">this</strong>​.comic});</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt; comic;</td></tr></table>
<p id="d24e24607">The <span class="cf class">ComicTile</span> will be a <span class="cf class">ListTile</span> that has the comic image as the <span class="cf ic">leading</span>, a comic title <span class="cf class">Text</span> as its <span class="cf ic">title</span> and, when tapped, displays a new screen just for that comic, showing the comic in a bigger format along with its <span class="emph">alt-text</span>.</p>
<p id="d24e24628">We’ll worry about building the comic page later: we now need to figure out how to show that screen. We talked about push/pop navigation earlier in <a href="/links/f_0059/f_0059.xhtml#sec.networking.navigation.pushpop">​<em>Push/Pop Navigation Using the Navigator</em>​</a>, and that’s what we’re going to use:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">①</span>​</span></td><td class="codeline">    leading: Image.network( </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      comic[​<em class="string">"img"</em>​],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      height: 30,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      width: 30</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">②</span>​</span></td><td class="codeline">    title: Text(comic[​<em class="string">"title"</em>​]), </td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">③</span>​</span></td><td class="codeline">    onTap: () { </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Navigator.push(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          builder: (BuildContext context) =&gt; ComicPage(comic)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    },</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><dl class="calloutlist"><dt>​<span class="callout-number" style="font-family:Quivira;">①</span>​</dt><dd>
<p id="d24e24694">
      In this section we define the <span class="cf variable">leading</span> widget of the <span class="cf class">ListTile</span>: an <span class="cf class">Image</span> taken from the network URL provided (the comic’s ‘img‘ attribute).
    </p>
<p id="d24e24705">
      We set the maximum width and height for the image preview to 30 pixels to avoid having the previews take up too much vertical or horizontal space in the list.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">②</span>​</dt><dd>
<p id="d24e24708">
      This is the text that will appear for each tile. In this case we use the comic’s title, taken from the comic’s <span class="cf variable">title</span> attribute.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">③</span>​</dt><dd>
<p id="d24e24714">
      Here we set what will happen when the user taps on the tile. In this case, it opens a <span class="cf class">ComicPage</span> (that we’ll define later) using the <span class="cf variable">push</span> operation we discussed in <a href="/links/f_0059/f_0059.xhtml#sec.networking.navigation.pushpop">​<em>Push/Pop Navigation Using the Navigator</em>​</a>.
    </p></dd></dl>
<p id="d24e24724">The full <span class="cf class">ComicTile</span> class definition is:



</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking_starting/xkcd_app/lib/main.dart">networking_starting/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ComicTile ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ComicTile({​<strong class="kw">this</strong>​.comic});</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt; comic;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      leading: Image.network(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        comic[​<em class="string">"img"</em>​],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        height: 30,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        width: 30</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      title: Text(comic[​<em class="string">"title"</em>​]),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      onTap: () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Navigator.push(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            builder: (BuildContext context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ComicPage(comic)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      },</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>,<h2 id="d24e27141">Adding Comic Selection by Number</h2>
<p id="d24e27144">
It’s very easy to fetch comics by number, so it seems obvious that we should be able to let the user select comics using the comic number, especially because very often users want to go back to a comic they’ve seen on the Web.</p>
<p id="d24e27150">To do that, we’ll start by creating a page to select the comics, which will look like this:</p><div class="ss"><img alt="images/Networking/select.png" class="border " id="d24e27152" src="/images/img67/images/Networking/select.png" style="width: 30%"/></div>
<p id="d24e27153">Since it doesn’t need any parameters to work, we don’t need to specify the constructor, but we need to have a <span class="cf methodname">fetchComic</span> method that fetches by comic number, unlike the one we used for the <span class="cf class">HomePage</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ SelectionPage ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; _fetchComic(​<strong class="kw">String</strong>​ n) async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     await http.read(​<em class="string">'https://xkcd.com/</em>​​<em class="string">$n</em>​​<em class="string">/info.0.json'</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e27202">The <span class="cf methodname">build</span> method will be more complex, using some Flutter features we’ve never seen before in this book:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     title: Text(​<em class="string">"Comic selection"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   body: Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">①</span>​</span></td><td class="codeline">     child: TextField(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       decoration: InputDecoration(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         labelText: ​<em class="string">"Insert comic #"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">②</span>​</span></td><td class="codeline">       keyboardType: TextInputType.number,</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">③</span>​</span></td><td class="codeline">       autofocus: ​<strong class="kw">true</strong>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       onSubmitted: (​<strong class="kw">String</strong>​ a) =&gt; Navigator.push(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">④</span>​</span></td><td class="codeline">           builder: (context) =&gt; FutureBuilder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             future: _fetchComic(a),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             builder: (context, snapshot) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">               ​<strong class="kw">if</strong>​(snapshot.hasData) ​<strong class="kw">return</strong>​ ComicPage(snapshot.data);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">               ​<strong class="kw">return</strong>​ CircularProgressIndicator();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><dl class="calloutlist"><dt>​<span class="callout-number" style="font-family:Quivira;">①</span>​</dt><dd>
<p id="d24e27310">
      This is a <span class="cf class">TextField</span>, which is a widget that allows the user to input text.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">②</span>​</dt><dd>
<p id="d24e27316">
      <span class="cf variable">keyboardType</span> is used to set the type of information the user is supposed to input (the framework will optimize the display and/or the type of keyboad shown to the user to suit this setting). It is of type <span class="cf class">TextInputType</span>, which can be one of the following:
    </p><ul><li>
          <span class="cf constant">TextInputType.text</span> (default) for regular single-line text.
        </li><li>
          <span class="cf constant">TextInputType.multiline</span> for multiple lines of text.
        </li><li>
          <span class="cf constant">TextInputType.number</span>, which is what we’re going to use, for numbers.
        </li><li>
          <span class="cf constant">TextInputType.datetime</span> for date and time.
        </li><li>
          <span class="cf constant">TextInputType.emailAddress</span> for email addresses.
        </li><li>
          <span class="cf constant">TextInputType.phone</span> for telephone numbers.
        </li></ul></dd><dt>​<span class="callout-number" style="font-family:Quivira;">③</span>​</dt><dd>
<p id="d24e27362">
      This argument makes the view automatically focus on the <span class="cf class">TextField</span>. This means the keypad will automatically open and any numbers typed on it will be sent to the <span class="cf class">TextField</span>, without requiring the user to tap on it first.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">④</span>​</dt><dd>
<p id="d24e27371">
      We haven’t yet fetched the comic, which means we need to call the <span class="cf class">FutureBuilder</span> to fetch the comic and use the comic as an argument for the <span class="cf class">ComicPage</span>.
	  
    </p></dd></dl>
<p id="d24e27388">Now we need to be able to reach that page from the home page.
We’ll do this by using <span class="cf class">AppBar</span> <span class="cf ic">actions</span>, which are widgets we can show on the right side of the app bar. In this case, we’re going to use an <span class="cf class">IconButton</span>:
</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  title: Text(title),</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">①</span>​</span></td><td class="codeline">  actions: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     IconButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      icon: Icon(Icons.looks_one),</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">②</span>​</span></td><td class="codeline">      tooltip: ​<em class="string">"Select Comics by Number"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">③</span>​</span></td><td class="codeline">      onPressed: () =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Navigator.push(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            builder: (BuildContext context) =&gt; SelectionPage()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table><dl class="calloutlist"><dt>​<span class="callout-number" style="font-family:Quivira;">①</span>​</dt><dd>
<p id="d24e27451">
      This is where we are going to add a <span class="cf class">List</span> of widgets to show on the <span class="cf class">AppBar</span>. In this case it’s going to be just one <span class="cf class">IconButton</span>.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">②</span>​</dt><dd>
<p id="d24e27463">
      The <span class="cf class">IconButton</span> also needs a tooltip to help the user understand what the button does. Further on in the book there is a screenshot of what it looks like.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">③</span>​</dt><dd>
<p id="d24e27475">
      This is just like the <span class="cf class">ComicTile</span>’s <span class="cf variable">onpressed</span>.
    </p></dd></dl>
<p id="d24e27483">The updated home page, showing the overall new look of the app, looks like:
</p><div class="ss"><img alt="images/Networking/home2.png" class="border " id="d24e27486" src="/images/img68/images/Networking/home2.png" style="width: 30%"/></div>
<p id="d24e27487">and when the user keeps the button pressed the tooltip will look like:
</p><div class="ss"><img alt="images/Networking/home2tooltip.png" class="border " id="d24e27490" src="/images/img69/images/Networking/home2tooltip.png" style="width: 30%"/></div><h3>What If That Comic Doesn’t Exist?</h3>
<p id="d24e27494">
The user could input any number that goes through their head in the <span class="cf class">SelectionPage</span>. While I don’t actively endorse abusing innocent app features this way, the user could choose to input a number that is bigger than the latest comic’s number, and we can’t just let the app crash or let the <span class="cf class">CircularProgressIndicator</span> loop forever because the user isn’t supposed to do that.</p>
<p id="d24e27506">


We need to handle that situation, and for that we’ll use the <span class="cf class">AsyncSnapshot</span>’s <span class="cf variable">hasError</span> property: if it is <span class="cf constant">true</span>, it means an error occurred during the processing of the <span class="cf variable">future</span>. If it is true, we’ll show the user an <span class="cf class">ErrorPage</span>, which we’ll build later.</p>
<p id="d24e27538">
Meanwhile, here’s the new <span class="cf variable">builder</span> for our <span class="cf class">FutureBuilder</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">builder: (context, snapshot) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(snapshot.hasError) ​<strong class="kw">return</strong>​ ErrorPage();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(snapshot.hasData) ​<strong class="kw">return</strong>​ ComicPage(snapshot.data);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ CircularProgressIndicator();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e27586">I said we were going to build a <span class="cf class">ComicPage</span> at some point. The moment has come to do that, so let’s do it! The <span class="cf class">ComicPage</span> needs to be just a simple <span class="cf class">StatelessWidget</span> and the usual <span class="cf class">Scaffold</span> and <span class="cf class">AppBar</span>. The <span class="cf variable">body</span> will be a <span class="cf class">Column</span> containing an icon and a <span class="cf class">Text</span> informing the user they have done something wrong:

</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ErrorPage ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        title: Text(​<em class="string">"Error Page"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      body: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              children: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                Icon(Icons.not_interested),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ​<em class="string">"The comics you have selected doesn't exist"</em>​+</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ​<em class="string">"or isn't available"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><div class="sidebar"><div class="sidebar-title">Make Your Own Changes</div><div class="sidebar-content">
<p id="d24e27679">
    We have already seen quite a lot of Dart code, but have you been writing your own as well? If you haven’t, here is another chance (after the one in <a href="/links/f_0041/f_0041.xhtml#sec.calculator.calculation.wrappingup">​<em>Wrapping Up the Calculation</em>​</a>) for you to make a very simple and slight improvement to our XKCD app.
  </p>
<p id="d24e27683">
    The <span class="cf class">ErrorPage</span> we just wrote generically informs the user that we couldn’t get that comic. This can also be used any time we can’t fetch a comic (for example, if there is no Internet available and the cache was wiped).
  </p>
<p id="d24e27688">
    You can do this yourself very easily by adding a <span class="cf variable">snapshot.hasError</span> condition to each <span class="cf class">FutureBuilder</span>. You could go one step further and compare the comic number given to the <span class="cf class">SelectionPage</span> to the latest comic number and show a different error if the user accidentally gave a comic number that is bigger than the latest comic number.
  </p></div></div>,<h2 id="d24e36245">Animations and Transistions</h2>
<p id="d24e36248">

There are two ways to animate widgets in Flutter: animating them <span class="emph">within</span> a given screen and animating them <span class="emph">between</span> different screens.</p><h3>Animating Within a Screen: the AnimatedContainer and Similar Widgets</h3>
<p id="d24e36264">
The <span class="cf class">AnimatedContainer</span> is one of the simplest widgets to start animating your Flutter app: it’s a regular <span class="cf class">Container</span> but it animates to when a property is changed, giving a nicer transition to a different state. For example, changing its <span class="cf ic">height</span> or <span class="cf ic">width</span> will make the widget shrink or expand gradually, and similar effects can be had by changing the border or color properties of the widget. The duration of the animation can optionally be changed using the <span class="cf ic">duration</span> argument and its curve (whether or not and how much the animation slows down or speeds up over time) can be changed using the <span class="cf ic">curve</span> argument.</p>
<p id="d24e36289">

The <span class="cf ic">duration</span> is of type duration, so you’d use the <span class="cf class">Duration</span> we used earlier during authentication, while the <span class="cf ic">curve</span> is of type <span class="cf class">Curve</span>. A collection of the most common curves is found in the <span class="cf class">Curves</span> class. It is a big collection, so you might consider reading the full list on the official Flutter reference manual<sup><a class="footnote" href="/links/f_0080/f_0080.xhtml#FOOTNOTE-51" id="FNPTR-51">[51]</a></sup> in the <span class="emph">Constants</span> section if the following basic curves aren’t enough for you or if you want to know the mathematical function that produces each curve:</p><ul><li><span class="cf constant">Curves.easeIn</span>, which starts out slowly and quickens over time.</li><li><span class="cf constant">Curves.easeOut</span>, which starts out fast and slows down over time.</li></ul>
<p id="d24e36335">
If you want to animate just some padding, you can replace a <span class="cf class">Padding</span> widget with some <span class="cf class">AnimatedPadding</span>, and if you want to anymate changes in <span class="cf class">TextStyle</span> you can use the animated version of the <span class="cf class">DefaultTextStyle</span> (which is a class that applies its <span class="cf ic">style</span> <span class="cf class">TextStyle</span> arguments to all of the descendants of its <span class="cf ic">child</span>), called the <span class="cf class">AnimatedDefaultTextStyle</span> (which animates the change in the <span class="cf ic">style</span>) by providing, optionally, a <span class="cf ic">curve</span> and a <span class="cf ic">duration</span> to these animated widgets.</p>
<p id="d24e36375">Those are all interesting, but the most useful is certainly the <span class="cf class">AnimatedList</span>, which animates additions made to a list or deletions of elements of a list.</p><h4>AnimatedList</h4>
<p id="d24e36383">

The <span class="cf class">AnimatedList</span> starts out as a normal <span class="cf class">ListView</span>, but its state object can be used (via a <span class="cf class">GlobalKey</span>) to insert or delete items, showing a transition when one of these operations is performed.</p>
<p id="d24e36407">We can construct an <span class="cf class">AnimatedList</span> just like a <span class="cf methodname">ListView.builder</span>-constructed <span class="cf class">ListView</span>, but we have to set a <span class="cf variable">key</span> that we’ll use to interact with it later, which has to be a <span class="cf ic">GlobalKey&lt;AnimatedListState&gt;</span>, and the <span class="cf variable">itemCount</span> will instead be called <span class="cf variable">initialItemCount</span>.</p>
<p id="d24e36431">The <span class="cf variable">itemBuilder</span> gets an extra <span class="cf variable">animation</span> argument, which provides the current state of the animation, which can be used by a <span class="cf class">SizeTransition</span> widget inside the <span class="cf variable">itemBuilder</span> to actually visually create the transition when an item is inserted by increasing the size of the widget (clipping it at the start and gradually showing it all) to animate the insertion of a widget.</p>
<p id="d24e36445">All of that adds up to the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">AnimatedList(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  key: key,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  initialItemCount: n,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemBuilder(context, i, animation) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    SizeTransition(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      sizeFactor: animation,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: WidgetToShow()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e36467">

The <span class="cf class">SizeTransition</span> isn’t the only widget that can perform similar transitions (for example the similar <span class="cf class">ScaleTransition</span> scales the widget up and down instead of clipping it), but it’s the most effective for the purpose of animating a list.</p>
<p id="d24e36484">
Having the same <span class="cf ic">key</span> stored somewhere allows us to get the <span class="cf class">AnimatedListState</span> object relative to that <span class="cf class">AnimatedList</span> by writing:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ listState = key.currentState ​<strong class="kw">as</strong>​ AnimatedListState;</td></tr></table>
<p id="d24e36512">which allows us to add a list item by wrapping the following in a call to <span class="cf methodname">setState</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">listState.insertItem(position);</td></tr></table>
<p id="d24e36524">keeping in mind that the <span class="cf class">AnimatedList</span> needs to be able to build the new element at that position: if it’s taking elements from a <span class="cf class">List</span>, make sure there is actually new data to build the new item from.</p>
<p id="d24e36532">A full example of a widget (or, more accurately, a stateful widget’s state) that takes advantage of an <span class="cf class">AnimatedList</span> to dynamically add items to a list when a floating action button is pressed is the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">GlobalKey _key = GlobalKey&lt;AnimatedListState&gt;();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">int</strong>​ _nextWidget = 3;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ _strings = [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"First"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"Second"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"Third"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    appBar: AppBar(title: Text(​<em class="string">"Animated List"</em>​)),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    body: AnimatedList(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      key: _key,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      initialItemCount: _nextWidget,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      itemBuilder: (context, i, animation) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        SizeTransition(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          sizeFactor: animation,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: ListTile(title: Text(_strings[i]),),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    floatingActionButton: FloatingActionButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Icon(Icons.add),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      onPressed: () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          (_key.currentState ​<strong class="kw">as</strong>​ AnimatedListState).insertItem(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            _nextWidget++</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          _strings.add(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">"</em>​​<em class="string">${_nextWidget}</em>​​<em class="string">th"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      },</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e36655">These widgets provide the simplest kind of animation available in Flutter: the most interesting animations are provided by the <span class="cf class">Hero</span> widget, which allows you to animate the movement of a widget across different screens.

</p><h3>Hero Animation</h3>
<p id="d24e36666">

Hero animations are performed by the Flutter framework on <span class="cf class">Hero</span> widgets. An <span class="cf class">Hero</span> widget needs a <span class="cf variable">tag</span> that identifies it and a <span class="cf variable">child</span> (which is the widget to animate). Adding the same <span class="cf variable">tag</span> to two <span class="cf class">Hero</span> widgets in two different screens, one of which is pushed from the other, will make the widget animate to move to its new position on the screen.</p>
<p id="d24e36694">A simple example that demonstrates the use of the <span class="cf class">Hero</span> widget is the following: there are two pages that have in common a widget (I used <span class="cf class">FlutterLogo</span> as an example) that is wrapped in an <span class="cf class">Hero</span> widget with the same <span class="cf ic">tag</span>. Switching between the views by clicking the floating action button will cause the widget to animate between its centered position in the first page to a top-left position in the second page and vice versa:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ FirstPage ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      body:Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child:Hero(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          tag: ​<em class="string">"Flutter Logo Hero"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: FlutterLogo(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      floatingActionButton: FloatingActionButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Icon(Icons.looks_two),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        onPressed: () =&gt; Navigator.pushReplacement(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            builder: (context) =&gt; SecondPage()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ SecondPage ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      body:Hero(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        tag: ​<em class="string">"Flutter Logo Hero"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: FlutterLogo(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      floatingActionButton: FloatingActionButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Icon(Icons.looks_one),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        onPressed: () =&gt; Navigator.pushReplacement(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            builder: (context) =&gt; FirstPage()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>,<h2 id="d24e35136">What Is Firebase?</h2>
<p id="d24e35139">The traditional way to build web and mobile apps is by having a front end and a back end. The front end is what is built using tools like Flutter, platform-specific native SDKs, <span class="emph">React</span> or <span class="emph">HTML</span> and it’s run on a the users’ client device, whereas the back end is ran on a server and is built with tools like <span class="emph">PHP</span>, <span class="emph">Spring</span> or <span class="emph">Node.js</span>.</p>
<p id="d24e35156">Firebase aims to replace most of the features run on server-side software with their own services that connect directly to apps using Google’s own API instead of using standard HTTP requests. Apps built using Firebase are usually simpler to set up and less complicated to maintain. There is a free plan (called <span class="emph">Spark</span>) that allows a limited number of connections and only offers limited storage and computing, but you don’t need anything more to complete the tasks described in this chapter.</p><h3>Getting Started</h3>
<p id="d24e35164">
Let’s start by navigating to the Firebase Console,<sup><a class="footnote" href="/links/f_0080/f_0080.xhtml#FOOTNOTE-46" id="FNPTR-46">[46]</a></sup> logging into Google and creating a new project:</p><div class="ss"><img alt="images/Firebase/addProjectButton.png" class="border " id="d24e35175" src="/images/img74/images/Firebase/addProjectButton.png" style="width: 33%"/></div>
<p id="d24e35176">after that, you’ll get the following popup window:</p><div class="ss"><img alt="images/Firebase/addProjectScreen.png" class="border " id="d24e35178" src="/images/img75/images/Firebase/addProjectScreen.png" style="width: 55%"/></div>
<p id="d24e35179">Choose a project name (for this example, we’ll use <span class="emph">ChatOnFire</span> from now on for all project/app names) and the closest servers to your location in the world. Now you need to connect your app to Firebase, and this has to be done separately for the Android and iOS configuration of the app by following the instructions provided on screen, keeping in mind that you can find the platform-specific configuration for each platform the app runs on in the <span class="cf dir">android</span> and <span class="cf dir">ios</span> directories of your app tree.</p>
<p id="d24e35190">After completing the platform-specific configuration, we need to start connecting Firebase to Flutter, and there are a bunch of Google-developed Flutter packages on Dart Pub that help us build apps using Flutter and Firebase.
</p><h3>Firebase for Flutter</h3>
<p id="d24e35196">


After installing the <span class="emph">firebase_core</span> package<sup><a class="footnote" href="/links/f_0080/f_0080.xhtml#FOOTNOTE-47" id="FNPTR-47">[47]</a></sup> (you know the drill, there’s no need for further explanations, remember to run <span class="cf commandname">flutter packages get</span> after editing <span class="cf filename">pubspec.yaml</span>) we need to worry about the specific features we need for our app. There is a complete list of Flutter Firebase packages on GitHub’s official Flutter account.<sup><a class="footnote" href="/links/f_0080/f_0080.xhtml#FOOTNOTE-48" id="FNPTR-48">[48]</a></sup></p>
<p id="d24e35231">Let’s start with the most commonly used Firebase tool: the Cloud Firestore database.</p><h3>The Firebase Cloud Firestore</h3>
<p id="d24e35236">

The Firebase Cloud Firestore is ideal for data that is subject to frequent additions and needs to be accessed in real time. This means it is perfectly suited to the creation of a chat app.</p>
<p id="d24e35243">For this example, navigate to Database -&gt; Rules in the Firebase Console and change the rules to the following so that we don’t need to authenticate (we’ll worry about that <a href="#sec.firebase.authentication">​<em>Authentication</em>​</a>).:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">service cloud.firestore {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  match /databases/{database}/documents {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    match /{document=**} {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      allow read, write;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e35263">What is commonly referred to in any SQL DBMS as a table is called a collection in Cloud Firestore. Let’s create one. Since we’re going to build a chat app, we’ll create one to store messages sent by the users.</p><h4>Creating a Collection</h4>
<p id="d24e35268">


Since our example is going to be a simple public chatroom, we just need to store three pieces of data about the message:</p><ul><li>
<p id="d24e35286">Who sent the message, which will be a string that we’ll initially set to <span class="emph">Anonymous</span> for each message, but that will be the user ID of the sender (which is a string) after we implement authentication.</p></li><li>
<p id="d24e35292">The message body itself (another string).</p></li><li>
<p id="d24e35295">The date and time at which the message was sent, which can be set to the Firestore data type <span class="cf ic">timestamp</span>, which is converted to a <span class="cf class">DateTime</span> object in Dart.</p></li></ul>
<p id="d24e35303">So, let’s go to Databases -&gt; Data in the Firebase Console, click the <span class="emph">Add collection</span> button, which will prompt you to enter a name for the collection. We’ll use <span class="emph">Messages</span> as the collection name. After that, you’ll be prompted to enter the data for the first document to be added to the collection.</p>
<p id="d24e35312">The Document ID doesn’t have to be anything in particular, so you can click the <span class="emph">Auto-ID</span> button to get it automatically filled for you by random characters;
We also need to add all of the fields we mentioned earlier, choosing the appropriate types and setting an appropriate value for each field to be used for the creation of the first message. For our example, let’s set the fields in the following way:</p><ul><li>
<p id="d24e35319">A <span class="cf ic">string</span> called <span class="emph">from</span> to identify the sender, with <span class="emph">Anonymous</span> as the value.</p></li><li>
<p id="d24e35331">A <span class="cf ic">string</span> called <span class="emph">msg</span>, which will be the body of the message, the value of which we you could set simply to <span class="emph">Hi</span>, as a test.</p></li><li>
<p id="d24e35343">A <span class="cf ic">timestamp</span> called <span class="emph">when</span>, which you should set to your current time converted to UTC time.</p></li></ul>
<p id="d24e35351">We are using UTC time for the <span class="cf ic">when</span> field because we want the date and time to be in the user’s local time, so we keep the UTC time in the database and convert it to the local time in the app. We’ll have to keep this in mind when sending messages from the app because in that occasion we’ll have to convert the local time to UTC.


</p><h4>Interacting with Cloud Firestore in Flutter Apps</h4>
<p id="d24e35364">



To use Firestore in our Flutter app, we’ll take advantage of the <span class="emph">cloud_firestore</span> package.</p>
<p id="d24e35388">Let’s start by adding the <span class="cf ic">cloud_firestore</span> package to the dependencies in <span class="cf filename">pubspec.yaml</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire/pubspec.yaml">firebase/chatonfire/pubspec.yaml</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">dependencies:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  flutter:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    sdk: ​<em class="string">flutter</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  firebase_core:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  cloud_firestore:</td></tr></table>
<p id="d24e35424">and importing it into <span class="cf filename">main.dart</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire/lib/main.dart">firebase/chatonfire/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:cloud_firestore/cloud_firestore.dart'</em>​;</td></tr></table>
<p id="d24e35438">
We interact with Cloud Firestore using an instance of the <span class="cf class">Firestore</span> class created using <span class="cf ic">Firestore.instance</span>. We can access a collection with <span class="cf methodname">Firestore.instance.collection("collectionName")</span> where <span class="emph">collectionName</span> is the name of the collection we want to access. The type of data returned by that is <span class="cf class">CollectionReference</span>, and we will explore how to use that in this section.


</p><p><strong id="sec.firebase.firestore.read">Reading from the Cloud Firestore</strong></p>
<p id="d24e35468">


If we want to access a certain document directly, we use the:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">CollectionReference.document(path)</td></tr></table>
<p id="d24e35491">
simple query method (where) <span class="cf ic">path</span> is actually the ID of the document, which corresponds with the path leading to the document within the collection. This returns a <span class="cf class">DocumentReference</span>, and doesn’t actually fetch the document. To fetch it, we need to call <span class="cf methodname">DocumentReference.get</span>, which returns a <span class="cf ic">Future&lt;DocumentSnapshot&gt;</span>. After <span class="cf ic">await</span>ing or otherwise getting the <span class="cf class">DocumentSnapshot</span> itself, we can access the data contained in the document by accessing the <span class="cf variable">DocumentSnapshot.data</span> property, which contains a <span class="cf class">Map</span> of the data contained in the document.</p>
<p id="d24e35522">For example, if we had the name of a collection stored in a variable called <span class="cf ic">collectionName</span> and we wanted to access document with ID <span class="cf ic">docPath</span>, and in particular its property <span class="cf ic">"myMember"</span> and set it to the <span class="cf variable">data</span> variable, we would need to write the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ firestore = Firestore.instance;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ data = (</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  await firestore</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    .collection(collectionName)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    .document(docPath)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    .get()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">).data[​<em class="string">"myMember"</em>​];</td></tr></table>
<p id="d24e35574">Querying a single document is useful for some purposes, but what we really want in a chat app when fetching messages is a way to access the list of all of the documents that have been stored in the collection.</p>
<p id="d24e35576">To do that, we can use the <span class="cf methodname">CollectionReference.getDocuments</span> method, which returns all of the documents in the given collection in a <span class="cf class">Future</span>, but its disadvantage is that we need to fetch it again every time we want to update the list of messages, which doesn’t really go well with the real-time nature of instant messaging.</p>
<p id="d24e35584">What we want is to get the messages as a <span class="cf class">Stream</span> that is changed in real time to yield the list of all messages updated in real time. This is done using the <span class="cf methodname">CollectionReference.snapshots</span> method, meaning we can use it to get a <span class="cf class">Stream</span> of the messages by writing:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Firestore.instance.collection(​<em class="string">"Messages"</em>​).snapshots()</td></tr></table><p><strong id="sec.firebase.firestore.add">Adding Data to the Cloud Firestore</strong></p>
<p id="d24e35615">

We can add a document to a Firestore collection by using <span class="cf methodname">CollectionReference.add(doc)</span> where <span class="cf ic">doc</span> is a <span class="cf class">Map</span> assigning a value for each of the document’s fields, like in the following example, which sends an anonymous message to be stored in the collection:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Firestore.instance.collection(​<em class="string">"Messages"</em>​).add(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"from"</em>​: ​<em class="string">"Anonymous"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"when"</em>​: DateTime.now().toUtc(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"msg"</em>​: ​<em class="string">"Hi There From The App"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">);</td></tr></table>
<p id="d24e35684">In a real app we need to authenticate users, so we’ll start by discovering how we can authenticate users to our Flutter apps using Firebase Authentication.</p><p><strong>Deleting or Changing Data from the Cloud Firestore</strong></p>
<p id="d24e35690">



Given a <span class="cf class">DocumentReference</span> (the object we get from <span class="cf methodname">Firestore.instance.collection(collection).document(document)</span>), we can, in addition to getting the data using the <span class="cf methodname">DocumentReference.get</span> as we said earllier, perform some actions on the document:</p><ul><li>Delete it using <span class="cf methodname">DocumentReference.delete</span>.</li><li>Change some fields by passing a <span class="cf class">Map</span> to <span class="cf methodname">DocumentReference.updateData</span>.</li><li>Set the contents of the document, creating it if doesn’t exist, by passing a <span class="cf class">Map</span> to <span class="cf methodname">DocumentReference.setData</span>.</li></ul>
<p id="d24e35746">All of these methods run asynchronously but don’t return anything.



</p><h3 id="sec.firebase.authentication">Authentication</h3>
<p id="d24e35758">


Authentication requires its own <span class="emph">firebase_auth</span> package<sup><a class="footnote" href="/links/f_0080/f_0080.xhtml#FOOTNOTE-49" id="FNPTR-49">[49]</a></sup> and can be configured in Flutter’s console by going to Develop -&gt; Authentication -&gt; Sign-in method. In our example we’ll authenticate users using their email address and password, which is made very easy by Firebase and is representative of the majority of apps. After selecting it, you’ll be warned that more platform-specific setup is required: specifically, we need to add:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">implementation 'com.google.firebase:firebase-auth:16.2.1'</td></tr></table>
<p id="d24e35786">to the app-level <span class="cf filename">build.gradle</span> dependencies for Android, and:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">pod 'Firebase/Auth'</td></tr></table>
<p id="d24e35795">to the iOS <span class="cf filename">Podfile</span> you should have from the CocoaPods configuration that was needed to connect the iOS app to Firebase.</p><h4>Using the firebase_auth Package</h4>
<p id="d24e35803">Let’s import the <span class="emph">firebase_auth</span> package, which provides an intuitive Flutter interface to the Firebase Authentication tools:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire/pubspec.yaml">firebase/chatonfire/pubspec.yaml</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">firebase_auth: ​<em class="string">^0.6.2</em>​</td></tr></table>
<p id="d24e35816">As always, we need to import the firebase_auth package in <span class="cf filename">main.dart</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire/lib/main.dart">firebase/chatonfire/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:firebase_auth/firebase_auth.dart'</em>​;</td></tr></table><p><strong>The FirebaseAuth</strong></p>
<p id="d24e35833">

Firebase authentication is achieved using an instance of the <span class="cf class">FirebaseAuth</span> class, obtained using:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ auth = FirebaseAuth.instance;</td></tr></table>
<p id="d24e35853">After this, we can use the <span class="cf variable">auth</span> object to handle most authentication-related actions.</p>
<p id="d24e35858">
Among them, we find:</p>
<p id="d24e35864"><span class="cf methodname">createUserWithEmailAndPassword(email, password)</span></p>
<p id="d24e35867">
which creates a user with the given email and password, and:</p>
<p id="d24e35873"><span class="cf methodname">signInWithEmailAndPassword(email, password)</span></p>
<p id="d24e35876">which signs in the user with the given email and password.</p><div class="sidebar"><div class="sidebar-title">The Many Authentication Methods Available in Flutter</div><div class="sidebar-content">
<p id="d24e35881">
	
		There are many authentication methods available to use with Firebase. Here is a list of the most common ones:
	</p><ul><li>
<p id="d24e35890">Phone Authentication, which relies on two phases: running <span class="cf methodname">FirebaseAuth.instance.verifyPhoneNumber</span>, which takes methods to be run when the code is sent, it’s automatically retrieved, or there was an issue during verification. If it is auto-retrieved, we should consider the user authenticated and move on. If it is not, we need to provide the user a way to insert the code they received via SMS and use and use an <span class="cf class">AuthCredential</span> to log in, as described in the aside <span class="emph">Package and Library Versions</span> that follows this sidebar.
		</p></li><li>
<p id="d24e35904">Google Sign-In Authentication, using <span class="cf methodname">FirebaseAuth.instance.signInWithGoogle</span>.
		</p></li></ul></div></div><table class="simpletable outerlines"><thead><tr><th class="outerlines" colspan="2"><p class="last-para-in-cell">Package and Library Versions</p></th></tr></thead><tbody><tr class="tr zebra "><td style="valign: middle; width: 12%; ">
               <img alt="images/aside-icons/warning.png" class="" id="d24e35922" src="/images/img83/images/aside-icons/warning.png" style="width: 100%"/>
             </td><td style="valign: middle; width: 88%; ">

  <p>
  
  	The <span class="emph">FlutterFire</span> packages (as Google likes to call the Firebase-related Flutter packages), just like the testing interface, are sometimes incompatible with some versions of Flutter or of the platform-specific API (the one we import in the Gradle/CocoaPods configuration) or don’t work at all. Additionally, they tend to have breaking changes from one version to another, meaning the same code has a high change of not working after one or two major releases.
  </p>
  <p>
  
  
  
  	For our example, I used <span class="emph">firebase_auth</span> version 0.6.X because that was the only version that consistenly worked with the current Flutter version (1.5) and native API version. If, in the future, you need to use a newer version because of security concerns about the older versions or any other reason. One thing to keep in mind is that the package is slowly switching to using the generic <span class="cf methodname">auth.signInWithCredential</span> method, which takes as a positional argument a <span class="cf class">AuthCredential</span> object.
  </p>
  <p>
  
  	An <span class="cf class">AuthCredential</span> object can be generated by calling the <span class="cf methodname">getCredential</span> of each <span class="cf class">AuthProvider</span>, providing to each the arguments it needs to perform the authentication.
  </p>
  <p class="last-para-in-cell">
  	You can look at all of the <span class="cf class">AuthProvider</span>s available and the methods you can use to get <span class="cf class">AuthCredential</span>s on the official <span class="emph">firebase_auth</span> API reference.<sup><a class="footnote" href="/links/f_0080/f_0080.xhtml#FOOTNOTE-50" id="FNPTR-50">[50]</a></sup> That’s also where you should look in case you upgrade the package version and have issues in general.
  </p>
</td></tr></tbody></table><p><strong id="sec.firebase.firebaseuser">The FirebaseUser</strong></p>
<p id="d24e36002">
The final result of an authentication process is the generation of a <span class="cf class">FirebaseUser</span> variable, which will also be stored. This represents the user account and stores the following information as properties:</p><ul><li>
<p id="d24e36013">Its <span class="cf variable">uid</span>, a string equivalent to a typical numerical User ID.</p></li><li>
<p id="d24e36019">Its <span class="cf variable">phoneNumber</span> and/or <span class="cf variable">email</span> address.</p></li><li>
<p id="d24e36028">An <span class="cf variable">isEmailVerified</span> to establish whether a user’s email address has been verified, which is useful when doing email and password authentication.</p></li><li>
<p id="d24e36034">A <span class="cf variable">displayName</span> and <span class="cf variable">photoUrl</span> we can set by changing these properties directly.</p></li></ul>
<p id="d24e36042">To make changes to these properties (for example to set the display name), we need to create an <span class="cf class">UserUpdateInfo</span> object, which will have all of these properties. Change any properties you want to change and then run <span class="cf methodname">user.updateProfile(userUpdateInfo)</span>, where <span class="cf variable">userUpdateInfo</span> is the <span class="cf class">UserUpdateInfo</span> object containing the changed properties.</p>
<p id="d24e36056">To change the user’s email address, you can use <span class="cf methodname">user.updateEmail(newEmail)</span>, whereas to change the user’s password you can use <span class="cf methodname">user.updatePassword(newPassword)</span>. You can reload the local profile to match the remote one using <span class="cf methodname">user.reload</span>. Keep in mind that this will only have an effect if you reassign the <span class="cf variable">user</span> variable to <span class="cf methodname">auth.currentUser</span>.</p>
<p id="d24e36073">Firebase’s authentication tools can do a lot: other than just creating and deleting accounts, resetting passwords and changing email address, it allows you to also verify email addresses. Verification happens by calling <span class="cf methodname">user.sendEmailVerification</span>, which sends an email containg a verification link to the user. When the user clicks the link, the email will be considered as verified.</p>
<p id="d24e36078">The only difference this makes to Firebase itself is that users with a verified email addresses have the <span class="cf variable">user.isEmailVerified</span> boolean property set to <span class="cf constant">true</span> instead of <span class="cf constant">false</span>. You get to decide what to do with unverified users: whether to supply all features, only some of them, or no features at all.</p>
<p id="d24e36089">You also get to decide what the email sent to the user will look like: by going to Authentication -&gt; Templates you can choose the sender name, some aspects of the sender email address and the entire body of the email sent to the user.
</p><p><strong id="sec.firebase.loginsignup">Writing Log-In and Sign-Up Methods</strong></p>
<p id="d24e36095">That’s the theory, here are two examples of how you can use those methods to write an interface to the Firebase Authentication API for our app.</p>
<p id="d24e36097">This is what a sign-up method for email and password authentication could look like:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire/lib/main.dart">firebase/chatonfire/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;FirebaseUser&gt; signUp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ email, ​<strong class="kw">String</strong>​ password</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">) async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  _auth.createUserWithEmailAndPassword(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    email: email,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    password: password</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr></table>
<p id="d24e36125">and this is how we could write a log-in method</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire/lib/main.dart">firebase/chatonfire/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;FirebaseUser&gt; logIn(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ email, ​<strong class="kw">String</strong>​ password</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">) async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  _auth.signInWithEmailAndPassword(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      email: email,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      password: password</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr></table><p><strong>Checking Whether the User is Logged-In and Getting Information on the Current user</strong></p>
<p id="d24e36158">Running:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">auth.currentUser();</td></tr></table>
<p id="d24e36167">

will return (asynchronously) the currently logged in <span class="cf class">FirebaseUser</span>.</p>
<p id="d24e36181">If we haven’t performed log-in yet, it will return <span class="cf ic">null</span>, meaning there is an easy way to check whether log-in has happened.</p><p><strong>Log-In Persistency in Local Cache</strong></p>
<p id="d24e36190">


Firebase will preserve login information in local storage, meaning we don’t have to worry about persistence of user data on the local user’s device since Firebase will take care of that for us as well.</p><p><strong>Sign Out</strong></p>
<p id="d24e36209">
Given that the user data is kept by Firebase indefinetly, to sign out a user you need to run:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">auth.signOut();</td></tr></table>
<p id="d24e36222">which is an asynchronous method that doesn’t return anything.</p><h3>Combining Authentication and Database Access</h3>
<p id="d24e36227">

Firebase is great: you just need to authenticate the user and then any operation you try to execute on a Firebase database will be executed on behalf of that user. You don’t even need to think about it: Firebase does it on its own and Flutter supports it perfectly. That’s what we’re going to take advantage of when we build our chat app in <a href="/links/f_0079/f_0079.xhtml#sec.firebase.chat">​<em>Building the Chat App</em>​</a>.


</p>,<h2 id="sec.dart.async">Asynchronous Code in Dart: The dart:async Library</h2>
<p id="d24e44137">




At some point during your Dart development process, you might need to call a method without affecting the execution of your code, or call a library method that has been declared as an <span class="cf ic">async</span> method.</p>
<p id="d24e44168">That’s when you realize the necessity for asynchronous code and the <span class="cf ic">dart:async</span> built-in Dart library, which allows <span class="cf ic">async</span> functions to return either a <span class="cf class">Future</span> or a <span class="cf class">Stream</span>.</p><h3>The <span class="cf class">Future</span></h3>
<p id="d24e44187">

The <span class="cf class">Future</span> is the most basic object type related to asynchronous methods—it is the return type of all <span class="cf ic">async</span> functions, including <span class="cf ic">void</span> ones:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;​<strong class="kw">void</strong>​&gt; doSomethingThatTakesLong() async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// do something</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">callingSyncFunction</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  doSomethingThatTakesLong();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">/* the code won't wait for the function to</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   * finish its execution and it will carry on</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   * in its regular order, executing</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   * the next instruction</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   */</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e44252">If you need to wait for the function to stop executing (perhaps because you need the returned value), you need to choose between using <span class="cf keyword">await</span> or <span class="cf methodname">.then</span>.</p><h4>await</h4>
<p id="d24e44263">
<span class="cf keyword">await</span> is useful when you actually need to wait for an async function to finish its execution, often because you need its return value. It converts a <span class="cf class">Future</span> into the value returned by the function by waiting for the code that returned the future to finish its execution:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;​<strong class="kw">int</strong>​&gt; getValue() async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ 5;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;​<strong class="kw">int</strong>​&gt; callingFunction() async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ n = await getValue();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ n+5;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h4>then(), catchError(), and whenComplete()</h4>
<p id="d24e44310">
If there are some actions you want to take when the <span class="cf class">Future</span> returns a value, but it doesn’t affect the rest of the current code block’s execution or its return value, you can use the <span class="cf class">Future</span>’s <span class="cf methodname">.then</span> method, which allows you to add a callback function to be called with the <span class="cf class">Future</span>’s return value when it is available:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;​<strong class="kw">int</strong>​&gt; getValue() async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ 5;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">main</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  getValue().then((n) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">assert</strong>​(n == 5);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">/* something else that</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   * won't wait for getValue</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   * to return to execute</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">   */</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e44379">

What if there’s a runtime error in the execution of the future? That’s when we use <span class="cf methodname">catchError</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">printValue</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  getValue()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    .then(print)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    .catchError((err) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="comment">// handle error</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e44422">
You can add a <span class="cf methodname">whenComplete</span> call (a lot like a <span class="cf keyword">finally</span> block) for code that needs to be executed regardless of anything that happens.

</p><h3 id="sec.dart.streams">Streams and StreamSubscriptions</h3>
<p id="d24e44440">

There are certain kinds of data that are subject to frequent change, like the battery and connectivity status we saw in Chapter 4, <a href="/links/f_0046/f_0046.xhtml#chp.packages">​<em> Beyond the Standard Library: Plugins and Packages </em>​</a> or the documents in the Firebase Cloud Firestore we saw in Chapter 7, <a href="/links/f_0074/f_0074.xhtml#chp.firebase">​<em> Build a Chat App Using Firebase </em>​</a>. For this kind of data, we use special asynchronous methods that <span class="cf keyword">yield</span> different values at different times or many different values at once.</p><h4>Creating a Stream</h4>
<p id="d24e44463">
The most basic way to create a <span class="cf class">Stream</span> is to return multiple values from an asynchronous generator function (<span class="cf ic">async*</span>) using the <span class="cf keyword">yield</span> keyword.</p><p><strong>yielding Values from a Generator Function</strong></p>
<p id="d24e44481">A function that generates a <span class="cf class">Stream</span> looks something like this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Stream&lt;​<strong class="kw">String</strong>​&gt; myStream() async* {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ returnValues = [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"This is The First String You'll See"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"After 2 Seconds You'll See This"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"Then This"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">for</strong>​ (​<strong class="kw">int</strong>​ i = 0; i &lt; 3; i++) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    await Future.delayed(Duration(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      seconds: 2</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    yield returnValues[i];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e44538">
<span class="cf methodname">Future.delayed</span> allows you to define a <span class="cf class">Future</span> that can be used to pause execution (by waiting for it to be done) for a specified amount of time.</p>
<p id="d24e44551"><span class="cf keyword">yield</span> is just like <span class="cf keyword">return</span>, but it doesn’t move the execution outside the asynchronous generator function: it yields a value to the calling function and then resumes execution inside the generator function, allowing it to yield another value later.</p><p><strong>Using a StreamController</strong></p>
<p id="d24e44561">
A <span class="cf class">StreamController</span> is a more advanced way of generating <span class="cf class">Stream</span>s: it allows you to generate a <span class="cf class">Stream</span> with a regular synchronous function and in more complex scenarios in which <span class="cf keyword">yield</span> just doesn’t cut it.</p>
<p id="d24e44579">Once you define a <span class="cf class">StreamController</span> variable in a function, you can use <span class="cf methodname">StreamController.add</span> anywhere within the function (perhaps in a callback) and have an effect similar to <span class="cf keyword">yield</span>. Another very important <span class="cf class">StreamController</span> method is <span class="cf methodname">StreamController.close</span>, which causes listening functions to stop listening to the <span class="cf class">Stream</span>.</p>
<p id="d24e44600">The <span class="cf class">StreamController</span> has two constructors: <span class="cf methodname">StreamController</span> (which is the default) and <span class="cf methodname">StreamController.broadcast</span>.</p>
<p id="d24e44611">The <span class="cf methodname">StreamController</span> constructor, which is used for streams that are only supposed to have one listener, takes four callback functions as arguments:</p><ul><li>
<p id="d24e44618"><span class="cf methodname">onListen</span>, which is fired when a listener starts listening for objects and should trigger the start of the yielding of values to avoid creating memory leaks by firing events that no listener is listening to, causing Dart to buffer them, using up memory for events that may never be listened to anywhere.</p></li><li>
<p id="d24e44623"><span class="cf methodname">onPause</span>, which is fired when the listener requests the <span class="cf class">Stream</span> to temporarily not yield anything using <span class="cf methodname">StreamSubscription.pause</span>, for the same reason <span class="cf methodname">onListen</span>.</p></li><li>
<p id="d24e44637"><span class="cf methodname">onResume</span>, which is fired when the listener requests the <span class="cf class">Stream</span> to resume the yielding of values after a pause by calling <span class="cf methodname">StreamSubscription.resume</span>, it should be obvious at this point that this function should cause the stream to resume firing events.</p></li><li>
<p id="d24e44648"><span class="cf methodname">onCancel</span>, which is fired when the listener cancels its subscription by calling <span class="cf methodname">StreamSubscription.cancel</span> and is supposed to make the <span class="cf class">Stream</span> stop trying to yield values.</p></li></ul>
<p id="d24e44658">The <span class="cf methodname">StreamController.broadcast</span> constructor, which is used for <span class="emph">broadcast streams</span>, can be listened to by multiple listeners. It takes only <span class="cf methodname">onListen</span> and <span class="cf methodname">onCancel</span> as arguments.
</p><h4>Using a Stream</h4>
<p id="d24e44676">
We’ve seen the basics of how to use <span class="cf class">Stream</span>s in <a href="/links/f_0048/f_0048.xhtml#sec.packages.streams">​<em>Getting the Battery and Connectivity Data: Asynchronous Programming Using Streams</em>​</a>. That example followed this structure:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyWidget ​<strong class="kw">extends</strong>​ StatefulWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// ...</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyState ​<strong class="kw">extends</strong>​ State&lt;MyWidget&gt; {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// ...</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  StreamSubscription&lt;Type&gt; _streamSub;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ initState() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// ...</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    _streamSub = stream.listen(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      (Type res) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<em class="comment">// do something with the response, setState()</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// ...</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  dispose() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// ...</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    _streamSub.cancel();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e44776">In that case, the <span class="cf ic">stream</span> was provided directly by a library, and we used <span class="cf methodname">setState</span> to update some variables when new data was available and rebuild the widget.</p>
<p id="d24e44784">All of that is inefficient if the <span class="cf class">StatefulWidget</span> that is rebuilt every time the stream changes isn’t just the part that’s showing the data from that <span class="cf class">Stream</span>.
</p><h4>The StreamBuilder</h4>
<p id="d24e44796">
Building a separate <span class="cf class">StatefulWidget</span> for that isn’t necessary because, just like the <span class="cf class">FutureBuilder</span> exists to build UI elements based on the results of <span class="cf class">Future</span>, the <span class="cf class">StreamBuilder</span> is the Flutter widget that builds its contents based on the data returned by a <span class="cf class">Stream</span>.</p>
<p id="d24e44818">The <span class="cf class">StreamBuilder</span>’s constructor requires, just like the <span class="cf class">FutureBuilder</span>, a data type and two arguments, but with a few differences.</p>
<p id="d24e44826">The basic structure of a <span class="cf class">StreamBuilder</span> widget is the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">StreamBuilder&lt;Type&gt; {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  stream: stream,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  builder: (context, snapshot) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(snapshot.hasData)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="comment">// display snapshot.data</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">else</strong>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="comment">// display an error or some indication that the data is loading</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e44863">
One of the differences between the <span class="cf class">StreamBuilder</span> and the <span class="cf class">FutureBuilder</span> lies in the <span class="cf variable">snapshot.connectionState</span> value. When working with a <span class="cf class">Future</span> in a <span class="cf class">FutureBuilder</span>, it could only assume the following values:</p><ul><li>
<p id="d24e44886"><span class="cf constant">ConnectionState.none</span> if the <span class="cf variable">future</span> argument is set to <span class="cf constant">null</span> (not set at all).</p></li><li>
<p id="d24e44897"><span class="cf constant">ConnectionState.waiting</span> if the <span class="cf class">FutureBuilder</span> is waiting for the <span class="cf variable">future</span> to return a value.</p></li><li>
<p id="d24e44908"><span class="cf constant">ConnectionState.none</span> if the <span class="cf variable">future</span> has returned a value, meaning <span class="cf variable">snapshot.hasData</span> is <span class="cf constant">true</span>.</p></li></ul>
<p id="d24e44921">
This is why we only used <span class="cf variable">snapshot.hasData</span> and not <span class="cf variable">snapshot.connectionState</span> when working with <span class="cf class">Future</span>s and <span class="cf class">FutureBuilder</span>s. When working with <span class="cf class">Stream</span>s, though, there’s more to it—the connection state could also be <span class="cf constant">ConnectionState.active</span>, meaning that the <span class="cf class">Stream</span> has already returned a value, but it hasn’t terminated, meaning it could return another value at any time.</p>
<p id="d24e44949">

<span class="cf variable">snapshot.hasError</span> and the <span class="cf variable">snapshot.error</span> exist for both in case you need to handle errors.
</p><h4>The await for Loop</h4>
<p id="d24e44970">
The <span class="cf class">Stream</span> can be interacted with in an alternative way to using the <span class="cf methodname">listen</span> method: the <span class="cf keyword">await for</span> loop.</p>
<p id="d24e44985">It’s just like a <span class="cf keyword">for</span>-<span class="cf keyword">in</span> loop but, instead of iterating over known values in a list, it waits for new values returned by the stream and only terminates when the stream terminates:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">await ​<strong class="kw">for</strong>​(​<strong class="kw">var</strong>​ value ​<strong class="kw">in</strong>​ stream) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// do something with the value</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e45012">For example, we can print to the console the strings returned by the <span class="cf methodname">myStream</span> function we defined earlier as soon as it <span class="cf keyword">yield</span>s them with the following loop:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">await ​<strong class="kw">for</strong>​(​<strong class="kw">var</strong>​ res ​<strong class="kw">in</strong>​ myStream()) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  print(res);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e45037">Instead of printing results the <span class="cf keyword">await for</span> can be used, for example, to take an existing <span class="cf class">Stream</span>, change the data or use it as an argument for some other function, and then <span class="cf keyword">yield</span> a changed value, creating a new <span class="cf class">Stream</span>.</p><h4>Error Handling Within Streams</h4>
<p id="d24e45054">



When using a <span class="cf class">StreamBuilder</span>, the <span class="cf ic">snapshot</span> you get in the <span class="cf ic">builder</span> has the same <span class="cf ic">snapshot.hasError</span> and <span class="cf ic">snapshot.error</span> you get with <span class="cf class">FutureBuilder</span>s so you can use those if you need to handle errors within a <span class="cf class">FutureBuilder</span> or a <span class="cf class">StreamBuilder</span></p>
<p id="d24e45099">
The <span class="cf methodname">listen</span> method optionally takes two more callbacks as arguments:</p><ul><li>
<p id="d24e45110"><span class="cf variable">onError</span>, which is run when there is an error is thrown by the asynchronous function that generates the <span class="cf class">Stream</span>.</p></li><li>
<p id="d24e45118"><span class="cf variable">onDone</span>, which is run when the <span class="cf class">Stream</span> terminates.



</p></li></ul>,<h2 id="sec.dart.classes">Classes</h2>
<p id="d24e45667">


Classes in Dart work a lot like classes in other object-oriented languages, but here’s most of what you need to know to get started.</p><h3>Members: Properties and Methods</h3>
<p id="d24e45682">


Properties are variables declared as members of a class:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ User {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">int</strong>​ id;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ username;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ password;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e45719">


Methods are functions defined inside classes. They are defined just like top-level functions, but inside the body of a class definition:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ User {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">int</strong>​ id;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ username;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ password;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ setId(​<strong class="kw">int</strong>​ newId) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    id = newId;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h4>Accessing Members: Dot Notation</h4>
<p id="d24e45772">


Members can be accessed using dot notation. If you wanted to get the <span class="cf variable">id</span> property of the <span class="cf variable">user</span> object and assign it to the <span class="cf variable">a</span> variable, you’d write:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ a = user.id;</td></tr></table>
<p id="d24e45806">and you’d run the <span class="cf methodname">setId</span> method like this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">user.setId(1000)</td></tr></table><h4 id="sec.dart.classes.cascadeNotation">Cascade Notation</h4>
<p id="d24e45821">



If you need to run multiple methods or change many properties of an object, you can use cascade notation, which allows you to write something like this, which will create a <span class="cf class">User</span> with the given username, password, and ID:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ a = User()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ..username=​<em class="string">"yourUsername"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ..password=​<em class="string">"Actually1veryComplicatedPass!"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ..setId(1000);</td></tr></table><h3 id="sec.dart.classes.constructors">Constructors</h3>
<p id="d24e45872">

Dart allows us to define just the constructor’s signature and it will automatically assign the arguments to the corresponding properties and create an instance of the class automatically. The parameters are defined just like any function’s parameters, but pointing to a property of the class:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ClassExample {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ClassExample(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">this</strong>​.var1, ​<em class="comment">// positional argument</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      @required ​<strong class="kw">this</strong>​.var2, ​<em class="comment">// named arguments</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">this</strong>​.var3</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">int</strong>​ var1;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ var2;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Function var3;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e45938">
You can define the constructor for a class inheriting from a superclass in the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ClassExample ​<strong class="kw">extends</strong>​ SuperClass {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ClassExample(parameters) :</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">super</strong>​(superClassArguments);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h4>Named Constructors</h4>
<p id="d24e45965">
You can also define <span class="emph">named</span> constructors, which are alternative constructors with a different name:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ClassExample {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ClassExample(parameters);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ClassExample.constructorName(otherParameters);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h4>Regular Constructors</h4>
<p id="d24e45990">

Dart also supports regular constructor with their own body, that can optionally also take advantage of automatic property assignment.</p>
<p id="d24e46000">Here’s an example of a class that has a constructor that takes an integer value and assigns its square to the <span class="cf variable">var1</span> while assigning <span class="cf variable">var2</span> and <span class="cf variable">var3</span> directly:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ClassExample {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ClassExample(​<strong class="kw">this</strong>​.var1, ​<strong class="kw">this</strong>​.var2, ​<strong class="kw">this</strong>​.var3);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ClassExample.withSqrtOfVar1(​<strong class="kw">int</strong>​ var1sqrt, ​<strong class="kw">this</strong>​.var2, ​<strong class="kw">this</strong>​.var3) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    var1 = var1sqrt*var1sqrt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">int</strong>​ var1;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ var2;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Function var3;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3 id="sec.dart.methods.static">Static Members</h3>
<p id="d24e46081">




Static class members can be accessed without requiring instantiation:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ClassExample {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// (...)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">static</strong>​ ​<strong class="kw">num</strong>​ square(​<strong class="kw">num</strong>​ val) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    val*val;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// (...)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">// Unlike in C++, we can use regular dot notation</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ n = ClassExample.square(0.1);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">/*</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment"> * Comparing floating-point numbers</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment"> * using == is unreliable in</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment"> * most programming languages,</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment"> * including Dart, so use</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment"> * syntax like this instead</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment"> */</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(n &lt; 0.011 &amp;&amp; n &gt; 0.009);</td></tr></table><h3>Abstract Classes</h3>
<p id="d24e46171">

An <span class="cf ic">abstract class</span> is a class that you can’t instantiate: you can’t create objects of that class. They are declared by substituting the <span class="cf ic">class</span> keyword with <span class="cf ic">abstract class</span>. Abstract classes are usually used as mixins (covered in <a href="#sec.dart.mixins">​<em>Writing a Class with a Mixin</em>​</a>) or interfaces (covered in <a href="#sec.dart.implements">​<em>Writing a Class That implements an Interface</em>​</a>).</p>
<p id="d24e46196">
An abstract class can contain abstract methods, which are method that don’t have an implementation, but it can also contain regular methods:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">abstract</strong>​ ​<strong class="kw">class</strong>​ MyClass {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ regularMethod() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// do something</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ abstractMethod();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e46231">An abstract method may be implemented by either a subclass or a class that implements the <span class="cf class">MyClass</span> interface, as explained in the following sections.</p><h3>Subclasses, Interfaces, and Mixins: extends, implements, and with</h3>
<p id="d24e46239">

Classes can interact with each other in three ways: a class can be a subclass of another, inheriting all of its members and optionally overriding some of the methods; it can <span class="cf keyword">implement</span> another class’s interface; or it can use methods defined in another class (called a mixin).</p><h4 id="sec.dart.extends">extends</h4>
<p id="d24e46254">
Especially in Flutter, extending another class is a very common occurrence. By doing that we create a subclass, and the class we extend is called the superclass. We can decide to declare new methods or re-implement (<span class="cf ic">override</span>) existing methods. A subclass can have its own variables and use the superclass’s by accessing the superclass itself through the <span class="cf variable">super</span> object.</p><p><strong>@override</strong></p>
<p id="d24e46269">


When creating subclasses, you might want to implement one of the superclass’s methods, you can do that by prefixing it with the @override annotation, as we do for the <span class="cf methodname">build</span> method when defining widgets:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyWidget ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// (...)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// (...)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e46312">the method can also be defined as:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override Widget build(context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// (...)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e46324">
Sometimes you might want to call the superclass’s corresponding method by adding <span class="cf methodname">super.methodName</span> at the start of the new method’s definition so that the new method acts as an addition, not a replacement, like we have to do when we redefine the <span class="cf class">State</span> class’s <span class="cf methodname">initState</span> when writing <span class="cf class">StatefulWidget</span>s:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ _MyWidgetState ​<strong class="kw">extends</strong>​ State&lt;StatefulWidget&gt; {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// (...)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ initState() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">super</strong>​.initState();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// our own instructions</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// (...)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e46384">


We have to do that for the <span class="cf class">State</span> class because it has been defined in the Flutter widgets library with the <span class="cf ic">@mustCallSuper</span> annotation, and we can do the same in case we want to define classes for which we think subclasses will be created and a certain overriding method is supposed to call the superclass’s overridden method.

</p><h4 id="sec.dart.mixins">Writing a Class with a Mixin</h4>
<p id="d24e46411">

A mixin is a class that contains methods to be used by other classes, without requiring those classes to inherit from the mixin directly by extending it and becoming a subclass of it. A mixin can be defined simply as a class and be used by declaring any class that wants to use it (<span class="emph">applying</span> the mixing) <span class="cf ic">with</span> the mixin, like in the following example:
</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">// the mixin</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyMixin {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ myMethod() =&gt; ​<em class="string">"Hi from the mixin"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyClass ​<strong class="kw">with</strong>​ MyMixin {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ obj = MyClass();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(obj.myMethod() == ​<em class="string">"Hi from the mixin"</em>​);</td></tr></table><h4 id="sec.dart.implements">Writing a Class That implements an Interface</h4>
<p id="d24e46480">


An interface is a class that only defines the return type and arguments of its methods, requiring other classes to implement those methods. Fittingly, this is done using the <span class="cf keyword">implements</span> keyword:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">abstract</strong>​ ​<strong class="kw">class</strong>​ MyInterface {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">abstract</strong>​ ​<strong class="kw">void</strong>​ myMethod();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyClass ​<strong class="kw">implements</strong>​ MyInterface {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ myMethod() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// do something</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyOtherClass ​<strong class="kw">implements</strong>​ MyInterface {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ myMethod() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// do something else</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e46562">After doing that, you can instantiate and use the <span class="cf class">MyClass</span> and <span class="cf class">MyOtherClass</span>, and you can use them knowing that they implement all of the methods described in <span class="cf class">MyInterface</span>.


</p>,<h2 id="d24e1303">Get Familiar with Dart Syntax and Flutter Classes</h2>
<p id="d24e1306">In this first section of the chapter, we’ll take a look at the Flutter CLI’s example code, review how to work with Dart code, and learn the basics of Flutter app architecture and implementation.</p>
<p id="d24e1308">



To create a new Flutter app, create a directory to contain the app’s source code and, inside it, another directory called <span class="cf dir">lib</span>. The <span class="cf dir">lib</span> directory is where we’ll add our Dart files defining what our app looks like and what our app does.</p>
<p id="d24e1333">For now we won’t work in the CLI, but once we’re ready to build the app we will use <span class="cf ic">flutter create</span> to generate the files that are necessary for the app to build (which you’ll get to know and edit in the appendix about app configuration). In addition to the files and directories directly related to Flutter and your app, the root of your Flutter app must also contain an <span class="cf dir">android</span> and an <span class="cf dir">ios</span> directory containing the configuration for the build system for each platform.

</p>
<p id="d24e1353">
Inside the <span class="cf dir">lib</span> directory, create a file called <span class="cf filename">main.dart</span>.</p>
<p id="d24e1365">
Outside <span class="cf dir">lib</span>, create a file called <span class="cf filename">pubspec.yaml</span> and paste this in it:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp/pubspec.yaml">firstapp/pubspec.yaml</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">name: ​<em class="string">flutter_example_name</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">description: ​<em class="string">Example description of a flutter app that makes</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             ​<em class="string">great things happen.</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">dependencies:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  flutter:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    sdk: ​<em class="string">flutter</em>​</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">dev_dependencies:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  flutter_test:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    sdk: ​<em class="string">flutter</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">flutter:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  uses-material-design: true</td></tr></table>
<p id="d24e1442">The <span class="cf filename">pubspec.yaml</span> file contains information about your project and its dependencies, which Flutter will need to build your app. Actually this file is required for any Dart package, but it’ll take a while and a few chapters before we start looking at Dart packages that aren’t Flutter apps.</p>
<p id="d24e1447">Inside <span class="cf filename">main.dart</span>, write the following:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp_starting/lib/main.dart">firstapp_starting/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:flutter/material.dart'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">main</strong>​() =&gt; runApp(MyApp());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyApp ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">return</strong>​ MaterialApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     title: ​<em class="string">'Flutter Demo'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     theme: ThemeData(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       primarySwatch: Colors.blue,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     home: MyHomePage(title: ​<em class="string">'Flutter Demo Home Page'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyHomePage ​<strong class="kw">extends</strong>​ StatefulWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> MyHomePage({Key key, ​<strong class="kw">this</strong>​.title}) : ​<strong class="kw">super</strong>​(key: key);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ title;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> _MyHomePageState createState() =&gt; _MyHomePageState();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ _MyHomePageState ​<strong class="kw">extends</strong>​ State&lt;MyHomePage&gt; {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">int</strong>​ _counter = 0;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">void</strong>​ _incrementCounter() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     _counter++;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       title: Text(widget.title),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     body: Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         mainAxisAlignment: MainAxisAlignment.center,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             ​<em class="string">'You have pushed the button this many times:'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             ​<em class="string">'</em>​​<em class="string">$_counter</em>​​<em class="string">'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             style: Theme.of(context).textTheme.display1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     floatingActionButton: FloatingActionButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       onPressed: _incrementCounter,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       tooltip: ​<em class="string">'Increment'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       child: Icon(Icons.add),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e1669">You’ll get a simple view with a counter and a floating action button which, when clicked, increments a counter that is shown at the center of the view, like in this screenshot:</p><div class="ss"><img alt="images/FirstApp/def.png" class="border " id="d24e1671" src="/images/img8/images/FirstApp/def.png" style="width: 38%"/></div>
<p id="d24e1672">
If the app doesn’t work, try running:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">$ flutter create .</td></tr></table>
<p id="d24e1685">As mentioned in the Preface, <span class="cf commandname">flutter create</span> is the command used to create Flutter app projects, and executing it with a directory containing Flutter code will create the files and directories necessary for the app to compile for Android and iOS (and, as they become more stable, will also include the files needed for desktop development).</p>
<p id="d24e1690">
Keep in mind that you can fix most build problems not caused by errors in the code, especially after multiple builds, by running:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">$ flutter clean</td></tr></table>
<p id="d24e1702">which will delete build files left by previous builds.

</p><h3>Analyze the Example Code</h3>
<p id="d24e1710">Let’s break down this code so that you can understand this example.</p><h4>The pubspec.yaml File</h4>
<p id="d24e1715">
Before moving on to <span class="cf filename">main.dart</span>, which contains the main app code, we should take a brief look at the <span class="cf filename">pubspec.yaml</span> file, which we will discuss in greater detail in Chapter 4, <a href="/links/f_0046/f_0046.xhtml#chp.packages">​<em> Beyond the Standard Library: Plugins and Packages </em>​</a> and, in even greater detail, in Appendix 2, <a href="/links/f_0095/f_0095.xhtml#chp.pubspec">​<em> Apple-Like Look and Additional App Configuration </em>​</a>.</p>
<p id="d24e1731">It is important to understand that the <span class="cf filename">pubspec.yaml</span> file is not unique to Flutter apps: it is a feature of Dart packages and, as such, also contains all the information needed to make it a Flutter app.</p>
<p id="d24e1736">In the first part we’ll specify some metadata about the Flutter app. In this section, two attributes are set:
</p><ul><li>The <span class="cf ic">name</span>, which is the Dart package name and it is the default app name that appears on the home screen or the app drawer. The one drawback with <span class="cf ic">name</span> is that it must be all lowercase and be a valid Dart identifier: it can’t start with a digit, it can’t contain any character other than letters and underscores (no spaces allowed) and it can’t be a Dart keyword (like <span class="cf ic">class</span>, <span class="cf ic">if</span>, <span class="cf ic">try</span>, etc.). Thus, it is recommended to edit the app files in the <span class="cf dir">android</span> and <span class="cf dir">ios</span> directories, as explained in <a href="/links/f_0098/f_0098.xhtml#sec.appconfig.platspec">​<em>Platform-Specific Setup</em>​</a>, if you want an app name that doesn’t fit within those restrictions and if you want to change the launcher icon.</li></ul><ul><li>The <span class="cf ic">description</span>, which should be a brief, sentence or two explanation of the Flutter app.</li></ul>
<p id="d24e1778">
In order to avoid build issues and as general good practice, the name of the directory that contains the root of the project (the <span class="cf dir">lib</span> directory and the <span class="cf filename">pubspec.yaml</span> file) should be the same as the Dart package name.</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp/pubspec.yaml">firstapp/pubspec.yaml</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">name: ​<em class="string">flutter_example_name</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">description: ​<em class="string">Example description of a flutter app that makes</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             ​<em class="string">great things happen.</em>​</td></tr></table>
<p id="d24e1808">

The rest of the file specifies the dependencies.</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp/pubspec.yaml">firstapp/pubspec.yaml</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">dependencies:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  flutter:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    sdk: ​<em class="string">flutter</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">dev_dependencies:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  flutter_test:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    sdk: ​<em class="string">flutter</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">flutter:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  uses-material-design: true</td></tr></table>
<p id="d24e1865">
Since we are not using any third-party packages, we are just specifying the Flutter SDK itself as a dependency and, with the lines:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">flutter:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  uses-material-design: true</td></tr></table>
<p id="d24e1882">we make sure that Material Design (Google/Android style) assets like icons are included.
</p><h4>The App Widget</h4><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:flutter/material.dart'</em>​;</td></tr></table>
<p id="d24e1897">





This brings in the Flutter classes we need to use. In this chapter you’ll learn about the simplest ones and how to work with them (we’ll look at many others as we continue in Chapter 2, <a href="/links/f_0016/f_0016.xhtml#chp.layout">​<em> Laying Out More Widgets </em>​</a> as well).</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">main</strong>​() =&gt; runApp(​<strong class="kw">new</strong>​ MyApp());</td></tr></table>
<p id="d24e1941">
This line means that, when our code gets executed, we will start an app, and this app’s behavior and appearance is specified inside a class called <span class="cf class">MyApp</span>, which is defined as:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp_starting/lib/main.dart">firstapp_starting/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyApp ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">return</strong>​ MaterialApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     title: ​<em class="string">'Flutter Demo'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     theme: ThemeData(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       primarySwatch: Colors.blue,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     home: MyHomePage(title: ​<em class="string">'Flutter Demo Home Page'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e1995">Let’s break this down further.</p><h4>Defining Widgets in Flutter</h4><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyApp ​<strong class="kw">extends</strong>​ StatelessWidget</td></tr></table>
<p id="d24e2009">

In Flutter every UI element or collection of UI elements is a widget, which is an immutable object.
This means we can’t change a widget’s member variables: if there are any, they have to be declared as <span class="cf ic">final</span> or constant.
You can find more information on Dart variables in <a href="/links/f_0084/f_0084.xhtml#sec.dart.variables">​<em>Variables and Conditions</em>​</a>.</p>
<p id="d24e2021">There are two kinds of widgets:



</p><ul><li>
<p id="d24e2044">Stateless widgets (subclasses of <span class="cf class">StatelessWidget</span>), which get rendered when the app starts and when a parent widget gets re-rendered, like <span class="cf class">MyApp</span>.</p></li><li>
<p id="d24e2053">Stateful widgets (subclasses of <span class="cf class">StatefulWidget</span>), which you can re-render at any time by calling the <span class="cf ic">setState()</span> function, like this app’s <span class="cf class">MyHomePage</span>, which is covered in <a href="#sec.firstapp.stateful">​<em>The Home Page Widget</em>​</a>.</p></li></ul>
<p id="d24e2066">


The app widget is the collection of every other widget, so it is a widget.
In this case it is a <span class="cf class">StatelessWidget</span>.


</p><h4>Working with Stateless Widgets</h4><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp_starting/lib/main.dart">firstapp_starting/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ MaterialApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    title: ​<em class="string">'Flutter Demo'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    theme: ThemeData(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      primarySwatch: Colors.blue,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    home: MyHomePage(title: ​<em class="string">'Flutter Demo Home Page'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e2129">




This is the build method, which gets called when the widget needs to be rendered and returns a <span class="cf class">Widget</span> object, which is every widget’s superclass.</p>
<p id="d24e2156">In this case it gets called just once: when the app starts, given that <span class="cf class">MyApp</span> doesn’t have a parent widget (it is every other widget’s parent widget).</p>
<p id="d24e2161">
In MyApp’s build method it is specified that the <span class="cf class">MyApp</span> widget (the app itself) is a <span class="cf class">MaterialApp</span>, which means that our app will use Material Design features that are part of the standard library.</p>
<p id="d24e2173">






The code sets, using the <span class="cf class">MaterialApp</span> constructor, an app title, a theme with a primary swatch (a range of similar colors, as specified in Google’s Material Design guidelines), and a home page, which will be of class <span class="cf class">MyHomePage</span> and have the title “Flutter Demo Home Page”.

</p><h4 id="sec.firstapp.stateful">The Home Page Widget</h4>
<p id="d24e2222">
This defines the aforementioned <span class="cf ic">MyHomePage</span> class, which is a <span class="cf ic">StatefulWidget</span> (a widget that has a state, unlike <span class="cf class">MyApp</span>) with a title member and a state, which is <span class="cf class">_MyHomePageState</span>:
</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp_starting/lib/main.dart">firstapp_starting/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyHomePage ​<strong class="kw">extends</strong>​ StatefulWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> MyHomePage({Key key, ​<strong class="kw">this</strong>​.title}) : ​<strong class="kw">super</strong>​(key: key);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ title;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> _MyHomePageState createState() =&gt; _MyHomePageState();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e2279">In Dart, the underscore (<span class="cf ic">_</span>) in <span class="cf class">_MyHomePageState</span> has an effect akin to the one <span class="cf ic">private</span> has in languages like Java and is explained in <a href="/links/f_0084/f_0084.xhtml#sec.dart.underscore">​<em>The underscore</em>​</a>.</p><p><strong>The Advantage of Stateful Widgets</strong></p>
<p id="d24e2296">Stateful widgets  have the ability to be re-rendered programmatically, allowing the developer to build an app that reacts to changes in the data it is showing or representing.</p>
<p id="d24e2298">
Because of this, they are more complex than stateless widgets: a stateful widget has a state, which is represented by a <span class="cf class">State</span> object, which contains the widget’s logic and mutable data. As I mentioned in the previous section, widgets themselves are immutable, so they need a different object (the <span class="cf class">State</span>) to hold the mutable data.</p>
<p id="d24e2310">

They get re-rendered when you call the <span class="cf ic">setState()</span> function, which notifies the framework that the state of the widget has changed and it needs to be re-rendered (by calling its <span class="cf ic">build</span> method again) to show the changes to the user.</p><p><strong>The MyHomePage Widget</strong></p>
<p id="d24e2330">The line:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">MyHomePage({Key key, ​<strong class="kw">this</strong>​.title}) : ​<strong class="kw">super</strong>​(key: key);</td></tr></table>
<p id="d24e2345">defines <span class="cf class">MyHomePage</span>’s arguments (as explained in <a href="/links/f_0090/f_0090.xhtml#sec.dart.classes.constructors">​<em>Constructors</em>​</a>). Since they are wrapped in braces, they are named arguments, which is why, when calling <span class="cf class">MyHomePage</span>’s constructor, the syntax was:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">MyHomePage(title: ​<em class="string">'Flutter Demo Home Page'</em>​)</td></tr></table>
<p id="d24e2362">The unused key parameter is used by the framework to identify which widgets to re-render. You can provide it and it can be useful, but it’s optional, and we won’t need it for this app.</p>
<p id="d24e2364">We’ll talk about keys in the next chapter in <a href="/links/f_0027/f_0027.xhtml#sec.layout.key">​<em>The Key</em>​</a>.</p>
<p id="d24e2368">You can find more information on Dart class and constructor definitions in <a href="/links/f_0090/f_0090.xhtml#sec.dart.classes">​<em>Classes</em>​</a>.</p>
<p id="d24e2372">Inside <span class="cf class">_MyHomePageState</span> is where the app’s logic is defined:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp_starting/lib/main.dart">firstapp_starting/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ _MyHomePageState ​<strong class="kw">extends</strong>​ State&lt;MyHomePage&gt; {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">int</strong>​ _counter = 0;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">void</strong>​ _incrementCounter() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     _counter++;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       title: Text(widget.title),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     body: Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         mainAxisAlignment: MainAxisAlignment.center,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             ​<em class="string">'You have pushed the button this many times:'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             ​<em class="string">'</em>​​<em class="string">$_counter</em>​​<em class="string">'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             style: Theme.of(context).textTheme.display1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     floatingActionButton: FloatingActionButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       onPressed: _incrementCounter,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       tooltip: ​<em class="string">'Increment'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       child: Icon(Icons.add),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ _MyHomePageState ​<strong class="kw">extends</strong>​ State&lt;MyHomePage&gt;</td></tr></table>
<p id="d24e2509">
<span class="cf class">_MyHomePageState</span> is defined as the state of the widget <span class="cf class">MyHomePage</span>.</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp_starting/lib/main.dart">firstapp_starting/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">int</strong>​ _counter = 0;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">_incrementCounter</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    _counter++;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e2543">

This declares a counter and defines a function that increments the counter and triggers a re-render by changing the state of the widget (calling <span class="cf ic">setState()</span>).</p><p><strong>The Main build Method for the Home Page</strong></p>
<p id="d24e2558"/><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp_starting/lib/main.dart">firstapp_starting/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      title: Text(widget.title),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    body: Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        mainAxisAlignment: MainAxisAlignment.center,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">'You have pushed the button this many times:'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">'</em>​​<em class="string">$_counter</em>​​<em class="string">'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            style: Theme.of(context).textTheme.display1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    floatingActionButton: FloatingActionButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      onPressed: _incrementCounter,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      tooltip: ​<em class="string">'Increment'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Icon(Icons.add),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><p><strong>Use of a Widget to Provide the Basic App Structure: The Scaffold</strong></p>
<p id="d24e2663">

This time the widget we return is a <span class="cf class">Scaffold</span>, the basic Material Design visual layout structure; in other words, it is a generic container for all of our app content.</p>
<p id="d24e2677">
A <span class="cf class">Scaffold</span> has an <span class="cf class">AppBar</span>, which (using a <span class="cf class">Text</span> widget) displays the title which was set earlier in <span class="cf class">MyHomePage</span>’s constructor.</p><p><strong>Build the App’s Body</strong></p>
<p id="d24e2698">
The body of our <span class="cf class">Scaffold</span> is wrapped inside a <span class="cf class">Center</span> widget, which centers our content in the middle of the page.</p>
<p id="d24e2710">The <span class="cf class">Center</span>’s child (the content which it centers) is a <span class="cf class">Column</span>, which displays its children in a vertical stack.</p>
<p id="d24e2718">The first <span class="cf class">Text</span> widget simply displays a <span class="cf class">String</span>, whereas the second displays the counter with a built-in theme called <span class="cf ic">display1</span>.</p><p><strong>Add the Floating Action Button</strong></p>
<p id="d24e2732">
Not centered (but inside the <span class="cf class">Scaffold</span>, outside the body, in its own <span class="cf ic">floatingActionButton</span> attribute) is the <span class="cf class">FloatingActionButton</span> which, when pressed, calls the <span class="cf ic">_incrementCounter</span> function we saw previously.</p>
<p id="d24e2750">Quite easy to understand are the tooltip code and the <span class="cf class">Icon</span> widget (again, everything is a widget here) inside of it (its “child”) which is a simple plus (or “add”, as it is called) sign.</p>
<p id="d24e2755">


Every time we click the FAB the counter is incremented and the state changes, the <span class="cf ic">setState()</span> call triggers the <span class="cf ic">build</span> method again and the UI gets reloaded with the updated counter.</p><h3>What We’ve Seen and Where We’re Going</h3>
<p id="d24e2778">This is a very simple app: it’s just a <span class="cf ic">MaterialApp</span> that contains a <span class="cf ic">Scaffold</span>, with a simple FAB in the lower right and, in the middle, a Column with two <span class="cf ic">Text</span> widgets showing the number of times the FAB has been clicked.</p>
<p id="d24e2789">This is very simple, but the only way to really understand how something is done is by doing it, so the next section is going to focus on adding new features to the existing code.</p>,<h2 id="d24e12547">The Finished Layout</h2>
<p id="d24e12550">If you have done everything correctly, you probably have ended up with the following code in <span class="cf filename">main.dart</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator_part2/lib/main.dart">layout/calculator_part2/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">"package:flutter/material.dart"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ExpandedButton ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ExpandedButton({​<strong class="kw">this</strong>​.onPressed, ​<strong class="kw">this</strong>​.child, ​<strong class="kw">this</strong>​.color});</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ Widget child;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ VoidCallback onPressed;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ Color color;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      flex:1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        onPressed: onPressed,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: child,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        color: color,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ExpandedRow ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ExpandedRow({​<strong class="kw">this</strong>​.children, ​<strong class="kw">this</strong>​.crossAxisAlignment});</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ List&lt;Widget&gt; children;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ CrossAxisAlignment crossAxisAlignment;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      flex:1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        children: children,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        crossAxisAlignment: crossAxisAlignment,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">main</strong>​() =&gt; runApp(​<strong class="kw">new</strong>​ MyApp());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyApp ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ MaterialApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      title: ​<em class="string">"Flutter Calculator"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      theme: ThemeData(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        primarySwatch: Colors.blue,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        backgroundColor: Colors.black26</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      home: CalculatorHomePage(title: ​<em class="string">"Flutter Calculator"</em>​, ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ CalculatorHomePage ​<strong class="kw">extends</strong>​ StatefulWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  CalculatorHomePage({Key key, ​<strong class="kw">this</strong>​.title}) : ​<strong class="kw">super</strong>​(key: key);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ title;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  _CalculatorHomePageState createState() =&gt; _CalculatorHomePageState();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ _CalculatorHomePageState ​<strong class="kw">extends</strong>​ State&lt;CalculatorHomePage&gt; {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ _str = ​<em class="string">"0"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ add(​<strong class="kw">String</strong>​ a) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ deleteAll() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ deleteOne() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ getResult() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ Center(child: Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        title: Text(widget.title),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      body: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        crossAxisAlignment: CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       ​<em class="comment">// mainAxisAlignment: MainAxisAlignment.spaceAround,</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       ​<em class="comment">// mainAxisSize: MainAxisSize.max,</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            flex: 2,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            child: Card(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              color: Colors.lightGreen[50],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              child: Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                padding: EdgeInsets.all(15.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  _str,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  textScaleFactor: 2.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            flex: 1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            child: Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              crossAxisAlignment: CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  flex: 3,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  child: FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ​<em class="string">'C'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    onPressed: (){deleteAll();},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    color: Colors.black54,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  flex: 1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  child: FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ​<em class="string">'&lt;-'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      style: TextStyle(color: Colors.white)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    onPressed: (){deleteOne();},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    color: Colors.black87,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            flex: 4,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            child: Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              crossAxisAlignment: CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  flex: 3,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    crossAxisAlignment: CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ExpandedRow(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        crossAxisAlignment:  CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              ​<em class="string">'7'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            onPressed: () {add(​<em class="string">'7'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              ​<em class="string">'8'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            onPressed: () {add(​<em class="string">'8'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              ​<em class="string">'9'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            onPressed: () {add(​<em class="string">'9'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ExpandedRow(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        crossAxisAlignment:  CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        children:&lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              ​<em class="string">'4'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            onPressed: () {add(​<em class="string">'4'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              ​<em class="string">'5'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            onPressed: () {add(​<em class="string">'5'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              ​<em class="string">'6'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            onPressed: () {add(​<em class="string">'6'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ExpandedRow(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        crossAxisAlignment:  CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              ​<em class="string">'1'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            onPressed: () {add(​<em class="string">'1'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              ​<em class="string">'2'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            onPressed: () {add(​<em class="string">'2'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              ​<em class="string">'3'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              style: TextStyle(color: Colors.white)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            onPressed: () {add(​<em class="string">'3'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ExpandedRow(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        crossAxisAlignment:  CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              ​<em class="string">'0'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            onPressed: () {add(​<em class="string">'0'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              ​<em class="string">'.'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            onPressed: () {add(​<em class="string">'.'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ExpandedButton(child: Text(​<em class="string">'='</em>​,), onPressed: () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            getResult();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          },</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          color: Colors.blue[50]),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  flex: 1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    crossAxisAlignment: CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        child: Image.asset(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ​<em class="string">"icons/divide.png"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          width: 10.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          height: 10.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        onPressed: () {add(​<em class="string">'÷'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        color: Colors.blue[50],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        child: Text(​<em class="string">'x'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        onPressed: () {add(​<em class="string">'x'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        color: Colors.blue[50],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        child: Text(​<em class="string">'-'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        onPressed: () {add(​<em class="string">'-'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        color: Colors.blue[50],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        child: Text(​<em class="string">'+'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        onPressed: () {add(​<em class="string">'+'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        color: Colors.blue[50],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e13539">Running the app produces the following visual result:

</p><div class="ss"><img alt="images/WidgetLayout/calculatorempty.png" class="border " id="d24e13544" src="/images/img44/images/WidgetLayout/calculatorempty.png" style="width: 38%"/></div>,<h2 id="sec.calculator.calculation">Implement the Calculations</h2>
<p id="d24e13548">
Now it’s time to make this really nice-looking calculator work. The way our calculator logic is going to work is not how expressions are usually parsed, but this way will show you how to parse and manipulate strings in Dart, and it will also show you how to do that using regular expressions. It’s not the simplest solution and it’s surely not the one with the lowest computational complexity, but it’s a good example and it is supposed to make you more confident when writing Dart code that operates on strings.</p>
<p id="d24e13554">The <span class="cf class">Calculation</span> class needs to handle a few basic operations:</p><ol><li>
<p id="d24e13561">Add a digit or operator.</p></li><li>
<p id="d24e13564">Display the current string containing all of the digits and operators that have been added.</p></li><li>
<p id="d24e13567">Compute the result of the current expression.</p></li><li>
<p id="d24e13570">Delete a digit or operator.</p></li><li>
<p id="d24e13573">Delete the entire expression.</p></li></ol>
<p id="d24e13575">Being able to display the current string can also be used for debugging insertion and deletion as it displays the current state of the calculation.</p>
<p id="d24e13577">The <span class="cf class">Calculation</span> class needs to be able to take inputs one character at a time and to compute the result of an expression considering mathematical operator precedence rules.</p>
<p id="d24e13582">


To do that, we will implement the class in the following way: we will have a <span class="cf class">List</span> of <span class="cf class">String</span>s, each of which will be either an operator or a number to make parsing and computing results simpler.</p>
<p id="d24e13610">We will start implementing it by creating a file called <span class="cf filename">calculator.dart</span> inside the <span class="cf dir">lib</span> directory.</p>
<p id="d24e13618">At this point we can start defining our <span class="cf class">Calculation</span> and that data it needs inside <span class="cf filename">calculator.dart</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/calculator.dart">layout/calculator/lib/calculator.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ Calculation {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  List&lt;​<strong class="kw">String</strong>​&gt; a = [];</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e13642">The first behavior we’ll define is adding a character to the current calculation.</p>
<p id="d24e13644">We will implement a method called <span class="cf methodname">add</span>, which will take as an argument a <span class="cf class">String</span> to be added to the calculation, after checking whether we add a new element to the <span class="cf ic">List</span> or not.</p>
<p id="d24e13655">If the <span class="cf class">String</span> we want to add is a digit and the previous <span class="cf class">String</span> in the <span class="cf class">List</span> is a number (it doesn’t contain an operator), we will append it to the last <span class="cf class">String</span> in the <span class="cf class">List</span>, otherwise it will have to be added as a new element in the <span class="cf class">List</span>.</p>
<p id="d24e13676">Also, if the <span class="cf class">List</span> is still empty, we will have to create a new element, unless the character we’re trying to add is an operator, in which case we won’t do anything at all because the expression wouldn’t make sense with an operator as the first element.</p>
<p id="d24e13681">To check whether a <span class="cf class">String</span> contains operators we will use a regular expression to shorten the creation of complex conditions and avoid repeating them.


</p><h3>How to Use Regular Expressions in Dart</h3>
<p id="d24e13694">



Regular expressions in Dart are achieved using the <span class="cf class">RegExp</span> class.</p>
<p id="d24e13718">Its constructor is used in the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">RegExp regExp = RegExp(​<em class="string">"REGULAREXPRESSION"</em>​);</td></tr></table>
<p id="d24e13727">In our case, the regular expression to check if a string contains an operator is:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/calculator.dart">layout/calculator/lib/calculator.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">final</strong>​ RegExp regExp = RegExp(​<em class="string">"[+</em>​​<em class="string">\\</em>​​<em class="string">-x÷]"</em>​);</td></tr></table>
<p id="d24e13743">and we can check that a string (called <span class="cf ic">string</span>) matches that regular expression by using:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">bool</strong>​ matches = regExp.hasMatch(string)</td></tr></table>
<p id="d24e13758">In the case of the regular expression we saw earlier, it will be <span class="cf ic">true</span> if the string contains an operator character, and <span class="cf ic">false</span> if it doesn’t.</p><h3>Implement add()</h3>
<p id="d24e13769">

The first thing we will check is whether the <span class="cf class">List</span> is empty and only adding the character if it’s not an operator:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">add</strong>​(​<strong class="kw">String</strong>​ added) {</td></tr></table><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/calculator.dart">layout/calculator/lib/calculator.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">if</strong>​(a.isEmpty) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(!regExp.hasMatch(added)) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.add(added);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e13827">If it’s not empty, we need to check whether the previous element was an operator.</p>
<p id="d24e13829">In that case, we need to do the same thing we did for the first element—we can’t add another operator or a dot, but we can add a digit and it has to go into a separate <span class="cf class">List</span> element:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/calculator.dart">layout/calculator/lib/calculator.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">else</strong>​ ​<strong class="kw">if</strong>​(regExp.hasMatch(a.last)) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(!RegExp(​<em class="string">"[+</em>​​<em class="string">\\</em>​​<em class="string">-x÷.]"</em>​).hasMatch(added)) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.add(added);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e13874">If the previous conditions haven’t been met (and that means the previous element was a number) we can add anything, but we need to differentiate betweem operators and digits:</p><ul><li>An operator will have to go into its own separate <span class="cf class">List</span> element;</li><li>A digit will have to be appended to the current last <span class="cf class">List</span> element.</li></ul>
<p id="d24e13889">That can be implemented very simply:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/calculator.dart">layout/calculator/lib/calculator.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(regExp.hasMatch(added)) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(!RegExp(​<em class="string">"."</em>​).hasMatch(a.last)) a.last+=​<em class="string">".0"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.add(added);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  } ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.last+=added;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e13945">So the entire <span class="cf methodname">add</span> method, combining all of the possible conditions, is:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/calculator.dart">layout/calculator/lib/calculator.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">add</strong>​(​<strong class="kw">String</strong>​ added) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(a.isEmpty) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(!regExp.hasMatch(added)) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.add(added);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">else</strong>​ ​<strong class="kw">if</strong>​(regExp.hasMatch(a.last)) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(!RegExp(​<em class="string">"[+</em>​​<em class="string">\\</em>​​<em class="string">-x÷.]"</em>​).hasMatch(added)) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.add(added);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(regExp.hasMatch(added)) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">if</strong>​(!RegExp(​<em class="string">"."</em>​).hasMatch(a.last)) a.last+=​<em class="string">".0"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.add(added);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    } ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.last+=added;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3>Implement getString()</h3>
<p id="d24e14084">







This is going to be the simplest method—it’s just going to display the concatenation of the strings in the <span class="cf class">List</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/calculator.dart">layout/calculator/lib/calculator.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ ​<strong class="kw">getString</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ str = ​<em class="string">""</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  a.forEach((​<strong class="kw">String</strong>​ el) {str+=el;});</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ str;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3>Implement Deletion</h3>
<p id="d24e14148">

To delete everything we just need to reset the <span class="cf class">List</span> to its initial state:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/calculator.dart">layout/calculator/lib/calculator.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">deleteAll</strong>​() =&gt; a = [];</td></tr></table>
<p id="d24e14173">But deleting one character at a time is more complicated, as we’ll need to check multiple things:</p><ol><li>
<p id="d24e14177">Check if the <span class="cf class">List</span> is empty, in that case we’ll do nothing.</p></li><li>
<p id="d24e14183">Check if the last element of the <span class="cf ic">List</span> is longer than one character, in that case we’ll delete the last character of that string.</p></li><li>
<p id="d24e14189">If the last element is just one character, we’ll delete it completely.</p></li></ol>
<p id="d24e14191">Number 2 is a bit complicated: to delete the last character we actually need to assign to the last element a substring of itself with the last character deleted.</p>
<p id="d24e14193">
To create substrings, we are going to use the <span class="cf ic">String.substring()</span> method, which is used in the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ substr = string.substring(startIndex, length);</td></tr></table>
<p id="d24e14213">where <span class="cf ic">startIndex</span> is an integer representing the index at which the substring starts (relative to the string from which the substring is created) and <span class="cf ic">length</span> is the length of the substring.</p>
<p id="d24e14222">In this case, we need it to start from 0 and to have a length that is equal to the length of the original string with 1 subtracted to it.</p>
<p id="d24e14224">Combining all of that, the code for the <span class="cf ic">deleteOne</span> method is as follows:

</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/calculator.dart">layout/calculator/lib/calculator.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">deleteOne</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(a.length &gt; 0) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(a.last.length &gt; 1) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.last = a.last.substring(0, a.last.length-1);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    } ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.removeLast();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3>Implement Result Calculation</h3>
<p id="d24e14297">At this point, all that’s left to do is to calculate the result of the expression.</p>
<p id="d24e14299">Before calculating the result, we’ll need to consider the case in which a user accidentally ends the expression with an operator (starting it with an operator is prevented by <span class="cf ic">add()</span>).</p>
<p id="d24e14304">We also need to check whether the string ends with a <span class="cf ic">.</span>, and that will require us to check whether a dot is left, a condition for which would be the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">a.last.lastIndexOf(​<em class="string">"."</em>​) == a.last.length-1</td></tr></table>
<p id="d24e14328">If that condition is true, we need to take the substring with the last character removed.</p>
<p id="d24e14330">Since it might end with both an operator and a dot, we need to check twice separately:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/calculator.dart">layout/calculator/lib/calculator.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">if</strong>​( regExp.hasMatch(a.last) )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  a.removeLast();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">if</strong>​(a.last.lastIndexOf(​<em class="string">"."</em>​) == a.last.length-1)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  a.last = a.last.substring(0, a.length-1);</td></tr></table>
<p id="d24e14382">
Now we need to parse the calculation and compute its result.</p>
<p id="d24e14391">The divisions we did in the rest of the methods are really useful: we just need to check each element in the <span class="cf ic">String</span> and, if it is an operator, we’ll substitute the block composed by it and the adjacent elements with the result of the operation.</p>
<p id="d24e14396">We will be implementing this using simple counter-based for loops because we need total control over which elements we’re parsing.</p>
<p id="d24e14398">Because of that, after we compute the result of each sub-calculation, we will decrease the counter by 1 so that the next iteration of the for loop will actually be the operator after the newly calculated result, as the following illustration shows:</p><div class="ss"><img alt="images/WidgetLayout/calculation.png" class="" id="d24e14400" src="/images/img45/images/WidgetLayout/calculation.png" style="width: 38%"/></div>
<p id="d24e14401">As this example shows, the newly calculated number takes the place that was occupied by the number to the left of the
operator and the next operator takes the place of the operator we just considered.</p>
<p id="d24e14403">Since the counter is currently at the index of the operator, we will have to decrement the loop’s counter so that, when it is incremented
again in the next iteration, it is the same value it was in the previous iteration.</p>
<p id="d24e14405">Because of mathematical operator precedence rules, we will first check if the <span class="cf ic">List</span> contains multiplications or divisions:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/calculator.dart">layout/calculator/lib/calculator.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">for</strong>​(​<strong class="kw">int</strong>​ i = 0; i &lt; a.length; i++) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(a[i] == ​<em class="string">"x"</em>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a[i-1] = ​<em class="string">"</em>​​<em class="string">${double.parse(a[i-1]) * double.parse(a[i+1])}</em>​​<em class="string">"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    i--;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  } ​<strong class="kw">else</strong>​ ​<strong class="kw">if</strong>​(a[i] == ​<em class="string">"÷"</em>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a[i-1] = ​<em class="string">"</em>​​<em class="string">${double.parse(a[i-1]) / double.parse(a[i+1])}</em>​​<em class="string">"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    i--;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e14488">and then check for additions or subtractions:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/calculator.dart">layout/calculator/lib/calculator.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">for</strong>​(​<strong class="kw">int</strong>​ i = 0; i &lt; a.length; i++) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(a[i] == ​<em class="string">"+"</em>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a[i-1] = ​<em class="string">"</em>​​<em class="string">${double.parse(a[i-1]) + double.parse(a[i+1])}</em>​​<em class="string">"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    i--;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  } ​<strong class="kw">else</strong>​ ​<strong class="kw">if</strong>​(a[i] == ​<em class="string">"-"</em>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a[i-1] = ​<em class="string">"</em>​​<em class="string">${double.parse(a[i-1]) - double.parse(a[i+1])}</em>​​<em class="string">"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    i--;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e14569">At the end, the <span class="cf ic">List</span> should contain just one <span class="cf ic">String</span> containing the result of the whole expression.</p>
<p id="d24e14577">We’ll return that using:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/calculator.dart">layout/calculator/lib/calculator.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">return</strong>​ ​<strong class="kw">double</strong>​.parse(a[0]);</td></tr></table>
<p id="d24e14591">The <span class="cf ic">getResult</span> method, combining all of these pieces, is:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/calculator.dart">layout/calculator/lib/calculator.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">double</strong>​ ​<strong class="kw">getResult</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​( regExp.hasMatch(a.last) )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.removeLast();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(a.last.lastIndexOf(​<em class="string">"."</em>​) == a.last.length-1)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.last = a.last.substring(0, a.length-1);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">for</strong>​(​<strong class="kw">int</strong>​ i = 0; i &lt; a.length; i++) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(a[i] == ​<em class="string">"x"</em>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a[i-1] = ​<em class="string">"</em>​​<em class="string">${double.parse(a[i-1]) * double.parse(a[i+1])}</em>​​<em class="string">"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      i--;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    } ​<strong class="kw">else</strong>​ ​<strong class="kw">if</strong>​(a[i] == ​<em class="string">"÷"</em>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a[i-1] = ​<em class="string">"</em>​​<em class="string">${double.parse(a[i-1]) / double.parse(a[i+1])}</em>​​<em class="string">"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      i--;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">for</strong>​(​<strong class="kw">int</strong>​ i = 0; i &lt; a.length; i++) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(a[i] == ​<em class="string">"+"</em>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a[i-1] = ​<em class="string">"</em>​​<em class="string">${double.parse(a[i-1]) + double.parse(a[i+1])}</em>​​<em class="string">"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      i--;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    } ​<strong class="kw">else</strong>​ ​<strong class="kw">if</strong>​(a[i] == ​<em class="string">"-"</em>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a[i-1] = ​<em class="string">"</em>​​<em class="string">${double.parse(a[i-1]) - double.parse(a[i+1])}</em>​​<em class="string">"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      i--;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(a.length != 1) ​<strong class="kw">throw</strong>​ Error();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ ​<strong class="kw">double</strong>​.parse(a[0]);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3 id="sec.calculator.calculation.wrappingup">Wrapping Up the Calculation</h3>
<p id="d24e14842">The entire <span class="cf filename">calculator.dart</span> should be, at this point, the following:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/calculator.dart">layout/calculator/lib/calculator.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ Calculation {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  List&lt;​<strong class="kw">String</strong>​&gt; a = [];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ RegExp regExp = RegExp(​<em class="string">"[+</em>​​<em class="string">\\</em>​​<em class="string">-x÷]"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ add(​<strong class="kw">String</strong>​ added) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(a.isEmpty) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">if</strong>​(!regExp.hasMatch(added)) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        a.add(added);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">else</strong>​ ​<strong class="kw">if</strong>​(regExp.hasMatch(a.last)) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">if</strong>​(!RegExp(​<em class="string">"[+</em>​​<em class="string">\\</em>​​<em class="string">-x÷.]"</em>​).hasMatch(added)) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        a.add(added);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">if</strong>​(regExp.hasMatch(added)) {</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">if</strong>​(!RegExp(​<em class="string">"."</em>​).hasMatch(a.last)) a.last+=​<em class="string">".0"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.add(added);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    } ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.last+=added;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ ​<strong class="kw">getString</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ str = ​<em class="string">""</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  a.forEach((​<strong class="kw">String</strong>​ el) {str+=el;});</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ str;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">double</strong>​ ​<strong class="kw">getResult</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​( regExp.hasMatch(a.last) )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.removeLast();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(a.last.lastIndexOf(​<em class="string">"."</em>​) == a.last.length-1)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    a.last = a.last.substring(0, a.length-1);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">for</strong>​(​<strong class="kw">int</strong>​ i = 0; i &lt; a.length; i++) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(a[i] == ​<em class="string">"x"</em>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a[i-1] = ​<em class="string">"</em>​​<em class="string">${double.parse(a[i-1]) * double.parse(a[i+1])}</em>​​<em class="string">"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      i--;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    } ​<strong class="kw">else</strong>​ ​<strong class="kw">if</strong>​(a[i] == ​<em class="string">"÷"</em>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a[i-1] = ​<em class="string">"</em>​​<em class="string">${double.parse(a[i-1]) / double.parse(a[i+1])}</em>​​<em class="string">"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      i--;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">for</strong>​(​<strong class="kw">int</strong>​ i = 0; i &lt; a.length; i++) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(a[i] == ​<em class="string">"+"</em>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a[i-1] = ​<em class="string">"</em>​​<em class="string">${double.parse(a[i-1]) + double.parse(a[i+1])}</em>​​<em class="string">"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      i--;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    } ​<strong class="kw">else</strong>​ ​<strong class="kw">if</strong>​(a[i] == ​<em class="string">"-"</em>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a[i-1] = ​<em class="string">"</em>​​<em class="string">${double.parse(a[i-1]) - double.parse(a[i+1])}</em>​​<em class="string">"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      a.removeAt(i);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      i--;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(a.length != 1) ​<strong class="kw">throw</strong>​ Error();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ ​<strong class="kw">double</strong>​.parse(a[0]);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ ​<strong class="kw">deleteOne</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(a.length &gt; 0) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">if</strong>​(a.last.length &gt; 1) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        a.last = a.last.substring(0, a.last.length-1);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      } ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        a.removeLast();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ deleteAll() =&gt; a = [];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e15347"> </p><div class="sidebar"><div class="sidebar-title">Make Your Own Changes</div><div class="sidebar-content">
<p id="d24e15353">
    We have seen quite a lot of Dart code so far, but have you also been writing your own? If you haven’t, here is a chance for you to make a very simple and slight improvement to our calculator app.
  </p>
<p id="d24e15355">
    The <span class="cf class">Calculation</span> properly handles operator precedence, but it doesn’t support parentheses. That’s something you should be able to add on your own at this point by using additional regular expressions to find opening and closing parentheses and then evaluate expressions within the parentheses first.
  </p></div></div>
<p id="d24e15360"> </p>,<h2 id="d24e15548">Wrapping Up the Calculator</h2>
<p id="d24e15551">If you followed everything and correctly put together all of the pieces of code related to the calculator, <span class="cf filename">main.dart</span> should be the following:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/lib/main.dart">layout/calculator/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">"package:flutter/material.dart"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">"calculator.dart"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ExpandedButton ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ExpandedButton({​<strong class="kw">this</strong>​.onPressed, ​<strong class="kw">this</strong>​.child, ​<strong class="kw">this</strong>​.color, Key key}) :</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">super</strong>​(key: key);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ Widget child;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ VoidCallback onPressed;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ Color color;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      flex:1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        onPressed: onPressed,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: child,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        color: color,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ExpandedRow ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ExpandedRow({​<strong class="kw">this</strong>​.children, ​<strong class="kw">this</strong>​.crossAxisAlignment});</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ List&lt;Widget&gt; children;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ CrossAxisAlignment crossAxisAlignment;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      flex: 1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        children: children,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        crossAxisAlignment: crossAxisAlignment,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">main</strong>​() =&gt; runApp(MyApp());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyApp ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ MaterialApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      title: ​<em class="string">"Flutter Calculator"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      theme: ThemeData(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        primarySwatch: Colors.blue,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        backgroundColor: Colors.black26</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      home: CalculatorHomePage(title: ​<em class="string">"Flutter Calculator"</em>​, ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ CalculatorHomePage ​<strong class="kw">extends</strong>​ StatefulWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  CalculatorHomePage({Key key, ​<strong class="kw">this</strong>​.title}) : ​<strong class="kw">super</strong>​(key: key);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ title;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  _CalculatorHomePageState createState() =&gt; _CalculatorHomePageState();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ _CalculatorHomePageState ​<strong class="kw">extends</strong>​ State&lt;CalculatorHomePage&gt; {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ _str = ​<em class="string">"0"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ _calculation = Calculation();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ add(​<strong class="kw">String</strong>​ a) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    setState((){</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      _calculation.add(a);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      _str = _calculation.getString();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ deleteAll() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      _calculation.deleteAll();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      _str = _calculation.getString();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ deleteOne() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      _calculation.deleteOne();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      _str = _calculation.getString();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ getResult() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      _str = _calculation.getResult().toString();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    _calculation = ​<strong class="kw">new</strong>​ Calculation();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ Center(child: Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        title: Text(widget.title),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      body: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        crossAxisAlignment: CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       ​<em class="comment">// mainAxisAlignment: MainAxisAlignment.spaceAround,</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       ​<em class="comment">// mainAxisSize: MainAxisSize.max,</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            flex: 2,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            child: Card(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              color: Colors.lightGreen[50],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              child: Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                padding: EdgeInsets.all(15.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  _str,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  textScaleFactor: 2.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            flex: 1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            child: Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              crossAxisAlignment: CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  flex: 3,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  child: FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ​<em class="string">'C'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    onPressed: (){deleteAll();},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    color: Colors.black54,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  flex: 1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  child: FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ​<em class="string">'&lt;-'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      style: TextStyle(color: Colors.white)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    onPressed: (){deleteOne();},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    color: Colors.black87,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            flex: 4,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            child: Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              crossAxisAlignment: CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  flex: 3,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    crossAxisAlignment: CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ExpandedRow(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        crossAxisAlignment:  CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              ​<em class="string">'7'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            onPressed: () {add(​<em class="string">'7'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              ​<em class="string">'8'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            onPressed: () {add(​<em class="string">'8'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              ​<em class="string">'9'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            onPressed: () {add(​<em class="string">'9'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ExpandedRow(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        crossAxisAlignment:  CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        children:&lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              ​<em class="string">'4'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            onPressed: () {add(​<em class="string">'4'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              ​<em class="string">'5'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            onPressed: () {add(​<em class="string">'5'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              ​<em class="string">'6'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                              style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            onPressed: () {add(​<em class="string">'6'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                            color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ExpandedRow(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        crossAxisAlignment:  CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        children: &lt;Widget&gt;[</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<em class="string">'1'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      onPressed: () {add(​<em class="string">'1'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<em class="string">'2'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      onPressed: () {add(​<em class="string">'2'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<em class="string">'3'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        style: TextStyle(color: Colors.white)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      onPressed: () {add(​<em class="string">'3'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ExpandedRow(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  crossAxisAlignment:  CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<em class="string">'0'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      onPressed: () {add(​<em class="string">'0'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<em class="string">'.'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      onPressed: () {add(​<em class="string">'.'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ExpandedButton(child: Text(​<em class="string">'='</em>​,), onPressed: () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      getResult();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    },</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          color: Colors.blue[50]),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  flex: 1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    crossAxisAlignment: CrossAxisAlignment.stretch,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        child: Image.asset(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          ​<em class="string">"icons/divide.png"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          width: 10.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          height: 10.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        onPressed: () {add(​<em class="string">'÷'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        color: Colors.blue[50],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        key: Key(​<em class="string">"divide button"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        child: Text(​<em class="string">'x'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        onPressed: () {add(​<em class="string">'x'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        color: Colors.blue[50],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        child: Text(​<em class="string">'-'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        onPressed: () {add(​<em class="string">'-'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        color: Colors.blue[50],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ExpandedButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        child: Text(​<em class="string">'+'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        onPressed: () {add(​<em class="string">'+'</em>​);},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        color: Colors.blue[50],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e16623">and produce this working calculator as shown in the <a href="#fig.calculator.result">screenshots</a>.</p><table class="simpletable " id="fig.calculator.result"><tbody><tr class="tr "><td style="width: 50%; ">
      <img alt="images/WidgetLayout/calculator.png" class="border " id="d24e16636" src="/images/img46/images/WidgetLayout/calculator.png" style="width: 70%"/>
    </td><td style="width: 50%; ">
      <img alt="images/WidgetLayout/calculatorresult.png" class="border " id="d24e16640" src="/images/img47/images/WidgetLayout/calculatorresult.png" style="width: 70%"/>
    </td></tr></tbody></table>,<h2 id="d24e17374">Package Usage Example</h2>
<p id="d24e17377">

Now that you know how to install packages, you’ll get to see packages in action.</p><h3>Getting Started</h3>
<p id="d24e17391">

We are going to build a simple app that displays the phone’s battery and connectivity state using the <span class="emph">battery</span><sup><a class="footnote" href="/links/f_0052/f_0052.xhtml#FOOTNOTE-28" id="FNPTR-28">[28]</a></sup> and <span class="emph">connectivity</span><sup><a class="footnote" href="/links/f_0052/f_0052.xhtml#FOOTNOTE-29" id="FNPTR-29">[29]</a></sup> packages from Pub:</p><div class="ss"><img alt="images/Packages/app.png" class="" id="d24e17412" src="/images/img48/images/Packages/app.png" style="width: 30%"/></div>
<p id="d24e17413">
To use those packages, we’ll start by adding the packages to our app’s dependencies, and you can do that by adding the following to the dependencies in <span class="cf filename">pubspec.yaml</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/battery_connectivity/pubspec.yaml">packages/battery_connectivity/pubspec.yaml</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">connectivity: ​<em class="string">^0.3.1</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">battery: ​<em class="string">^0.2.2</em>​</td></tr></table>
<p id="d24e17436">

And import the packages in our code by adding to the top of the main Dart file the following:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/battery_connectivity/lib/main.dart">packages/battery_connectivity/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'dart:async'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:flutter/material.dart'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:battery/battery.dart'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:connectivity/connectivity.dart'</em>​;</td></tr></table>
<p id="d24e17478">



In addition to the packages we download from Pub, we also need Flutter’s standard Material Design API and Dart’s <span class="cf ic">async</span> library, which is needed to  properly handle the asynchronous nature of the packages we are using.</p><h3>The Main Function and Home Page Definition</h3>
<p id="d24e17509">The main function looks like any other main function that has been shown throughout this book:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/battery_connectivity/lib/main.dart">packages/battery_connectivity/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">main</strong>​() =&gt; runApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  MaterialApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    title: ​<em class="string">"Battery and connectivity status"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    theme: ThemeData(primarySwatch: Colors.green),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    home: HomePage(​<em class="string">"Dashboard"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">);</td></tr></table>
<p id="d24e17541">The home page will be a <span class="emph">Stateful</span> widget, since we want it to change when the battery or connectivity state changes:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/battery_connectivity/lib/main.dart">packages/battery_connectivity/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ HomePage ​<strong class="kw">extends</strong>​ StatefulWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  HomePage(​<strong class="kw">this</strong>​.title);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ title;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  HomePageState createState() =&gt; HomePageState();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3>Defining the Home Page’s State</h3>
<p id="d24e17580">Each battery and connectivity state is going to be shown in the form of a string (like <span class="cf ic">Mobile Data</span> or <span class="cf ic">Full</span>) and an icon, with each status being represented by a different color:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/battery_connectivity/lib/main.dart">packages/battery_connectivity/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ HomePageState ​<strong class="kw">extends</strong>​ State&lt;HomePage&gt; {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ _connectionStatus = ​<em class="string">'Unknown'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  IconData _connectionIcon;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ _batteryStatus = ​<em class="string">'Unknown'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  IconData _batteryIcon;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Color _connectionColor = Colors.deepOrange;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Color _batteryColor = Colors.deepOrange;</td></tr></table><h4 id="sec.packages.streams">Getting the Battery and Connectivity Data: Asynchronous Programming Using Streams</h4>
<p id="d24e17630">

Since the data we are going to be showing could change at any time, the packages allow the data to be used in the form of <span class="firstuseinline">Stream</span>s, which allow your code to listen for changes in the data and define the actions that need to be taken using the new data when it changes.</p>
<p id="d24e17642">In this case, we want to change the state of the widget by changing the strings and icons describing the connectivity and battery state.</p>
<p id="d24e17644">
We can do that using the following code:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/battery_connectivity/lib/main.dart">packages/battery_connectivity/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">①</span>​</span></td><td class="codeline">StreamSubscription&lt;ConnectivityResult&gt; _connSub; </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">StreamSubscription&lt;BatteryState&gt; _battSub;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">initState</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">super</strong>​.initState();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">②</span>​</span></td><td class="codeline">  _connSub = Connectivity()                    </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            .onConnectivityChanged</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            .listen(( ConnectivityResult res) async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">③</span>​</span></td><td class="codeline">      ​<strong class="kw">switch</strong>​(res) {                            </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">case</strong>​ ConnectivityResult.mobile:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          _connectionStatus = ​<em class="string">'Mobile Data'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          _connectionIcon = Icons.sim_card;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          _connectionColor = Colors.red;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<strong class="kw">break</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">case</strong>​ ConnectivityResult.wifi:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          _connectionStatus = ​<em class="string">'Wi-Fi'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          _connectionIcon = Icons.wifi;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          _connectionColor = Colors.blue;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<strong class="kw">break</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">case</strong>​ ConnectivityResult.none:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          _connectionStatus = ​<em class="string">"No Connection"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          _connectionIcon = Icons.not_interested;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          _connectionColor = Colors.black;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">④</span>​</span></td><td class="codeline">  _battSub = Battery()                            </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            .onBatteryStateChanged</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            .listen((BatteryState res) async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">switch</strong>​(res) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<strong class="kw">case</strong>​ BatteryState.charging:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            _batteryStatus = ​<em class="string">'Charging'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            _batteryIcon = Icons.battery_charging_full;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            _batteryColor = Colors.blueAccent;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<strong class="kw">break</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<strong class="kw">case</strong>​ BatteryState.full:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            _batteryStatus = ​<em class="string">'Full'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            _batteryIcon = Icons.battery_full;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            _batteryColor = Colors.green;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<strong class="kw">break</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<strong class="kw">case</strong>​ BatteryState.discharging:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            _batteryStatus = ​<em class="string">'In Use'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            _batteryIcon = Icons.battery_alert;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            _batteryColor = Colors.redAccent;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><dl class="calloutlist"><dt>​<span class="callout-number" style="font-family:Quivira;">①</span>​</dt><dd>
<p id="d24e17892">
			These two lines are used to define the <span class="cf class">StreamSubscriptions</span> we’ll be using in our app.
			<span class="firstuseinline">subscriptions</span> are used to run some code when the data returned by a Stream changes.
		</p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">②</span>​</dt><dd>
<p id="d24e17901">
			We are calling the <span class="cf class">Connectivity</span> constructor to get an object and listen on its member <span class="cf variable">onConnectivityChanged</span> <span class="cf class">Stream</span>, which, like all <span class="cf class">Stream</span>s, has a <span class="cf variable">listen</span> member function, which takes as a positional argument the callback function to be called when the connectivity changes, which will usually be a call to <span class="cf methodname">setState</span>, since in most apps a change in a <span class="cf class">Stream</span> means that the app’s UI needs to be updated.
		</p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">③</span>​</dt><dd>
<p id="d24e17926">
			In case you’re not familiar with it, the usage of a switch statement is explained in <a href="/links/f_0088/f_0088.xhtml#sec.dart.switch">​<em>Switch</em>​</a>.
			In this instance, we’re using it to set different strings, icons, and colors for each connection and battery status.
		</p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">④</span>​</dt><dd>
<p id="d24e17931">
			This is the same as what we’ve seen for the connectivity status, but for the battery status.
		</p></dd></dl>
<p id="d24e17933">Since this code is doing a lot of different things, we’ll break this down and explain each part.</p><p><strong>Disposing of the StreamSubscriptions</strong></p>
<p id="d24e17938">For each subscription there needs to be an entry to the <span class="cf methodname">dispose</span> method to dispose of the subscription when it’s not needed anymore.
<span class="cf class">StreamSubscription</span>s have a <span class="cf methodname">cancel</span> method, which does exactly that.
Since <span class="cf class">State</span> classes need to override their superclass’ <span class="cf methodname">dispose</span> method (which is the method that runs when that <span class="cf class">State</span> isn’t needed anymore, which is when the <span class="cf class">StatefulWidget</span> isn’t being rendered anymore), they need to call <span class="cf methodname">super.dispose</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/battery_connectivity/lib/main.dart">packages/battery_connectivity/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">dispose() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">super</strong>​.dispose();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  _connSub.cancel();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  _battSub.cancel();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e17991">You can find out more about <span class="cf class">Stream</span>s in <a href="/links/f_0087/f_0087.xhtml#sec.dart.streams">​<em>Streams and StreamSubscriptions</em>​</a>.


</p><h3>Defining the App’s UI</h3>
<p id="d24e18006">The <span class="cf methodname">build</span> method will be the following:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/battery_connectivity/lib/main.dart">packages/battery_connectivity/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    backgroundColor: Theme.of(context).backgroundColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      title: Text(widget.title),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    body: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      mainAxisAlignment: MainAxisAlignment.spaceAround,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Icon(_connectionIcon, color: _connectionColor, size: 50.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ​<em class="string">"Connection:</em>​​<em class="string">\n</em>​​<em class="string">$_connectionStatus</em>​​<em class="string">"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              style: TextStyle(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                color: _connectionColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                fontSize: 40.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Icon(_batteryIcon, color: _batteryColor, size: 50.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ​<em class="string">"Battery:</em>​​<em class="string">\n</em>​​<em class="string">$_batteryStatus</em>​​<em class="string">"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              style: TextStyle(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                color: _batteryColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                fontSize: 40.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e18128">The app’s body is a <span class="cf class">Column</span>, with the <span class="cf ic">mainAxisAlignment</span> set to <span class="cf ic">MainAxisAlignment.spaceAround</span> so the widgets occcupy the entire body, instead of being stacked closely on top:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/battery_connectivity/lib/main.dart">packages/battery_connectivity/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">body: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  mainAxisAlignment: MainAxisAlignment.spaceAround,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Icon(_connectionIcon, color: _connectionColor, size: 50.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"Connection:</em>​​<em class="string">\n</em>​​<em class="string">$_connectionStatus</em>​​<em class="string">"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          style: TextStyle(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            color: _connectionColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            fontSize: 40.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Icon(_batteryIcon, color: _batteryColor, size: 50.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"Battery:</em>​​<em class="string">\n</em>​​<em class="string">$_batteryStatus</em>​​<em class="string">"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          style: TextStyle(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            color: _batteryColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            fontSize: 40.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e18225">The <span class="cf class">Column</span> contains two <span class="cf class">Row</span>s, one showing the connection state, and one showing the battery state.</p><h4>Showing the States</h4>
<p id="d24e18236">The connection state will be shown using a <span class="cf class">Row</span> to show both the string and the icon of the color we set when the state changes:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/battery_connectivity/lib/main.dart">packages/battery_connectivity/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Icon(_connectionIcon, color: _connectionColor, size: 50.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="string">"Connection:</em>​​<em class="string">\n</em>​​<em class="string">$_connectionStatus</em>​​<em class="string">"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      style: TextStyle(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        color: _connectionColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        fontSize: 40.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/battery_connectivity/lib/main.dart">packages/battery_connectivity/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Icon(_batteryIcon, color: _batteryColor, size: 50.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="string">"Battery:</em>​​<em class="string">\n</em>​​<em class="string">$_batteryStatus</em>​​<em class="string">"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      style: TextStyle(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        color: _batteryColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        fontSize: 40.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e18313">The result is that each status is represented by a different Icon and string of a different color for each battery status:</p><div class="ss"><img alt="images/Packages/charging.png" class="" id="d24e18315" src="/images/img49/images/Packages/charging.png" style="width: 30%"/></div><div class="ss"><img alt="images/Packages/full.png" class="" id="d24e18316" src="/images/img50/images/Packages/full.png" style="width: 30%"/></div><div class="ss"><img alt="images/Packages/inuse.png" class="" id="d24e18317" src="/images/img51/images/Packages/inuse.png" style="width: 30%"/></div>
<p id="d24e18318">and for each connectivity status:</p><div class="ss"><img alt="images/Packages/mobiledata.png" class="" id="d24e18321" src="/images/img52/images/Packages/mobiledata.png" style="width: 30%"/></div><div class="ss"><img alt="images/Packages/noconnection.png" class="" id="d24e18322" src="/images/img53/images/Packages/noconnection.png" style="width: 30%"/></div><div class="ss"><img alt="images/Packages/wifi.png" class="" id="d24e18323" src="/images/img54/images/Packages/wifi.png" style="width: 30%"/></div>,<h2 id="d24e18324">Making Your Own Packages</h2>
<p id="d24e18327">



Now that you know how to use a package, you might want to know how to make your own package and how you can write platform-specific code to be used inside a Flutter app.</p><h3>Creating the Package</h3>
<p id="d24e18339">
Making a package is a lot like making an app.</p>
<p id="d24e18345">If you’re using Android Studio, you just need to use File -&gt; New -&gt; New Flutter Project.</p>
<p id="d24e18347">If you only need to use multi-platform Dart code for your package, choose the Flutter Package option, if you also need to add iOS(Objective-C/Swift) or Android(Java/Kotlin) code, choose Flutter Plugin.</p>
<p id="d24e18349">Interaction between Dart code and platform-specific code is described in <a href="#sec.packages.makingplugins">​<em>Integrating Native Code: Making Plugin Packages</em>​</a>.</p>
<p id="d24e18353">
If you’re using the command line, run this command:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">flutter create --template=package packagename</td></tr></table>
<p id="d24e18363">If you want to create a plugin, replace the word <span class="emph">package</span> with <span class="emph">plugin</span>.</p><h3>Package Development</h3>
<p id="d24e18374">Creating a normal Dart-only package is as simple as editing and creating Dart files in the <span class="cf dir">lib</span> folder, defining the functions and classes that you want your package to provide, and then publishing it, as explained in <a href="/links/f_0050/f_0050.xhtml#sec.packages.publishing">​<em>Publishing a Package to Pub</em>​</a>.
</p><h3 id="sec.packages.makingplugins">Integrating Native Code: Making Plugin Packages</h3>
<p id="d24e18385">

The situation becomes more complicated when you want your package to communicate with platform-specific code, since you’ll need to join together three different codebases written in three different languages.</p>
<p id="d24e18396">Many native Android/iOS features are available using packages from Pub, but you might need to use a feature that isn’t available in Flutter and that isn’t supplied by any package, so you’ll need to write your own platform-specific code to access that feature.</p>
<p id="d24e18398">Although this chapter is about packages, the information in <a href="#sec.packages.platformchannels">​<em>Connecting Flutter and Platform-Specific Code Together Using Platform Channels</em>​</a> is also useful if you just want to connect Android and iOS code to just one app, without creating a package.</p><h4>Creating a Plugin Package</h4>
<p id="d24e18405">
You can create a plugin package using the following command:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">flutter create --template=plugin packagename</td></tr></table>
<p id="d24e18415">This will let you use use Java for Android-specific code and Objective-C for iOS code but, especially in the iOS world, those languages are losing ground to Kotlin (for Android) and Swift (for iOS).
Flutter actually also provides a template for those languages too, and if you want to use both Swift and Kotlin, you need to run this command instead:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">flutter create --template=plugin -a kotlin -i swift packagename</td></tr></table>
<p id="d24e18421">As we’ve just seen, you can use <span class="cf commandname">flutter</span>’s <span class="cf commandoption">-a</span> option to specify the language to use for Android code and <span class="cf commandoption">-i</span> to specify the language for iOS code.
</p><h4 id="sec.packages.platformchannels">Connecting Flutter and Platform-Specific Code Together Using Platform Channels</h4>
<p id="d24e18436">

We’ll write the interface for our package in Dart, but we’ll need to connect it to the platform-specific code, and you can do that using platform channels.</p>
<p id="d24e18445">Platform channels aren’t exclusive to packages: we can also use them with apps.</p>
<p id="d24e18448">The Flutter code calls methods for the platform-specific code to execute through a platform channel, the platform-specific code listens on the channel, receives the method call, performs the actions it needs to perform, and returns a response.</p><p><strong>How Platform Channels Work</strong></p>
<p id="d24e18453">
To connect to our platform-specific code we’ll use the <span class="cf class">MethodChannel</span> class, which is Flutter’s side of the interface between Flutter and platform-specific code.</p>
<p id="d24e18462">We pass the channel name to its constructor, which is a unique <span class="cf class">String</span> identifier for the channel in the entire app.</p>
<p id="d24e18467">Since it has to be unique for the entire app, the channel name is usually prefixed by a domain name.</p>
<p id="d24e18469">The channel works the following way: the Dart code invokes methods on the channel, the platform-specific code listens on the channel, waiting for a method call, which is dealt with by a method call handler, which sends the result back to the Dart code.</p>
<p id="d24e18471">
The response is received by the Dart code in the form of a <span class="cf class">Future</span>.</p><p><strong>Implementing the Flutter Interface in Dart</strong></p>
<p id="d24e18483">
An example of a basic Flutter interface that can interact with platform-specific code is the following:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/making_plugins/lib/plugin_example.dart">packages/making_plugins/lib/plugin_example.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'dart:async'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:flutter/services.dart'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ PluginExample {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">static</strong>​ ​<strong class="kw">const</strong>​ _platformChannel =</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      MethodChannel(​<em class="string">'example.com/plugin_example'</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">static</strong>​ Future&lt;type&gt; exampleMethod async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ await _platformChannel.invokeMethod(​<em class="string">'runExampleMethod'</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e18543">



We can access platform channels using the <span class="emph">services</span> library, and we also need to use the async library to handle the <span class="cf class">Future</span>, so the following lines need to be placed at the top of your Dart file:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/making_plugins/lib/plugin_example.dart">packages/making_plugins/lib/plugin_example.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'dart:async'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:flutter/services.dart'</em>​;</td></tr></table>
<p id="d24e18590">Then we define the class that will contain our code and we start by defining the channel we’re going use, which will be <span class="cf ic">example.com/plugin_example</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/making_plugins/lib/plugin_example.dart">packages/making_plugins/lib/plugin_example.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">static</strong>​ ​<strong class="kw">const</strong>​ _platformChannel =</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    MethodChannel(​<em class="string">'example.com/plugin_example'</em>​);</td></tr></table>
<p id="d24e18609">This string could be anything: you can prefix it with a real domain, a fake domain, or by no domain at all, but you should prefix it with a real domain if possible to make sure this doesn’t clash with any other plugin’s channel name. In this regard, it is very similar to Java package names, except the domain prefix is optional in this case.</p>
<p id="d24e18612">After you’ve chosen the channel name, implement the actual interface for the package:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/making_plugins/lib/plugin_example.dart">packages/making_plugins/lib/plugin_example.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">static</strong>​ Future&lt;type&gt; exampleMethod async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ await _platformChannel.invokeMethod(​<em class="string">'runExampleMethod'</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e18633">where in <span class="cf ic">Future</span> you would replace <span class="cf ic">type</span> with the type that you want the function to return.</p>
<p id="d24e18641">For more information on what data types in Java and Swift correspond to the Dart data types, see the table <a href="/links/f_0093/f_0093.xhtml#sec.dart.types.conversion">​<em>Conversion Between Native Java/Apple and Dart Data Types</em>​</a>.</p>
<p id="d24e18647">This is what will actually be called by the users of your package, and the only thing to bear in mind is that the way you call platform-specific code is by invoking methods using <span class="cf ic">platformChannel.invokeMethod(METHOD_NAME)</span>.</p>
<p id="d24e18652">Obviously for such a simple package you could skip defining the <span class="cf ic">platformChannel</span> variable and just use <span class="cf ic">MethodChannel(CHANNEL_NAME).invokeMethod(METHOD_NAME)</span>, but that would not make the code much shorter and could be a really bad way to do things long term, so stick with declaring the channel beforehand like we showed in the example.

</p><p><strong>Implementing the Android Interface in Java</strong></p>
<p id="d24e18666">

In the <span class="cf dir">android</span> directory there will be a source tree that looks just like an app’s source tree, with the only difference being the actual content of the files.</p>
<p id="d24e18680">An Android-specific Java plugin implementation looks like the following:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/making_plugins/android/src/main/java/com/example/pluginexample/PluginExamplePlugin.java">packages/making_plugins/android/src/main/java/com/example/pluginexample/PluginExamplePlugin.java</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">package</strong>​ com.example.pluginexample;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<strong class="kw">io.flutter.plugin.common.MethodChannel</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<strong class="kw">io.flutter.plugin.common.MethodChannel.MethodCallHandler</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<strong class="kw">io.flutter.plugin.common.MethodChannel.Result</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<strong class="kw">io.flutter.plugin.common.MethodCall</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<strong class="kw">io.flutter.plugin.common.PluginRegistry.Registrar</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">public</strong>​ ​<strong class="kw">class</strong>​ PluginExample ​<strong class="kw">implements</strong>​ MethodCallHandler {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">public</strong>​ ​<strong class="kw">static</strong>​ ​<strong class="kw">void</strong>​ ​<strong class="kw">registerWith</strong>​(Registrar registrar) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">final</strong>​ MethodChannel channel =</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">new</strong>​ ​<strong class="kw">MethodChannel</strong>​(registrar.messenger(), ​<em class="string">"example.com/plugin_example"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    channel.setMethodCallHandler(​<strong class="kw">new</strong>​ PluginExample());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @Override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">public</strong>​ ​<strong class="kw">void</strong>​ ​<strong class="kw">onMethodCall</strong>​(MethodCall call, Result result) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​ (call.method.equals(​<em class="string">"runExampleMethod"</em>​)) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      result.success(DATA_TO_RESPOND_WITH);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    } ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      result.notImplemented();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e18836">Specifically, the Java file will be a class which implements the <span class="cf ic">MethodCallHandler</span> trait, and we’ll need to define two methods for it: a <span class="cf methodname">registerWith</span> method, where we’ll define what channel to listen on, and an <span class="cf methodname">onMethodCall</span> which gets called when a method is called on the channel:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/making_plugins/android/src/main/java/com/example/pluginexample/PluginExamplePlugin.java">packages/making_plugins/android/src/main/java/com/example/pluginexample/PluginExamplePlugin.java</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">public</strong>​ ​<strong class="kw">class</strong>​ PluginExample ​<strong class="kw">implements</strong>​ MethodCallHandler {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">public</strong>​ ​<strong class="kw">static</strong>​ ​<strong class="kw">void</strong>​ ​<strong class="kw">registerWith</strong>​(Registrar registrar) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">final</strong>​ MethodChannel channel =</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">new</strong>​ ​<strong class="kw">MethodChannel</strong>​(registrar.messenger(), ​<em class="string">"example.com/plugin_example"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    channel.setMethodCallHandler(​<strong class="kw">new</strong>​ PluginExample());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @Override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">public</strong>​ ​<strong class="kw">void</strong>​ ​<strong class="kw">onMethodCall</strong>​(MethodCall call, Result result) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​ (call.method.equals(​<em class="string">"runExampleMethod"</em>​)) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      result.success(DATA_TO_RESPOND_WITH);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    } ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      result.notImplemented();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e18953">Let’s start dissecting the code by looking at <span class="cf methodname">registerWith</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/making_plugins/android/src/main/java/com/example/pluginexample/PluginExamplePlugin.java">packages/making_plugins/android/src/main/java/com/example/pluginexample/PluginExamplePlugin.java</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">public</strong>​ ​<strong class="kw">static</strong>​ ​<strong class="kw">void</strong>​ ​<strong class="kw">registerWith</strong>​(Registrar registrar) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ MethodChannel channel =</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">new</strong>​ ​<strong class="kw">MethodChannel</strong>​(registrar.messenger(), ​<em class="string">"example.com/plugin_example"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  channel.setMethodCallHandler(​<strong class="kw">new</strong>​ PluginExample());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e19002">This method is comparable to <span class="cf methodname">initState</span> in Flutter widgets: here you would add any action that has to be performed once and is necessary for the functionality of the package, including setting the class as the method call handler for the channel the plugin operates on.</p>
<p id="d24e19008">More specifically, when a method is invoked, <span class="cf methodname">onMethodCall</span> gets called, with two arguments: one describing the call and another providing an interface to return a result.</p>
<p id="d24e19013"><span class="cf methodname">onMethodCall</span> could be defined in the following way:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/making_plugins/android/src/main/java/com/example/pluginexample/PluginExamplePlugin.java">packages/making_plugins/android/src/main/java/com/example/pluginexample/PluginExamplePlugin.java</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@Override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">public</strong>​ ​<strong class="kw">void</strong>​ ​<strong class="kw">onMethodCall</strong>​(MethodCall call, Result result) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​ (call.method.equals(​<em class="string">"runExampleMethod"</em>​)) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    result.success(DATA_TO_RESPOND_WITH);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  } ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    result.notImplemented();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e19064">Since a plugin might call different methods on the same channel, the <span class="cf ic">call</span> argument provides information about the method call, more specifically:</p><ul><li>
<p id="d24e19071"><span class="cf ic">call.method</span>, which is the name of the method that is being called, in this case this would be <span class="cf ic">"runExampleMethod"</span>.</p></li><li>
<p id="d24e19079"><span class="cf ic">call.arguments</span>, which contains the arguments supplied by the caller code (if there are any), this topic is explained in greater detail in <a href="#sec.packages.platformchannels.arguments">​<em>Adding arguments to Method Calls</em>​</a>.</p></li></ul>
<p id="d24e19086">The result is returned using the <span class="cf ic">result</span> argument: running <span class="cf methodname">result.success(DATA)</span> will return DATA to the calling code, whereas running <span class="cf methodname">result.notImplemented</span> will tell the calling code that there the method that was called has not been implemented in the platform-specific code.

</p><p><strong>Implementing the iOS Interface in Swift</strong></p>
<p id="d24e19103">

When you create a Swift plugin project, in the <span class="cf dir">ios/Classes</span> folder, you will find a Swift file where you will write the iOS-specific code:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/making_plugins/ios/Classes/SwiftPluginExamplePlugin.swift">packages/making_plugins/ios/Classes/SwiftPluginExamplePlugin.swift</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<strong class="kw">Flutter</strong>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<strong class="kw">UIKit</strong>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">public</strong>​ ​<strong class="kw">class</strong>​ ​<strong class="kw">PluginExample</strong>​: ​<strong class="kw">NSObject</strong>​, ​<strong class="kw">FlutterPlugin</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">public</strong>​ ​<strong class="kw">static</strong>​ ​<strong class="kw">func</strong>​ ​<strong class="kw">register</strong>​(with registrar: ​<strong class="kw">FlutterPluginRegistrar</strong>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">let</strong>​ channel =</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">FlutterMethodChannel</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                name: ​<em class="string">"example.com/plugin_swift"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                binaryMessenger: registrar.​<strong class="kw">messenger</strong>​()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">let</strong>​ handler = ​<strong class="kw">PluginExample</strong>​()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    registrar.​<strong class="kw">addMethodCallDelegate</strong>​(handler, channel: channel)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">public</strong>​ ​<strong class="kw">func</strong>​ ​<strong class="kw">handle</strong>​(call: ​<strong class="kw">FlutterMethodCall</strong>​, result: ​<strong class="kw">@escaping</strong>​ ​<strong class="kw">FlutterResult</strong>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(call.method == ​<em class="string">"runExampleMethod"</em>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">result</strong>​(​<strong class="kw">DATA</strong>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e19274">Instead of having a <span class="cf class">MethodChannel</span> and a <span class="cf class">MethodCall</span>, you’ll use a <span class="cf class">FlutterMethodChannel</span> and a <span class="cf class">FlutterMethodCall</span>, but most of the same principles apply.</p>
<p id="d24e19288">Registering is slightly different:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/making_plugins/ios/Classes/SwiftPluginExamplePlugin.swift">packages/making_plugins/ios/Classes/SwiftPluginExamplePlugin.swift</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">public</strong>​ ​<strong class="kw">static</strong>​ ​<strong class="kw">func</strong>​ ​<strong class="kw">register</strong>​(with registrar: ​<strong class="kw">FlutterPluginRegistrar</strong>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">let</strong>​ channel =</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">FlutterMethodChannel</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              name: ​<em class="string">"example.com/plugin_swift"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              binaryMessenger: registrar.​<strong class="kw">messenger</strong>​()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">let</strong>​ handler = ​<strong class="kw">PluginExample</strong>​()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  registrar.​<strong class="kw">addMethodCallDelegate</strong>​(handler, channel: channel)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e19364">The <span class="cf class">FlutterMethodChannel</span> constructor arguments are named and not positional and you can set the method handler by using the <span class="cf class">FlutterPluginRegistrar</span>’s <span class="cf methodname">addMethodCallDelegate</span> method, passing the handler class as a positional argument and the channel as a named argument:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/making_plugins/ios/Classes/SwiftPluginExamplePlugin.swift">packages/making_plugins/ios/Classes/SwiftPluginExamplePlugin.swift</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">registrar.​<strong class="kw">addMethodCallDelegate</strong>​(handler, channel: channel)</td></tr></table>
<p id="d24e19386"><span class="cf ic">onMethodCall</span> becomes <span class="cf methodname">handle</span> and instead of using <span class="cf methodname">result.success</span> to return data it is just <span class="cf methodname">result</span>, with the rest of the differences being down to variations in syntax between Java and Swift:

</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/packages/making_plugins/ios/Classes/SwiftPluginExamplePlugin.swift">packages/making_plugins/ios/Classes/SwiftPluginExamplePlugin.swift</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">public</strong>​ ​<strong class="kw">func</strong>​ ​<strong class="kw">handle</strong>​(call: ​<strong class="kw">FlutterMethodCall</strong>​, result: ​<strong class="kw">@escaping</strong>​ ​<strong class="kw">FlutterResult</strong>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(call.method == ​<em class="string">"runExampleMethod"</em>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">result</strong>​(​<strong class="kw">DATA</strong>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><p><strong id="sec.packages.platformchannels.arguments">Adding arguments to Method Calls</strong></p>
<p id="d24e19453">
Getting a value from a platform-specific API is useful, but sometimes you need to pass arguments to the called code, and you can do that by passing another argument to <span class="cf methodname">invokeMethod</span>.</p>
<p id="d24e19462">The arguments will then be available in Android’s <span class="cf class">MethodCall</span> and iOS’s <span class="cf class">FlutterMethodCall</span> in <span class="cf ic">call.arguments</span>.</p>
<p id="d24e19473">Its type is <span class="cf ic">dynamic</span> in Dart, <span class="cf class">Object</span> in Java, and <span class="cf ic">id</span> in Objective-C, meaning it could be anything.</p>
<p id="d24e19484">For example, let’s pass an integer number and multiply it by 10 to see how it’s done.</p>
<p id="d24e19486">The Dart interface is fairly simple:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">static</strong>​ Future&lt;​<strong class="kw">int</strong>​&gt; multiplyBy10(​<strong class="kw">int</strong>​ n) async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ await platformChannel.invokeMethod(​<em class="string">'multiplyBy10'</em>​, n);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e19513">
In the Android code, after casting the type of the arguments to <span class="cf ic">int</span>, it’s as simple as returning the number multiplied by 10:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">if</strong>​(call.method.equals(​<em class="string">"multiplyBy10"</em>​)) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    result.success(((​<strong class="kw">int</strong>​) call.arguments)*10);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e19551">
For the iOS code, in <span class="cf ic">call.arguments</span> you’ll get an <span class="cf ic">NSNumber NumberWithInt</span>, so it takes a few extra steps to achieve this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">if</strong>​(call.method == ​<em class="string">"multiplyBy10"</em>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">let</strong>​ arg = call.arguments ​<strong class="kw">as!</strong>​ ​<strong class="kw">NSNumber</strong>​ ​<strong class="kw">NumberWithInt</strong>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">result</strong>​(​<strong class="kw">NSNumber</strong>​(value: arg.integerValue * 10))</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e19601">Given that the <span class="cf ic">NSNumber</span> contains the actual number in the <span class="cf ic">integerValue</span> member, that’s what we need to multiply by 10. After we’ve done that, we convert it back to an NSNumber and send it back to the calling code.
For more information about the type conversions between Dart and platform-specific code, the section <a href="/links/f_0093/f_0093.xhtml#sec.dart.types.conversion">​<em>Conversion Between Native Java/Apple and Dart Data Types</em>​</a> lists the most important ones.

</p><h3>Using the Package in an App Without Publishing to Pub</h3>
<p id="d24e19617">
Let’s suppose you have a directory structure that looks like the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">flutter_stuff</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">├── app</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">│   ├── lib</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">│   │   └── main.dart</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">│   └── pubspec.yaml</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">└── packagename</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ├── lib</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    │   └── packagename.dart</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    └── pubspec.yaml</td></tr></table>
<p id="d24e19644">and you want the app in the <span class="cf dir">app</span> directory to use the package in the <span class="cf dir">packagename</span> directory.</p>
<p id="d24e19652">As we explained in <a href="/links/f_0047/f_0047.xhtml#sec.packages.nopub">​<em>Fetching Packages from Locations Other Than Pub</em>​</a>, you can just add:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">packagename:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  path: ​<em class="string">../packagename/</em>​</td></tr></table>
<p id="d24e19669">to the dependencies in <span class="cf filename">pubspec.yaml</span> and add:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:packagename/packagename.dart'</em>​;</td></tr></table>
<p id="d24e19684">to <span class="cf dir">app/lib</span><span class="cf filename">main.dart</span> and you will be able to access the package just like you would if you had used Pub.</p>,<h2 id="sec.networking.storage">Making Everything Faster by Caching to Local Storage</h2>
<p id="d24e25502">




Our app works, but it is very slow because it downloads everything every time, and that wastes the user’s time and data.</p>
<p id="d24e25528">To make our app more efficient, we’ll have to save the comics to a local cache and retrieve them from there before trying to get them from the Internet. If the needed comic isn’t already saved, we’ll download it from the Internet.</p><h3>An Introduction to the path_provider Package</h3>
<p id="d24e25533">
Mobile apps can store data in two directories: a temporary cache directory (which is what we’ll use for this example) or a permanent Data/Documents directory (which is meant to be used for permanent storage of user data). The difference between those two directories is that the cache directory may be wiped at any time by the operating system or the user; wiping the data directory should be done only after warning the user that they may lose important data.</p>
<p id="d24e25539">The <span class="cf ic">path_provider</span> package allows you to get the path where these folders are located in all of the operating systems supported by Flutter, whereas the I/O operations themselves are handled by the built-in <span class="cf ic">dart:io</span> plugin. Let’s start by adding the following to the dependencies in <span class="cf filename">pubspec.yaml</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/pubspec.yaml">networking/xkcd_app/pubspec.yaml</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">path_provider:</td></tr></table>
<p id="d24e25556">And import it in our Dart code using this at the top:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:path_provider/path_provider.dart'</em>​;</td></tr></table>
<p id="d24e25567">
Since they perform I/O operations (which take a considerable amount of time to complete), both <span class="cf ic">path_provider</span> and <span class="cf ic">dart:io</span> functions return <span class="cf class">Future</span>s.
</p><h3>Get Down to It: Implement Caching</h3>
<p id="d24e25586">


Since we also need to use Dart’s built-in <span class="cf ic">dart:io</span> plugin to actually perform the I/O operations, we need to add the following at the top of the Dart file:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'dart:io'</em>​;</td></tr></table>
<p id="d24e25618">The code we need to modify is the code that fetches the comics: we need the comic fetching functions to check if the comic is already saved, get it from local storage if it is, and download it and save it if it isn’t already saved.</p>
<p id="d24e25620">We’ll create a file to store the number of the latest comic (which is going to be updated whenever the app is started with a network connection available) and each comic is going to be saved in a separate file.</p>
<p id="d24e25622">
Let’s start with the most significant change: the change to the <span class="cf methodname">fetchComic</span> methods.</p>
<p id="d24e25631">Specifically, the <span class="cf class">HomeScreen</span>’s fetchComic method, which, at the moment, looks like this:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking_starting/xkcd_app/lib/main.dart">networking_starting/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; _fetchComic(​<strong class="kw">int</strong>​ n) async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    await http.read(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="string">"https://xkcd.com/</em>​​<em class="string">${latestComic-n}</em>​​<em class="string">/info.0.json"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr></table>
<p id="d24e25671">Fat arrow syntax won’t work for what we need now: before returning a value we need to get the temporary directory path, check if the comic has already been downloaded and fetch it if it hasn’t.</p>
<p id="d24e25674">We’ll start editing it by reverting to the regular syntax, with braces and return:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; _fetchComic(​<strong class="kw">int</strong>​ n) async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    await http.read(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="string">"https://xkcd.com/</em>​​<em class="string">${latestComic-n}</em>​​<em class="string">/info.0.json"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e25716">At the start of the function, we’ll declare three variables: the directory that will contain the files, the comic number (since we’ll use it more than once it’s easier  to just calculate it once and use it every time) and the File object itself.</p>
<p id="d24e25718">The function that returns the directory is <span class="cf methodname">getTemporaryDirectory</span>, it is asynchronous and returns a <span class="cf class">Directory</span> object, the path string itself is the <span class="cf ic">Directory.path</span> member.</p>
<p id="d24e25729">
Files are managed through the <span class="cf class">File</span> class, which allows us to create files and perform read/write operations on them.</p>
<p id="d24e25738">The <span class="cf class">File</span> constructor is very simple: it takes one positional argument, which is the path to the file.</p>
<p id="d24e25743">
We can perform operations on files using two methods for each operation: we can choose between a synchronous method (like <span class="cf methodname">File.readAsStringSync</span>) which returns whatever is requested directly (no <span class="cf class">Future</span>s involved), and an asynchronous method (like <span class="cf methodname">File.readAsString</span>) which is asynchronous, returns a <span class="cf class">Future</span> and requires <span class="cf ic">await</span> or <span class="cf methodname">Future.then</span> to retrieve the requested data. The advantage of the synchronous method is that we don’t need to convert everything to asynchronous methods and we don’t need to use <span class="cf ic">await</span> all the time, while the advantage of the asynchronous method is that we can just run it and let the rest of the main thread run unaffected if we don’t need the result, as would happen when we create files, for example.</p><h4>The First Step: Saving the JSON Response</h4>
<p id="d24e25774">These three things can be done with the following three lines of code:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">final</strong>​ dir = await getTemporaryDirectory();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">int</strong>​ comicNumber = latestComic-n;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ comicFile = File(​<em class="string">"</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$comicNumber</em>​​<em class="string">.json"</em>​);</td></tr></table>
<p id="d24e25801">Now we need to check if the file exists and isn’t empty and return its decoded content:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">if</strong>​(await comicFile.exists() &amp;&amp; comicFile.readAsStringSync() != ​<em class="string">""</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ json.decode(comicFile.readAsStringSync());</td></tr></table>
<p id="d24e25829">If it isn’t, we need to create the file and write the JSON string to it:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ comic =</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      await http.read(​<em class="string">'https://xkcd.com/</em>​​<em class="string">${latestComic - n}</em>​​<em class="string">/info.0.json'</em>​);</td></tr></table>
<p id="d24e25854">The entire function, when put together, ends up being:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; _fetchComic(​<strong class="kw">int</strong>​ n) async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ dir = await getTemporaryDirectory();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">int</strong>​ comicNumber = latestComic-n;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ comicFile = File(​<em class="string">"</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$comicNumber</em>​​<em class="string">.json"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(await comicFile.exists() &amp;&amp; comicFile.readAsStringSync() != ​<em class="string">""</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ json.decode(comicFile.readAsStringSync());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">final</strong>​ comic =</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        await http.read(​<em class="string">'https://xkcd.com/</em>​​<em class="string">${latestComic - n}</em>​​<em class="string">/info.0.json'</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">/* no need to use sync methods as we</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">       don't have to wait for it to finish caching */</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    comicFile.writeAsString(comic);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ json.decode(comic);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e25969">Since the <span class="cf class">SelectionPage</span> should also take advantage of cached comics, we just need to modify this function slightly to take the comic number as a string argument:
</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; _fetchComic(​<strong class="kw">int</strong>​ n) async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ dir = await getTemporaryDirectory();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ comicFile = File(​<em class="string">"</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$n</em>​​<em class="string">.json"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(await comicFile.exists() &amp;&amp; comicFile.readAsStringSync() != ​<em class="string">""</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ json.decode(comicFile.readAsStringSync());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">final</strong>​ comic =</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        await http.read(​<em class="string">'https://xkcd.com/</em>​​<em class="string">$n</em>​​<em class="string">/info.0.json'</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    comicFile.writeAsString(comic);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ json.decode(comic);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3>Saving the Latest Comic Number</h3>
<p id="d24e26078">
In its current state, our app still depends on the latest comic number being fetched at startup to work, but we can save that in a file when we get it and, if at some point we can’t fetch it at startup, we will try to get it from the file instead.</p>
<p id="d24e26084">We obviously want to fetch the remote one whenever we can, since we want that number to change when new comics come out, unlike what we did in <span class="cf methodname">_fetchComic</span>, where we fetched from files whenever possible and only resorted to fetching from the Internet if that wasn’t possible.</p>
<p id="d24e26089">To do this in our app we need to change the <span class="cf methodname">getLatestComicNumber</span> top-level function, and to achieve what we want there is a feature that will be familiar to most programmers is catching exception using <span class="cf ic">try</span> and <span class="cf ic">catch</span>.</p>
<p id="d24e26100">If the app attempts a network connection and fails (which happens when the site can’t be reached by the device for any reason), it will throw an exception.</p>
<p id="d24e26102">We can catch that exception and grab the comic number from local storage instead.</p>
<p id="d24e26104">We’ll start editing the function declaring the directory and file variables, along with a variable to store the latest comic number that will be returned:





</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">final</strong>​ dir = await getTemporaryDirectory();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ file = File(​<em class="string">'</em>​​<em class="string">${dir.path}</em>​​<em class="string">/latestComicNumber.txt'</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">int</strong>​ n = 1;</td></tr></table><h3>Catching Exceptions</h3>
<p id="d24e26142">

This section is an anticipation of <a href="/links/f_0071/f_0071.xhtml#sec.testing.errors">​<em>Throwing and Catching Exceptions</em>​</a>, since we will deal with <span class="cf ic">try</span>-<span class="cf ic">catch</span> block to catch exceptions.</p>
<p id="d24e26161">Whenever, in any programming language, a piece of code fails to perform the action that is requested to perform, the programming language allows it to <span class="emph">throw</span> an <span class="emph">exception</span>. This will result in a crash of the piece of software in question, but any exception can be handled by <span class="emph">catching</span> it and performing an action in response to the exception.</p>
<p id="d24e26172">For example, if we try to get the comic number and an exception is thrown (meaning that the latest comic number couldn’t be fetched, probably because no network connection is available) we can catch that exception and check if we have fetched it in a previous occasion, so that we can retrieve it from there instead.</p>
<p id="d24e26174">To do that, we’ll start by wrapping whatever could fail in a <span class="cf ic">try</span> block, like this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">try</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// CODE THAT COULD FAIL</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">} ​<strong class="kw">catch</strong>​(exceptionDetails) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  print(​<em class="string">"Something failed"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  print(exceptionDetails);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e26203">So let’s fetch the latest comic number, but in a <span class="cf ic">try</span> block:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">try</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  n = json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    await http.read(​<em class="string">'https://xkcd.com/info.0.json'</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  )[​<em class="string">"num"</em>​];</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e26237">Since saving the number in a file doesn’t affect the rest of the function’s execution,  we can check if the file exist, create it if it doesn’t and write the number to the file in a separate thread, without making the function wait for these operations to be completed (all of this will go inside the <span class="cf ic">try</span> block and will only be executed if the previous instruction doesn’t fail):</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">file.exists().then(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  (exists) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(!exists) file.createSync();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    file.writeAsString(​<em class="string">'</em>​​<em class="string">$n</em>​​<em class="string">'</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">);</td></tr></table>
<p id="d24e26278">The <span class="cf methodname">.then</span> method creates a new thread, waiting for the function to return a value.</p>
<p id="d24e26283">When <span class="cf methodname">file.exists</span> returns a value, it is passed to an anonymous function that does everything we need it to do without affecting the rest of the function.</p>
<p id="d24e26288">If this fails and there is a file from which we can get the number we will get the number from that file, using the <span class="cf ic">catch</span> keyword:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">catch</strong>​(e) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    file.existsSync() &amp;&amp;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    file.readAsStringSync() != ​<em class="string">""</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    n = ​<strong class="kw">int</strong>​.parse(file.readAsStringSync());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e26331">And, regardless of how we get here, we return the number:

</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">return</strong>​ n;</td></tr></table><h3>Saving the Images</h3>
<p id="d24e26345">



Now, if you try to open the app with no network connection, you will notice that everything works, but there are no images.</p>
<p id="d24e26366">This shouldn’t be surprising: we are only saving their URL, and we obviously can’t access the images without a network connection.</p>
<p id="d24e26368">This means we need to download the images to make our app 100% usable offline and, to be able to do this, we will, once again, have to make changes to <span class="cf methodname">fetchComic</span>.</p>
<p id="d24e26373">The code that runs when the file already exists doesn’t need to be changed: it just reads the file and saves it, we just need to ensure that we clear the cache before running the app since we’ll be making changes to how the comic’s JSON string is being saved and we will be making changes to the functions that use the values in the cached comics.</p>
<p id="d24e26375">In the <span class="cf ic">else</span> statement’s curly braces in the <span class="cf class">HomeScreen</span>’s fetchComic method we need to create the file, get the comic’s JSON body, save the image to local storage, and replace the URL in the img parameter with the saved image’s path.</p>
<p id="d24e26385">These are all operations that have already been described by this book and, when put together, produce the following <span class="cf methodname">_fetchComic</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; _fetchComic(​<strong class="kw">int</strong>​ n) async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">final</strong>​ dir = await getTemporaryDirectory();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">int</strong>​ comicNumber = latestComic-n;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">var</strong>​ comicFile = File(​<em class="string">"</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$comicNumber</em>​​<em class="string">.json"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">if</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  await comicFile.exists() &amp;&amp;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  comicFile.readAsStringSync() != ​<em class="string">""</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">return</strong>​ json.decode(comicFile.readAsStringSync());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   comicFile.createSync();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">final</strong>​ comic = json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     await http.read(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="string">'https://xkcd.com/</em>​​<em class="string">$comicNumber</em>​​<em class="string">/info.0.json'</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    File(​<em class="string">'</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$comicNumber</em>​​<em class="string">.png'</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      .writeAsBytesSync(await http.readBytes(comic[​<em class="string">"img"</em>​]));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    comic[​<em class="string">"img"</em>​] = ​<em class="string">'</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$comicNumber</em>​​<em class="string">.png'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    comicFile.writeAsString(json.encode(comic));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ comic;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e26557">We are just using an asynchronous function without an <span class="cf ic">await</span> expression to write the comic file, since it isn’t going to be used by the app until it is restarted, so we don’t need to pause the execution to write it like we do, for example, for the image file that is going to be used by the <span class="cf class">ComicTile</span> not long after the method returns.</p>
<p id="d24e26565">The same exact changes apply to the <span class="cf class">SelectionPage</span>’s <span class="cf methodname">_fetchComic</span> method, given that this part of the function doesn’t change between the two:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; _fetchComic(​<strong class="kw">String</strong>​ n) async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ dir = await getTemporaryDirectory();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ comicFile = File(​<em class="string">"</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$n</em>​​<em class="string">.json"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">if</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   await comicFile.exists() &amp;&amp;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   comicFile.readAsStringSync() != ​<em class="string">""</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">return</strong>​ json.decode(comicFile.readAsStringSync());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   comicFile.createSync();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">final</strong>​ comic = json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     await http.read(​<em class="string">'https://xkcd.com/</em>​​<em class="string">$n</em>​​<em class="string">/info.0.json'</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   File(​<em class="string">'</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$n</em>​​<em class="string">.png'</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     .writeAsBytesSync(await http.readBytes(comic[​<em class="string">"img"</em>​]));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   comic[​<em class="string">"img"</em>​] = ​<em class="string">'</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$n</em>​​<em class="string">.png'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   comicFile.writeAsString(json.encode(comic));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">return</strong>​ comic;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e26732">Since the <span class="cf ic">comic["img"]</span> value is now the path to the file that contains the comic image, we need to change (in the build methods for the <span class="cf class">ComicPage</span> and for the <span class="cf class">ComicTile</span>) the following line:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Image.network(comic[​<em class="string">"img"</em>​])</td></tr></table>
<p id="d24e26753">to:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Image.file(File(comic[​<em class="string">"img"</em>​]))</td></tr></table>
<p id="d24e26765">At this point opening the app with an active Internet connection, closing it and opening it again without an Internet connection will reveal that the app is now completely capable of browsing comics that have already been fetched while not being able to perform requests to the XKCD website.



</p>,<h2 id="d24e27700">Permanent Data I/O in Flutter: Adding “Starred” Comics</h2>
<p id="d24e27703">




Up until now we have only used the temporary cache directory, but if we want to add a feature that allows the user to save some comics to local storage permanently as a way to keep their favorite comics always available to them. To do that, we need to have access to a permanent local storage facility.</p>
<p id="d24e27725">That is available to us in the form of application documents directory, which is where an app is supposed to save data that should be kept until the user consciously deletes it.</p>
<p id="d24e27727">We can get the path of the application documents directory using <span class="cf methodname">getApplicationDocumentsDirectory</span>, and we can use it in the same way we use the cache directory we got through <span class="cf methodname">getTemporaryDirectory</span>: we use <span class="cf ic">getApplicationDocumentsDirectory().path</span> as part of the path we give to the <span class="cf class">File</span>’s constructor.</p>
<p id="d24e27743">Let’s get to implementing this feature, starting with adding a star-shaped button in the app bar in the home page to access previously saved comics and one in the comic page to save comics.</p>
<p id="d24e27745">But even before we do any of that, we need to turn the <span class="cf class">ComicPage</span> into a <span class="cf class">StatefulWidget</span> if we want the view to reflect the change in the comic’s state triggered by the user’s action. This means we need to do two things: change the definition of the <span class="cf class">ComicPage</span> to be a subclass of <span class="cf class">StatefulWidget</span> and turn what was up until now the <span class="cf class">ComicPage</span> into a <span class="cf ic">State&lt;ComicPage&gt;</span> definition, inside which the same <span class="cf methodname">build</span> method will reside:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ComicPage ​<strong class="kw">extends</strong>​ StatefulWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ComicPage(​<strong class="kw">this</strong>​.comic);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt; comic;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  _ComicPageState createState() =&gt; _ComicPageState();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ _ComicPageState ​<strong class="kw">extends</strong>​ State&lt;ComicPage&gt; {</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// return Scaffold(...)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e27829">The next step is to decide what kind of file we should use for storing the starred comics. We have used two different kind of files until now:</p><ul><li>
<p id="d24e27833">A JSON-encoded text file to store the comic data and a simple text file to store the latest comic number.</p></li><li>
<p id="d24e27836">A binary file to save the image data.</p></li></ul>
<p id="d24e27838">The choices have been dictated by the nature of the data we needed to save: images are binary data, whereas we get the comics in a textual JSON format, meaning they can easily be saved in that format to local storage. A single number can be stored as binary data or text-based data without too many differences.</p>
<p id="d24e27841">The starred comics will be a list of numbers, and there are advantages and disadvantages to each approach:</p><ul><li>
<p id="d24e27845">Saving in a binary format (using <span class="cf methodname">writeAsBytes</span>) is simpler to implement and requires less computing overhead, but will generate files that are not readable by the user, but more efficient on storage.</p></li><li>
<p id="d24e27851">Saving it in a JSON list makes it possible for the user to read and edit the file directly, but results in a less efficient use of computing power and storage space.</p></li></ul>
<p id="d24e27853">We are going to use binary format in this case since that seems to be the optimal solution for this problem. We’ll start by implementing an <span class="cf methodname">_addToStarred</span> in the <span class="cf class">ComicPageState</span> to add a comic to the starred comics list:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">_addToStarred</strong>​(​<strong class="kw">int</strong>​ ​<strong class="kw">num</strong>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ file = File(​<em class="string">"</em>​​<em class="string">$docsDir</em>​​<em class="string">/starred"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  List&lt;​<strong class="kw">int</strong>​&gt; savedComics = json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    file.readAsStringSync()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ).cast&lt;​<strong class="kw">int</strong>​&gt;();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(isStarred) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    savedComics.remove(​<strong class="kw">num</strong>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    savedComics.add(​<strong class="kw">num</strong>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  file.writeAsStringSync(json.encode(savedComics));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr></table>
<p id="d24e27950">which depends on the existence of <span class="cf variable">isStarred</span> as a <span class="cf class">ComicPage</span> member variable:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">bool</strong>​ isStarred;</td></tr></table>
<p id="d24e27965">We need to determine whether or not the comic is starred when we load the <span class="cf class">ComicPage</span> for the first time, since we will be changing that variable’s value whenever the user taps on the star button. Since we can’t have an <span class="cf ic">async</span> <span class="cf methodname">initState</span>, we’ll use <span class="cf methodname">.then</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">initState</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">super</strong>​.initState();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  getApplicationDocumentsDirectory().then(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (dir) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      docsDir = dir.path;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">var</strong>​ file = File(​<em class="string">"</em>​​<em class="string">$docsDir</em>​​<em class="string">/starred"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">if</strong>​(!file.existsSync()) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        file.createSync();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        file.writeAsStringSync(​<em class="string">"[]"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        isStarred = ​<strong class="kw">false</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        setState((){isStarred = _isStarred(widget.comic[​<em class="string">"num"</em>​]);});</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e28070">This depends on an <span class="cf methodname">onStarred</span> method that finds out if the comic have been starred by opening the file containing the starred comic numbers, casting it from a <span class="cf class">List</span> of <span class="cf class">dynamic</span> (which is a data type that can contain anything) to a <span class="cf class">List</span> of integers and checking whether the comic number is contained in the list:



</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">bool</strong>​ ​<strong class="kw">_isStarred</strong>​(​<strong class="kw">int</strong>​ ​<strong class="kw">num</strong>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ file = File(​<em class="string">"</em>​​<em class="string">$docsDir</em>​​<em class="string">/starred"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  List&lt;​<strong class="kw">int</strong>​&gt; savedComics = json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    file.readAsStringSync()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ).cast&lt;​<strong class="kw">int</strong>​&gt;();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(savedComics.indexOf(​<strong class="kw">num</strong>​) != -1)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ ​<strong class="kw">true</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">else</strong>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ ​<strong class="kw">false</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3>Adding the AppBar Action to the Comic Path</h3>
<p id="d24e28176">
Now we need to implement a way to add each comic to the starred. The way we’ll do it in this case is by showing a star-shaped icon in the app bar that, when tapped, calls the <span class="cf methodname">_addToStarred</span> method on the current comic, adding it to the starred comics list.
To do that, we’ll add yet another <span class="cf class">AppBar</span> <span class="cf variable">action</span> to our app in the <span class="cf class">ComicPage</span>’s <span class="cf methodname">build</span> method:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">actions: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  IconButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   icon: isStarred == ​<strong class="kw">true</strong>​ ?</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     Icon(Icons.star) :</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     Icon(Icons.star_border),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   tooltip: ​<em class="string">"Star Comic"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   onPressed: () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     _addToStarred(widget.comic[​<em class="string">"num"</em>​]);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       isStarred = !isStarred;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">],</td></tr></table>
<p id="d24e28248">This is what our new ComicPage looks like:</p><div class="ss"><img alt="images/Networking/ComicPageNonFavorite.png" class="border " id="d24e28250" src="/images/img70/images/Networking/ComicPageNonFavorite.png" style="width: 30%"/></div>
<p id="d24e28251">and what its app bar will look like if the current comic has been starred:
</p><div class="ss"><img alt="images/Networking/ComicPageFavorite.png" class="border " id="d24e28254" src="/images/img71/images/Networking/ComicPageFavorite.png" style="width: 40%"/></div><h3>Implementing a Starred Comics List</h3>
<p id="d24e28258">We need a way for the user to find all of the comics they add to their favorite comics, and we’ll be doing that by creating a new widget: a new page in our app that will be just like the <span class="cf class">HomeScreen</span>, but only showing starred comics.</p>
<p id="d24e28263">Let’s define yet another widget and a <span class="cf methodname">fetchComic</span> just like the one in the <span class="cf class">SelectionPage</span> (one that fetches by comic number):</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ StarredPage ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  StarredPage();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; _fetchComic(​<strong class="kw">String</strong>​ n) async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">final</strong>​ dir = await getTemporaryDirectory();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">var</strong>​ comicFile = File(​<em class="string">"</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$n</em>​​<em class="string">.json"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      await comicFile.exists() &amp;&amp;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      comicFile.readAsStringSync() != ​<em class="string">""</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">return</strong>​ json.decode(comicFile.readAsStringSync());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      comicFile.createSync();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">final</strong>​ comic = json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        await http.read(​<em class="string">'https://xkcd.com/</em>​​<em class="string">$n</em>​​<em class="string">/info.0.json'</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      File(​<em class="string">'</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$n</em>​​<em class="string">.png'</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        .writeAsBytesSync(await http.readBytes(comic[​<em class="string">"img"</em>​]));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      comic[​<em class="string">"img"</em>​] = ​<em class="string">'</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$n</em>​​<em class="string">.png'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      comicFile.writeAsString(json.encode(comic));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">return</strong>​ comic;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e28444">While we’re at it, let’s also write a method to retrieve all of the saved comics and return a <span class="cf class">List</span> containing all of the data, taking advantage of the <span class="cf methodname">_fetchComic</span> method we just wrote:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;List&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt;&gt; _retrieveSavedComics() async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">①</span>​</span></td><td class="codeline">  Directory docsDir = await getApplicationDocumentsDirectory(); </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  File file = File(​<em class="string">"</em>​​<em class="string">${docsDir.path}</em>​​<em class="string">/starred"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  List&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; comics = [];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">②</span>​</span></td><td class="codeline">  ​<strong class="kw">if</strong>​(!file.existsSync()) { </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    file.createSync();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    file.writeAsStringSync(​<em class="string">"[]"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  } ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">③</span>​</span></td><td class="codeline">    json.decode(file.readAsStringSync()).forEach( </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      (n) async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        comics.add(await _fetchComic(n.toString()))</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ comics;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><dl class="calloutlist"><dt>​<span class="callout-number" style="font-family:Quivira;">①</span>​</dt><dd>
<p id="d24e28545">
      Here we define the needed variables and fetch the application documents directory and use it to define the file which we wil be operating on.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">②</span>​</dt><dd>
<p id="d24e28548">
      We need to check whether the starred comics file exists; if it doesn’t, we just create the file and end up returning an empty list (we’ll work with that later when we build the UI for the starred comics page).
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">③</span>​</dt><dd>
<p id="d24e28551">
      If the file exists, we fetch all of the comics listed in the file and return them.
    </p></dd></dl>
<p id="d24e28553">Now we’ll <span class="cf ic">build</span> the UI for the <span class="cf class">StarredPage</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/starredPageUI.dart">networking/xkcd_app/lib/starredPageUI.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">①</span>​</span></td><td class="codeline">  ​<strong class="kw">var</strong>​ comics = _retrieveSavedComics();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        title: Text(​<em class="string">"Browse your Favorite Comics"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      body: FutureBuilder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        future: comics,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        builder: (context, snapshot) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">②</span>​</span></td><td class="codeline">          snapshot.hasData &amp;&amp; snapshot.data.isNotEmpty ?</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ListView.builder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            itemCount: snapshot.data.length,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            itemBuilder: (context, i) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ComicTile(comic: snapshot.data[i],),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          )</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">③</span>​</span></td><td class="codeline">          :</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            children: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              Icon(Icons.not_interested),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              Text(​<em class="string">"""</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">                You haven't starred any comics yet.</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">                Check back after you have found something worthy of being here.</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">              """</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><dl class="calloutlist"><dt>​<span class="callout-number" style="font-family:Quivira;">①</span>​</dt><dd>
<p id="d24e28672">
      The <span class="cf methodname">build</span> method will be called just once, so adding this call anywhere wouldn’t change anything, but this is how you’re supposed to do it: put the call returning a <span class="cf class">Future</span> anywhere it will be called just once and then use the value returned by that call as the <span class="cf class">FutureBuilder</span> constructor’s <span class="cf variable">future</span> argument.
	  
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">②</span>​</dt><dd>
<p id="d24e28692">
      We need to check whether there are any starred comics. If there are any, we’ll show a <span class="cf class">ListView</span> of <span class="cf class">ComicTiles</span> as we do in the home page.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">③</span>​</dt><dd>
<p id="d24e28701">
      If there are no starred comics, we’ll just show a notice to the user. We are using multi-line strings as explained in the Dart appendix to this book (<a href="/links/f_0084/f_0084.xhtml#sec.dart.strings">​<em>Characters and Strings</em>​</a>).
    </p></dd></dl>
<p id="d24e28705">The entire <span class="cf class">StarredPage</span> code we’ve seen is combined into the following class definition:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ StarredPage ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  StarredPage();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; _fetchComic(​<strong class="kw">String</strong>​ n) async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">final</strong>​ dir = await getTemporaryDirectory();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">var</strong>​ comicFile = File(​<em class="string">"</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$n</em>​​<em class="string">.json"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      await comicFile.exists() &amp;&amp;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      comicFile.readAsStringSync() != ​<em class="string">""</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">return</strong>​ json.decode(comicFile.readAsStringSync());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      comicFile.createSync();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">final</strong>​ comic = json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        await http.read(​<em class="string">'https://xkcd.com/</em>​​<em class="string">$n</em>​​<em class="string">/info.0.json'</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      );</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    File(​<em class="string">'</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$n</em>​​<em class="string">.png'</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      .writeAsBytesSync(await http.readBytes(comic[​<em class="string">"img"</em>​]));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    comic[​<em class="string">"img"</em>​] = ​<em class="string">'</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$n</em>​​<em class="string">.png'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    comicFile.writeAsString(json.encode(comic));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ comic;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;List&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt;&gt; _retrieveSavedComics() async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Directory docsDir = await getApplicationDocumentsDirectory();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  File file = File(​<em class="string">"</em>​​<em class="string">${docsDir.path}</em>​​<em class="string">/starred"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  List&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; comics = [];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(!file.existsSync()) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    file.createSync();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    file.writeAsStringSync(​<em class="string">"[]"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  } ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    json.decode(file.readAsStringSync()).forEach(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      (n) async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        comics.add(await _fetchComic(n.toString()))</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ comics;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ comics = _retrieveSavedComics();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        title: Text(​<em class="string">"Browse your Favorite Comics"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      body:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      FutureBuilder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        future: comics,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        builder: (context, snapshot) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          snapshot.hasData &amp;&amp; snapshot.data.isNotEmpty ?</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ListView.builder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            itemCount: snapshot.data.length,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            itemBuilder: (context, i) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ComicTile(comic: snapshot.data[i],),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          :</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            children: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              Icon(Icons.not_interested),</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                Text(​<em class="string">"""</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">                  You haven't starred any comics yet.</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">                  Check back after you have found something worthy of being here.</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">                """</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e29084">This is what our starred comics’ list will look like:</p><div class="ss"><img alt="images/Networking/FavoritePage.png" class="border " id="d24e29086" src="/images/img72/images/Networking/FavoritePage.png" style="width: 38%"/></div><h4>Adding a Link to the HomeScreen’s App Bar</h4>
<p id="d24e29090">
Now we need the user to be able to reach this page from the rest of the app. We’ll make this possible by adding an <span class="cf class">AppBar</span> action to the <span class="cf class">HomeScreen</span>. This will be very similar to previous app bar actions we added earlier: when the user taps on the icon we show the user the <span class="cf class">StarredPage</span> on top of the current view:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">IconButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> icon: Icon(Icons.star),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> tooltip: ​<em class="string">"Browse Starred Comics"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> onPressed: () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   Navigator.push(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       builder: (BuildContext context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         StarredPage()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e29146">This is what the <span class="cf class">HomeScreen</span>’s app bar will look like:

</p><div class="ss"><img alt="images/Networking/HomeScreenFavorite.png" class="border " id="d24e29154" src="/images/img73/images/Networking/HomeScreenFavorite.png" style="width: 40%"/></div>,<h2 id="d24e29170">Testing</h2>
<p id="d24e29173">
There are multiple kinds of automated tests that can be applied to Flutter apps:


</p><ul><li>
<p id="d24e29192">Unit testing, the most common, which tests a smaller piece of code and should comprise the majority of the testing you should do on an app.</p></li><li>
<p id="d24e29195">Integration testing, which tests a big section of integrated pieces of code and, in the case of Flutter, runs the app in an emulator or physical device to check whether it behaves as it should when the user interacts with it in a certain way.</p></li></ul><ul><li>Widget testing, which tests UI elements without firing up the app on an emulator or device, instead just keeping track of everything that is supposed to be on screen and letting us interact with it in a way that is much simpler and faster than is done in integration tests.</li></ul>
<p id="d24e29202">In this section we are going to use as an example the calculator app we built earlier in the book (Chapter 3, <a href="/links/f_0029/f_0029.xhtml#chp.calculator">​<em> Building a Calculator App </em>​</a>) and write some tests that make sure each section of the app is working correctly. We are then going to test the XKCD comic browsing app built in the previous chapter to introduce you to mock objects and dependency injection in Flutter.
</p><h3>Dart Unit Testing</h3>
<p id="d24e29210">


Unit testing is really simple: you run a piece of code (for example, a class constructor and a few member methods) and check whether the return value is what is expected.</p>
<p id="d24e29224">


To perform unit testing, we need to add the <span class="cf ic">test</span> package to <span class="cf filename">pubspec.yaml</span>’s <span class="cf ic">dev_dependencies</span>, which is the section where we list dependencies only needed for development and debugging/testing and not needed for the execution of the app on an user’s device.</p><h4>Writing Unit Tests for the Calculator App</h4>
<p id="d24e29253">
Let’s start by taking a look at the app tree created by <span class="cf commandname">flutter create</span>: it contains a directory called <span class="cf dir">test</span>. That’s where we’re going to add any tests we want to be performed by Flutter.</p>
<p id="d24e29265">Here we’ll create a file called <span class="cf filename">calculation_test.dart</span>, inside which, as the name says, we are going to test the <span class="cf class">Calculation</span> class which, if you remember (or go back to <a href="/links/f_0041/f_0041.xhtml#sec.calculator.calculation">​<em>Implement the Calculations</em>​</a>), allows us to add little pieces of an expression (as <span class="cf class">String</span>s) at a time and then get either the result as a <span class="cf ic">double</span> number or a <span class="cf class">String</span> representing the expression.</p>
<p id="d24e29285">There are multiple tests that can be done: we’ll test whether it performs all the different operations and return the right result, then whether it can handle multiple operations and then whether it respects operator precedence. Additionally, we need to check both string values and numeric values returned by it.</p>
<p id="d24e29292">
We’ll start writing the test by importing the needed classes. In this case we’ll need to import the <span class="cf ic">test</span> package and the <span class="cf filename">calculator.dart</span> file in which we have defined the <span class="cf class">Calculation</span> class:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/test/calculation_test.dart">layout/calculator/test/calculation_test.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:flutter_test/flutter_test.dart'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:calculator/calculator.dart'</em>​;</td></tr></table>
<p id="d24e29323">Then we call the <span class="cf class">Calculation</span> constructor to get an object on which to operate:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/test/calculation_test.dart">layout/calculator/test/calculation_test.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ calc = Calculation();</td></tr></table>
<p id="d24e29334">Everything else will go into the <span class="cf methodname">main</span> function:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/test/calculation_test.dart">layout/calculator/test/calculation_test.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">main</strong>​() {</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e29353">The first thing to do is to define a <span class="cf methodname">setUp</span> function that will get called before each test, creating a brand-new calculation object by calling the constructor in order to make sure each test is run in isolation.</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/test/calculation_test.dart">layout/calculator/test/calculation_test.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">setUp(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc = Calculation();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">});</td></tr></table>
<p id="d24e29366">
We are going to call the <span class="cf methodname">test</span> function, which takes a string and a callback function as positional arguments. The string is a text description of the test, so that we know what tests failed (if any fail) and the callback is the code that is going to be run when that test is fired. Inside the callback we’ll use the <span class="cf methodname">expect</span> function to specify what value a certain instruction should return.
For example, if we wanted to test a simple addition operation in our <span class="cf class">Calculation</span> we could write the following:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/test/calculation_test.dart">layout/calculator/test/calculation_test.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">test(​<em class="string">'simple addition'</em>​, () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"+"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"6"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  expect(calc.getResult(), 70.0);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">});</td></tr></table>
<p id="d24e29427">If we want to test more than one addition/subtraction operation in the same test, we just add the following after it:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/test/calculation_test.dart">layout/calculator/test/calculation_test.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">test(​<em class="string">'more sums'</em>​, () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"-"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"+"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"50"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  expect(calc.getResult(), 100.0);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">});</td></tr></table>
<p id="d24e29492">We also need to test whether multiplication works, as we do in the following:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/test/calculation_test.dart">layout/calculator/test/calculation_test.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">test(​<em class="string">'simple multiplication'</em>​, () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"x"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"6"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  expect(calc.getResult(), 30.0);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">});</td></tr></table>
<p id="d24e29532">Division is also important, and we also get a chance to check whether we can properly return floating-point values with a decimal part:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/test/calculation_test.dart">layout/calculator/test/calculation_test.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">test(​<em class="string">'division'</em>​, () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"÷"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"2"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  expect(calc.getResult(), 2.5);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">});</td></tr></table>
<p id="d24e29572">Operator precedence can’t be taken for granted, so we need to check whether it is respected:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/test/calculation_test.dart">layout/calculator/test/calculation_test.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">test(​<em class="string">'precedence'</em>​, () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"+"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"6"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"x"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  expect(calc.getResult(), 35.0);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">});</td></tr></table>
<p id="d24e29629">The last thing to check is whether the <span class="cf methodname">getString</span> operation works correctly:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/test/calculation_test.dart">layout/calculator/test/calculation_test.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">test(​<em class="string">'string'</em>​, () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"x"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"6"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"+"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  calc.add(​<em class="string">"7"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  expect(calc.getString().toString(), ​<em class="string">"5x6+7"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">});</td></tr></table>
<p id="d24e29694">The entire <span class="cf filename">calculation_test.dart</span> file adds up to the following:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/test/calculation_test.dart">layout/calculator/test/calculation_test.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:flutter_test/flutter_test.dart'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:calculator/calculator.dart'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ calc = Calculation();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">main</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  setUp(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc = Calculation();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  test(​<em class="string">'simple addition'</em>​, () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"+"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"6"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    expect(calc.getResult(), 70.0);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  test(​<em class="string">'more sums'</em>​, () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"-"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"+"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"50"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    expect(calc.getResult(), 100.0);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  test(​<em class="string">'simple multiplication'</em>​, () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"x"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"6"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    expect(calc.getResult(), 30.0);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  test(​<em class="string">'division'</em>​, () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"÷"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"2"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    expect(calc.getResult(), 2.5);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  test(​<em class="string">'precedence'</em>​, () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"+"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"6"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"x"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    expect(calc.getResult(), 35.0);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  test(​<em class="string">'string'</em>​, () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"5"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"x"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"6"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"+"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    calc.add(​<em class="string">"7"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    expect(calc.getString().toString(), ​<em class="string">"5x6+7"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><div class="sidebar"><div class="sidebar-title">Make Your Own Changes</div><div class="sidebar-content">
<p id="d24e30029">
		If you have implemented parentheses in the calculator app, you should consider writing a unit test for that too.
	</p>
<p id="d24e30031">
		It is very easy to write unit tests: you actually only need to split <span class="cf methodname">calc.add</span> calls when you want to add an operator, but it’s recommended you add numbers one digit at a time at least in some tests since that’s how the actual calculator app does it and there might be an issue that only manifests itself when doing it that way (or maybe adding more than one digit at a time would break an implementation that would work in the real calculator, but that’s not the case for how we implemented it).
	</p></div></div>
<p id="d24e30036">
At this point, every time you try to build your app these tests will be run. You can also run the tests using <span class="cf commandname">flutter test</span> on the command line. However, probably the best way to run tests is by using Visual Studio Code, which shows a <span class="emph">Run</span> button for each test, allowing you to run each test and get the results shown in an intuitive UI. Android Studio also shows a <span class="emph">right arrow</span> button next to the line number to run a test, but I found its UI slightly less intuitive and consistent. You might feel differently, though, especially if you prefer the Android Studio/IntelliJ UI over the Visual Studio UI; opt for whichever you’re more comfortable using.



</p><h3>Flutter Widget and Integration Testing</h3>
<p id="d24e30059">Unit testing was simple and straight-forward enough, but widget and integration testing need more attention since they rely on UI, which isn’t exactly as dry and simple as the calculation processing code.</p>
<p id="d24e30061">Each little piece of low-level logic in our app may be correct, but there might be something wrong in the UI or the combination of some of the pieces of code we already tested. This is why widget testing and integration testing exist. It’s to test whether a single widget or a bigger part of the app work correctly.</p><h4>Flutter Widget Testing</h4>
<p id="d24e30066">

Flutter provides a way to test whether widgets work correctly and to programmatically interact with widgets in our app.</p>
<p id="d24e30075">This might be really hard to imagine if you’re not used to similar testing infrastructure, so here’s an example of how you might test whether pressing the 5 button will actually make the 5 number appear on the calculator screen after importing <span class="cf filename">main.dart</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/test/widget_test.dart">layout/calculator/test/widget_test.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">①</span>​</span></td><td class="codeline">testWidgets(​<em class="string">'5 press test'</em>​, (WidgetTester tester) async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">②</span>​</span></td><td class="codeline">  await tester.pumpWidget(​<strong class="kw">new</strong>​ MyApp()); </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">③</span>​</span></td><td class="codeline">  expect(find.text(​<em class="string">'5'</em>​), findsOneWidget);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">④</span>​</span></td><td class="codeline">  await tester.tap(find.text(​<em class="string">'5'</em>​));</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">⑤</span>​</span></td><td class="codeline">  await tester.pump();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">⑥</span>​</span></td><td class="codeline">  expect(find.text(​<em class="string">'5'</em>​), findsNWidgets(2));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">});</td></tr></table><dl class="calloutlist"><dt>​<span class="callout-number" style="font-family:Quivira;">①</span>​</dt><dd>
<p id="d24e30134">
      The <span class="cf methodname">testWidgets</span> function is very similar to the <span class="cf methodname">test</span> function, but with a big difference: it passes a <span class="cf class">WidgetTester</span> object to its callback, and that object is what makes widget testing special.
	  
	  
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">②</span>​</dt><dd>
<p id="d24e30156">
      <span class="emph">pump</span> means <span class="emph">build</span> or <span class="emph">render</span>. <span class="cf methodname">tester.pumpWidget</span> renders a widget for which we have a definition.
	  
    </p>
<p id="d24e30175">
    	It’s important to keep in mind that, even though the <span class="cf methodname">pumpWidgets</span> gives the impression that it allows to pump any kind of widget, if you have a <span class="cf class">Scaffold</span> in your widget it needs to be wrapped in a <span class="cf class">MaterialApp</span> (or the more generic <span class="cf class">WidgetsApp</span> class, which doesn’t rely on the Material Design classes) because it needs to have a <span class="cf class">MediaQuery</span> widget in its scope, and such a widget is provided by the aforementioned classes.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">③</span>​</dt><dd>
<p id="d24e30193">
      This is the first <span class="cf methodname">expect</span> call. When we build the app for the first time, just one widget containing the <span class="cf constant">5</span> string should exist (the 5 button).
	  
    </p>
<p id="d24e30206">
    	<span class="cf constant">find</span> is a constant. We’ll look at its use in more detail later in this section.
		
    </p>
<p id="d24e30216">
    	<span class="cf methodname">find.text</span> is a <span class="cf class">Finder</span> and <span class="cf constant">findsOneWidget</span> is a <span class="emph">flutter_test</span>-provided <span class="cf class">Matcher</span> constant.
    </p>
<p id="d24e30233">
	
	
    
	
      We’ll list all <span class="cf class">Finder</span>s and <span class="cf class">Matcher</span>s in more detail in the next two paragraphs after this code’s explanation. All you need to know now is that a <span class="cf class">Matcher</span> is used to judge the results delivered by a <span class="cf class">Finder</span>, which looks for widgets based on a certain characteristic.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">④</span>​</dt><dd>
<p id="d24e30273">
      This is quite self-explanatory: we tap that widget.
	  
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">⑤</span>​</dt><dd>
<p id="d24e30281">
      When testing, Flutter widgets aren’t rebuilt automatically when <span class="cf methodname">setState</span> is called: to do that, we need to call <span class="cf methodname">tester.pump</span>, which re-renders the next frame the app is waiting to render.
	  
    </p>
<p id="d24e30294">
    	There is also another method called <span class="cf methodname">tester.pumpAndSettle</span>, which keeps rendering frames until there is no re-render waiting to happen. This is useful when certain actions trigger an animation that takes several frames to complete.
		
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">⑥</span>​</dt><dd>
<p id="d24e30305">
      This is just like the other <span class="cf methodname">find.text</span> check, but this time there should be two widgets with that text: one is the button, and the other is the screen, which should now show that number.
    </p></dd></dl>
<p id="d24e30310">As you can see, the interface is quite flexible and intuitive, and it is really useful to check whether the UI actually functions correctly.</p><p><strong>All of the Finders</strong></p>
<p id="d24e30315">


Let’s get a bigger picture of Flutter widget testing: there are multiple ways to find widgets using the <span class="cf constant">find</span> constant, which is a collection (of class <span class="cf class">CommonFinders</span><sup><a class="footnote" href="/links/f_0073/f_0073.xhtml#FOOTNOTE-43" id="FNPTR-43">[43]</a></sup>) of the most commonly used <span class="cf class">Finder</span>s:




</p><ul><li>
<p id="d24e30377"><span class="cf methodname">find.text(text)</span>, which finds <span class="cf class">Text</span> widgets that display a string that is <span class="emph">equal</span> to its <span class="cf ic">text</span> argument.</p></li><li>
<p id="d24e30391"><span class="cf methodname">find.byIcon(icon)</span>, which looks for <span class="cf class">Icon</span> widgets that show an <span class="cf class">IconData</span> (something such as <span class="cf constant">Icons.not_interested</span>) equal to its <span class="cf ic">icon</span> argument.</p></li><li>
<p id="d24e30408"><span class="cf methodname"> find.byKey(key)</span>, which takes us back to <a href="/links/f_0027/f_0027.xhtml#sec.layout.key">​<em>The Key</em>​</a>: it matches the widget that has the <span class="cf class">Key</span> you give it as an argument.</p></li><li>
<p id="d24e30418"><span class="cf methodname">find.byElementPredicate(predicate)</span>, which is very flexible: the <span class="cf ic">predicate</span> argument (of type <span class="cf class">WidgetPredicate</span>) is simply a callback that receives a <span class="cf class">Widget</span> as its argument, and returning either <span class="cf ic">true</span> or <span class="cf ic">false</span> will, respectively, consider the widget being examined as matching or not matching the requirements to be included in the <span class="cf class">Finder</span>’s result, which gives the developer significantly more freedom in deciding matching conditions than the other <span class="cf class">Finder</span>s.</p></li><li>
<p id="d24e30445"><span class="cf methodname">find.byWidget(widget)</span>, which is the most specific of the <span class="cf class">Finder</span>s: it matches just the <span class="cf class">Widget</span> given as an argument.</p></li></ul>
<p id="d24e30455">There are other, less common <span class="cf class">Finder</span> provided by the <span class="cf constant">find</span> constant:</p><ul><li><span class="cf methodname">find.byTooltip</span>;</li><li><span class="cf methodname">find.byElementType</span>;</li><li><span class="cf methodname">find.byType</span>;</li><li><span class="cf methodname">find.widgetWithIcon</span>;</li><li><span class="cf methodname">find.widgetWithText</span>;</li><li><span class="cf methodname">find.byDescendant</span>.</li></ul><div class="sidebar"><div class="sidebar-title">Offstage Widgets</div><div class="sidebar-content">
<p id="d24e30497">
		All of the <span class="cf class">Finder</span>s we have talked about allow you to set a named boolean <span class="cf variable">skipOffstage</span> argument which, if set to true, will skip any widgets contained in the rarely used <span class="cf class">Offstage</span> widget, which is a class that allows you to get some widgets (set as the <span class="cf class">Offstage</span>’s <span class="cf variable">child</span>) to get laid out and occupy space without actually being shown.
	</p></div></div><p><strong>All of the Matchers</strong></p>
<p id="d24e30517">

In addition to <span class="cf constant">findsNothing</span>, <span class="cf constant">findsOneWidget</span>, and <span class="cf methodname">findsNWidgets(n)</span> there is also <span class="cf constant">findsWidgets</span>, which is the opposite of <span class="cf constant">findsNothing</span> (equal to <span class="cf ic">!findsNothing</span>).</p><p><strong>More Calculator Testing</strong></p>
<p id="d24e30552">
Let’s actually get into a more complete and realistic example of widget testing our calculator app.</p><p><strong>Checking the Grid</strong></p>
<p id="d24e30561">The first part of the <span class="emph">5 press test</span> can actually be turned into something very useful: checking whether all of the grid is actually being rendered and the user has a button for each button. The numbers, the deletion buttons, the <span class="emph">.</span> button and all of the operation buttons except the division button contain a <span class="cf class">Text</span> to show their use. This means that we can match them using <span class="cf methodname">find.text</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/layout/calculator/test/widget_test.dart">layout/calculator/test/widget_test.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">testWidgets(​<em class="string">'grid existence test'</em>​, (WidgetTester tester) async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      await tester.pumpWidget(​<strong class="kw">new</strong>​ MyApp());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">①</span>​</span></td><td class="codeline">  expect(find.text(​<em class="string">'0'</em>​), findsNWidgets(2));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">②</span>​</span></td><td class="codeline">      ​<strong class="kw">for</strong>​(​<strong class="kw">int</strong>​ i = 1; i &lt; 10; i++) { </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              expect(find.text(​<em class="string">'</em>​​<em class="string">$i</em>​​<em class="string">'</em>​), findsOneWidget);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      [​<em class="string">'+'</em>​, ​<em class="string">'-'</em>​, ​<em class="string">'x'</em>​, ​<em class="string">'&lt;-'</em>​, ​<em class="string">'C'</em>​].forEach(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (str) =&gt; expect(find.text(str), findsOneWidget)</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">③</span>​</span></td><td class="codeline">  ); </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">④</span>​</span></td><td class="codeline">  expect(find.byElementPredicate((element) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(!(element.widget ​<strong class="kw">is</strong>​ Image))</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">return</strong>​ ​<strong class="kw">false</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">else</strong>​ ​<strong class="kw">if</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      (element.widget ​<strong class="kw">as</strong>​ Image).image</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ==</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      AssetImage(​<em class="string">"icons/divide.png"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">return</strong>​ ​<strong class="kw">true</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">else</strong>​ ​<strong class="kw">return</strong>​ ​<strong class="kw">false</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }), findsOneWidget);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">});</td></tr></table><dl class="calloutlist"><dt>​<span class="callout-number" style="font-family:Quivira;">①</span>​</dt><dd>
<p id="d24e30731">
      There should be two widgets containing the <span class="emph">0</span> string: the calculator screen at the start and the zero button.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">②</span>​</dt><dd>
<p id="d24e30737">
      The numbers from 1 to 10 can be found by simply using a <span class="cf keyword">for</span> loop.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">③</span>​</dt><dd>
<p id="d24e30743">
      We haven’t used <span class="cf methodname">forEach</span> much in this book, but it is very useful: it executes the same callback on each member of a <span class="cf class">List</span> or <span class="cf class">Iterable</span>. In this case, it is a good replacement for a for loop iterating over the list of symbols or just writing the instruction to look for each symbol separately.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">④</span>​</dt><dd>
<p id="d24e30755">
      We can’t use <span class="cf methodname">find.text</span> for images obviously, and <span class="cf methodname">find.byWidget</span> might come up as a viable alternative. The issue with that, though, is that it doesn’t actually work in our case: it looks for an <span class="emph">exact</span> match, and it wouldn’t find our image if we tried since the resulting object usually contains extra arguments that control widget position and other properties that we don’t set directly while creating the widget.
    </p>
<p id="d24e30766">
      That’s where <span class="cf methodname">find.byElementPredicate</span> comes to our rescue: we can judge ourselves whether the widget matches what we want, which means we can focus just on what we need: we need the widget in question to be an image and we want it to be displaying <span class="cf filename">icons/divide.png</span> from the assets.
    </p>
<p id="d24e30774">
      What gets passed to the callback closure is an <span class="cf class">Element</span> (an instance of a widget along with some context on its position in the widget tree, which we don’t need for what we’re doing right now). We can access the <span class="cf class">Widget</span> that <span class="cf class">Element</span> was spawned from by accessing its <span class="cf variable">widget</span> member property, so that’s what we’re doing when using <span class="cf variable">element.widget</span>.
    </p>
<p id="d24e30791">
      If the widget isn’t an instance of an <span class="cf class">Image</span> (that’s what <span class="cf keyword">is</span> is for, it’s checking whether the widget is an instance of an <span class="cf class">Image</span> or a subclass), we need to ignore it (return <span class="cf constant">false</span> to exclude it from the found widgets). If it is, we need to check whether the <span class="cf class">ImageProvider</span> it’s taking the image from is actually the <span class="cf filename">icons/divide.png</span> file from the assets.
    </p>
<p id="d24e30812">
      Please note that accessing assets in unit and widget tests is only available starting from Flutter version <span class="emph">1.5</span>.
    </p></dd></dl><h4>Flutter Integration Testing</h4>
<p id="d24e30820">




Integration testing is a level above widget testing: for mobile apps, it is performed in an emulator and is meant to test whether a big part of app functionality works correctly. The calculator app is really simple and we don’t really get much from integration testing when compared with widget testing, whereas one app that requires integration testing is the previous chapter’s XKCD comics app.</p>
<p id="d24e30835">Before we get to running integration tests on it, we need to figure out how to also run unit tests and widget tests on it without being dependent on a network connection to the XKCD servers being available and without being able to access the filesystem, as is the case during unit and widget testing.</p>,<h2 id="d24e36823">Custom Shapes and Drawing in Flutter Apps Using Painters</h2>
<p id="d24e36826">



With <span class="cf class">Canvas</span> and <span class="cf class">Paint</span> we can change the look of a certain widget. That is done using a <span class="cf class">CustomPainter</span>, which is a class that allows us to draw lines and shapes on a virtual <span class="cf class">Canvas</span>.</p><h3>CustomPaint</h3>
<p id="d24e36852">
<span class="cf class">CustomPaint</span> is the widget that allows us to insert the custom shapes we’ll create using a <span class="cf class">CustomPainter</span> into the widget tree. It takes two arguments: a <span class="cf class">CustomPainter</span> as the named <span class="cf variable">painter</span> and a <span class="cf variable">child</span> widget, which will be the widget on which the effect will be applied.
For example, if we wanted to paint a Flutter logo widget using a custom painter we’ll create called <span class="cf class">LogoPainter</span>, we’d insert the following into the widget tree:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">CustomPaint(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  painter: LogoPainter(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: FlutterLogo(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table><h3>Creating a <span class="cf class">CustomPainter</span></h3>
<p id="d24e36892">
The <span class="cf variable">painter</span> needs to be a subclass of the <span class="cf class">CustomPainter</span> widget we have to define ourselves by overriding the <span class="cf methodname">paint</span> and <span class="cf methodname">shouldRepaint</span> methods.</p><h4>The paint Method</h4>
<p id="d24e36913">
The <span class="cf methodname">paint</span> method takes two arguments: a <span class="cf class">Canvas</span> and a <span class="cf class">Size</span>.</p>
<p id="d24e36928">
The <span class="cf class">Canvas</span> is the object on which we will perform drawing operations, such as:</p><ul><li>
<p id="d24e36941">Drawing lines, using <span class="cf methodname">canvas.drawLine(point1, point2, paint)</span>, where the points are represented by <span class="cf class">Offset</span>s (that we’ll discuss later) and <span class="cf ic">paint</span> is of type <span class="cf class">Paint</span> and decides the color and appearance of the line and will be discussed later.</p></li><li>
<p id="d24e36956">Drawing circles using <span class="cf methodname">canvas.drawCircle(center, radius, paint)</span>, where <span class="cf ic">center</span> is an <span class="cf class">Offset</span>, <span class="cf ic">radius</span> is a <span class="cf ic">double</span> and <span class="cf ic">paint</span> is a <span class="cf class">Paint</span> object.</p></li><li>
<p id="d24e36981">Inserting an <span class="cf class">Image</span> using <span class="cf methodname">canvas.drawImage(image, point, paint)</span>, where <span class="cf ic">image</span> is the <span class="cf ic">dart:ui</span> library’s <span class="cf class">Image</span> class, about which there will be a sidebar at the end of this section.</p></li><li>
<p id="d24e36999">Drawing rectangles, using <span class="cf methodname">canvas.drawRect(rect, paint)</span>, where <span class="cf ic">rect</span> is of class <span class="cf class">Rect</span>, about which we’re going to talk later in this section;</p></li><li>
<p id="d24e37011">Drawing ellipses using <span class="cf methodname">canvas.drawOval(rect, paint)</span>, where the arguments are the same as the rectangle’s, but will result in an oval being drawn instead of a rectangle.</p></li></ul>
<p id="d24e37016">
The <span class="cf class">Offset</span> class is used to represent a point in the absolute virtual plane of the app screen by using two <span class="cf ic">double</span> numbers (for example (<span class="cf ic">Offset(0.0, 0.0)</span> is the origin of the virtual plane). You can choose offsets relative to various properties of the <span class="cf class">Paint</span> widget using the properties and methods that are passed along with the <span class="cf class">Canvas</span> to the <span class="cf methodname">paint</span> method as part of the <span class="cf class">Size</span> widget, as described in the official API reference.<sup><a class="footnote" href="/links/f_0080/f_0080.xhtml#FOOTNOTE-52" id="FNPTR-52">[52]</a></sup> Most of the time, you’re going to use <span class="cf class">Offset</span> like vectors to define shapes relative to some other points using <span class="cf class">Size</span> as we’ll see later.</p>
<p id="d24e37055">
The <span class="cf class">Paint</span> class is used to define styling features (such as the color or the width) of the lines and shapes drawn on the canvas. The main ones are color and painting style: <span class="cf variable">paint.color</span> can be set to any color (for example <span class="cf ic">Colors.green</span>) and <span class="cf variable">paint.style</span> can be set to either <span class="cf ic">PaintingStyle.fill</span> or <span class="cf ic">PaintingStyle.stroke</span>, where the first one fills the shape with paint, whereas the second one only draws the edge. If you choose the latter, you may set <span class="cf variable">paint.strokeWidth</span> to any <span class="cf ic">double</span> value.</p>
<p id="d24e37086">
The <span class="cf class">Rect</span> class is used to describe a rectangle in the plane. It is created from either two points (using the <span class="cf methodname">Rect.fromPoints(point1, point2)</span> constructor), which will generate the smallest possible rectangle that encloses the two points, from the left and right X coordinates and top and bottom and top Y coordinates (using <span class="cf methodname">Rect.fromLTRB(left, top, right, bottom)</span>, where the arguments are all <span class="cf ic">double</span> values), or from a couple of edges, width and height (using <span class="cf methodname">Rect.fromLTWH(left, top, width, height)</span>, the arguments are all <span class="cf ic">double</span> values just like with the previous constructor). <span class="cf methodname">Rect.fromCircle(center, radius)</span>, with the same arguments as <span class="cf methodname">Canvas.drawCircle</span>, is used to get a square from a circle.</p>
<p id="d24e37117">
The <span class="cf class">Size</span> is used to generate <span class="cf class">Offset</span> based on the size and positioning of the <span class="cf class">CustomPaint</span>’s <span class="cf ic">child</span>. This can be done using methods such as <span class="cf methodname">Size.center(offset)</span>, which will return an <span class="cf class">Offset</span> that is obtained by considering the center of the widget we’re painting as the origin of the plane and considering. Another way to see that is as the point obtained from the translation of the center of the widget by the vector <span class="cf ic">offset</span>. Other methods, such as <span class="cf methodname">Size.bottomRight(offset)</span> can be used if you need to draw a point relative to other points of the widget.
</p><div class="sidebar"><div class="sidebar-title">Using ui.Image</div><div class="sidebar-content">
<p id="d24e37152">
  
  
  
  
    The image passed to <span class="cf methodname">drawImage</span> isn’t a regular Flutter <span class="cf class">Image</span> widget: it’s the <span class="cf class">Image</span> class found in the <span class="cf keyword">dart:ui</span> library.<sup><a class="footnote" href="/links/f_0080/f_0080.xhtml#FOOTNOTE-53" id="FNPTR-53">[53]</a></sup>
  </p>
<p id="d24e37196">
    An <span class="cf class">ui.Image</span> (usually referred to with the ‘ui.‘ prefix in documentation because ‘dart:ui‘ is typically imported ‘as ui‘ to differentiate it from the Flutter <span class="cf class">Image</span> widget) is obtained as the ‘image‘ property of an <span class="cf class">ui.FrameInfo</span> object.
  </p>
<p id="d24e37207">
  
    A <span class="cf class">FrameInfo</span> can be obtained by running (and <span class="cf keyword">await</span>ing) <span class="cf class">ui.Codec</span>’s <span class="cf methodname">getNextFrame</span> method. Finally, an <span class="cf class">ui.Codec</span> can be obtained using ‘dart:ui‘’s <span class="cf methodname">instantiateImageCodec</span> function. This data can be obtained from an image file by using <span class="cf keyword">dart:io</span>’s regular <span class="cf methodname">File.readBytes</span> method.
  </p></div></div><h4>The shouldRepaint Method</h4>
<p id="d24e37242">
The <span class="cf methodname">shouldRepaint</span> method has to be implemented, and it’s an important optimization factor when talking about complex and resource-intensive <span class="cf class">CustomPainter</span>s.</p>
<p id="d24e37256">It returns a boolean value that tells the framework whether or not the widget needs to be repainted. It is called whenever a <span class="cf class">CustomPaint</span> object attempts to get painted with a new instance of a <span class="cf class">CustomPainter</span> class. This method gets the old custom painter instance as an argument, so you can compare it with the new one to decide whether anything worthy of a re-render has changed.</p>
<p id="d24e37264">In our case, we’re just going to return <span class="cf ic">false</span> because the same object never gets called with different <span class="cf class">CustomPainter</span>s. For performance reasons, you should start with that and, if there are problems, try to make it more and more common that <span class="cf methodname">shouldRepaint</span> returns <span class="cf ic">true</span> until all issues are fixed and the widgets get painted according to how you want them to be painted.</p><h4>An Example of a CustomPainter</h4>
<p id="d24e37281"><span class="cf class">CustomPainter</span>s allow a great degree of customization, so they are best described with an example to show you how to put together the basic concepts we talked about, so that you can get an idea of how it’s done, keeping in mind that only the official API reference<sup><a class="footnote" href="/links/f_0080/f_0080.xhtml#FOOTNOTE-54" id="FNPTR-54">[54]</a></sup> can comprehensively list all of the possible transformations and shapes available:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ LogoPainter ​<strong class="kw">extends</strong>​ CustomPainter {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ paint(Canvas canvas, Size size) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">var</strong>​ greenPaint = Paint()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ..style = PaintingStyle.fill</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ..color = Colors.green;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">var</strong>​ redPaint = Paint()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ..style = PaintingStyle.fill</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ..color = Colors.red;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">var</strong>​ whitePaint = Paint()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ..style = PaintingStyle.fill</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ..color = Colors.white;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    canvas.drawColor(Colors.blue, BlendMode.color);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    canvas.drawOval(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Rect.fromPoints(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        size.topLeft(Offset(-40, -100)),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        size.bottomRight(Offset(15, 10))</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      greenPaint</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    canvas.drawOval(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Rect.fromPoints(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        size.topLeft(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Offset(-15, -10)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        size.bottomRight(Offset(40, 100))</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      redPaint</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    canvas.drawCircle(size.center(Offset(0, 0)), 40.0, whitePaint);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">bool</strong>​ shouldRepaint(CustomPainter old) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ ​<strong class="kw">false</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e37467">This example takes advantage of cascade notation (covered in <a href="/links/f_0090/f_0090.xhtml#sec.dart.classes.cascadeNotation">​<em>Cascade Notation</em>​</a>), which is a way to call multiple methods on an object or alter some of its properties without having to repeat the name of the object by returning the altered object and not the result of the method (<span class="cf ic">whitePaint..</span><span class="cf ic">color=Colors.white</span> returns <span class="cf variable">whitePaint</span>, meaning we can add another two dots with another instruction, and it will be executed on the <span class="cf variable">whitePaint</span> object).</p>
<p id="d24e37484">It results in the following being drawn when painting a <span class="cf class">FlutterLogo</span>:
</p><div class="ss"><img alt="images/Firebase/custompaint.png" class="border " id="d24e37490" src="/images/img77/images/Firebase/custompaint.png" style="width: 42%"/></div><h3>Hero Animations Combined with CustomPaint</h3>
<p id="d24e37494">

The combination of these canvas painting abilities with hero animation could make for interesting user interaction animation in Flutter apps: let’s imagine having two widgets similar to the one we’ve seen in the previous section, but in different colors and that serve as links to different views or different versions of the same view.</p>
<p id="d24e37501">Let’s start by defining the painters: a red, green and white one just like the previous one:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ GreenWhiteRedPainter ​<strong class="kw">extends</strong>​ CustomPainter {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ paint(Canvas canvas, Size size) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">var</strong>​ greenPaint = Paint();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    greenPaint.style =PaintingStyle.fill;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    greenPaint.color = Colors.green;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">var</strong>​ redPaint = Paint();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    redPaint.style =PaintingStyle.fill;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    redPaint.color = Colors.red;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">var</strong>​ whitePaint = Paint();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    whitePaint.style =PaintingStyle.fill;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    whitePaint.color = Colors.white;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    canvas.drawColor(Colors.blue, BlendMode.color);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    canvas.drawOval(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Rect.fromPoints(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        size.topLeft(Offset(-40, -100)),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        size.bottomRight(Offset(15, 10))</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      greenPaint</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    canvas.drawOval(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Rect.fromPoints(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        size.topLeft(Offset(-15, -10)),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        size.bottomRight(Offset(40, 100))</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      redPaint</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    canvas.drawCircle(size.center(Offset(0, 0)), 40.0, whitePaint);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">bool</strong>​ shouldRepaint(CustomPainter old) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ ​<strong class="kw">false</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e37679">and a blue and white one:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ BlueWhiteBluePainter ​<strong class="kw">extends</strong>​ CustomPainter {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ paint(Canvas canvas, Size size) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">var</strong>​ bluePaint = Paint();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    bluePaint.style =PaintingStyle.fill;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    bluePaint.color = Colors.blue;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">var</strong>​ whitePaint = Paint();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    whitePaint.style =PaintingStyle.fill;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    whitePaint.color = Colors.white;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    canvas.drawColor(Colors.blue, BlendMode.color);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    canvas.drawOval(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Rect.fromPoints(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        size.topLeft(Offset(-40, -100)),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        size.bottomRight(Offset(15, 10))</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      bluePaint</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    canvas.drawOval(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Rect.fromPoints(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        size.topLeft(Offset(-15, -10)),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        size.bottomRight(Offset(40, 100))</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      bluePaint</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    canvas.drawCircle(size.center(Offset(0, 0)), 40.0, whitePaint);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">bool</strong>​ shouldRepaint(CustomPainter old) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ ​<strong class="kw">false</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e37836">We’ll use them in an app for two different widgets in a <span class="cf class">Row</span> that will each pass themselves to a second view:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ FirstPage ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ widgets = [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Hero(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      tag: ​<em class="string">"Blue White Red"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: CustomPaint(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        painter: BlueWhiteBluePainter(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Text(​<em class="string">"1"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Hero(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      tag: ​<em class="string">"Green White Red"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: CustomPaint(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        painter: GreenWhiteRedPainter(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Text(​<em class="string">"2"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      body:Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child:Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          mainAxisAlignment: MainAxisAlignment.spaceEvenly,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Hero(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              tag: ​<em class="string">"Green White Red"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              child: CustomPaint(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                painter: BlueWhiteBluePainter(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                child: GestureDetector(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  child: Text(​<em class="string">"1"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  onTap: () =&gt; Navigator.pushReplacement(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      builder: (context) =&gt; SecondPage(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        widgets[0]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Hero(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              tag: ​<em class="string">"Blue White Red"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              child: CustomPaint(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                painter: GreenWhiteRedPainter(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                child: GestureDetector(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  child: Text(​<em class="string">"2"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  onTap: () =&gt; Navigator.pushReplacement(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      builder: (context) =&gt; SecondPage(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        widgets[1]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e38018">that other view shows the widget in the top left corner of the screen, as a way to show what choice has been made and provides a way to go back:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ SecondPage ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  SecondPage(​<strong class="kw">this</strong>​.topLeft);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ Widget topLeft;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      body: Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        padding: EdgeInsets.only(left: 50.0, top: 150.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: topLeft,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      floatingActionButton: FloatingActionButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Icon(Icons.looks_one),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        onPressed: () =&gt; Navigator.pushReplacement(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            builder: (context) =&gt; FirstPage()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e38091">The first view will look like this:</p><div class="ss"><img alt="images/Firebase/heropainthome.png" class="border " id="d24e38093" src="/images/img78/images/Firebase/heropainthome.png" style="width: 38%"/></div>
<p id="d24e38094">When clicking the number 1 the view will animate to show the following:</p><div class="ss"><img alt="images/Firebase/heropaint1.png" class="border " id="d24e38096" src="/images/img79/images/Firebase/heropaint1.png" style="width: 38%"/></div>
<p id="d24e38097">and when clciking the number 2 the view will animate to show the following:</p><div class="ss"><img alt="images/Firebase/heropaint2.png" class="border " id="d24e38099" src="/images/img80/images/Firebase/heropaint2.png" style="width: 38%"/></div>
<p id="d24e38100">Clicking the floating action button in the second page will animate to the initial page with both buttons.
</p>,<h2 id="sec.dart.variables">Variables and Conditions</h2>
<p id="d24e41765">


Variables can be declared in two ways in Dart:</p><ul><li>
<p id="d24e41783"> In the <span class="emph">traditional</span> C-like way, by prefixing the variable name with the data type:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">int</strong>​ a = 3;</td></tr></table></li><li>
<p id="d24e41795">By prefixing the variable name with ‘var‘:

  </p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ a = 3;</td></tr></table></li></ul>
<p id="d24e41803">A list of some of the most common data types is provided at the end of this appendix.</p><h3 id="sec.dart.strings">Characters and Strings</h3>
<p id="d24e41808">






In some languages there are <span class="cf ic">char</span> types for single characters and arrays of <span class="cf ic">char</span>s or separate types for strings. In Dart, the <span class="cf class">String</span> type is the only character/string type, and it can contain one or more characters. For that reason, unlike in other languages, you can use single or double quotes to enclose what you assign to the string (called a <span class="emph">string literal</span>):</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ greeting = ​<em class="string">"Hi!"</em>​;</td></tr></table>
<p id="d24e41864">will work just as well as:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ greeting = ​<em class="string">'Hi!'</em>​;</td></tr></table>
<p id="d24e41875">


Like in many other modern languages, two strings can be concatenated using the same <span class="cf ic">+</span> operator you use for addition between numbers:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ firstGreeting = ​<em class="string">"Hi"</em>​ + ​<em class="string">"!"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(firstGreeting == ​<em class="string">'Hi!'</em>​);</td></tr></table>
<p id="d24e41915">
What’s <span class="cf ic">assert</span>? It’s something you will get used to seeing reading this appendix: its effect in compiled code is that, in a testing/debugging situation (it does nothing on production code), it terminates the execution if the condition in its parentheses isn’t true, but it’s widely used in programming language tutorials and documentation to explain language features. Whenever you see one in this appendix, you should expect the condition inside its parentheses to always be true.</p><h4>The Backslash</h4>
<p id="d24e41928">


Just like in many other languages, the backslash can be used to escape some characters or insert special characters.</p>
<p id="d24e41949">For example, if you wanted to have quotes inside a string, you have two ways to do it:</p><ul><li>
<p id="d24e41953">You use different kind of quotes to enclose the string (for example <span class="cf ic">’He said: "Hi!"’</span>).</p></li><li>
<p id="d24e41959">You escape the quotes (for example, <span class="cf ic">"He said: \"Hi!\""</span>).</p></li></ul>
<p id="d24e41964">For the special characters part, this will be familiar especially to C developers; the <span class="cf ic">\n</span> character can be used to go to a new line:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Text(​<em class="string">"First line</em>​​<em class="string">\n</em>​​<em class="string">Second line"</em>​)</td></tr></table>
<p id="d24e41980">will render <span class="emph">Second line</span> below <span class="emph">First line</span>.</p>
<p id="d24e41988">Obviously, the backslash itself has to be escaped to be used as part of a string:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Text(​<em class="string">"</em>​​<em class="string">\\</em>​​<em class="string"> is the backslash character"</em>​)</td></tr></table>
<p id="d24e42002">will display <span class="cf ic">\ is the backslash character</span>.


</p><h4>String Interpolation</h4>
<p id="d24e42015">

String interpolation allows you to insert one or more variables’ value into a string. Let’s first explore how things would be done <span class="emph">without</span> string interpolation.</p>
<p id="d24e42027">For example, if you wanted to display the value of an <span class="cf ic">int</span> with a <span class="cf class">Text</span>, you can’t just write:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">int</strong>​ number;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">// (...)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Text(number)</td></tr></table>
<p id="d24e42048">because <span class="cf class">Text</span> expects a <span class="cf class">String</span>. This means you need to change that to:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Text(number.toString())</td></tr></table>
<p id="d24e42063">What if you want to display a string and the number? Then you would need to write something like this, using string concatenation:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">"You tapped the button"</em>​ + number.toString() + ​<em class="string">"times"</em>​</td></tr></table>
<p id="d24e42077">What string interpolation allows you to do is write this instead:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">"You tapped the button </em>​​<em class="string">$number</em>​​<em class="string"> times"</em>​</td></tr></table>
<p id="d24e42088">




By prefixing a variable’s name with $ you can insert its value into the string. If you need to access an element of a <span class="cf class">List</span>, the member of a class, or write any kind of expression, you need to enclose the statement in curly braces. If you had a list like the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">List numbers = [1, 2, 3];</td></tr></table>
<p id="d24e42121">you would use string interpolation like this:

</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">"There are </em>​​<em class="string">${numbers.length}</em>​​<em class="string"> and second element is number </em>​​<em class="string">${numbers[1]}</em>​​<em class="string">"</em>​</td></tr></table><h4>Multi-Line Strings and Raw Strings</h4>
<p id="d24e42142">






Like in many other languages, you can make multi-line strings by using triple quotes and you can make raw strings by prefixing the opening quotes with the letter “r”.</p>
<p id="d24e42179">A multi-line string makes it so that you can turn this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">"First line</em>​​<em class="string">\n</em>​​<em class="string">Second line"</em>​;</td></tr></table>
<p id="d24e42191">or this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">"First line</em>​​<em class="string">\n</em>​​<em class="string">"</em>​ +</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">"Second line"</em>​</td></tr></table>
<p id="d24e42206">into this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">"""</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">First line</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">Second line</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">"""</em>​</td></tr></table>
<p id="d24e42223">A raw string treats any special characters inside it (<span class="cf ic">$</span>, <span class="cf ic">\</span>, and so on) like any other character, without giving it any special meaning that you can write just:




</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">r"\ is the backslash character"</em>​</td></tr></table><h3>Conditions: Boolean Algebra in Dart</h3>
<p id="d24e42249">













Dart conditions will look exactly like the conditions you find in C, Java or JavaScript: you use <span class="cf ic">==</span>, <span class="cf ic">!=</span>, <span class="cf ic">&gt;</span>, <span class="cf ic">&lt;</span>, <span class="cf ic">&lt;=</span> and <span class="cf ic">&gt;=</span> to compare values, and you use <span class="cf ic">&amp;&amp;</span> as the AND operator, <span class="cf ic">||</span> as the OR operator and <span class="cf ic">!</span> as the NOT operator.</p><h3>Immutable Variables: final and const</h3>
<p id="d24e42343">




If the variable doesn’t need to vary at all, there are two keywords that can make sure the compiler knows your wish: <span class="cf ic">final</span> and <span class="cf ic">const</span>:</p><ul><li>
<p id="d24e42376">A <span class="cf ic">final</span> variable’s value can’t be changed: you initialize it with a value and that value is stored there forever, this is needed for all widget properties in Flutter because widgets themselves are immutable.</p></li><li>
<p id="d24e42382"><span class="cf ic">const</span> is used to create compile-time constants: the compiler will evaluate the value of the constant when you build your app, so you can’t have <span class="cf ic">const</span> arguments.</p></li></ul>
<p id="d24e42390">You use these two keywords by replacing the word <span class="cf ic">var</span> with them:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">const</strong>​ a = 3;</td></tr></table>
<p id="d24e42401">or by prefixing the variable data type with one of them:




</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ greeting = ​<em class="string">"Hi!"</em>​;</td></tr></table><h3 id="sec.dart.lists">Lists and collection literals</h3>
<p id="d24e42427">


A <span class="cf class">List</span> is what is commonly referred to as an array: an ordered collection of data, the elements of which are indexed with the values from 0 to <span class="cf ic">length-1</span> where the <span class="cf ic">length</span> of a <span class="cf class">List</span> is the number of elements it contains. A <span class="cf class">List</span> can be initialized with a list literal, which is a comma-separated list of values enclosed in square brackets:

</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ list = [30, 20, 500];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(list[0] == 30);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(list[1] == 20);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(list[2] == 500);</td></tr></table><h4>If and For in List Literals</h4>
<p id="d24e42498">

List literals in Dart can do more than that, though—you can have <span class="cf ic">if</span> statements in them:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">bool</strong>​ condition;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">// ...</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ list = [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(condition)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"First"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">else</strong>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"First, alternative"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"Second"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(list[1] == ​<em class="string">"Second"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">if</strong>​(condition)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">assert</strong>​(list[0] == ​<em class="string">"First"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">else</strong>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">assert</strong>​(list[0] == ​<em class="string">"First, alternative"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">/*</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment"> * As in other languages, these latest two assert() calls could become one:</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment"> * assert((condition &amp;&amp; list[0] == "First") ||</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment"> *        (!condition &amp;&amp; list[0] == "First, alternative"))</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment"> */</em>​</td></tr></table><h4>Adding and Removing Items from Lists</h4>
<p id="d24e42606">
An item can be added to the end of a list by using <span class="cf methodname">List.add</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ l = [1, 2, 3];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">l.add(4);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(l[3] == 4);</td></tr></table>
<p id="d24e42632">
An item can be removed in two main ways (there are others, feel free to check out all <span class="cf class">List</span> methods at the official Dart language reference<sup><a class="footnote" href="/links/f_0094/f_0094.xhtml#FOOTNOTE-55" id="FNPTR-55">[55]</a></sup>). One of them is by passing the value you want to remove with <span class="cf methodname">List.remove</span> (which will only remove the first occurence):</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ l = [​<em class="string">"Test"</em>​, ​<em class="string">"test"</em>​, ​<em class="string">"Test"</em>​];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">l.remove(​<em class="string">"Test"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(l[0] == ​<em class="string">"test"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(l[1] == ​<em class="string">"Test"</em>​); ​<em class="comment">// The second occurrence won't be removed</em>​</td></tr></table>
<p id="d24e42690">
The other is by passing the index at which you want to remove an element to <span class="cf methodname">List.removeAt</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ l = [5, 6, 7];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">l.removeAt(1);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(l[1] == 7);</td></tr></table><h4 id="sec.dart.lists.generate">Generating Lists</h4>
<p id="d24e42719">
One of the ways to create lists is by using the <span class="cf methodname">List.generate</span> constructor, which takes two arguments: the number of elements the list will have and a callback function (a function to be run by another function in certain conditions and with certain arguments) that generates each element based on its index.</p>
<p id="d24e42728">For example, this is how you’d create a list from the concatenation of the strings contained in two lists:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ l1 = [​<em class="string">"First"</em>​, ​<em class="string">"Second"</em>​, ​<em class="string">"Third"</em>​];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ l2 = [​<em class="string">"1"</em>​, ​<em class="string">"2"</em>​, ​<em class="string">"3"</em>​];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ l = List.generate(3, (index) =&gt; l1[i]+l2[i]);</td></tr></table>
<p id="d24e42766">If this example wasn’t clear to you, check out the section about functions (<a href="/links/f_0085/f_0085.xhtml#sec.dart.functions">​<em>Functions</em>​</a>) and the one about classes (<a href="/links/f_0090/f_0090.xhtml#sec.dart.classes">​<em>Classes</em>​</a>).</p><h4>Iterating Over Lists: for, map, and forEach</h4>
<p id="d24e42775">We’ve found out how to generate lists, now what about how to iterate over the elements of a list? There are multiple ways to do that:</p><ul><li>The <span class="cf ic">for</span> <span class="cf ic">in</span> loop.</li><li>The <span class="cf methodname">.forEach</span> method.</li><li>The <span class="cf methodname">.map</span> method.</li></ul><p><strong>The for in Loop</strong></p>
<p id="d24e42802">
Present in most modern languages, it’s a special kind of <a href="/links/f_0089/f_0089.xhtml#sec.dart.loops">​<em>Loops: while, do while, and for</em>​</a> that iterates over the elements of a list:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ listName = [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"First"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"Second"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"Third"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"Fourth"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">for</strong>​(​<strong class="kw">var</strong>​ elName ​<strong class="kw">in</strong>​ listName) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  print(elName);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><p><strong>map and forEach</strong></p>
<p id="d24e42855">

Particularly loved by some for their functional style, the <span class="cf class">Iterable</span>’s <span class="cf methodname">map</span> and <span class="cf methodname">forEach</span> methods are alternatives to the <span class="cf keyword">for</span> <span class="cf ic">in</span> loop.</p>
<p id="d24e42882"><span class="cf methodname">forEach</span> is the most similar to the <span class="cf keyword">for</span> loop, as it is used to execute an operation on (or for) each of the elements of a list. The callback closure you use is of type <span class="cf ic">void</span>, so you can’t return anything. Here’s an example, showing how to print each element of a list:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">listName.forEach((el) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  print(el);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">});</td></tr></table>
<p id="d24e42903">
<span class="cf methodname">map</span> is different: it is used to create an <span class="cf class">Iterable</span> from calling a function on each element of the <span class="cf class">List</span>, here’s an example:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ numbers = [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  2,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  3,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  4,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  5,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  6</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ iter = numbers.map((el) =&gt; ​<em class="string">"#</em>​​<em class="string">$el</em>​​<em class="string">"</em>​);</td></tr></table>
<p id="d24e42953">
<span class="cf variable">iter</span> is an <span class="cf class">Iterable</span>, not a proper <span class="cf class">List</span>. If you want to access the elements directly just like you do with a list, you need to use the <span class="cf methodname">toList</span> method:


</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ list = numbers.map((el) =&gt; ​<em class="string">"#</em>​​<em class="string">$el</em>​​<em class="string">"</em>​).toList();</td></tr></table><h3 id="sec.dart.underscore">The underscore</h3>
<p id="d24e42999">




You might have seen in many code examples that we have prefixed some variable or class names with an underscore (<span class="cf ic">_</span>). It is used to make them <span class="emph">library private</span>.</p>
<p id="d24e43035">For example, when we write:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyWidget ​<strong class="kw">extends</strong>​ StatefulWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// (...)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ _MyWidgetState ​<strong class="kw">extends</strong>​ State&lt;MyWidget&gt; {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// (...)</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e43066">We are making the <span class="cf class">MyWidgetState</span> class <span class="emph">library private</span>, meaning it is only accessible from within the current package: if you are working on a library and you want to make a class or top-level function inaccessible to users of that library, you us the underscore this way.</p>
<p id="d24e43074">Using the underscore for class members is used to make it inaccessible from outside its class definition, like in the following example:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ CounterClass {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">int</strong>​ _counter = 0;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ _setCounterTo(​<strong class="kw">int</strong>​ n) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    _counter = n;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">int</strong>​ getCounter() =&gt; _counter</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ increaseCounter() =&gt; _setCounterTo(_counter+1);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e43114">which is obviously a lot more complicated than it needs to be (<span class="cf methodname">_setCounterTo</span> adds unnecessary complication) in order to show how different kinds of methods may be chosen to be set as private: if we are making a counter class, we want to be able to get the current value of the counter, but we don’t need to change it to any value other than it incremented by 1, so we only give access to a method that does exactly that and another that returns the value of the counter.</p><h3>Other Iterable Data Structures: Maps, Sets, and More</h3>
<p id="d24e43122">



The <span class="cf class">Map</span> is a key/value collection, similar to JSON objects and often used as the way to handle JSON objects in Dart as a simpler alternative to defining a class for each kind of object the app works with. A <span class="cf class">Map</span> literal is enclosed in curly braces and looks something like this:

</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ user = {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"userId"</em>​: 1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"firstName"</em>​: ​<em class="string">"Carmine"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"lastName"</em>​: ​<em class="string">"Zaccagnino"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">};</td></tr></table>
<p id="d24e43195">You can access and add elements to a <span class="cf class">Map</span> by using the same <span class="cf ic">[]</span> and <span class="cf ic">[]</span> you’d use to access and modify elements of a <span class="cf class">List</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ name = ​<em class="string">"</em>​​<em class="string">${user["firstName"]}</em>​​<em class="string"> </em>​​<em class="string">${user["lastName"]}</em>​​<em class="string">"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">user[​<em class="string">"password"</em>​] = ​<em class="string">"my!!Very!!own!!Very!!safe1passWordstr"</em>​;</td></tr></table>
<p id="d24e43234">





A <span class="cf class">Set</span> a linear collection of different values:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ G8 = {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"United States"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"Japan"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"Germany"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"United Kingdom"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"France"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"Italy"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"Canada"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"Russia"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">};</td></tr></table>
<p id="d24e43318">You can remove an item from a <span class="cf class">Set</span> by value using <span class="cf methodname">remove</span> and add one using <span class="cf methodname">add</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ G7 = G8</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ..remove(​<em class="string">"Russia"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ..add(​<em class="string">"European Union"</em>​);</td></tr></table><table class="simpletable outerlines"><thead><tr><th class="outerlines" colspan="2"><p class="last-para-in-cell">Set Literals</p></th></tr></thead><tbody><tr class="tr zebra "><td style="valign: middle; width: 12%; ">
               <img alt="images/aside-icons/warning.png" class="" id="d24e43362" src="/images/img83/images/aside-icons/warning.png" style="width: 100%"/>
             </td><td style="valign: middle; width: 88%; ">

  <p>
    Set literals using curly braces are supported starting from Dart version 2.2, in earlier versions the most similar way was to use the <span class="cf methodname">Set.from</span> method, which takes a <span class="cf class">List</span>:
  </p>
<table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ countriesByGDP = ​<strong class="kw">Set</strong>​.from([​<em class="string">"USA"</em>​, ​<em class="string">"PRC"</em>​, ​<em class="comment">/*...*/</em>​]);</td></tr></table>


</td></tr></tbody></table>
<p id="d24e43399">There are many more <span class="cf class">Iterable</span>s. A very common one in computer science is the linked list, which can be implemented using <span class="cf class">LinkedList</span>, but there is also a <span class="cf class">Queue</span> class and the unordered hash table-based alternatives to the <span class="cf class">Map</span> and <span class="cf class">Set</span> called <span class="cf class">HashMap</span> and <span class="cf class">HashSet</span>.

</p><h3>Numbers: The num Type and Its Subclasses</h3>
<p id="d24e43429">






The <span class="cf class">num</span> class is a generic number class, and its subclasses are <span class="cf class">int</span> for integers and <span class="cf class">double</span> for floating-point numbers. There’s no <span class="cf class">float</span> in Dart; floating-point numbers are all 64-bit <span class="cf class">double</span>s.</p>
<p id="d24e43479">


Keeping with the mathematical notation used in the UK and the United States, the decimal separator is a dot (<span class="cf ic">.</span>). You can specify powers of 10 by using <span class="cf ic">e</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ a = 5.2e2;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(a == 520);</td></tr></table>
<p id="d24e43512">


<span class="cf class">double</span> numbers can be rounded using <span class="cf methodname">round</span> (which rounds away from 0 with the decimal part starting from .5), rounded down by using <span class="cf methodname">floor</span> or rounded up using <span class="cf methodname">ceil</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ a = 5.2;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(a.round() == 5);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(a.floor() == 5);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(a.ceil() == 6);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ b = 5.5;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(a.round() == 6);</td></tr></table>
<p id="d24e43582">

An hexadecimal integer is obtained by prefixing it with <span class="cf ic">0x</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(0x7E3 == 2019);</td></tr></table><h4 id="sec.dart.typed">Lists of Bytes and More: the dart:typed_data library</h4>
<p id="d24e43606">



When reading binary data, using a <span class="cf class">List</span> of 64-bit <span class="cf keyword">int</span>s is extremely inefficient if all each of those integers is doing is clearly less than optimally efficient. That’s why the <span class="cf ic">dart:typed_data</span> contains the <span class="cf class">Uint8List</span> class, which works exactly like the regular <span class="cf class">List</span>, but with 8-bit integers.</p><h4>Type Casting</h4>
<p id="d24e43648">
Type casting in Dart is done in one of the following two ways.</p>
<p id="d24e43652">
You can use an <span class="cf ic">as</span> expression to cast a value to one of its subtypes:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">num</strong>​ a = 5;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ a_int = a ​<strong class="kw">as</strong>​ ​<strong class="kw">int</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(a_int ​<strong class="kw">is</strong>​ ​<strong class="kw">int</strong>​);</td></tr></table>
<p id="d24e43690">
or use <span class="cf methodname">cast</span> to cast all values of <span class="cf class">List</span> to a specified type:



</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">List&lt;​<strong class="kw">num</strong>​&gt; l = [1, 2, 3];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">var</strong>​ l_int = l.cast&lt;​<strong class="kw">int</strong>​&gt;();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">assert</strong>​(l_int[0] ​<strong class="kw">is</strong>​ ​<strong class="kw">int</strong>​);</td></tr></table>,<h2 id="d24e47028">Cupertino Widgets</h2>
<p id="d24e47031">

Before we venture out of Flutter Dart code too much, there is one thing you might have noticed in <span class="cf filename">pubspec.yaml</span>: the dependency on <span class="cf ic">cupertino_icons</span>. We have actually never used what is contained in it in the body of the book, because it doesn’t really allow you to do anything you couldn’t do before in Flutter apps: it contains icons to be used by widgets that look like native Apple widgets and can be used instead of the Material Design widgets.

</p>
<p id="d24e47055">This means you have the following two choices regarding the look of your app:</p><ul><li>
<p id="d24e47060">Make your app look the same on Android and iOS by either using the Material widgets or the Cupertino widgets.</p></li><li>
<p id="d24e47063">Make your app look like other apps built for each platform by using Material widgets on Android and Cupertino widgets on iOS.</p></li></ul>
<p id="d24e47065">Obviously you could choose to show your iOS users the Material widgets and the Android users the Cupertino widgets, but that’s probably not the smartest choice for most people.</p><h3>The Counter Increase App with Cupertino Widgets</h3>
<p id="d24e47070">

As a way to get an idea of how to use Cupertino widgets, we’re going to rewrite the counter app that Flutter itself gives as an example of basic Flutter UI that we saw in the first chapter, this time using Cupertino widgets instead of Material widgets.</p><h4>What We’re Going to Build</h4>
<p id="d24e47082">It will look like the following screenshots, keeping in mind that floating action buttons aren’t part of regular Apple Design:</p><div><div><img alt="images/Cupertino/counterapp.png" class="border " id="d24e47085" src="/images/img84/images/Cupertino/counterapp.png" style="width: 38%"/></div></div>
<p id="d24e47087">The alternative would have been to add it to the right of the title in the navigation bar (the Apple app bar), but doing it this way allows us to look at more of the Flutter Cupertino widgets.</p><h4>Importing the Cupertino Library</h4>
<p id="d24e47092">
Let’s start by changing the imports, we only need to import the Cupertino Flutter library, given that we won’t be using any Material widgets:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/cupertino/counter_cupertino/lib/main.dart">cupertino/counter_cupertino/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:flutter/cupertino.dart'</em>​;</td></tr></table><h4>From MaterialApp to CupertinoApp</h4>
<p id="d24e47110">


The <span class="cf class">MaterialApp</span> is the next thing that needs to change, to become a <span class="cf class">CupertinoApp</span>. The name isn’t the only thing that needs to change: the <span class="cf ic">theme</span> needs to be of class <span class="cf class">CupertinoThemeData</span> and not just <span class="cf class">ThemeData</span>. The <span class="cf class">CupertinoThemeData</span> takes a <span class="cf ic">primaryColor</span> instead of a <span class="cf ic">primarySwatch</span>, and it needs to one of the <span class="cf class">CupertinoColors</span>, which aren’t the regular colors you use with Material apps: <span class="cf ic">Colors.blue</span> will become <span class="cf ic">CupertinoColors.activeBlue</span>, which is the default color.</p><p><strong>Material-Based Cupertino Theme Data</strong></p>
<p id="d24e47164">
Given that you’re probably going to build apps for both Android and iOS using both Material and Cupertino widgets, you might want to create one <span class="cf class">ThemeData</span> for the Material Design app and derive the styling of the Cupertino version from that Material Design theme. This can be done using <span class="cf methodname">MaterialBasedCupertinoThemeData(materialTheme: themeData)</span>, which takes as a named argument called <span class="cf ic">materialTheme</span> the <span class="cf class">ThemeData</span> we want to derive the new <span class="cf class">CupertinoThemeData</span> from.</p><p><strong>Our CupertinoApp</strong></p>
<p id="d24e47188">Because of that, the <span class="cf ic">theme</span> argument could be skipped entirely unless you want your app to have a dark background that is supposed to be with an <span class="cf ic">activeOrange</span> primary color. We’re going to stick with a regular light theme with a blue primary color, providing the same arguments that were used in the original Material example to keep the example as close to the original as possible:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/cupertino/counter_cupertino/lib/main.dart">cupertino/counter_cupertino/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyApp ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ CupertinoApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      title: ​<em class="string">'Flutter Demo'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      theme: CupertinoThemeData(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        primaryColor: CupertinoColors.activeBlue,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      home: MyHomePage(title: ​<em class="string">'Flutter Demo Home Page'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h4>Unchanged Widgets</h4>
<p id="d24e47243"><span class="cf class">StatefulWidget</span>s, <span class="cf class">StatelessWidget</span>s and <span class="cf class">State</span>s are all the same as with Material apps, and the same goes for <span class="cf class">Row</span>s, <span class="cf class">Column</span>, <span class="cf class">Container</span>s and <span class="cf class">Center</span> widgets, as well as simple widgets like <span class="cf class">Icon</span>s (even though the <span class="cf class">IconData</span> used for them should be taken from the <span class="cf ic">CupertinoIcons</span> instead of taking it from the <span class="cf ic">Icons</span>) and <span class="cf class">Text</span>.</p><h4>The Scaffold and App Bar</h4>
<p id="d24e47284">


Before getting to them, though, the <span class="cf class">Scaffold</span> needs to switch to a <span class="cf class">CupertinoPageScaffold</span> (there is a <span class="cf class">CupertinoTabScaffold</span> for scaffolds that have bottom navigation, there’s no <span class="cf class">CupertinoScaffold</span>), which (as I anticipated earlier) takes a <span class="cf class">CupertinoNavigationBar</span> as the <span class="cf ic">navigationBar</span> argument instead of taking an <span class="cf class">AppBar</span> as the <span class="cf ic">appBar</span> argument as we did with Material apps. Additionally, the <span class="cf class">CupertinoNavigationBar</span> takes three peculiarly named arguments: <span class="cf ic">leading</span>, <span class="cf ic">middle</span> and <span class="cf ic">trailing</span> for widgets to place in the navigation bar. Usually the left side is reserved for a back button, the right side for an important action and the middle is where we should put the title of the page:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/cupertino/counter_cupertino/lib/main.dart">cupertino/counter_cupertino/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">return</strong>​ ​<strong class="kw">CupertinoPageScaffold</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  navigationBar: CupertinoNavigationBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    middle: Text(widget.title),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr></table><h4>The CupertinoButton</h4>
<p id="d24e47359">
The button to increase the counter will be a - <span class="emph">you guessed it</span> - <span class="cf class">CupertinoButton</span>. It takes a <span class="cf ic">child</span> widget for which we can use a simple <span class="cf class">Row</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/cupertino/counter_cupertino/lib/main.dart">cupertino/counter_cupertino/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">CupertinoButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  onPressed: _incrementCounter,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    mainAxisAlignment: MainAxisAlignment.center,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    children: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Icon(CupertinoIcons.add_circled_solid),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Text(​<em class="string">"Increase"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e47408"><span class="cf ic">CupertinoIcons.add</span> is the <span class="cf ic">+</span> icon that should be used when it appears alone, <span class="cf ic">CupertinoIcons.add_circled</span> has a circle around it and <span class="cf ic">CupertinoIcons.circled_solid</span> is what’s in the screenshot you saw earlier.</p><h4>Wrapping Up</h4>
<p id="d24e47424">The full code, including the things that are the same as the app we saw in the first chapter, is the following:

</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/cupertino/counter_cupertino/lib/main.dart">cupertino/counter_cupertino/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:flutter/cupertino.dart'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">main</strong>​() =&gt; runApp(MyApp());</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyApp ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ CupertinoApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      title: ​<em class="string">'Flutter Demo'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      theme: CupertinoThemeData(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        primaryColor: CupertinoColors.activeBlue,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      home: MyHomePage(title: ​<em class="string">'Flutter Demo Home Page'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyHomePage ​<strong class="kw">extends</strong>​ StatefulWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  MyHomePage({Key key, ​<strong class="kw">this</strong>​.title}) : ​<strong class="kw">super</strong>​(key: key);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ title;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  _MyHomePageState createState() =&gt; _MyHomePageState();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ _MyHomePageState ​<strong class="kw">extends</strong>​ State&lt;MyHomePage&gt; {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">int</strong>​ _counter = 0;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ _incrementCounter() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      _counter++;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ CupertinoPageScaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      navigationBar: CupertinoNavigationBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        middle: Text(widget.title),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          crossAxisAlignment: CrossAxisAlignment.center,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          mainAxisAlignment: MainAxisAlignment.center,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          children: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ​<em class="string">'You have pushed the button this many times:'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ​<em class="string">'</em>​​<em class="string">$_counter</em>​​<em class="string">'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              style: CupertinoTheme.of(context).textTheme.navLargeTitleTextStyle,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            CupertinoButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              onPressed: _incrementCounter,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              child: Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                mainAxisAlignment: MainAxisAlignment.center,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                children: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  Icon(CupertinoIcons.add_circled_solid),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  Text(​<em class="string">"Increase"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3>Other Cupertino Widgets</h3>
<p id="d24e47672">This is meant to be just a quick introduction to how to build iOS-style UIs and is meant as a starting platform, not as a comprehensive guide, so we will only be talking about the most important Cupertino widgets. You can find more of them in detail in a dedicated section of Flutter’s official website.<sup><a class="footnote" href="/links/f_0098/f_0098.xhtml#FOOTNOTE-56" id="FNPTR-56">[56]</a></sup></p><h4>Cupertino Navigation</h4>
<p id="d24e47681">

Before talking about some of the UI elements that need to be converted to Cupertino widgets, we’ll see how to implement navigation using Cupertino widgets. There are a few differences between Material Design and iOS layouts that need to be clarified: the drawer side navigation menu is a typical Material Design element, so it doesn’t have a Cupertino equivalent and navigation is handled using either a bottom tab bar or simple push/pop navigation.</p><p><strong>Tab-Based Navigation Using the CupertinoTabScaffold</strong></p>
<p id="d24e47695">
Let’s talk about something we briefly mentioned in the previous section: the <span class="cf class">CupertinoTabScaffold</span>. This widget isn’t actually necessary to have tab-based navigation (since the<span class="cf class">CupertinoTabBar</span> can be used to call <span class="cf methodname">setState</span> and render different data based on the selected tab), but it makes it very easy.</p>
<p id="d24e47710">It takes two arguments:</p><ul><li>
<p id="d24e47714">The <span class="cf ic">tabBar</span>, which has to be set to a <span class="cf class">CupertinoTabBar</span> with the needed <span class="cf ic">items</span> list of <span class="cf class">BottomNavigationBarItem</span>s.</p></li><li>
<p id="d24e47729">The <span class="cf ic">tabBuilder</span> which, given the <span class="cf ic">context</span> and the <span class="cf ic">int</span> index, has to return the content of the tab corresponding to that index, usually returning a <span class="cf class">CupertinoTabView</span> that gives each tab its own navigation history and state, containing a <span class="cf class">CupertinoPageScaffold</span> for the content of the tab.</p></li></ul>
<p id="d24e47746">An example of how to do that is the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ HomePage ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ data = [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="string">"Train"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      CupertinoIcons.train_style_one</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    },</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="string">"Search"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      CupertinoIcons.search</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    },</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="string">"Share"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      CupertinoIcons.share</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    CupertinoTabScaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      tabBar: CupertinoTabBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        items: data.map(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          (el) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            BottomNavigationBarItem(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              title: Text(el.first),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              icon: Icon(el.last)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ).toList(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      tabBuilder: (context, i) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        CupertinoTabView(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          builder: (context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            CupertinoPageScaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              navigationBar: CupertinoNavigationBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                middle: Text(data[i].first),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              child: Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                child: Icon(data[i].last, size: 80.0)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e47878">which produces the following view when opened:</p><div class="ss"><img alt="images/Cupertino/tabnav1.png" class="border " id="d24e47880" src="/images/img85/images/Cupertino/tabnav1.png" style="width: 37%"/></div>
<p id="d24e47881">and it gives us a chance to notice the iOS Share icon, which is very different from the Material Share icon, when tapping on the third tab:
</p><div class="ss"><img alt="images/Cupertino/tabnav2.png" class="border " id="d24e47884" src="/images/img86/images/Cupertino/tabnav2.png" style="width: 37%"/></div><p><strong>Push/Pop Navigation with the CupertinoPageRoute</strong></p>
<p id="d24e47888">

The <span class="cf class">Navigator</span> itself works just like in Material apps, but we need to replace the <span class="cf class">MaterialPageRoute</span> with the <span class="cf class">CupertinoPageRoute</span>, but not necessarily. The <span class="cf class">MaterialPageRoute</span> actually adapts to the native animations typically used for transitioning between pages (vertical on Android, horizontal on iOS), but it is contained in <span class="cf ic">material.dart</span>. In case you want to use the iOS animation (<span class="cf class">CupertinoPageTransition</span>) on Android or you don’t want to use widgets from <span class="cf ic">material.dart</span> because the current file only imports <span class="cf ic">cupertino.dart</span>, you can use the <span class="cf class">CupertinoPageRoute</span> just like you use the <span class="cf class">MaterialPageRoute</span>, by passing it to <span class="cf methodname">Navigator.push</span> or similar methods, passing to the <span class="cf class">CupertinoPageRoute</span> constructor the usual <span class="cf ic">context</span> and a <span class="cf ic">builder</span> callback.</p>
<p id="d24e47943">After pushing a page, the <span class="cf ic">leading</span> widget of the navigation bar (if present) will be a button that allows the user to go back to the previous page.

</p><div class="ss"><img alt="images/Cupertino/backbutton.png" class="border " id="d24e47951" src="/images/img87/images/Cupertino/backbutton.png" style="width: 30%"/></div><h4>Replacement for Some UI Elements</h4>
<p id="d24e47955">

There are a few UI elements that are worthy or being discussed as replacements for Material widgets we’ve seen during the course of this book.</p><p><strong>CupertinoTextField</strong></p>
<p id="d24e47967">
One of the widgets that needs to be changed is the <span class="cf class">TextField</span>, and it doesn’t only require a name change, unlike some other Cupertino widgets: the <span class="cf class">CupertinoTextField</span>’s <span class="cf ic">decoration</span> is of type <span class="cf class">BoxDecoration</span>  (the same we used with the <span class="cf class">Container</span>) and not <span class="cf class">InputDecoration</span>. The <span class="cf class">InputDecoration</span> is what we used to provide a <span class="cf ic">labelText</span>, which now is an argument of the <span class="cf class">CupertinoTextField</span> itself called <span class="cf ic">placeholder</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">TextField(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  controller: _controller,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  decoration: InputDecoration(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    labelText: ​<em class="string">"Description"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  onSubmitted: (val) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// do something with value</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e48029">will become:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">CupertinoTextField(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  controller: _controller,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  placeholder: ​<em class="string">"Description"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  onSubmitted: (val) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// do something with value</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table><p><strong>CupertinoActivityIndicator</strong></p>
<p id="d24e48054">
The replacement for the <span class="cf class">CircularProgressIndicator</span> is the <span class="cf class">CupertinoActivityIndicator</span>, which looks like this:</p><div class="ss"><img alt="images/Cupertino/activityindicator.png" class="border " id="d24e48066" src="/images/img88/images/Cupertino/activityindicator.png" style="width: 30%"/></div><p><strong>CupertinoAlertDialog</strong></p>
<p id="d24e48070">
The Cupertino library provides the <span class="cf class">CupertinoAlertDialog</span> to be launched with <span class="cf methodname">showCupertinoDialog</span> as a replacement for the Material <span class="cf class">AlertDialog</span> that is launched using <span class="cf methodname">showDialog</span>.</p>
<p id="d24e48088">The <span class="cf class">CupertinoAlertDialog</span> takes three arguments: the <span class="cf ic">title</span> widget (presumably some <span class="cf class">Text</span>, the <span class="cf ic">content</span> widget and a list of widgets (presumably buttons) called <span class="cf ic">actions</span> to show at the bottom of the dialog:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">CupertinoAlertDialog(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  title: Text(​<em class="string">"Dialog title"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  content: Text(​<em class="string">"Content of the dialog, usually longer than the title"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  actions: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    CupertinoButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Text(​<em class="string">"Action 1"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      onPressed: () {}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    CupertinoButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Text(​<em class="string">"Action 2"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      onPressed: () {}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e48148">It will look like this when launched with <span class="cf methodname">showCupertinoDialog(context: context, builder: (_) =&gt; CupertinoAlertDialog(...))</span>:

</p><div class="ss"><img alt="images/Cupertino/dialog.png" class="" id="d24e48156" src="/images/img89/images/Cupertino/dialog.png" style="width: 42%"/></div><h3>Automatically Switching Between Cupertino and Material</h3>
<p id="d24e48160">


If we want our app to be able to change what it displays based on what OS it runs on, we need to be able to know what platform we’re running on from the Dart code. This is possible thanks to the <span class="cf class">Platform</span> class in the <span class="cf ic">dart:io</span> library, which can be used in the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">if</strong>​(Platform.isIOS) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// render Cupertino widgets</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">} ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// render Material widgets</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e48206">It also provides <span class="cf ic">Platform.isAndroid</span>, <span class="cf ic">Platform.isFuchsia</span>, <span class="cf ic">Platform.isMacOS</span>, <span class="cf ic">Platform.isWindows</span> and <span class="cf ic">Platform.isLinux</span>, but you probably won’t need the latter three given that at the time of writing Flutter on the desktop won’t work for most apps.</p>
<p id="d24e48223">The easiest way to take advantage of that is to have different UI trees for different platforms, but it isn’t really the most elegant solution. That’s why many Flutter developers choose to implement generic classes that have factory methods to render different widgets for different platforms.</p><h4>The Flutter Platform Widgets Package</h4>
<p id="d24e48228">
The implementation of that, though, can be repetitive and it is suited to the creation of a library, which does indeed exist: the <span class="cf ic">flutter_platform_widgets</span> package. This package provides classes like <span class="cf class">PlatformApp</span>, <span class="cf class">PlatformScaffold</span>, <span class="cf class">PlatformAppBar</span>, <span class="cf class">PlatformButton</span> and <span class="cf class">PlatformPageRoute</span> (full list and usage available on the package’s API reference<sup><a class="footnote" href="/links/f_0098/f_0098.xhtml#FOOTNOTE-57" id="FNPTR-57">[57]</a></sup>) that will automatically use the Material or Cupertino equivalents on each platform.</p>
<p id="d24e48258">
It also provides a generic <span class="cf class">PlatformWidget</span> that takes an <span class="cf ic">ios</span> and an <span class="cf ic">android</span> argument that you can use for widgets not provided by the library with a dedicated class or if the choice of widgets made by the authors of the library isn’t what you want or need for your app.




</p>,<h2 id="d24e2792">Give the App Your Personal Touch</h2>
<p id="d24e2795">Now let’s modify what we’ve seen. We’ll change the app color to be green, add a red reset button to reset the counter to 0, make the app display the string “None” instead of the counter when the counter is at 0 and change the <span class="cf ic">appBar</span>’s title text. In doing this, we’ll get a feel for how to make simple changes, and also an introduction to more complex Flutter syntax.</p>
<p id="d24e2800">The result will look like this:</p><table class="simpletable "><tbody><tr class="tr "><td style="width: 50%; ">
      <img alt="images/FirstApp/None.png" class="border " id="d24e2808" src="/images/img9/images/FirstApp/None.png" style="width: 70%"/>
    </td><td style="width: 50%; ">
      <img alt="images/FirstApp/15scaled.png" class="border " id="d24e2812" src="/images/img10/images/FirstApp/15scaled.png" style="width: 70%"/>
    </td></tr></tbody></table><h3>Change the App’s Primary Color</h3>
<p id="d24e2818">


We’ll start editing our app with the simplest change:  changing the color to green. This is as simple as changing the following few lines in <span class="cf class">MyApp</span>’s <span class="cf ic">build</span> method:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp_starting/lib/main.dart">firstapp_starting/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">theme: ThemeData(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  primarySwatch: Colors.blue,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e2853">Go ahead and change <span class="cf ic">Colors.blue</span> to <span class="cf ic">Colors.green</span> so that those lines instead read as follows:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp/lib/main.dart">firstapp/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">theme: ThemeData(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  primarySwatch: Colors.green,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table><h3>Make the Counter Display “None” Instead of 0</h3>
<p id="d24e2875">

Now, let’s change the counter text in the middle so that it displays “None” instead of 0.</p>
<p id="d24e2886">To do this, we’ll add a <span class="cf ic">_displayedString</span> variable to <span class="cf class">_MyHomePageState</span>, below the counter’s declaration.</p>
<p id="d24e2894">Locate the following line:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">int</strong>​ _counter = 0;</td></tr></table>
<p id="d24e2902">and, below it, add:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ _displayedString;</td></tr></table>
<p id="d24e2910">After we’ve done that, we need to set this variable to “None” if the counter is 0 and to a string representation of the counter if that isn’t the case. We’re going to need a conditional.</p><h4>Use Conditionals in Flutter</h4>
<p id="d24e2915">
To do this every time the counter is increased (which we do using a call to <span class="cf ic">setState</span> that triggers a re-render that calls the <span class="cf ic">build</span> method), this needs to be part of <span class="cf class">_MyHomePageState</span>’s <span class="cf ic">build</span> method. So, just above:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">return</strong>​ ​<strong class="kw">new</strong>​ ​<strong class="kw">Scaffold</strong>​(</td></tr></table>
<p id="d24e2943">add:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp/lib/main.dart">firstapp/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">if</strong>​(_counter == 0) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  _displayedString = ​<em class="string">"None"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">} ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  _displayedString = _counter.toString();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e2968">

This is a simple <span class="cf ic">if-else</span> construct and, like in many other languages, it could also be expressed in a braceless way as:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">if</strong>​(_counter == 0) _displayedString = ​<em class="string">"None"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">else</strong>​              _displayedString = _counter.toString();</td></tr></table>
<p id="d24e2999">or, with a conditional expression, as:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">_displayedString = _counter == 0 ? ​<em class="string">"None"</em>​ : ​<em class="string">'</em>​​<em class="string">$_counter</em>​​<em class="string">'</em>​;</td></tr></table>
<p id="d24e3016">You can find more information about conditional constructs and expressions in <a href="/links/f_0088/f_0088.xhtml#sec.dart.conditionals">​<em>Conditional Constructs and Expressions</em>​</a>.</p><h3>Set the Counter Text</h3>
<p id="d24e3023">Now we need to replace the counter with the string we’ve just generated.</p><h4>Use String Literals in Dart</h4>
<p id="d24e3028">
At the moment, the code we’re using to generate the <span class="cf class">Text</span> widget for the counter looks like this:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp_starting/lib/main.dart">firstapp_starting/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">'</em>​​<em class="string">$_counter</em>​​<em class="string">'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  style: Theme.of(context).textTheme.display1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e3061">You might have noticed the syntax currently used to display the counter to the user:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">'</em>​​<em class="string">$_counter</em>​​<em class="string">'</em>​</td></tr></table>
<p id="d24e3072">

The single quotes (unlike in C, C++, and Java, single and double quotes are the same in Dart)  enclose a string literal, and inside this string literal is a variable name (<span class="cf ic">_counter</span>) preceded by a dollar sign.
</p><h4>Use String Interpolation</h4>
<p id="d24e3090">
In this case, this is an alternative to the syntax we used earlier to convert an integer to a string (<span class="cf ic">_counter.toString()</span>).</p>
<p id="d24e3097">

This is how string literals work in Dart: they are enclosed in single or double quotes. And we can include variables in string literals by preceding the variable name with a dollar sign.</p>
<p id="d24e3108">

If we need to use string interpolation with an expression or dot notation (for example, to use member variables of objects or display results of expressions), we need to enclose the variable name in braces. We’ll need to do this shortly  for the app title.</p>
<p id="d24e3119">You can find more information about string literals and string interpolation in <a href="/links/f_0084/f_0084.xhtml#sec.dart.strings">​<em>Characters and Strings</em>​</a>.</p>
<p id="d24e3123">Back to our example. Since we now want to display a string, we can replace:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">'</em>​​<em class="string">$_counter</em>​​<em class="string">'</em>​</td></tr></table>
<p id="d24e3134">to be just:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">displayedString</td></tr></table>
<p id="d24e3141">since we don’t need to use string literals.
</p><h3>Change the App’s Title</h3>
<p id="d24e3147">

To change the appBar’s title to “An app that can count to <span class="cf ic">[0, 1, 2, 3…]</span>”  we need to use string interpolation.</p>
<p id="d24e3161">We will use a fixed string defined in the app’s constructor and a variable part, which will be created inside the build method.</p>
<p id="d24e3163">The fixed part is the title we give to <span class="cf class">MyHomePage</span>’s constructor (and which then becomes <span class="cf ic">widget.title</span>), which will be “An app that can count to”:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp_starting/lib/main.dart">firstapp_starting/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  home: MyHomePage(title: ​<em class="string">'Flutter Demo Home Page'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">);</td></tr></table>
<p id="d24e3180">will have to become:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp/lib/main.dart">firstapp/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  home: MyHomePage(title: ​<em class="string">'An app that can count to'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">);</td></tr></table>
<p id="d24e3191">Now we need to edit <span class="cf class">_MyHomePageState</span>’s <span class="cf ic">build</span> method again, since that’s what gets called every time the app’s state changes, and that’s where the variable part of the string will have to be generated.</p>
<p id="d24e3199">To do what I just described, locate the following lines:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp_starting/lib/main.dart">firstapp_starting/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  title: Text(widget.title),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e3213">and change:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">widget.title</td></tr></table>
<p id="d24e3221">to:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">'</em>​​<em class="string">${widget.title}</em>​​<em class="string"> </em>​​<em class="string">$_counter</em>​​<em class="string">'</em>​</td></tr></table>
<p id="d24e3236">so that those lines now instead read as follows:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp/lib/main.dart">firstapp/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  title: Text(​<em class="string">'</em>​​<em class="string">${widget.title}</em>​​<em class="string"> </em>​​<em class="string">$_counter</em>​​<em class="string">'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e3258">As you can see, we’ve done the opposite of what we did to the counter, and we had to use braces for <span class="cf ic">widget.title</span> because dot notation was needed to access a member variable.
</p><h3>Add a Reset Button</h3>
<p id="d24e3267">The last thing we need to do to get to the app in the screenshots shown earlier is to add the reset button.</p>
<p id="d24e3269">
Before we add the button itself, let’s define a simple method that changes the state and resets the counter to 0.</p><h4>Use <span class="cf ic">setState()</span> to Reset the Counter</h4>
<p id="d24e3279">
Inside <span class="cf ic">_MyHomePageState</span>’s definition, below <span class="cf ic">_incrementCounter()</span>’s definition, add the following code:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp/lib/main.dart">firstapp/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">_resetCounter</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    _counter = 0;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e3308">This is very similar to <span class="cf ic">_incrementCounter()</span> but, instead of incrementing the counter, we set it to 0.</p><h4>Make the Reset Button</h4>
<p id="d24e3316">Now that we’ve defined a method that resets the counter and triggers a re-render, we need to create a button to call that function. So before we do that, we need to know how we do that with Flutter.</p><p><strong>Buttons in Flutter: The FlatButton and the IconButton</strong></p>
<p id="d24e3321">


If we want to quickly create a button in Flutter we can choose between a <span class="cf class">FlatButton</span> or an <span class="cf class">IconButton</span>.</p>
<p id="d24e3343">The <span class="cf class">FlatButton</span> is ideal when you want a button that displays text: it has a <span class="cf ic">child</span> attribute that is usually a <span class="cf class">Text</span> widget, but you have the option to set it to anything.</p>
<p id="d24e3354">The reason why the <span class="cf class">FlatButton</span> is used mostly for text buttons is that using an <span class="cf class">IconButton</span> exists specifically for the creation of icon-based buttons, by allowing the developer to specify an <span class="cf class">Icon</span> object as its <span class="cf ic">icon</span> attribute, with the button only consisting of the icon and a small amount of padding.</p>
<p id="d24e3368">One of the attributes that show the difference in focus is that the <span class="cf class">FlatButton</span>’s <span class="cf ic">color</span> attribute controls the color of the button itself (the background to its content), whereas the <span class="cf class">IconButton</span>’s <span class="cf ic">color</span> attribute control’s the icon’s color.</p>
<p id="d24e3382">
A <span class="cf class">RaisedButton</span> also exists, but it is just a slightly different looking <span class="cf class">FlatButton</span>.</p><p><strong>Implement the Reset Button</strong></p>
<p id="d24e3397">
For this example we’ll make a <span class="cf class">FlatButton</span>.</p>
<p id="d24e3406">To add the button, locate the following lines in <span class="cf class">_MyHomePageState</span>’s <span class="cf ic">build</span> method:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp_starting/lib/main.dart">firstapp_starting/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">'You have pushed the button this many times:'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">'</em>​​<em class="string">$_counter</em>​​<em class="string">'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    style: Theme.of(context).textTheme.display1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">],</td></tr></table>
<p id="d24e3453">and add, inside the square brackets, the following to the list of widgets:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp/lib/main.dart">firstapp/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  onPressed: _resetCounter,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  color: Colors.red,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"Reset counter"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    style: Theme.of(context).textTheme.button,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e3488">First of all, the action we want to perform is to fire the <span class="cf ic">_resetCounter</span> function, so we set that as the <span class="cf ic">onPressed</span> attribute.</p>
<p id="d24e3496">The <span class="cf class">FlatButton</span>’s <span class="cf ic">color</span> attribute should not be confused with the CSS attribute that goes by the same name: as I described earlier, it changes the button’s background color, not the text color, which we’ll leave black.</p>
<p id="d24e3504">The <span class="cf ic">child</span> attribute is just a text string with the built-in button text theme.</p>
<p id="d24e3510">The final code is:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp_oldfab/lib/main.dart">firstapp_oldfab/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:flutter/material.dart'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">main</strong>​() =&gt; runApp(MyApp());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyApp ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">return</strong>​ MaterialApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     title: ​<em class="string">'Flutter Demo'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     theme: ThemeData(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       primarySwatch: Colors.green,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     home: MyHomePage(title: ​<em class="string">'An app that can count to'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyHomePage ​<strong class="kw">extends</strong>​ StatefulWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> MyHomePage({Key key, ​<strong class="kw">this</strong>​.title}) : ​<strong class="kw">super</strong>​(key: key);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ title;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> _MyHomePageState createState() =&gt; _MyHomePageState();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ _MyHomePageState ​<strong class="kw">extends</strong>​ State&lt;MyHomePage&gt; {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">int</strong>​ _counter = 0;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">String</strong>​ _displayedString;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">void</strong>​ _incrementCounter() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     _counter++;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">void</strong>​ _resetCounter() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     _counter = 0;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">if</strong>​(_counter == 0) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     _displayedString = ​<em class="string">"None"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   } ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     _displayedString = _counter.toString();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       title: Text(​<em class="string">'</em>​​<em class="string">${widget.title}</em>​​<em class="string"> </em>​​<em class="string">$_counter</em>​​<em class="string">'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     body: Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         mainAxisAlignment: MainAxisAlignment.center,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             ​<em class="string">'You have pushed the button this many times:'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             _displayedString,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             style: Theme.of(context).textTheme.display1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             onPressed: _resetCounter,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             color: Colors.red,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">               ​<em class="string">"Reset counter"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">               style: Theme.of(context).textTheme.button,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     floatingActionButton: FloatingActionButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       onPressed: _incrementCounter,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       tooltip: ​<em class="string">'Increment'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       child: Icon(Icons.add),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e3802">Now, build and run or reload the app and the result will be the same as the screenshots we saw earlier.

</p><h3>Make a Custom Widget: Our Own Button</h3>
<p id="d24e3811">

That <span class="cf class">FloatingActionButton</span> is a default button class and it looks like a default button: it is the same as the one used in various other apps and you’ve probably seen it many times before.</p>
<p id="d24e3825">What if, instead of using that default-looking button, we wanted to use a custom-made button to make it look exactly like we want?</p><h4>The Button We’ll Create</h4>
<p id="d24e3830">Let’s say we want to make a text button with rounded corners and a nice ink splash effect when we tap it, like the one in these pictures:</p><div class="ss"><img alt="images/FirstApp/btn1.png" class="border " id="d24e3832" src="/images/img11/images/FirstApp/btn1.png" style="width: 38%"/></div><div class="ss"><img alt="images/FirstApp/btn3.png" class="border " id="d24e3833" src="/images/img12/images/FirstApp/btn3.png" style="width: 38%"/></div><div class="ss"><img alt="images/FirstApp/btn2.png" class="border " id="d24e3834" src="/images/img13/images/FirstApp/btn2.png" style="width: 38%"/></div><h4>Split Dart Code into Separate Files</h4>
<p id="d24e3838">
First, let’s create a new Dart file called <span class="cf filename">OurButton.dart</span> inside the <span class="cf dir">lib</span> directory and define our own <span class="cf class">StatelessWidget</span> called <span class="cf class">OurButton</span>, which will be a custom <span class="cf class">RawMaterialButton</span>.
In the new file, we’ll import the basic Flutter API we need and define our class:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:flutter/material.dart'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ OurButton ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h4>Define a Custom Widget</h4>
<p id="d24e3888">


Now, inside <span class="cf class">OurButton</span>’s curly braces, we’ll define the constructor arguments and we’ll set them as “required”, since we need all of them and we will be setting all of them in our code:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp/lib/OurButton.dart">firstapp/lib/OurButton.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">OurButton({</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Key key,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @required ​<strong class="kw">this</strong>​.text,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @required ​<strong class="kw">this</strong>​.textColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @required ​<strong class="kw">this</strong>​.backgroundColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @required ​<strong class="kw">this</strong>​.splashColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @required ​<strong class="kw">this</strong>​.onPressed</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}) : ​<strong class="kw">super</strong>​(key: key);</td></tr></table>
<p id="d24e3955">For each of these arguments we need a variable to store them, like we do in the following lines:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp/lib/OurButton.dart">firstapp/lib/OurButton.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ text;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">final</strong>​ Color textColor, backgroundColor, splashColor;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">final</strong>​ VoidCallback onPressed;</td></tr></table>
<p id="d24e3974">Now, like for all widgets, we need a build method which, in this case, will be:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp/lib/OurButton.dart">firstapp/lib/OurButton.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ RawMaterialButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    onPressed: onPressed,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    fillColor: backgroundColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    splashColor: splashColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    padding: ButtonTheme.of(context).padding,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      text,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      style: TextStyle(color: textColor),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    shape: StadiumBorder(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e4019">
The button we’re making is a <span class="cf class">RawMaterialButton</span>, which is a bare-bones button class that allows us to customize much more of its appearance than a simpler <span class="cf class">FlatButton</span>.</p>
<p id="d24e4032">More specifically, the arguments we’re passing to its constructor are:</p><ul><li>
<p id="d24e4036"><span class="cf ic">onPressed</span>, which is the same as the other <span class="cf ic">onPressed</span> attributes we’ve seen, and we assign <span class="cf class">OurButton</span>’s <span class="cf ic">onPressed</span> attribute to it.</p></li><li>
<p id="d24e4050"><span class="cf ic">fillColor</span>, which is the same as the <span class="cf ic">color</span> attribute we saw used for the <span class="cf class">FlatButton</span> earlier in the chapter: it’s the button’s background color, which will be set to <span class="cf class">OurButton</span>’s <span class="cf ic">backgroundColor</span> attribute, to show how our custom button’s attribute names can be different when compared to those of the widget we are basing it on.</p></li><li>
<p id="d24e4067"><span class="cf ic">splashColor</span> is the color used for the inksplash effect and we use the <span class="cf ic">padding</span> argument to give a normal (default) amount of padding to our button.</p></li><li>
<p id="d24e4075"><span class="cf ic">child</span> is simply a <span class="cf class">Text</span>, using the color specified in <span class="cf class">OurButton</span>’s arguments as the text color.</p></li><li>
<p id="d24e4086"><span class="cf ic">shape</span> is the button’s shape, and we’re using a <span class="cf class">StadiumBorder()</span> to give our button the rounded corners we wanted.</p></li></ul>
<p id="d24e4093">The entire <span class="cf filename">OurButton.dart</span> source code is:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp/lib/OurButton.dart">firstapp/lib/OurButton.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:flutter/material.dart'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ OurButton ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> OurButton({</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   Key key,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   @required ​<strong class="kw">this</strong>​.text,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   @required ​<strong class="kw">this</strong>​.textColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   @required ​<strong class="kw">this</strong>​.backgroundColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   @required ​<strong class="kw">this</strong>​.splashColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   @required ​<strong class="kw">this</strong>​.onPressed</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }) : ​<strong class="kw">super</strong>​(key: key);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ text;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">final</strong>​ Color textColor, backgroundColor, splashColor;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">final</strong>​ VoidCallback onPressed;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">return</strong>​ RawMaterialButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     onPressed: onPressed,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     fillColor: backgroundColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     splashColor: splashColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     padding: ButtonTheme.of(context).padding,</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       text,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       style: TextStyle(color: textColor),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     shape: StadiumBorder(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3>Use the Custom Button in Our App</h3>
<p id="d24e4228">

To use our custom button in the <span class="cf filename">main.dart</span> file we need to import the file we just created by inserting, at the top of the file, the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'OurButton.dart'</em>​;</td></tr></table>
<p id="d24e4251">and, in <span class="cf class">_MyHomePageState</span>’s build method, replace:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp_starting/lib/main.dart">firstapp_starting/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">floatingActionButton: FloatingActionButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  onPressed: _incrementCounter,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  tooltip: ​<em class="string">'Increment'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: Icon(Icons.add),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e4274">with:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp/lib/main.dart">firstapp/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">floatingActionButton: OurButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  text: ​<em class="string">'Make the counter </em>​​<em class="string">${_counter+1}</em>​​<em class="string">'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  textColor: Colors.white,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  backgroundColor: Theme.of(context).primaryColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  splashColor: Theme.of(context).primaryColorLight,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  onPressed: _incrementCounter,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e4314">Among the arguments we’re passing there is a string with the expression <span class="cf ic">_counter+1</span>, which requires curly braces around it.</p>
<p id="d24e4320">After that, we’re done!</p>
<p id="d24e4322">The full <span class="cf filename">main.dart</span> source code is:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firstapp/lib/main.dart">firstapp/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:flutter/material.dart'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'OurButton.dart'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">main</strong>​() =&gt; runApp(MyApp());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyApp ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> @override</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">return</strong>​ MaterialApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     title: ​<em class="string">'Flutter Demo'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     theme: ThemeData(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       primarySwatch: Colors.green,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     home: MyHomePage(title: ​<em class="string">'An app that can count to'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MyHomePage ​<strong class="kw">extends</strong>​ StatefulWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> MyHomePage({Key key, ​<strong class="kw">this</strong>​.title}) : ​<strong class="kw">super</strong>​(key: key);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ title;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> _MyHomePageState createState() =&gt; _MyHomePageState();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ _MyHomePageState ​<strong class="kw">extends</strong>​ State&lt;MyHomePage&gt; {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">int</strong>​ _counter = 0;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">String</strong>​ _displayedString;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">void</strong>​ _incrementCounter() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     _counter++;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">void</strong>​ _resetCounter() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     _counter = 0;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">if</strong>​(_counter == 0) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     _displayedString = ​<em class="string">"None"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   } ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     _displayedString = _counter.toString();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       title: Text(​<em class="string">'</em>​​<em class="string">${widget.title}</em>​​<em class="string"> </em>​​<em class="string">$_counter</em>​​<em class="string">'</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     body: Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         mainAxisAlignment: MainAxisAlignment.center,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             ​<em class="string">'You have pushed the button this many times:'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           ),</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             _displayedString,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             style: Theme.of(context).textTheme.display1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             onPressed: _resetCounter,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             color: Colors.red,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">               ​<em class="string">"Reset counter"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">               style: Theme.of(context).textTheme.button,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     floatingActionButton: OurButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       text: ​<em class="string">'Make the counter </em>​​<em class="string">${_counter+1}</em>​​<em class="string">'</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       textColor: Colors.white,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       backgroundColor: Theme.of(context).primaryColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       splashColor: Theme.of(context).primaryColorLight,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       onPressed: _incrementCounter,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>,<h2 id="d24e6318">Vertical Layout</h2>
<p id="d24e6321">There are two options available when the developer needs to lay out items vertically, depending on what is needed: the <span class="cf ic">Column</span> and the <span class="cf ic">ListView</span>.</p><h3 id="sec.layout.column">The Column</h3>
<p id="d24e6332">

The <span class="cf ic">Column</span> is used to create a vertical stack of widgets, and it is not scrollable.
It is used to display items next to each other vertically and not to create a list of items.</p><h4>How You Use It</h4>
<p id="d24e6351">You can make a simple <span class="cf ic">Column</span> this way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// Widgets separated by commas</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table><h4 id="sec.layout.options">Layout Widget Options</h4>
<p id="d24e6373">
You just need to put the widgets inside the square brackets of the <span class="cf ic">Widget</span> collection literal (more on collection literals and lists in <a href="/links/f_0084/f_0084.xhtml#sec.dart.lists">​<em>Lists and collection literals</em>​</a>) and the widgets will be shown in a vertical stack, but there are a lot of options to customize in the constructor’s arguments, like the <span class="cf ic">mainAxisAlignment</span>, which sets how the children widgets should be aligned along the main axis (in the case of a <span class="cf ic">Column</span> it is the vertical axis), and can be one of:</p><ul><li>
<p id="d24e6394"><span class="cf ic">MainAxisAlignment.start</span>, <span class="cf ic">MainAxisAlignment.center</span>, or <span class="cf ic">MainAxisAlignment.end</span>, which will place the widgets as close as possible, respectively, to the start, middle, or end of the main axis.</p></li><li>
<p id="d24e6405"><span class="cf ic">MainAxisAlignment.spaceAround</span>, which uses half of the available space to separate the children from each other and the other half of it to separate the first and last of them from the start and end of the Column.</p></li><li>
<p id="d24e6410"><span class="cf ic">MainAxisAlignment.spaceBetween</span>, which uses the space to make the children as far as possible to each other.</p></li><li>
<p id="d24e6415"><span class="cf ic">MainAxisAlignment.spaceEvenly</span>, which separates each child from the next as much as the start of the <span class="cf ic">Column</span> to the first and the last to the end of the ‘Column.</p></li></ul>
<p id="d24e6422">Closely related is the <span class="cf ic">mainAxisSize</span>, which can be either <span class="cf ic">MainAxisSize.max</span> or <span class="cf ic">MainAxisSize.min</span>.</p>
<p id="d24e6433">There is also <span class="cf ic">crossAxisAlignment</span>, which sets how the children widgets should be aligned along the cross axis (in the case of a <span class="cf ic">Column</span> it is the horizontal axis) and can be one of the following:</p><ul><li>
<p id="d24e6443">The default <span class="cf ic">CrossAxisAlignment.center</span>, which aligns the widgets so that their center is aligned.</p></li><li>
<p id="d24e6449"><span class="cf ic">CrossAxisAlignment.start</span> and <span class="cf ic">CrossAxisAlignment.end</span> which, respectively, align the widgets to the start or the end of the cross axis.</p></li><li>
<p id="d24e6457"><span class="cf ic">CrossAxisAlignment.stretch</span>, which makes the widgets occupy as much space as possible in the cross axis.</p></li><li>
<p id="d24e6462"><span class="cf ic">CrossAxisAlignment.baseline</span>, especially useful with <span class="cf ic">Row</span>’s, which aligns the children’s baseline.</p></li></ul><h4>What You Use It For</h4>
<p id="d24e6472">You can use a <span class="cf ic">Column</span> simply, like in the previous chapter, to show two widgets one on top of the other, like this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  appBar: AppBar(...),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  body: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    crossAxisAlignment: CrossAxisAlignment.start,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    mainAxisAlignment: MainAxisAlignment.spaceBetween,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Icon(Icons.arrow_upward),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Text(​<em class="string">"This will be in the middle"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Text(​<em class="string">"This will be at the bottom"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table><div class="ss"><img alt="images/WidgetLayout/column.png" class="border " id="d24e6519" src="/images/img21/images/WidgetLayout/column.png" style="width: 38%"/></div>
<p id="d24e6520">but you will probably want to use it more often to group together widgets, perhaps forming a new and more complex widget:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ TwoTexts ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  TwoTexts({​<strong class="kw">this</strong>​.firstText, ​<strong class="kw">this</strong>​.secondText});</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ firstText, secondText;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Text(firstText),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Text(secondText)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e6577">This will be especially useful inside <span class="cf ic">ListView</span>s, which we’ll see in action now.

</p><h3 id="sec.layout.listview">The ListView</h3>
<p id="d24e6588">

The <span class="cf ic">ListView</span> is used to create a scrollable list of widgets.</p>
<p id="d24e6604">It is used when there is a need to create long lists of similar (or the same) items, and it can dynamically load other elements when they are many (or unlimited).</p>
<p id="d24e6606">The list can be expressed in multiple ways, as we will now see.</p><h4 id="sec.layout.listview.usage">How You Use It</h4>
<p id="d24e6611">There are multiple constructors that you can use to create a <span class="cf ic">ListView</span>.</p>
<p id="d24e6616">The default constructor works just like the <span class="cf ic">Column</span>’s constructor: you just need to provide a <span class="cf ic">List</span> of <span class="cf ic">Widget</span>s as the <span class="cf ic">children</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ListView(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Text(​<em class="string">"1"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Text(​<em class="string">"2"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Text(​<em class="string">"3"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ...</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e6657">
This example shows the advantage of using another constructor, the <span class="cf ic">ListView.builder</span> constructor, which is used the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ListView.builder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemCount: 499,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemBuilder: (BuildContext context, ​<strong class="kw">int</strong>​ i) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Text(​<em class="string">"</em>​​<em class="string">${i+1}</em>​​<em class="string">"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e6691">This does the same and creates a list of 499 <span class="cf ic">Text</span> widgets with the numbers from 1 to 500.</p>
<p id="d24e6696">But this constructor can also be useful when each element has something different—for example, if each <span class="cf ic">Text</span> needs a different, unrelated string.</p>
<p id="d24e6701">After defining something like:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">const</strong>​ strings = [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"The First Widget"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"The Second Widget"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"The Third Widget"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"The Last Widget"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">]</td></tr></table>
<p id="d24e6731">or generating a <span class="cf ic">List</span> list using what is described in <a href="/links/f_0084/f_0084.xhtml#sec.dart.lists.generate">​<em>Generating Lists</em>​</a>.</p>
<p id="d24e6739">You can create a <span class="cf ic">ListView</span> like this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ListView.builder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemCount: strings.length,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemBuilder: (BuildContext context, ​<strong class="kw">int</strong>​ i) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Text(strings[i]),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e6765">
There is also <span class="cf ic">ListView.separated</span>, which allows you to add a separator widget, in this case yet another <span class="cf ic">Text</span> for simplicity:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ListView.separated(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemCount: 500,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemBuilder: (context, i) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Text(​<em class="string">"</em>​​<em class="string">$i</em>​​<em class="string">"</em>​, style: Theme.of(context).textTheme.display1,),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  separatorBuilder: (context, i) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    i%3 == 0 ? Divider() : Padding(padding: EdgeInsets.all(0.5),),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e6815">This adds a divider widget<sup><a class="footnote" href="/links/f_0028/f_0028.xhtml#FOOTNOTE-21" id="FNPTR-21">[21]</a></sup> once every three numbers, starting from the space between the first and second widget, like in the following screenshot:</p><div class="ss"><img alt="images/WidgetLayout/separate.png" class="border " id="d24e6822" src="/images/img22/images/WidgetLayout/separate.png" style="width: 30%"/></div>
<p id="d24e6824">This is especially useful when you want do display lists of items separated into categories.</p>
<p id="d24e6826">Other uses for <span class="cf ic">ListView</span> in general are explained in the <span class="cf ic">Row</span>’s usage section in <a href="/links/f_0022/f_0022.xhtml#sec.layout.row.uses">​<em>Where You’ll Use the Row Together with Other Widgets</em>​</a>.</p>
<p id="d24e6836"><span class="cf ic">shrinkWrap</span>, when set to <span class="cf ic">false</span> (default), will make the list take up as much space as is available on the main axis. If, instead, you set it to <span class="cf ic">true</span> the grid’s size will adapt to the size that is needed to display its <span class="cf ic">children</span>.</p><h4>Customizing the Divider</h4>
<p id="d24e6852">
The <span class="cf class">Divider</span> can be customized to fit your app’s overall look, feel and needs:</p><ul><li>
<p id="d24e6863">You can set the <span class="cf ic">color</span> option to another color.</p></li><li>
<p id="d24e6869">You can set its <span class="cf ic">height</span> option by providing a <span class="cf ic">double</span> number to make the space bigger or smaller.</p></li><li>
<p id="d24e6878">You can set its <span class="cf ic">indent</span> option by providing a <span class="cf ic">double</span> number to make the line start at a different position along the horizontal axis.

</p></li></ul><h4>Horizontal Lists</h4>
<p id="d24e6892">
You can use <span class="cf ic">scrollDirection</span> to make a horizontally scrolling list, which is very useful if you want to have a horizontal list inside a vertical list.
This can be seen in several apps and you’ll see exactly why it is useful.</p>
<p id="d24e6903">In the following example, I’ll explain how to show many products, grouped in categories, using a combination of <span class="cf ic">ListView.builder</span> to display the categories and horizontal <span class="cf ic">ListView.builder</span> to show the products.
We’ll use example data, defined in the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">const</strong>​ categories = [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"Automotive"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"Books"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"Electronics"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"Food"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">const</strong>​ products = [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"Car"</em>​, ​<em class="string">"Tyre"</em>​, ​<em class="string">"Fuel"</em>​, ​<em class="string">"Oil"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"Programming Book"</em>​, ​<em class="string">"Novel"</em>​, ​<em class="string">"Politics Book"</em>​, ​<em class="string">"Business Book"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"Desktop Computer"</em>​, ​<em class="string">"Laptop"</em>​, ​<em class="string">"Computer keyboard"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"Pasta"</em>​, ​<em class="string">"Pizza"</em>​, ​<em class="string">"Bread"</em>​ ​<em class="string">"Cheese"</em>​, ​<em class="string">"Ham"</em>​, ​<em class="string">"Sausage"</em>​, ​<em class="string">"Beef"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">];</td></tr></table>
<p id="d24e7021">and then render the product list using something like:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">return</strong>​ ​<strong class="kw">Scaffold</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  backgroundColor: Colors.greenAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  appBar: AppBar(title: Text(​<em class="string">"List inside List example"</em>​)),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  body: ListView.builder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    itemCount: categories.length,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    itemBuilder: (context, i) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Text(categories[i]),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Container(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            height: 150.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            child: ListView.builder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              padding: EdgeInsets.all(10.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              scrollDirection: Axis.horizontal,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              itemCount: products[i].length,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              itemBuilder: (context, j) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  padding: EdgeInsets.all(20.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  child: Card(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    child:Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      padding: EdgeInsets.all(10.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        products[i][j],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        style: Theme.of(context)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                                        .textTheme.display1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ).</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">);</td></tr></table>
<p id="d24e7142">which produces the result as seen in the <a href="#fig.listinsidelist">screenshot</a>.</p><div id="fig.listinsidelist"><div><img alt="images/WidgetLayout/listinsidelist.png" class="border " id="d24e7148" src="/images/img23/images/WidgetLayout/listinsidelist.png" style="width: 38%"/></div></div>
<p id="d24e7151">The <span class="cf class">Container</span> is needed to constrain the internal <span class="cf class">ListView</span> since it is inside another scrollable widget and the app wouldn’t work without it.
</p>
<p id="d24e7160">More on the <span class="cf class">Card</span> in <a href="/links/f_0024/f_0024.xhtml#sec.layout.card">​<em>The Card</em>​</a>.</p><h4>The ListTile</h4>
<p id="d24e7170">

The <span class="cf ic">ListTile</span> is the typical widget that is used with <span class="cf ic">ListView</span>s and is very common in chat apps: the typical row made of a (usually round) preview picture, on the left, and on the right side a title and an optional subtitle.</p><p><strong>Implement a ListTile</strong></p>
<p id="d24e7194"><span class="cf ic">ListTile</span> is very common and useful and very easy to implement in Flutter:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  leading: Image(leftImage), ​<em class="comment">// OPTIONAL</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  title: Text(title),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  subtitle: Text(subtitle), ​<em class="comment">// OPTIONAL</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  onTap: () =&gt; openTile(), ​<em class="comment">// OPTIONAL</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e7218"><span class="cf ic">leading</span> is the little preview widget shown <span class="emph">before</span> the title, and it is usually an image, <span class="cf ic">title</span> is the big text description of the element, the <span class="cf ic">subtitle</span> is smaller and shown below, and <span class="cf ic">onTap</span> is the funciton that will be fired when the user taps on the tile.</p>
<p id="d24e7234">There is also a (less common) <span class="cf ic">trailing</span> argument available to add a widget placed <span class="emph">after</span> the title.</p>
<p id="d24e7242">For example, the following code, using the list icon as the leading icon:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ListView.builder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemBuilder: (context, i) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      leading: Icon(Icons.list),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      title: Text(​<em class="string">"title number </em>​​<em class="string">${i+1}</em>​​<em class="string">"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      subtitle: Text(​<em class="string">"subtitle"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e7278">will produce:</p><div class="ss"><img alt="images/WidgetLayout/listtile.png" class="border " id="d24e7280" src="/images/img24/images/WidgetLayout/listtile.png" style="width: 38%"/></div><h4 id="sec.layout.round">Make Round Widgets</h4>
<p id="d24e7284">

You previously learned that the <span class="cf ic">leading</span> widget of a <span class="cf ic">ListTile</span> is usually round, but how can you make a round widget?</p>
<p id="d24e7301">You build round widgets in two ways: using a <span class="cf ic">CircleAvatar</span> or using a <span class="cf ic">BoxDecoration</span> for a <span class="cf ic">Container</span>.</p><p><strong>Use a Container to Make Widgets of Any Shape and Size</strong></p>
<p id="d24e7315">

The most versatile and generic way is to contain the widget within a circular shape using a circle-shaped <span class="cf ic">Container</span>.</p>
<p id="d24e7331">As an example of the usage of the container, the following code produces a normal square box with an icon and some text:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Container(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  height: 50.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  width: 50.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Icon(Icons.apps),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<em class="string">"Test"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e7376">just like in the following screenshot:</p><div class="ss"><img alt="images/WidgetLayout/squarecontainer.png" class="" id="d24e7378" src="/images/img25/images/WidgetLayout/squarecontainer.png" style="width: 38%"/></div>
<p id="d24e7379">A <span class="cf ic">Container</span> can be made of any shape or size. Making it round is very simple, but you have to keep in mind that you need to move the <span class="cf ic">color</span> attribute to the <span class="cf ic">BoxDecoration</span> widget:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Container(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  height: 50.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  width: 50.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Icon(Icons.apps),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<em class="string">"Test"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        style: TextStyle(color: Colors.white),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  decoration: BoxDecoration(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    color: Colors.blueAccent,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    shape: BoxShape.circle,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e7442">and that produces:

</p><div class="ss"><img alt="images/WidgetLayout/roundcontainer.png" class="" id="d24e7448" src="/images/img26/images/WidgetLayout/roundcontainer.png" style="width: 38%"/></div><p><strong>Use a CircleAvatar to Round Widgets</strong></p>
<p id="d24e7452">
The alternative is to use a <span class="cf ic">CircleAvatar</span>, which simplifies the process when it can be used.</p>
<p id="d24e7461">A <span class="cf ic">CircleAvatar</span> is comparable to a pre-made circle container and it is optimized for rounding images, but it can also be used as a container.</p>
<p id="d24e7466">For example, you could exactly replicate the <span class="cf ic">Container</span> example from before in a simpler way like this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">CircleAvatar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  radius: 25.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  backgroundColor: Colors.blue,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Icon(Icons.apps),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Text(​<em class="string">"Test"</em>​, style: TextStyle(color: Colors.white),)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e7510">Where the <span class="cf ic">radius</span> is the radius of the circle, the <span class="cf ic">backgroundColor</span> is the background color of the circle and the <span class="cf ic">child</span> is what will actually be displayed inside the circle.</p>
<p id="d24e7521">The real advantage of using a <span class="cf ic">CircleAvatar</span> is that it allows you to cut an image into a round shape in a really easy way by simply passing an <span class="cf ic">ImageProvider</span> as the <span class="cf ic">backgroundImage</span> argument.</p>
<p id="d24e7532">Using the pragprog.com website’s PNG favicon<sup><a class="footnote" href="/links/f_0028/f_0028.xhtml#FOOTNOTE-22" id="FNPTR-22">[22]</a></sup> as an example, you would display it inside an app by using the <span class="cf ic">Image.network</span> contructor of the <span class="cf ic">Image</span> widget and passing the URL as the positional argument (as we’ll do in the Chapter 5, <a href="/links/f_0055/f_0055.xhtml#chp.networking">​<em> Network and Storage I/O and Navigation </em>​</a>), like this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Image.network(​<em class="string">"https://pragprog.com/favicon.png"</em>​)</td></tr></table>
<p id="d24e7558">but that can’t be used for the <span class="cf ic">CircleAvatar</span>’s <span class="cf ic">backgroundImage</span> because it needs an <span class="cf ic">ImageProvider</span>, not an <span class="cf ic">Image</span>.</p>
<p id="d24e7572">So you need to use the <span class="cf ic">NetworkImage</span> class, and pass that as the argument of the <span class="cf ic">CircleAvatar</span>, like in the following example:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">CircleAvatar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  backgroundImage: NetworkImage(​<em class="string">"https://pragprog.com/favicon.png"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e7591">which produces the following round image:</p><div class="ss"><img alt="images/WidgetLayout/roundfavicon.png" class="" id="d24e7593" src="/images/img27/images/WidgetLayout/roundfavicon.png" style="width: 38%"/></div>
<p id="d24e7594">Obviously you can change the radius to your liking by using the <span class="cf ic">radius</span> argument.</p><p><strong>Use a CircleAvatar in a ListTile</strong></p>
<p id="d24e7603">Integrating it into a <span class="cf ic">ListTile</span> is as simple as using the <span class="cf ic">CircleAvatar</span> as the <span class="cf ic">leading</span> widget, like in the following example:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  leading: CircleAvatar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    backgroundImage: NetworkImage(​<em class="string">"https://pragprog.com/favicon.png"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  title: Text(​<em class="string">"Example"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e7635">which produces:




</p><div class="ss"><img alt="images/WidgetLayout/listtileroundfavicon.png" class="" id="d24e7646" src="/images/img28/images/WidgetLayout/listtileroundfavicon.png" style="width: 35%"/></div><h4>Use the Expandable ListTile: The ExpansionTile</h4>
<p id="d24e7650">

The <span class="cf ic">ExpansionTile</span> is an expandable <span class="cf ic">ListTile</span>: it is just like a <span class="cf ic">ListTile</span> when it first gets rendered but you can, without leaving the current view, make an <span class="cf ic">ExpansionTile</span> taller and show more widgets, like more text or additional buttons and features.</p>
<p id="d24e7680">You use the <span class="cf ic">ExpansionTile</span> like this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ExpansionTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  leading: Image(leftImage), ​<em class="comment">// OPTIONAL</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  title: Text(title),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">// ExpansionTile-specific arguments</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  initiallyExpanded: ​<strong class="kw">true</strong>​, ​<em class="comment">// OPTIONAL default: false</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Text(​<em class="string">"Left on first row"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Text(​<em class="string">"Right on first row"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Text(​<em class="string">"Second row"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  backgroundColor: Colors.green[100], ​<em class="comment">// OPTIONAL</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// OPTIONAL, argument is a boolean, true if expanding, false if collapsing</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  onExpansionChanged: (expanding) {​<strong class="kw">return</strong>​;},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table><p><strong>Change the ExpansionTile’s attributes</strong></p>
<p id="d24e7755">Most of the properties are the same as the <span class="cf ic">ListTile</span>’s (except for <span class="cf ic">onTap</span>, which doesn’t exist for <span class="cf ic">ExpansionTiles</span>), but <span class="cf ic">trailing</span> is different this time: if it is not specified it will be an arrow which, when clicked, rotates to show whether the widget is expanded or not.</p>
<p id="d24e7769">There are four main <span class="cf ic">ExpansionTile</span>-specific arguments:</p><ul><li>
<p id="d24e7776"><span class="cf ic">initiallyExpanded</span>, which can be set to <span class="cf ic">true</span> if you want the inital state of the widget to be the expanded state.</p></li><li>
<p id="d24e7784"><span class="cf ic">children</span>, which is the list of widgets to be displayed below the tile when it expands.</p></li></ul><ul><li>
<p id="d24e7791"><span class="cf ic">backgroundColor</span>, which is the background color of the list of children widgets.</p></li><li>
<p id="d24e7796"><span class="cf ic">onExpansionChanged</span>, with which you can set a function to be called when the tile is expanded.</p></li></ul>
<p id="d24e7800">For example, the following code:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ExpansionTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  leading: Icon(Icons.list),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  title: Text(​<em class="string">"title"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: &lt;Widget&gt; [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      mainAxisAlignment: MainAxisAlignment.spaceEvenly,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Text(​<em class="string">"Left on first row"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Text(​<em class="string">"Right on first row"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Text(​<em class="string">"Second row"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e7851">produces:</p><div class="ss"><img alt="images/WidgetLayout/expandabletile.png" class="border " id="d24e7853" src="/images/img29/images/WidgetLayout/expandabletile.png" style="width: 38%"/></div>
<p id="d24e7856">which can be expanded to:

</p><div class="ss"><img alt="images/WidgetLayout/expandedtile.png" class="border " id="d24e7861" src="/images/img30/images/WidgetLayout/expandedtile.png" style="width: 38%"/></div><h4 id="sec.layout.dismissible">Dismissible ListTiles</h4>
<p id="d24e7865">


A very common usage for <span class="cf class">ListTile</span>s is as dismissible widgets, which means they can be deleted with a swipe gesture.
A widget gains that ability by being wrapped in a <span class="cf ic">Dismissible</span> widget.</p>
<p id="d24e7895"><span class="cf class">Dismissible</span> requires a <span class="cf class">Key</span> to be provided.
It’s not strictly necessary to understand <span class="cf class">Key</span>s to use <span class="cf class">Dismissible</span>s, but a more in-depth explanation will be provided in <a href="/links/f_0027/f_0027.xhtml#sec.layout.key">​<em>The Key</em>​</a>.</p>
<p id="d24e7910">The <span class="cf class">Dismissible</span> widget is used in the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Dismissible(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  background: Container(color: Colors.green),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  key: Key(string),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    title: Text(string),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e7934">where the <span class="cf ic">background</span> is what is shown behind the tile when it is swiped by the user. Setting it to a container makes it possible to choose the background color.</p>
<p id="d24e7941">A complete implementation of <span class="cf class">Dismissible</span> inside a <span class="cf class">ListView</span> would be:</p><table class="processedcode" id="code.layout.dismissibletiles"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ListView.builder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemCount: 20,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemBuilder: (context, i) =&gt; Dismissible(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    background: Container(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      color: Colors.red,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        mainAxisAlignment: MainAxisAlignment.spaceBetween,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        children: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Icon(Icons.clear, color: Colors.white,),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Icon(Icons.clear, color: Colors.white,),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    key: UniqueKey(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    child: ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      leading: CircleAvatar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        backgroundImage: NetworkImage(​<em class="string">"https://pragprog.com/favicon.png"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      title: Text(​<em class="string">"Example </em>​​<em class="string">${i+1}</em>​​<em class="string">"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e8027">The <span class="cf ic">UniqueKey</span> is the most basic and uncomplicated <span class="cf ic">Key</span>, and it should be enough unless you need greater control over the widgets’ state than is provided by Flutter by default.
The <span class="cf ic">Row</span> with two spaced-out <span class="cf ic">Icons.clear</span> icons shows the <span class="cf ic">Icon</span> on both sides when the tile is swiped.
That code generates the following list:</p><div class="ss"><img alt="images/WidgetLayout/DismissableListInitial.png" class="border " id="d24e8045" src="/images/img31/images/WidgetLayout/DismissableListInitial.png" style="width: 35%"/></div>
<p id="d24e8046">Partially swiping a tile shows the red background and an icon:</p><div class="ss"><img alt="images/WidgetLayout/DismissableListPartial.png" class="border " id="d24e8048" src="/images/img32/images/WidgetLayout/DismissableListPartial.png" style="width: 38%"/></div>
<p id="d24e8049">And completely swiping it removes the tile from the list with a nice animation, eventually leaving the list looking like this:


</p><div class="ss"><img alt="images/WidgetLayout/DismissableListFinal.png" class="border " id="d24e8056" src="/images/img33/images/WidgetLayout/DismissableListFinal.png" style="width: 35%"/></div><h4>Displaying a SnackBar</h4>
<p id="d24e8061">


In most apps, when a <span class="cf class">ListTile</span> is dismissed, a <span class="cf class">SnackBar</span><sup><a class="footnote" href="/links/f_0028/f_0028.xhtml#FOOTNOTE-23" id="FNPTR-23">[23]</a></sup> is displayed at the bottom of the screen.</p>
<p id="d24e8095">Displaying a <span class="cf class">SnackBar</span> using Flutter is really simple:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Scaffold.of(context).showSnackBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  SnackBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    content: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="string">"Tile #</em>​​<em class="string">${i+1}</em>​​<em class="string"> was dismissed"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e8128">And it can be displayed automatically when a tile is dismissed by changing the <a href="#code.layout.dismissibletiles">​code​</a><a href="#code.layout.dismissibletiles">​​</a> to:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ListView.builder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemCount: 20,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  itemBuilder: (context, i) =&gt; Dismissible(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    background: Container(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      color: Colors.red,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        mainAxisAlignment: MainAxisAlignment.spaceBetween,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        children: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Icon(Icons.clear, color: Colors.white,),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Icon(Icons.clear, color: Colors.white,),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    key: UniqueKey(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    child: ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      leading: CircleAvatar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        backgroundImage: NetworkImage(​<em class="string">"https://pragprog.com/favicon.png"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      title: Text(​<em class="string">"Example </em>​​<em class="string">${i+1}</em>​​<em class="string">"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    onDismissed: (direction) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Scaffold.of(context).showSnackBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            SnackBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              content: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ​<em class="string">"Tile #</em>​​<em class="string">${i+1}</em>​​<em class="string"> was dismissed"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        },</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e8242">The <span class="cf class">SnackBar</span>’s constructor supports, in addition to the <span class="cf ic">content</span>, an <span class="cf ic">action</span> attribute, in the form of a <span class="cf class">SnackBarAction</span>, which allows the developer to display a button that allows the user to take an action in response to the <span class="cf class">SnackBar</span>’s message:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">SnackBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  content: Text(​<em class="string">"Something happened"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  action: SnackBarAction(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    label: ​<em class="string">"DO SOMETHING ABOUT IT"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    onPressed: () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="comment">// do something about it</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    },</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e8288">A <span class="cf class">SnackBar</span> built with that code looks like this:



</p><div class="ss"><img alt="images/WidgetLayout/snackbar.png" class="" id="d24e8300" src="/images/img34/images/WidgetLayout/snackbar.png" style="width: 45%"/></div>,<h2 id="sec.networking.navigation">What You Need to Build the UI: Navigation and the InheritedWidget</h2>
<p id="d24e21407">Before we actually build the UI for this app, we’re going to  discuss two important things: how to navigate between multiple views in Flutter and how to use <span class="cf class">InheritedWidget</span>s. This will be a general introduction to the options Flutter offers for navigation; we’ll only use some of these in the app. If you’d prefer to jump ahead to more advanced navigation, take a look at <a href="/links/f_0060/f_0060.xhtml#sec.xkcdapp.UI">​<em>Build the App’s Basic UI</em>​</a> and then come back here when you want to learn about how to implement navigation in Flutter apps.</p><h3>Navigation in Flutter</h3>
<p id="d24e21417">

Flutter offers multiple options for navigating between views:</p><ul><li>
<p id="d24e21430"><span class="cf ic">push</span>/<span class="cf ic">pop</span> navigation, useful when there is a home page and many pages accessible from it, potentially using a <span class="cf class">Drawer</span> menu.</p></li><li>
<p id="d24e21441">Page-by-page navigation using the <span class="cf class">PageView</span> and <span class="cf class">PageController</span>, useful when there are a limited number of pages that can be considered on the same level.</p></li></ul><h3 id="sec.networking.navigation.pushpop">Push/Pop Navigation Using the Navigator</h3>
<p id="d24e21452">


Making an app that takes advantage of the <span class="cf class">Navigator</span> for <span class="cf ic">push</span>/<span class="cf ic">pop</span> navigation is really simple.</p><h4>Define the Pages</h4>
<p id="d24e21478">The first thing to do is to define the pages, which will be really simple:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ NewPage ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      appBar: AppBar(title: Text(​<em class="string">"New Page"</em>​),),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      body: Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          color: Colors.black12,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          onPressed: () {},</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(​<em class="string">"Go back to the home page"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ HomePage ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      appBar: AppBar(title: Text(​<em class="string">"Home Page"</em>​),),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      body: Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Container(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          height: 100,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Card(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  padding: EdgeInsets.all(10.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ​<em class="string">"Click the button to go to a new page"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    style: Theme.of(context).textTheme.title,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ButtonTheme.bar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  child: FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    child: Text(​<em class="string">"Go to new page"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    onPressed: () {}</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e21633">which generates the following app in its initial state as shown in the <a href="#fig.NavigationHomePage">screenshot</a>.</p><div id="fig.NavigationHomePage"><div><img alt="images/WidgetLayout/NavigationHomePage.png" class="border " id="d24e21639" src="/images/img55/images/WidgetLayout/NavigationHomePage.png" style="width: 38%"/></div></div>
<p id="d24e21641">I made the home page a bit more complex than it needed to be to differentiate the two pages visually.</p>
<p id="d24e21643">Now comes the important part: that <span class="cf ic">onPressed</span> option for both pages, inside which we are going to add the navigation code.</p>
<p id="d24e21648">I called this type of navigation &amp;lquot;push&amp;rquot;/&amp;lquot;pop&amp;rquot; because it uses two methods called <span class="cf methodname">Navigator.push</span> and <span class="cf methodname">Navigator.pop</span>.</p><h4>Push</h4>
<p id="d24e21659">You can navigate to a new page (contained in a <span class="cf class">Widget</span> called <span class="cf class">NewPage</span>) using the <span class="cf methodname">Navigator.push</span> in the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Navigator.push(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    builder: (context) =&gt; NewPage(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">);</td></tr></table>
<p id="d24e21687"><span class="cf methodname">Navigator.push</span> takes two arguments: the <span class="cf class">BuildContext</span> and a <span class="cf class">Route</span> to the new page.</p>
<p id="d24e21697">
You can create a route using the <span class="cf methodname">MaterialPageRoute</span> constructor, which uses a builder callback function (which can be a call to the widget’s constructor, as is the case in the example) to build the new view.</p>
<p id="d24e21706">You can put that code inside the curly braces of the <span class="cf ic">onPressed</span> option for the <span class="cf class">FlatButton</span> inside <span class="cf class">MyHomePage</span> and the following view will be displayed when the user taps the button:</p><div class="ss"><img alt="images/WidgetLayout/NavigationNewPage.png" class="border " id="d24e21717" src="/images/img56/images/WidgetLayout/NavigationNewPage.png" style="width: 38%"/></div><h4>Pop</h4>
<p id="d24e21721">Even though the framework by itself has added a (working, by the way) <span class="emph">back</span> button in the top left, it is useful to know how to make a custom button to go back.</p>
<p id="d24e21726">It is also incredibly simple:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Navigator.pop(context);</td></tr></table>
<p id="d24e21735">Adding that code to the curly braces of the <span class="cf ic">onPressed</span> attribute of <span class="cf class">NewPage</span>’s <span class="cf class">FlatButton</span>, tapping that button in the middle of the screen will make the app go back to the home page.</p><h3>Using a Drawer Side Navigation Menu</h3>
<p id="d24e21749">

A commonly seen navigation element is the <span class="cf class">Drawer</span>,<sup><a class="footnote" href="/links/f_0067/f_0067.xhtml#FOOTNOTE-39" id="FNPTR-39">[39]</a></sup> which is the menu, seen in many apps, that opens by swiping right starting from the left edge of the screen or by tapping the commonly seen button with three vertically stacked horizontal lines.</p>
<p id="d24e21768">
Like many items that are commonly used and placed outside the app body, a drawer is added to the app by using the <span class="cf ic">drawer</span> option of the <span class="cf class">Scaffold</span> and setting it to a <span class="cf class">Drawer</span> object:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  appBar: AppBar(title: ...),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  drawer: Drawer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    child: ...</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  body: ...,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e21803">The <span class="cf class">Drawer</span> class takes just three arguments (excluding the <span class="cf class">Key</span>), which makes it one of the simplest widgets in the entire Flutter standard library in this respect.</p>
<p id="d24e21811">Since one of them is the <span class="cf ic">semanticLabel</span> (which is a string used by accessibility tools such as screen readers to describe what they’re seeing) and the other is the <span class="cf ic">elevation</span> (which is a <span class="cf ic">double</span>, also present in the <span class="cf class">Card</span>, which is used to customize the shadow behind it), the only one that we’re currently interested in is the <span class="cf ic">child</span>, which is usually a <span class="cf class">Column</span> or a <span class="cf class">ListView</span> (if you’re worried about items not having enough vertical space).</p>
<p id="d24e21835">
For this example, we’ll use a <span class="cf class">ListView</span>.</p>
<p id="d24e21848">Very often, the first element in the list is a <span class="cf class">DrawerHeader</span>, which is a lot like a <span class="cf class">Container</span> and usually includes either account information and facilities to switch accounts (if present), the name of the app and/or information about its creators, or a short description of what the menu is for.</p>
<p id="d24e21856">Below it, a number of <span class="cf class">ListTile</span>s are used to display navigation options.</p>
<p id="d24e21861">If you decide to use a <span class="cf class">ListView</span>, you should set its <span class="cf ic">padding</span> option to <span class="cf ic">EdgeInsets.zero</span> to avoid having gaps at the top and bottom of the screen.</p>
<p id="d24e21873">
Since we’re talking about navigation so much, a <span class="cf class">Drawer</span> for a public transportation or travel app could be the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Drawer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: ListView(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    padding: EdgeInsets.zero,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    children: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      DrawerHeader(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        decoration: BoxDecoration(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          color: Colors.red,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          crossAxisAlignment: CrossAxisAlignment.start,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          mainAxisAlignment: MainAxisAlignment.end,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          children: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ​<em class="string">"Profile Name"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              style: TextStyle(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                color: Colors.white,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                fontSize: 18,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ​<em class="string">"email@example.com"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              style: TextStyle(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                color: Colors.white,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                fontSize: 11,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                fontWeight: FontWeight.w300</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        leading: Icon(Icons.train),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        title: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"Tickets"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          style: Theme.of(context).textTheme.title,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ListTile(title: Text(​<em class="string">"Buy Tickets"</em>​), onTap: () {}),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ListTile(title: Text(​<em class="string">"My Tickets"</em>​), onTap: () {}),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Divider(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        leading: Icon(Icons.person),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        title: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"Profile"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          style: Theme.of(context).textTheme.title,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ListTile(title: Text(​<em class="string">"Profile information"</em>​), onTap: () {}),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ListTile(title: Text(​<em class="string">"Past trips"</em>​), onTap: () {}),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ListTile(title: Text(​<em class="string">"Loyalty program points"</em>​), onTap: () {}),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e22063">First of all, it’s important to clarify that just adding a <span class="cf ic">drawer</span> to a <span class="cf class">Scaffold</span> causes the framework to automatically add a button to the app bar to expand it, as you can see with an empty <span class="cf class">Scaffold</span> body as shown in the <a href="#fig.travelhome">screenshot</a>.</p><div id="fig.travelhome"><div><img alt="images/WidgetLayout/travelhome.png" class="border " id="d24e22080" src="/images/img57/images/WidgetLayout/travelhome.png" style="width: 38%"/></div></div>
<p id="d24e22083">The <span class="cf class">Drawer</span> itself looks like this:</p><div class="ss"><img alt="images/WidgetLayout/traveldrawer.png" class="border " id="d24e22088" src="/images/img58/images/WidgetLayout/traveldrawer.png" style="width: 38%"/></div>
<p id="d24e22089">At this point, you might not be sure about how to actually use the drawer for navigation purposes, and that is because it’s not done using <span class="cf methodname">Navigator.push</span>, but by changing the state of the home page and some data that can be used by <span class="cf methodname">build</span> to build the page and, after doing that, calling <span class="cf methodname">Navigator.pop</span> to go back to the home page.</p>
<p id="d24e22100">This means the home page has to be a stateful widget (don’t forget that, especially if you get a <span class="emph">setState isn’t defined for HomePage</span> error) and it is a great chance to introduce Dart <span class="cf ic">enum</span>s.</p><h4>Enumerated Types</h4>
<p id="d24e22112">

You can create an enumerated type of data by code like the following:</p><table class="processedcode" id="code.layout.enums"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">enum</strong>​ PageType {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  buyTickets,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  myTickets,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  profileInfo,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  pastTrips,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  myPoints</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e22139">which creates a new type called <span class="cf ic">PageType</span> which can only be one of <span class="cf ic">PageType.buy</span><span class="cf ic">Tickets</span>, <span class="cf ic">PageType.myTickets</span>, <span class="cf ic">PageType.profileInfo</span>, <span class="cf ic">PageType.pastTrips</span>, or <span class="cf ic">PageInfo.myPoints</span>.</p>
<p id="d24e22165">Even if you are not used to this kind of data type, you’ll surely be able to understand it with the continuation of the travel app example.</p><h4>Finishing Our Travel App’s Navigation</h4>
<p id="d24e22170">To finish the travel app’s navigation, add the <a href="#code.layout.enums">​code​</a><a href="#code.layout.enums">​​</a> to your app outside any class definition and a complete, working example of a <span class="cf class">State</span> that implements the functionality I described is the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ HomePageState ​<strong class="kw">extends</strong>​ State&lt;HomePage&gt; {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  PageType _pageType = PageType.buyTickets;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ _str;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ _sub;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">switch</strong>​(_pageType) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">case</strong>​ PageType.buyTickets:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        _str = ​<em class="string">"Buy Tickets"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        _sub = ​<em class="string">"You can buy your tickets here"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">break</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">case</strong>​ PageType.myPoints:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        _str = ​<em class="string">"My Points"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        _sub = ​<em class="string">"You can buy check your loyalty program points here"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">break</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">case</strong>​ PageType.myTickets:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        _str = ​<em class="string">"My Tickets"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        _sub = ​<em class="string">"You can see the tickets you've bought here"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">break</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">case</strong>​ PageType.pastTrips:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        _str = ​<em class="string">"My Past Trips"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        _sub = ​<em class="string">"You can check the trips you have made previously here"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">break</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">case</strong>​ PageType.profileInfo:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        _str = ​<em class="string">"My Profile Information"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        _sub = ​<em class="string">"You can see your profile information here"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        title: Text(​<em class="string">"Programming Travels"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        backgroundColor: Colors.red,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      drawer: Drawer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: ListView(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          padding: EdgeInsets.zero,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          children: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            DrawerHeader(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              decoration: BoxDecoration(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                color: Colors.red,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                crossAxisAlignment: CrossAxisAlignment.start,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                mainAxisAlignment: MainAxisAlignment.end,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                children: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ​<em class="string">"Profile Name"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    style: TextStyle(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      color: Colors.white,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      fontSize: 18,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ​<em class="string">"email@example.com"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    style: TextStyle(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      color: Colors.white,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      fontSize: 11,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      fontWeight: FontWeight.w300</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              leading: Icon(Icons.train),</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  title: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"Tickets"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    style: Theme.of(context).textTheme.title,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  title: Text(​<em class="string">"Buy Tickets"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  onTap: () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    setState(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      () =&gt; _pageType = PageType.buyTickets,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Navigator.pop(context);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  title: Text(​<em class="string">"My Tickets"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  onTap: () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    setState(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      () =&gt; _pageType = PageType.myTickets,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Navigator.pop(context);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Divider(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  leading: Icon(Icons.person),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  title: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"Profile"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    style: Theme.of(context).textTheme.title,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  title: Text(​<em class="string">"Profile Information"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  onTap: () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    setState(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      () =&gt; _pageType = PageType.profileInfo,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Navigator.pop(context);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  title: Text(​<em class="string">"Past Trips"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  onTap: () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    setState(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      () =&gt; _pageType = PageType.pastTrips,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Navigator.pop(context);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              title: Text(​<em class="string">"Loyalty Program Points"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              onTap: () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                setState(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  () =&gt; _pageType = PageType.myPoints,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                Navigator.pop(context);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          padding: EdgeInsets.all(10.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            children: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              Text(_str, style: Theme.of(context).textTheme.title),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              Text(_sub, style: Theme.of(context).textTheme.subtitle)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e22696">As you can see, each of the <span class="cf class">Drawer</span>’s <span class="cf class">ListTile</span> sets the <span class="cf ic">_pageType</span> variable (which, by default, is <span class="cf ic">PageType.buyTickets</span>), reloads the home page using <span class="cf methodname">setState</span> and then calls <span class="cf methodname">Navigator.pop</span> to close the drawer.</p>
<p id="d24e22718"><span class="cf methodname">build</span> checks which of them is the current <span class="cf ic">_pageType</span> and sets two strings (a title and a subtitle) accordingly. Those two strings are then displayed in a centered and padded <span class="cf class">Column</span> as shown in the <a href="#fig.ProgrammingTravel">screenshot</a>.</p><div id="fig.ProgrammingTravel"><div><img alt="images/WidgetLayout/ProgrammingTravel.png" class="border " id="d24e22732" src="/images/img59/images/WidgetLayout/ProgrammingTravel.png" style="width: 38%"/></div></div>
<p id="d24e22734">The result is working navigation using a <span class="cf class">Drawer</span> menu.





</p><h3>Page-by-Page Navigation</h3>
<p id="d24e22755">




Swipeable page-by-page navigation can be achieved using two kinds of view: the <span class="cf class">PageView</span> and the <span class="cf class">TabBarView</span>, the difference is that the first only allows navigation by swiping, whereas the second is used together with a <span class="cf class">TabBar</span> below the <span class="cf class">AppBar</span>.</p>
<p id="d24e22792">If, instead, you just want something like the YouTube app: being able to switch between pages using a menu at the bottom of the screen, the way to go is with a <span class="cf class">BottomNavigationBar</span>.</p><h3>BottomNavigationBar</h3>
<p id="d24e22800">

A <span class="cf class">BottomNavigationBar</span> works a lot like a <span class="cf class">Drawer</span>, but it’s always visible at the bottom, so you don’t need to use <span class="cf methodname">Navigator.pop</span>.</p>
<p id="d24e22820">
More specifically, you add it to the <span class="cf class">Scaffold</span>’s <span class="cf ic">bottomNavigationBar</span> option, and you use it like this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">return</strong>​ ​<strong class="kw">Scaffold</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// app body, appbar, etc.</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  bottomNavigationBar: BottomNavigationBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    currentIndex: index,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    items: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      BottomNavigationBarItem(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        icon: Icon( ... ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        title: Text( ... ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      BottomNavigationBarItem(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        icon: Icon( ... ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        title: Text( ... ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="comment">// potentially more navigation items...</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    onTap: (page) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">switch</strong>​(page) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<strong class="kw">case</strong>​ 0:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="comment">// Things to do if the user selects the first item</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            index = 0;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<strong class="kw">break</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<strong class="kw">case</strong>​ 1:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="comment">// Things to do if the user selects the second item</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            index = 1;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="comment">// Potentially other cases for more navigation items</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    },</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e22929">It has three main options:</p><ul><li>
<p id="d24e22933">The <span class="cf ic">items</span>, which are the navigation options to be given to the user.</p></li><li>
<p id="d24e22939">The <span class="cf ic">currentIndex</span>, the value to which you assign will have to be changed manually when the user taps on a navigation item.</p></li><li>
<p id="d24e22945">The <span class="cf ic">onTap</span> callback, which takes an integer indicating which option has been tapped by the user.</p></li></ul>
<p id="d24e22950">A practical example of a full app home page class could be the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">String</strong>​ _str;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">int</strong>​ index = 0;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">switch</strong>​(index) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">case</strong>​ 0:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      _str = ​<em class="string">"Home"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">break</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">case</strong>​ 1:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      _str = ​<em class="string">"Page 2"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">break</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">case</strong>​ 2:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      _str = ​<em class="string">"Page 3"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      title: Text(​<em class="string">"Bottom Navigation Bar Example"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      backgroundColor: Colors.red,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    body: Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<em class="string">"</em>​​<em class="string">$_str</em>​​<em class="string">"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        style: Theme.of(context).textTheme.display1</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    bottomNavigationBar: BottomNavigationBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      currentIndex: index,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      items: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        BottomNavigationBarItem(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          icon: Icon(Icons.home),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          title: Text(​<em class="string">"Home"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        BottomNavigationBarItem(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          icon: Icon(Icons.looks_two),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          title: Text(​<em class="string">"Page 2"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        BottomNavigationBarItem(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          icon: Icon(Icons.format_list_numbered_rtl),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          title: Text(​<em class="string">"Page 3"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      onTap: (page) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        setState(() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<strong class="kw">switch</strong>​(page) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<strong class="kw">case</strong>​ 0:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              index = 0;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ​<strong class="kw">break</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<strong class="kw">case</strong>​ 1:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              index = 1;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ​<strong class="kw">break</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<strong class="kw">case</strong>​ 2:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              index = 2;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      },</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e23170">which looks like the <a href="#fig.BottomNavigation">screenshot</a>
and produces the desired behavior when the user taps on a navigation option.</p><div id="fig.BottomNavigation"><div><img alt="images/WidgetLayout/BottomNavigation.png" class="border " id="d24e23177" src="/images/img60/images/WidgetLayout/BottomNavigation.png" style="width: 35%"/></div></div>
<p id="d24e23180">
</p><h4 id="sec.networking.pageview">PageView</h4>
<p id="d24e23187">


The <span class="cf class">PageView</span> is comparable to a horizontal <span class="cf class">ListView</span>, but that only scrolls page by page.</p>
<p id="d24e23207">
You can use it as a part of the overall layout, but also as the entire body of the app’s <span class="cf class">Scaffold</span>, like in the following example:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    title: Text(​<em class="string">"PageView Example"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    backgroundColor: Colors.teal,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  body: PageView(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"Swipe left"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          style: Theme.of(context).textTheme.display1</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          padding: EdgeInsets.all(10.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">"Swipe left again, or swipe right"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            style: Theme.of(context).textTheme.display1</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"Swipe right"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          style: Theme.of(context).textTheme.display1</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e23331">
which produces a simple view with an <span class="cf class">AppBar</span> and, in the middle of the screen, a <span class="cf class">Text</span> widget.</p>
<p id="d24e23343">There is no other on-screen indication that the view has other pages, but swiping left moves the view to the next page and swiping right moves the view to the previous page.</p>
<p id="d24e23346">In addition to the <span class="cf ic">children</span>, the <span class="cf class">PageView</span> has a <span class="cf ic">controller</span> attribute, which can be set to a <span class="cf class">PageController</span>.</p>
<p id="d24e23360">
The <span class="cf class">PageController</span> has a useful option: the <span class="cf ic">initialPage</span>, which is an integer specifying the page (starting from 0) at which the view starts when the app loads.


</p><h3>Top Navigation with a TabBar and TabBarView</h3>
<p id="d24e23380">



Significantly more useful and common is the <span class="cf class">TabBarView</span> which, paired with a <span class="cf class">TabBar</span> below the <span class="cf class">AppBar</span>, provides the same swiping experience of a <span class="cf class">PageView</span> combined with a nice menu at the top to select which page to switch to and to highlight the page the user is currently at.</p>
<p id="d24e23412">
The <span class="cf class">TabBarView</span> and the <span class="cf class">TabBar</span> are linked by a <span class="cf class">TabController</span>.</p>
<p id="d24e23427">

An elegant way to create one is by wrapping the entire view in a <span class="cf class">DefaultTabController</span>, and setting the entire <span class="cf class">Scaffold</span> as its <span class="cf ic">child</span>, the number of tabs as its <span class="cf ic">length</span>, and (optionally) an <span class="cf ic">initialIndex</span> (starting from 0, which is the default).</p>
<p id="d24e23458">The <span class="cf class">TabBar</span> can be set as the <span class="cf class">AppBar</span>’s <span class="cf ic">bottom</span> option and it has a <span class="cf ic">tab</span> option where you’ll add the <span class="cf class">Tab</span> widgets, made up of a <span class="cf ic">text</span> and an optional <span class="cf ic">icon</span>, which will be the menu items which will make up the <span class="cf class">TabBar</span>.</p>
<p id="d24e23485">The <span class="cf class">TabBarView</span> will instead be set as the <span class="cf class">Scaffold</span>’s body and you will add the pages to be displayed to its <span class="cf ic">children</span> option.</p>
<p id="d24e23496">For example, this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">DefaultTabController(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  length: 3,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">// OPTIONAL initialIndex: 0,</em>​</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      title: Text(​<em class="string">"TabBarView Example"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      bottom: TabBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        tabs: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Tab(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            icon: Icon(Icons.looks_one),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            text: ​<em class="string">"First Page"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Tab(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            icon: Icon(Icons.looks_two),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            text: ​<em class="string">"Second Page"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Tab(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            icon: Icon(Icons.looks_3),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            text: ​<em class="string">"Third Page"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    body: TabBarView(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(​<em class="string">"This is the first page"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(​<em class="string">"This is the second page"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(​<em class="string">"This is the third page"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e23614">which produces the result as shown in the <a href="#fig.TabBarView">screenshot</a>.</p><div id="fig.TabBarView"><div><img alt="images/WidgetLayout/TabBarView.png" class="border " id="d24e23620" src="/images/img61/images/WidgetLayout/TabBarView.png" style="width: 38%"/></div></div><h4 id="sec.networking.inheritedwidget">InheritedWidgets</h4>
<p id="d24e23625">



The <span class="cf class">DefaultTabController</span> is a special kind of widget: an <span class="cf class">InheritedWidget</span>, which is used to share state information between Flutter widgets, by storing them in a widget that sits at the top of the widget tree and allowing direct access to its fields and methods by its children, so that they don’t need to be passed down the tree using constructor arguments.</p>
<p id="d24e23652">They are usually accessed using the <span class="cf ic">Widget.of(context).fieldName</span> syntax that we used previously to get theming data from the <span class="cf class">Theme</span> and to show snackbars in the <span class="cf class">Scaffold</span>. That is because both the <span class="cf class">Theme</span> and the <span class="cf class">Scaffold</span> are actually <span class="cf class">InheritedWidget</span>s.</p>
<p id="d24e23673">An <span class="cf class">InheritedWidget</span> is defined in the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ Example ​<strong class="kw">extends</strong>​ InheritedWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Example({child, ​<strong class="kw">this</strong>​.field}):</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">super</strong>​(child: child);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ field;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">bool</strong>​ updateShouldNotify(Example old) =&gt; ​<strong class="kw">true</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e23721"><span class="cf methodname">updateShouldNotify</span> is used to determine whether the children widgets have to be rebuilt when the <span class="cf class">InheritedWidget</span> gets rebuilt by the framework.</p>
<p id="d24e23728">That will usually be <span class="cf ic">true</span>, but there you can also set it to a set of conditions to determine whether, for example, there are changes to the widget’s fields and only rebuild the <span class="cf ic">children</span> in that case.</p>
<p id="d24e23736">In its current state, <span class="cf ic">Example.of(context).fieldName</span> from a child of <span class="cf class">Example</span> wouldn’t work since there is actually no <span class="cf methodname">of</span> method.</p>
<p id="d24e23747">Even though it is very common, it is not actually built into the framework: by default you access parent <span class="cf class">InheritedWidget</span>s using <span class="cf ic">context.inheritFromWidgetOfExactType(Example)</span>.</p>
<p id="d24e23755">In fact, a very common static method (explained on <a href="/links/f_0090/f_0090.xhtml#sec.dart.methods.static">​<em>Static Members</em>​</a>) defined inside <span class="cf class">InheritedWidget</span>s is the <span class="cf ic">of</span> method which, in the case of an <span class="cf class">InheritedWidget</span> called <span class="cf ic">Example</span>, can be defined in the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">static</strong>​ Example ​<strong class="kw">of</strong>​(BuildContext context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> context.inheritFromWidgetOfExactType(Example);</td></tr></table>
<p id="d24e23786">so that our entire <span class="cf class">Example</span> class definition becomes:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ Example ​<strong class="kw">extends</strong>​ InheritedWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Example({child, ​<strong class="kw">this</strong>​.field}): ​<strong class="kw">super</strong>​(child: child);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ field;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">bool</strong>​ updateShouldNotify(Example old) =&gt; old.field != field;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">static</strong>​ Example of(BuildContext context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   context.inheritFromWidgetOfExactType(Example);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e23843">You can use it inside an app like this:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Example(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  field: ​<em class="string">"An example of a string"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: MyCustomExternalWidget(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e23858">And, at any point inside the definition of <span class="cf class">MyCustomExternalWidget</span>, which takes no arguments, you could access that <span class="cf ic">field</span> you set using:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Example.of(context).field</td></tr></table>
<p id="d24e23876">which returns the exact <span class="cf class">String</span> that was set earlier.







</p>,<h2 id="sec.firebase.chat">Building the Chat App</h2>
<p id="d24e38164">
Now that we know how to use Firebase for what we need (authentication and database) and we have some more advanced UI notions, we can start building the chat app I promised we would work on.</p><h3>Planning Our App’s UI</h3>
<p id="d24e38171">

A chat app needs the user to perform multiple actions when they first start the app:</p><ul><li>
<p id="d24e38182">We need the user to insert an email address and password and either log into an existing account or create a new one if they don’t have one yet, at this point the user should also receive an email asking him to verify his user account, but we’re not going to make distinctions between verified and unverified users at this point.</p></li><li>
<p id="d24e38185">We need the user to choose a <span class="emph">display name</span> to use to identify themselves to other users in the app.</p></li><li>
<p id="d24e38191">If the user has done all of this, they should get to the page showing all messages sent by other users.</p></li></ul><h3>Building the UI</h3>
<p id="d24e38196">We’ll build the UI by creating each piece in the order in which the user will interact with it. Let’s start with the Sign-Up/Sign-In page!</p><h4>Login/Signup Page</h4>
<p id="d24e38201">

As we did in the previous chapter, we are going to use a <span class="cf class">TextEditingController</span> to be able to access text entered into a <span class="cf class">TextField</span> from outside its own <span class="cf ic">onSubmitted</span>.</p>
<p id="d24e38221">The UI is going to be the following (we’ll implement the <span class="cf methodname">logIn</span> and <span class="cf methodname">signUp</span> methods later in <a href="#sec.firebase.chat.interface.authentication">​<em>Authentication</em>​</a>):</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire/lib/main.dart">firebase/chatonfire/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(_verificationComplete) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Navigator.pushReplacement(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          builder: (context) =&gt; ConfigPage()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      title: Text(​<em class="string">"ChatOnFire Login"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    body: ListView(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          padding: EdgeInsets.all(15.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">"Log In Using Your Phone Number"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            style: Theme.of(context).textTheme.display1,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          padding: EdgeInsets.all(10.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: TextField(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            keyboardType: TextInputType.emailAddress,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            controller: _emailController,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            decoration: InputDecoration(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              labelText: ​<em class="string">"Email Address"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            autofocus: ​<strong class="kw">true</strong>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          padding: EdgeInsets.all(10.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: TextField(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            keyboardType: TextInputType.text,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            obscureText: ​<strong class="kw">true</strong>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            controller: _passwordController,</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    decoration: InputDecoration(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      labelText: ​<em class="string">"Password"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  padding: EdgeInsets.all(10.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    color: Theme.of(context).accentColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    textColor: Colors.white,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    child: Text(​<em class="string">"Log In"</em>​.toUpperCase()),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    onPressed: () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      logIn(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        _emailController.text,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        _passwordController.text</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ).then(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        (user) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          _user = user;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<strong class="kw">if</strong>​(!_user.isEmailVerified) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            _user.sendEmailVerification();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          _verificationComplete = ​<strong class="kw">true</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Navigator.pushReplacement(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            context, MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              builder: (context) =&gt; ConfigPage()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ).catchError(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        (e) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Scaffold.of(context).showSnackBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            SnackBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              content: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ​<em class="string">"You don't have an account. Please sign up."</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    },</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  padding: EdgeInsets.all(10.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    color: Theme.of(context).hintColor,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    textColor: Colors.white,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    child: Text(​<em class="string">"Create an Account"</em>​.toUpperCase()),</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            onPressed: () async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ​<strong class="kw">try</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                _user = await signUp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  _emailController.text,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  _passwordController.text</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ​<strong class="kw">if</strong>​(!_user.isEmailVerified) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  _user.sendEmailVerification();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                _verificationComplete = ​<strong class="kw">true</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                Navigator.pushReplacement(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  context, MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    builder: (context) =&gt; ConfigPage()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ​<strong class="kw">catch</strong>​(e) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                Scaffold.of(context).showSnackBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  SnackBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    content: Text(​<em class="string">"An error occurred"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            },</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e38644">At this point no guidance should be needed to understand these widgets, all of which we have already used at some point.</p>
<p id="d24e38646">An exception is <span class="cf methodname">Navigator.pushReplacement</span>, which is just like <span class="cf methodname">Navigator.push</span>, but it provides no way for the user to go back to the previous page. In this case each screen means that some progress has been done, so the previous screen was a worry of the past we don’t want the user to accidentally go back to.

</p><h4>Config Page</h4>
<p id="d24e38660">
After logging in, the user has to enter a display name, so we need a screen called <span class="cf class">ConfigPage</span> specifically meant to achieve that, since it’s a step that requires authentication to have happened and is a prerequisite to using the chat page:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire/lib/main.dart">firebase/chatonfire/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    appBar: AppBar(title: Text(​<em class="string">"Configure you account's basic information"</em>​)),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    body: ListView(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        TextField(decoration: InputDecoration(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            labelText: ​<em class="string">"Display Name"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          onSubmitted: (displayName) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            setNameAndGoToChatPage(displayName, context),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          controller: _controller,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Text(​<em class="string">"Submit"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          onPressed: () =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            setNameAndGoToChatPage(_controller.text, context),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e38735">Once again, we’re going to implement <span class="cf methodname">setNameAndGoToChatPage</span> later. All we need to know about it is that it’s certainly going to push a new screen, loading a widget called <span class="cf class">ChatPage</span>, which we’ll implement now.
</p><h4>Chat Page</h4>
<p id="d24e38747">Here’s what we’re going to build in this section:</p><div class="ss"><img alt="images/Firebase/chatPage.png" class="border " id="d24e38749" src="/images/img81/images/Firebase/chatPage.png" style="width: 33%"/></div>
<p id="d24e38750">
The <span class="cf class">ChatPage</span> is going to consist of a <span class="cf class">Column</span> that shows an <span class="cf class">Expanded</span>-wrapped <span class="cf class">ListView</span> built using the messages passed to the <span class="cf class">StreamBuilder</span> and a <span class="cf class">Row</span>(shown at the bottom of the screen, since the <span class="cf class">ListView</span> is going to be expanded by the <span class="cf class">Expanded</span> widget) showing a <span class="cf class">TextField</span> and an <span class="cf class">IconButton</span> to send the message, making use of a <span class="cf class">TextEditingController</span> as always:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire/lib/main.dart">firebase/chatonfire/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      title: Text(​<em class="string">"ChatOnFire"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    body: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: StreamBuilder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            stream: getMessages(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            builder: (context, snapshot) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              snapshot.hasData ?</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                MessagesList(snapshot.data ​<strong class="kw">as</strong>​ QuerySnapshot)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              :</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                Center(child: CircularProgressIndicator())</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Row(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Expanded(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              child: Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                padding: ​<strong class="kw">const</strong>​ EdgeInsets.all(8.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                child: TextField(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  controller: _messageController,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  keyboardType: TextInputType.text,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  onSubmitted: (txt) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    sendText(txt);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    _messageController.clear();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            IconButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              icon: Icon(Icons.send),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              onPressed: () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                sendText(_messageController.text);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                _messageController.clear();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e38927">As always, <span class="cf methodname">getMessages</span> and the <span class="cf class">MessagesList</span> will be defined later, when we implement an interface with the Cloud Firestore in <a href="#sec.firebase.chat.interface.databases">​<em>Database</em>​</a>.
</p><p><strong>The List of Messages</strong></p>
<p id="d24e38941">

In the <span class="cf class">MessagesList</span> widget, we’ll take the list of messages and create a <span class="cf class">ListView</span> using the <span class="cf methodname">ListView.builder</span> constructor, passing the data needed to show the message (sender, text, and timestamp) to a <span class="cf class">Message</span> widget we’ll build later.</p>
<p id="d24e38964">The <span class="cf class">ListView</span>’s <span class="cf variable">reverse</span> argument makes the list <span class="emph">start from the bottom</span>, meaning the first element will be shown at the bottom, which will be the scrolling view’s default position, which will be held when new messages are added. This is the typical behavior of chat apps and we want to replicate it, so we’ll set that to <span class="cf ic">true</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire/lib/main.dart">firebase/chatonfire/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MessagesList ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  MessagesList(​<strong class="kw">this</strong>​.data);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ QuerySnapshot data;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">bool</strong>​ areSameDay(Timestamp a, Timestamp b) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">var</strong>​ date1 = a.toDate().toLocal();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">var</strong>​ date2 = b.toDate().toLocal();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      (date1.year == date2.year)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      &amp;&amp;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      (date1.month == date2.month)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      &amp;&amp;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      (date1.day == date2.day);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(BuildContext context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ListView.builder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      reverse: ​<strong class="kw">true</strong>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      itemCount: data.documents.length,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      itemBuilder: (context, i) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">var</strong>​ months = [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"January"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"February"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"March"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"April"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"May"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"June"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"July"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"August"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"September"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"October"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"November"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"December"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        DateTime when = data</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                         .documents[i]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                         .data[​<em class="string">"when"</em>​]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                         .toDate()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                         .toLocal();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">var</strong>​ widgetsToShow = &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          Message(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            from: data.documents[i].data[​<em class="string">"from"</em>​],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            msg: data.documents[i].data[​<em class="string">"msg"</em>​],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            when: when</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">if</strong>​(i == data.documents.length-1) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          widgetsToShow.insert(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              padding: ​<strong class="kw">const</strong>​ EdgeInsets.symmetric(vertical: 10.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ​<em class="string">"</em>​​<em class="string">${when.day}</em>​​<em class="string"> </em>​​<em class="string">${months[when.month-1]}</em>​​<em class="string"> </em>​​<em class="string">${when.year}</em>​​<em class="string">"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                style: Theme.of(context).textTheme.subhead,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        } ​<strong class="kw">else</strong>​ ​<strong class="kw">if</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          !areSameDay(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            data.documents[i+1].data[​<em class="string">"when"</em>​],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            data.documents[i].data[​<em class="string">"when"</em>​]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          widgetsToShow.insert(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              padding: ​<strong class="kw">const</strong>​ EdgeInsets.symmetric(vertical: 10.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ​<em class="string">"</em>​​<em class="string">${when.day}</em>​​<em class="string"> </em>​​<em class="string">${months[when.month-1]}</em>​​<em class="string"> </em>​​<em class="string">${when.year}</em>​​<em class="string">"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                style: Theme.of(context).textTheme.subhead</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">return</strong>​ Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          children: widgetsToShow</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e39391">You might have noticed that we are building the <span class="cf class">ListView</span> using a <span class="cf class">Column</span> that allows us to show the date on which a message was sent if it is different than the previous message’s date. This is the preferred approach of many chat apps since it allows us to show the date only when it matters to the user.</p>
<p id="d24e39399">One disadvantage is that doing it that way is a bit unintuitive and verbose: we need to have an <span class="cf ic">if</span> and an <span class="cf ic">else if</span> necessarily because having both conditions in the first <span class="cf ic">if</span> will cause the app to crash if we try to access the document at index <span class="cf ic">documents.length</span>, but it’s made even worse by the fact that the list is created in two steps, making the contents less clear at first glance.</p>
<p id="d24e39413">Dart 2.3 helps with that by allowing us to integrate if statements in list literals, allowing us to bypass the <span class="cf variable">widgetsToShow</span> variable completely and return a <span class="cf class">Column</span> that has, at the start of the list of <span class="cf ic">children</span>, the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">return</strong>​ ​<strong class="kw">Column</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(i == data.documents.length)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        padding: ​<strong class="kw">const</strong>​ EdgeInsets.symmetric(vertical: 10.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"</em>​​<em class="string">${when.day}</em>​​<em class="string"> </em>​​<em class="string">${months[when.month-1]}</em>​​<em class="string"> </em>​​<em class="string">${when.year}</em>​​<em class="string">"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          style: Theme.of(context).textTheme.subhead</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">else</strong>​ ​<strong class="kw">if</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      !areSameDay(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        data.documents[i+1].data[​<em class="string">"when"</em>​],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        data.documents[i].data[​<em class="string">"when"</em>​]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        padding: ​<strong class="kw">const</strong>​ EdgeInsets.symmetric(vertical: 10.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"</em>​​<em class="string">${when.day}</em>​​<em class="string"> </em>​​<em class="string">${months[when.month-1]}</em>​​<em class="string"> </em>​​<em class="string">${when.year}</em>​​<em class="string">"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          style: Theme.of(context).textTheme.subhead</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr></table>
<p id="d24e39570">This is more intuitive, but it requires you to change <span class="cf filename">pubspec.yaml</span>’s <span class="cf ic">environment</span> section to the following, requiring Dart version 2.3.0 or higher:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire2/pubspec.yaml">firebase/chatonfire2/pubspec.yaml</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">environment:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  sdk: ​<em class="string">"</em>​​<em class="string">&gt;=2.3.0</em>​ ​<em class="string">&lt;3.0.0"</em>​</td></tr></table>
<p id="d24e39598">In case you wondered, for loops can be used inside list literals in a similar way starting from Dart version <span class="emph">2.3.2</span>.

</p><p><strong>Showing Each Message</strong></p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire/lib/main.dart">firebase/chatonfire/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ FutureBuilder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    future: FirebaseAuth.instance.currentUser(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    builder: (context, snapshot) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">if</strong>​(snapshot.hasData) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        FirebaseUser user = snapshot.data;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">return</strong>​ Container(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          alignment: user.displayName == from</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ?</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Alignment.centerRight</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            :</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Alignment.centerLeft,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Container(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            width: MediaQuery.of(context).size.width/3*2,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            child: Card(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              shape: StadiumBorder(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              child: ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                title: user.displayName != from</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ? Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    padding: ​<strong class="kw">const</strong>​ EdgeInsets.only(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      top: 8.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      left: 5.0</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      from,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      style: Theme.of(context).textTheme.subtitle</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  : Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      padding: EdgeInsets.only(left: 5.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        ​<em class="string">"You"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        style: Theme.of(context).textTheme.subtitle</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                subtitle: Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  padding: ​<strong class="kw">const</strong>​ EdgeInsets.only(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    bottom: 10.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    left: 5.0</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    msg,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    style: Theme.of(context).textTheme.body1</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                trailing: Text(​<em class="string">"</em>​​<em class="string">${when.hour}</em>​​<em class="string">:</em>​​<em class="string">${when.minute}</em>​​<em class="string">"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      } ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">return</strong>​ CircularProgressIndicator();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3>Implementing an Interface with Firebase</h3>
<p id="d24e39839">


The emphasis on email/password authentication in the previous section was spefically meant to prepare you to implement this kind of authentication method in our chat app.</p>
<p id="d24e39849">We’re going to follow the flow of user interaction for this section as well and start with implementing an interface for authentication purposes.</p><h4 id="sec.firebase.chat.interface.authentication">Authentication</h4>
<p id="d24e39854">


In <a href="/links/f_0075/f_0075.xhtml#sec.firebase.loginsignup">​<em>Writing Log-In and Sign-Up Methods</em>​</a>, we saw how to implement a log-in method:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire/lib/main.dart">firebase/chatonfire/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;FirebaseUser&gt; logIn(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ email, ​<strong class="kw">String</strong>​ password</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">) async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  _auth.signInWithEmailAndPassword(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      email: email,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      password: password</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr></table>
<p id="d24e39897">and a sign-up method:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire/lib/main.dart">firebase/chatonfire/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;FirebaseUser&gt; signUp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ email, ​<strong class="kw">String</strong>​ password</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">) async =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  _auth.createUserWithEmailAndPassword(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    email: email,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    password: password</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr></table>
<p id="d24e39925">What we’re missing is a method that sets the display name and redirects to the chat page, as needed by the <span class="cf class">ConfigPage</span>.</p>
<p id="d24e39930">That’s something that you shouldn’t find too hard since we have already seen how to change data such as the display name when we’ve covered <a href="/links/f_0075/f_0075.xhtml#sec.firebase.firebaseuser">​<em>The FirebaseUser</em>​</a>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire/lib/main.dart">firebase/chatonfire/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">setNameAndGoToChatPage</strong>​(​<strong class="kw">String</strong>​ name, BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  FirebaseAuth.instance.currentUser().then(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (user) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">var</strong>​ newUserInfo = UserUpdateInfo();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      newUserInfo.displayName = name;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      user.updateProfile(newUserInfo);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Navigator.pushReplacement(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      builder: (_) =&gt; ChatPage(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h4 id="sec.firebase.chat.interface.databases">Database</h4>
<p id="d24e39999">


Sending a message is done using the <span class="cf methodname">CollectionReference.add</span> we mentioned when we talked about adding documents to the Cloud Firestore in <a href="/links/f_0075/f_0075.xhtml#sec.firebase.firestore.add">​<em>Adding Data to the Cloud Firestore</em>​</a>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire/lib/main.dart">firebase/chatonfire/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">sendText</strong>​(​<strong class="kw">String</strong>​ text) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  FirebaseAuth.instance.currentUser().then(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (user) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Firestore.instance.collection(​<em class="string">"Messages"</em>​).add(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"from"</em>​: user != ​<strong class="kw">null</strong>​ ? user.displayName : ​<em class="string">"Anonymous"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"when"</em>​: Timestamp.fromDate(DateTime.now().toUtc()),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ​<em class="string">"msg"</em>​: text,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr></table>
<p id="d24e40100">

Among the methods discussed at the start of the chapter (<a href="/links/f_0075/f_0075.xhtml#sec.firebase.firestore.read">​<em>Reading from the Cloud Firestore</em>​</a>) to read data from the Cloud Firestore, we need to get a <span class="cf class">Stream</span> to use with a <span class="cf class">StreamBuilder</span>, so we use <span class="cf methodname">CollectionReference.snapshots</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire/lib/main.dart">firebase/chatonfire/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Stream&lt;QuerySnapshot&gt; getMessages() =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Firestore</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    .instance</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    .collection(​<em class="string">"Messages"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    .orderBy(​<em class="string">"when"</em>​, descending: ​<strong class="kw">true</strong>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    .snapshots();</td></tr></table><h3>Adding a Profile Page: Storing User Data in the Cloud Firestore</h3>
<p id="d24e40160">

There are some issues with our app: two users with the same display name would create confusion, since we are only storing a user’s display name in the database, and not their ID, so our app would think a user was the sender of a message even if the user who sent the message was a completely different user that happened to have the same display name.</p>
<p id="d24e40168">Additionally, the app doesn’t really provide any way to distinguish between these two users, so that would be a confusing situation for everyone. A good start would be to provide users with a way to set a short string to customize their profile (usually called a status or a bio) and a way to contact another user of the chat app via email since we’re already asking for that information.</p><h4>Creating a Collection for User Data</h4>
<p id="d24e40173">Let’s create another collection! We’ll call it <span class="emph">Users</span>, and it’ll be structured the following way:</p><ul><li>
<p id="d24e40180">The user’s <span class="cf ic">uid</span> will be the document’s ID, to make it easier to access the document corresponding to each user.</p></li><li>
<p id="d24e40186">The user’s <span class="cf ic">displayName</span> will be a string called <span class="cf ic">displayName</span>.</p></li><li>
<p id="d24e40195">The user’s email address will be another string called <span class="cf ic">email</span>.</p></li><li>
<p id="d24e40201">The user’s bio will be stored as a string called <span class="cf ic">bio</span>.</p></li></ul><h4>Changing the Documents and the App</h4>
<p id="d24e40209">We need to create entries to the user data collection for each existing user of our app and change every entry in the collection of messages and substitute the display name with the user ID. Then, we’ll worry about making the app work with the changed messages in the database, make it display the display name fetched from the Firestore, and then we’ll work on building a profile page.</p><p><strong>Changing the Data</strong></p>
<p id="d24e40215">Creating the users’ collection has to be done manually and it’s a good idea generally to have a collection containing user data: that’s how it is in most “traditional” databases and it’s worth it to replicate it in Firebase, except for the fact we don’t need (and shouldn’t, and especially not in plain text) to store passwords in the database we can access.</p>
<p id="d24e40217">Let’s start with dealing with the changing data: to change each message in the database and substitute the values is easy enough when there aren’t many messages since we can just change them manually in the Firebase console, but with bigger databases you’d have to write some code that (using the interfaces we learned about in this chapter) fetches the messages, finds the user with the given display name and substitutes the display name with the user ID.</p><div class="sidebar"><div class="sidebar-title">Making Smooth Transitions</div><div class="sidebar-content">
<p id="d24e40223">
    During initial development (and in our case) an app has no users, so we can make changes to the database that stop a previous version of the app from working at any moment, but that’s not the case when an app is already on the market and a significant change is made to the way data is stored.
  </p>
<p id="d24e40225">
    Certainly, one of the first steps would be to inform the user of a previous version that their version of the app doesn’t work anymore instead of just crashing the app, but giving the user a window of time to perform the update would also be something good, and that would be done, in our case, by storing the user ID as an additional property of a message, instead of replacing the previously used one, and then removing the (now useless) display name property after giving some time for the users to upgrade, showing users of the previous version a notice that they shouldn’t use that version anymore.
  </p>
<p id="d24e40230">
    Additionally, for other users who have updated their version of the app before many have had a chance to set a bio, you’d have to set every existing user’s bio to some default value (which could be a blank <span class="cf constant">""</span> or something different like the ones other chat apps use).
  </p></div></div><p><strong>Changing the App</strong></p>
<p id="d24e40241">The changes we need to make to our app start, as always, before the user even gets to the chat page. After log-in or sign-up, when we ask the user for a display name, we need to prompt the user to enter a bio.</p>
<p id="d24e40243">We’ll change the <span class="cf methodname">setNameAndGoToChatPage(name, context)</span> to a generic <span class="cf methodname">setDataAndGoToChatPage(name, bio, context)</span>. This addition means we need to define another <span class="cf class">TextEditingController</span> and change the UI to this:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire2/lib/main.dart">firebase/chatonfire2/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">TextField(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  decoration: InputDecoration(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    labelText: ​<em class="string">"Display Name"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  controller: _nameController,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">TextField(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  decoration: InputDecoration(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    labelText: ​<em class="string">"Bio"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  controller: _bioController,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  child: Text(​<em class="string">"Submit"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  onPressed: () =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    setDataAndGoToChatPage(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      _nameController.text,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      _bioController.text, context</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e40310">The method itself will do the same things <span class="cf methodname">setNameAndGoToChatPage</span> did, but it will also add a document to the Users collection:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire2/lib/main.dart">firebase/chatonfire2/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">setDataAndGoToChatPage</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ name,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ bio,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  BuildContext context</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  FirebaseAuth.instance.currentUser().then(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (user) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">var</strong>​ newUserInfo = UserUpdateInfo();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      newUserInfo.displayName = name;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      user.updateProfile(newUserInfo);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Firestore</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        .instance</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        .collection(​<em class="string">"Users"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        .document(user.uid)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        .setData(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">"bio"</em>​: bio,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">"displayName"</em>​: name,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ​<em class="string">"email"</em>​: user.email,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Navigator.pushReplacement(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      builder: (_) =&gt; ChatPage(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e40440">Another place where things need to change is the chat page, more specifically, the list of messages should pass the entire user to the <span class="cf class">Message</span> class, so that it has all of the information about it that will also be needed by the <span class="cf class">ProfilePage</span>, but it should also pass the user ID, which isn’t actually included in the <span class="cf class">Map</span> that contains the user data, since the ID actually represents the path where to find the user data in the Firestore collection.</p>
<p id="d24e40451">This requires changing the <span class="cf class">Message</span> constructor and properties:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire2/lib/main.dart">firebase/chatonfire2/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Message({​<strong class="kw">this</strong>​.from, ​<strong class="kw">this</strong>​.msg, ​<strong class="kw">this</strong>​.when, ​<strong class="kw">this</strong>​.uid});</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">final</strong>​ Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt; from;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ uid;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">final</strong>​ ​<strong class="kw">String</strong>​ msg;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">final</strong>​ DateTime when;</td></tr></table>
<p id="d24e40515">and the call from the <span class="cf class">MessagesList</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire2/lib/main.dart">firebase/chatonfire2/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">? Message(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  from: (snapshot.data ​<strong class="kw">as</strong>​ DocumentSnapshot).data,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  msg: data.documents[i].data[​<em class="string">"msg"</em>​],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  when: when,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  uid: data.documents[i].data[​<em class="string">"from"</em>​]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">)</td></tr></table>
<p id="d24e40561">The <span class="cf class">Message</span> itself doesn’t need to change a lot: it just needs to align widgets left or right by checking the UID we got from the <span class="cf class">MessagesList</span> with the current user’s ID instead of comparing display names, everything else will be supplied by the <span class="cf variable">from</span> argument. The other change is that the display name’s <span class="cf class">Text</span>  widget (the <span class="cf ic">title</span> of each <span class="cf class">ListTile</span>) will now be wrapped in an <span class="cf class">InkWell</span> to make it possible for the user to tap it and go to the profile page:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire2/lib/main.dart">firebase/chatonfire2/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">@override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Widget ​<strong class="kw">build</strong>​(BuildContext context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ FutureBuilder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    future: FirebaseAuth.instance.currentUser(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    builder: (context, snapshot) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">if</strong>​(snapshot.hasData) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        FirebaseUser user = snapshot.data;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">return</strong>​ Container(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          alignment: user.uid == uid</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ? Alignment.centerRight</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          : Alignment.centerLeft,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          child: Container(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            width: MediaQuery.of(context).size.width*2/3,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            child: Card(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              shape: StadiumBorder(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              child: ListTile(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                title: user.uid != uid</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ?</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  InkWell(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    child: Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      padding: EdgeInsets.only(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        top: 8.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        left: 5.0</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        from[​<em class="string">"displayName"</em>​],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        style: Theme.of(context).textTheme.subtitle</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    onTap: () =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      Navigator.push(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          builder: (context) =&gt; ProfilePage(from)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  :</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  InkWell(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    child: Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      padding: EdgeInsets.only(left: 5.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        ​<em class="string">"You"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        style: Theme.of(context).textTheme.subtitle</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    onTap: () =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      Navigator.push(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                          builder: (context) =&gt; ProfilePage(from)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                        )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                subtitle: Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  padding: ​<strong class="kw">const</strong>​ EdgeInsets.only(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    bottom: 10.0,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    left: 5.0</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  child: Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    msg,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    style: Theme.of(context).textTheme.body1</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                trailing: Text(​<em class="string">"</em>​​<em class="string">${when.hour}</em>​​<em class="string">:</em>​​<em class="string">${when.minute}</em>​​<em class="string">"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      } ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">return</strong>​ CircularProgressIndicator();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h4>Creating a Profile Page</h4>
<p id="d24e40856">The profile page, as we said previously, needs to show three things: the user’s display name, the bio, and a button to send an email. To do the latter we need a new package: the <span class="emph">url_launcher</span> package, which allows us to launch an URL from the app.</p><h4>Using url_launcher to Launch an URL and Send an Email</h4>
<p id="d24e40864">
Since an URL can also be used to create an email by prefixing the email address to which to send the email with <span class="cf ic">mailto:</span>, we need to add the <span class="cf ic">url_launcher</span> package to the dependencies in <span class="cf filename">pubspec.yaml</span> and import it into <span class="cf filename">main.dart</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire2/lib/main.dart">firebase/chatonfire2/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:url_launcher/url_launcher.dart'</em>​;</td></tr></table>
<p id="d24e40891">The package provides two functions:</p><ul><li>
<p id="d24e40895"><span class="cf methodname">canLaunch(url)</span>, which returns a <span class="cf ic">Future&lt;bool&gt;</span> and checks whether there are any apps that are capable of handling the URL we’re trying to launch.</p></li><li>
<p id="d24e40903"><span class="cf methodname">launch(url)</span>, which launches the URL asynchronously, throwing a <span class="cf class">PlatformException</span> if no app was able to handle the URL.</p></li></ul>
<p id="d24e40910">The profile page UI itself is going to be very simple: a <span class="cf class">Column</span> (with evenly spaced children) with two <span class="cf class">Text</span> widgets (one for the display name and one for the bio) and a <span class="cf class">FlatButton</span> to allow the user to send an email.</p>
<p id="d24e40921">More specifically, the <span class="cf class">FlatButton</span> is going to have an icon as well as text as shown in the <a href="#fig.profilepage">screenshot</a>.</p><div id="fig.profilepage"><div><img alt="images/Firebase/profilepage.png" class="border " id="d24e40930" src="/images/img82/images/Firebase/profilepage.png" style="width: 38%"/></div></div>
<p id="d24e40932">The code is the following:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire2/lib/main.dart">firebase/chatonfire2/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ProfilePage ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ProfilePage(​<strong class="kw">this</strong>​.user);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt; user;</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(context) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      body: Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          crossAxisAlignment: CrossAxisAlignment.center,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          mainAxisAlignment: MainAxisAlignment.spaceEvenly,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              user[​<em class="string">"displayName"</em>​],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              style: Theme.of(context).textTheme.title</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Text(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              user[​<em class="string">"bio"</em>​],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              style: Theme.of(context).textTheme.subtitle</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            FlatButton.icon(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              icon: Icon(Icons.email),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              label: Text(​<em class="string">"Send an e-mail to </em>​​<em class="string">${user["displayName"]}</em>​​<em class="string">"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              onPressed: () async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ​<strong class="kw">var</strong>​ url =</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  ​<em class="string">"mailto:</em>​​<em class="string">${user["email"]}</em>​​<em class="string">?body=</em>​​<em class="string">${user["displayName"]}</em>​​<em class="string">,</em>​​<em class="string">\n</em>​​<em class="string">"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ​<strong class="kw">if</strong>​(await canLaunch(url)) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  launch(url);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                } ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  Scaffold.of(context).showSnackBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    SnackBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                      content: Text(​<em class="string">"You don't have any e-mail app"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><p><strong>Allowing Users to Edit Their Bio</strong></p>
<p id="d24e41128">A user might want to edit their bio in the future. For that, we’ll provide an <span class="cf class">AppBar</span> action in the chat page that fires up a new page called <span class="cf class">ChangeBioPage</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire2/lib/main.dart">firebase/chatonfire2/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  title: Text(​<em class="string">"ChatOnFire"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  actions: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    IconButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      tooltip: ​<em class="string">"Change your bio"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      icon: Icon(Icons.edit),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      onPressed: () =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Navigator.push(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            builder: (context) =&gt; ChangeBioPage()</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table>
<p id="d24e41183">The page itself is going to be very similar to the <span class="cf class">ConfigPage</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/firebase/chatonfire2/lib/main.dart">firebase/chatonfire2/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ ChangeBioPage ​<strong class="kw">extends</strong>​ StatelessWidget {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ _controller = TextEditingController();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">void</strong>​ _changeBio(​<strong class="kw">String</strong>​ bio) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    FirebaseAuth.instance.currentUser().then(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      (user) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        Firestore</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          .instance</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          .collection(​<em class="string">"Users"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          .document(user.uid)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          .updateData(</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ​<em class="string">"bio"</em>​: bio</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  @override</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Widget build(context) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    Scaffold(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      appBar: AppBar(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        title: Text(​<em class="string">"Change your bio"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      body: Center(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        child: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          children: &lt;Widget&gt;[</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            Padding(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              padding: ​<strong class="kw">const</strong>​ EdgeInsets.all(8.0),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              child: TextField(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                controller: _controller,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                decoration: InputDecoration(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  labelText: ​<em class="string">"New Bio"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                onSubmitted: (bio) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  _changeBio(bio);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                  Navigator.pop(context);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              child: Text(​<em class="string">"Change Bio"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              onPressed: () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                _changeBio(_controller.text);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">                Navigator.pop(context);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">              }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">            )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">          ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h3>Making the App More Secure by Locking Down Access to the Firestore</h3>
<p id="d24e41367">



Since we’ve implemented authentication, we shouldn’t keep the Cloud Firestore database rules as open as they are now because, even though we allow anyone to sign up, we should try to constrain access to the minimum necessary for the app to work.</p><h4>What We’re Going to Do</h4>
<p id="d24e41388">More specifically we need to do the following:</p><ul><li>
<p id="d24e41392">Only allow users authenticated with a given <span class="cf ic">uid</span> to add or edit a user with that <span class="cf ic">uid</span> to the users’ collection, letting everybody read user data, but allowing nobody to delete users (at the moment we’re not offering that option).</p></li><li>
<p id="d24e41404">Only allow users authenticated with a given <span class="cf ic">uid</span> to add a message that declares to be from that <span class="cf ic">uid</span>, letting everybody access the messages, but allowing nobody to edit or delete them (for the same reason: we’re not offering that option to users at the moment).</p></li></ul><h4>Implementing the Restriction</h4>
<p id="d24e41415">All of that is achieved by the following Cloud Firestore configuration (to be inserted in <span class="emph">Database -&gt; Rules</span> in the Firebase console):</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">service cloud.firestore {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  match /databases/{database}/documents {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    match /Users/{userId} {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      allow create, update: if request.auth.uid == userId;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      allow read: if request.auth != null;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    match /Messages/{messageId} {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      allow create: if request.auth.uid == request.resource.data.from;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      allow read: if request.auth != null;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><p><strong>matching Documents</strong></p>
<p id="d24e41451"><span class="cf ic">match /databases/{database}/documents</span> makes it so the root path of everything in the curly braces after that statement is at collection-level, meaning that, for example, <span class="cf ic">/Users/ABCD</span> is the document of the collection <span class="emph">Users</span> that has ID <span class="emph">ABCD</span>.</p>
<p id="d24e41464">Inside that, we have other two <span class="cf ic">match</span> statements:</p><ul><li>
<p id="d24e41471"><span class="cf ic">match /Users/{userId}</span>, where we’re going to regulate access to the <span class="emph">Users</span> collection.</p></li><li>
<p id="d24e41479"><span class="cf ic">match /Messages/{message}</span>, where we’re going to worry about access to the <span class="cf class">Messages</span> collection.</p></li></ul><p><strong>allowing Access</strong></p>
<p id="d24e41489"><span class="cf ic">allow</span> statements are used in the following way:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">allow operation: if condition;</td></tr></table>
<p id="d24e41497">The operation can be either just <span class="cf ic">read</span> or <span class="cf ic">write</span>, or a more specific aspect of <span class="cf ic">write</span>, like <span class="cf ic">create</span>, <span class="cf ic">update</span> and <span class="cf ic">delete</span>. It can also be a comma-separated list of operations.</p>
<p id="d24e41518">

The condition can be just <span class="cf ic">true</span> or <span class="cf ic">false</span> (like we did at the start), but it should take into consideration both what document the user is trying to access and who the user is (whether they’re authenticated, what their UID is, etc.).</p>
<p id="d24e41535">In our case, for each condition, we can use three pieces of data: whatever is in the curly braces in the path of any match <span class="cf ic">statement</span> that encloses it (for example, in the case of the <span class="emph">Users</span> <span class="cf ic">match</span> statement, <span class="cf ic">{userId}</span>, which is the path of the user document, in other words its ID), the <span class="cf ic">request</span> interface and the <span class="cf ic">resource</span> interface.</p>
<p id="d24e41556">Let’s start with the latter: the <span class="cf ic">resource</span> interfaces contains data about the resource we’re trying to read, update, or delete. For example, if we wanted to access the <span class="cf ic">from</span> field of a message, we would write <span class="cf ic">resource.data.from</span>.</p>
<p id="d24e41567">Very similar to <span class="cf ic">resource</span> is <span class="cf ic">request.resource</span>, which is the incoming data from the request. For example, if the request is trying to add a user, we would access that user’s bio with <span class="cf ic">request.resource.data.bio</span>. Another important proprty of the <span class="cf ic">request</span> interface is <span class="cf ic">request.auth</span>, which tells us whether the user who’s trying to acess the Firestore is authenticated, and what their credentials are. For example, if the user is not authenticated <span class="cf ic">request.auth</span> will be equal to <span class="cf ic">null</span>; if, instead, the user is authenticated <span class="cf ic">request.auth.uid</span> will return the UID of the user who’s trying to access the Firestore.</p>
<p id="d24e41594">Combining all of these aspects and our requirements gives us the following for the <span class="emph">Users</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">match /Users/{userId} {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  allow create, update: if request.auth.uid == userId;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  allow read: if request.auth != null;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e41610">and the following for the <span class="emph">Messages</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">match /Messages/{messageId} {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  allow create: if request.auth.uid == request.resource.data.from;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  allow read: if request.auth != null;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><h4>A Few Words on Making Data in the Firestore More Secure</h4>
<p id="d24e41628">Now the data is inaccessible to anonymous users and, in the case of a public chat, it’s fine. But what about one-on-one or group chat apps? For one, you would need to separate messages from different conversations, which would be rather simple, but a really important issue is that of privacy and confindentiality: the messages would be stored in plain text in the database, allowing those who run the app to spy on conversations, which would all be revealed in case of a security incident. That is the reason why most one-on-one chat apps implement some sort of encryption, storing in the database encrypted messages that can only be encrypted using keys stored on each user’s device.</p><div class="sidebar"><div class="sidebar-title">Password Reset and Verifying Email Addresses</div><div class="sidebar-content">
<p id="d24e41635">
    For the purposes of our chat app, we don’t really need to differentiate users who have verified their email address and those who haven’t, since we’re not even offering password reset via email (which is achieved by running <span class="cf methodname">_auth.sendPasswordResetEmail</span>). You could, though, choose to make those who haven’t yet verified their email appear in the list of messages differently (changing their display name text to a different color, for example, or showing an approval icon next to users with  verified email addresses), but it’s not really needed.
  </p>
<p id="d24e41640">
    In the case of other apps the ability to do all of this without having to rely on anything other than Firebase and in such a simple way is certainly a good reason to be interested in Firebase as a tool to help create apps that would otherwise have to rely on servers and separate back-end code to work.
  </p></div></div>,<h2 id="d24e30840">Testing the XKCD App: Using Mock Objects</h2>
<p id="d24e30843">


Testing the XKCD app presents a challenge: the app relies on external variables: an Internet connection needs to be present and the app needs to be able to connect to the XKCD servers (which need to be up) to work. The issue with that is that we may need to only test a small part of our app (especially during unit testing) without needing to interface with anything else, and we need to mock files since we can’t access them anyway. To do this, developers usually resort to building <span class="emph">mock objects</span>, which are objects that simulate the features provided by the external interface while not requiring that interface.</p>
<p id="d24e30860">Building mock objects isn’t language or framework specific, but Google has developed a Flutter package that allows developers to simplify the creation of mock objects: the Mockito library.</p><h3>The Mockito Library</h3>
<p id="d24e30865">

The Google-developed <span class="emph">mockito</span> package on Pub<sup><a class="footnote" href="/links/f_0073/f_0073.xhtml#FOOTNOTE-44" id="FNPTR-44">[44]</a></sup> allows you to write classes that reproduce a behavior you choose by using the <span class="cf methodname">when</span> function.</p><h4>Writing a Mock Object</h4>
<p id="d24e30896">

As an example, let’s write a replacement for the <span class="cf constant">http</span> constant we use in the XKCD app to make requests so that we can test the <span class="cf methodname">getLatestNumber</span> and <span class="cf methodname">fetchComic</span> methods. It is an object of the class <span class="cf class">Client</span>, so we write an empty class that <span class="cf ic">extends</span> (<a href="/links/f_0090/f_0090.xhtml#sec.dart.extends">​<em>extends</em>​</a>) <span class="cf class">Mock</span> and <span class="cf ic">implements</span> (<a href="/links/f_0090/f_0090.xhtml#sec.dart.implements">​<em>Writing a Class That implements an Interface</em>​</a>) <span class="cf class">Client</span>’s members:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/testing/xkcd_app/test/unit_test.dart">testing/xkcd_app/test/unit_test.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:http/http.dart'</em>​ ​<strong class="kw">as</strong>​ http;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">class</strong>​ MockHTTPClient ​<strong class="kw">extends</strong>​ Mock ​<strong class="kw">implements</strong>​ http.Client {}</td></tr></table>
<p id="d24e30962">Let’s define two comics we can return:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/testing/xkcd_app/test/unit_test.dart">testing/xkcd_app/test/unit_test.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">const</strong>​ comics = [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">"""</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">  {</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">    "</em>​month​<em class="string">": "",</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">    "</em>​​<strong class="kw">num</strong>​​<em class="string">": 1,</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">    "</em>​link​<em class="string">": "",</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">    "</em>​year​<em class="string">": "",</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">    "</em>​news​<em class="string">": "",</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">    "</em>​safe_title​<em class="string">": "</em>​The First Comic​<em class="string">",</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">    "</em>​transcript​<em class="string">": "",</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">    "</em>​alt​<em class="string">": "</em>​first comic alt-text​<em class="string">",</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">    "</em>​img​<em class="string">": "</em>​https:​<em class="comment">//example.com/1.png",</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"title"</em>​: ​<em class="string">"The First Comic"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"day"</em>​: ​<em class="string">""</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">""",</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">  """</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"month"</em>​: ​<em class="string">""</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"num"</em>​: 2,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"link"</em>​: ​<em class="string">""</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"year"</em>​: ​<em class="string">""</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"news"</em>​: ​<em class="string">""</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"safe_title"</em>​: ​<em class="string">"The Second Comic"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"transcript"</em>​: ​<em class="string">""</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"alt"</em>​: ​<em class="string">"second comic alt-text"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"img"</em>​: ​<em class="string">"https://example.com/2.png"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"title"</em>​: ​<em class="string">"The Second Comic"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="string">"day"</em>​: ​<em class="string">""</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="string">"""</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="string">];</em>​</td></tr></table>
<p id="d24e31161">At this point we need to think about the calls we make to <span class="cf methodname">http.read</span>. The first of them is <span class="cf ic">http.read(’https://xkcd.com/info.0.json’)</span>, which is supposed to return a <span class="cf class">String</span> containing the comic in a JSON format, so we’ll return the second comic:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">when(mockHttp.read(​<em class="string">'https://xkcd.com/info.0.json'</em>​)).thenReturn(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  comics[1]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">);</td></tr></table>
<p id="d24e31189">The same also needs to apply for <span class="cf ic">/$num/info.0.json</span>, so we also need the following:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">when(mockHttp.read(​<em class="string">'https://xkcd.com/2/info.0.json'</em>​)).thenReturn(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  comics[1]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">);</td></tr></table>
<p id="d24e31212">We need to be ready to return comic number 1 since that’s going to be fetched at some point and we need to be ready for that:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">when(mockHttp.read(​<em class="string">'https://xkcd.com/1/info.0.json'</em>​)).thenReturn(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  comics[0]</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">);</td></tr></table>
<p id="d24e31231">We also need to worry about when <span class="cf methodname">http.readBytes()</span> gets called to fetch an image. The issue with that is that it should return an <span class="cf class">Uint8List</span>, which is a list of 8-bit integers (each of them is a byte). To create an <span class="cf class">Uint8List</span> we need first import the <span class="cf ic">dart:typed_data</span> library. The simplest way to create an <span class="cf class">Uint8List</span> is by calling the <span class="cf methodname">Uint8.fromList(list)</span> and passing it a list literal.</p>
<p id="d24e31252">After that, we need to worry about what to return. In this case, we don’t really care that the data actually represents an image, since we don’t need to render it, we just need it to be something we can predict—in this case, the list will be just the comic number:

</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">when(mockHttp.readBytes(​<em class="string">'https://example.com/1.png'</em>​)).thenReturn(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Uint8List.fromList([1])</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">when(mockHttp.readBytes(​<em class="string">'https://example.com/2.png'</em>​)).thenReturn(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Uint8List.fromList([2])</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">);</td></tr></table><p><strong>File Mock Object</strong></p>
<p id="d24e31299">We need to also create mock objects for files and images.</p>
<p id="d24e31301">In this case, even though we are calling the classes directly in the app, we need to implement file objects to pass to the functions. An example will be given when we see <a href="#sec.testing.latestcomic">​<em>Testing <span class="cf methodname">getLatestComicNumber</span></em>​</a>.

</p><h4>Using the Mock Object</h4>
<p id="d24e31311">
We need to make changes to the functions that use the objects we created mock objects for so that they can be passed the mock object and use it instead of the real object they currently use.</p>
<p id="d24e31317">This means that the <span class="cf methodname">getLatestComicNumber</span> function you see in the following code needs to instead take the <span class="cf class">Client</span> and custom <span class="cf class">File</span> as a parameter:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;​<strong class="kw">int</strong>​&gt; getLatestComicNumber() async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ dir = await getTemporaryDirectory();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ file = File(​<em class="string">'</em>​​<em class="string">${dir.path}</em>​​<em class="string">/latestComicNumber.txt'</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">int</strong>​ n = 1;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">try</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    n = json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      await http.read(​<em class="string">'https://xkcd.com/info.0.json'</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )[​<em class="string">"num"</em>​];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    file.exists().then(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      (exists) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">if</strong>​(!exists) file.createSync();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        file.writeAsString(​<em class="string">'</em>​​<em class="string">$n</em>​​<em class="string">'</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">catch</strong>​(e) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      file.existsSync() &amp;&amp;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      file.readAsStringSync() != ​<em class="string">""</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      n = ​<strong class="kw">int</strong>​.parse(file.readAsStringSync());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ n;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e31465">The updated code should look as follows:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/testing/xkcd_app/lib/main.dart">testing/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;​<strong class="kw">int</strong>​&gt; getLatestComicNumber</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">({http.Client httpClient, File latestComicNFile}) async</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">{</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(httpClient == ​<strong class="kw">null</strong>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    httpClient = http.Client();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(latestComicNFile == ​<strong class="kw">null</strong>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">final</strong>​ dir = await getTemporaryDirectory();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    latestComicNFile = File(​<em class="string">'</em>​​<em class="string">${dir.path}</em>​​<em class="string">/latestComicNumber.txt'</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">int</strong>​ n = 1;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">try</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    n = json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      await httpClient.read(​<em class="string">'https://xkcd.com/info.0.json'</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )[​<em class="string">"num"</em>​];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    latestComicNFile.exists().then(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      (exists) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<strong class="kw">if</strong>​(!exists) latestComicNFile.createSync();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        latestComicNFile.writeAsString(​<em class="string">'</em>​​<em class="string">$n</em>​​<em class="string">'</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">catch</strong>​(e) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestComicNFile.existsSync() &amp;&amp;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestComicNFile.readAsStringSync() != ​<em class="string">""</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      n = ​<strong class="kw">int</strong>​.parse(latestComicNFile.readAsStringSync());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">return</strong>​ n;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e31635">This method works just like the older one when no additional named arguments are provided (they would be equal to <span class="cf ic">null</span>, triggering the fallback <span class="cf ic">if</span> clauses), which would happen during normal app use. If they are provided, though, they are used in place of the real file and HTTP client.</p>
<p id="d24e31646">Obviously <span class="cf methodname">fetchComic</span> also needs to change. Let’s start with the <span class="cf class">SelectionPage</span>’s, which was the following in the original app:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/networking/xkcd_app/lib/main.dart">networking/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; _fetchComic(​<strong class="kw">String</strong>​ n) async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">final</strong>​ dir = await getTemporaryDirectory();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ comicFile = File(​<em class="string">"</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$n</em>​​<em class="string">.json"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">if</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   await comicFile.exists() &amp;&amp;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   comicFile.readAsStringSync() != ​<em class="string">""</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">return</strong>​ json.decode(comicFile.readAsStringSync());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   comicFile.createSync();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">final</strong>​ comic = json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     await http.read(​<em class="string">'https://xkcd.com/</em>​​<em class="string">$n</em>​​<em class="string">/info.0.json'</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   File(​<em class="string">'</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$n</em>​​<em class="string">.png'</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     .writeAsBytesSync(await http.readBytes(comic[​<em class="string">"img"</em>​]));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   comic[​<em class="string">"img"</em>​] = ​<em class="string">'</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$n</em>​​<em class="string">.png'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   comicFile.writeAsString(json.encode(comic));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ​<strong class="kw">return</strong>​ comic;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e31812">and needs to become the following to allow for testing by using the clients and files given as arguments if they are given and reverting back to the default when they aren’t (in normal app usage) just like we did for <span class="cf methodname">getLatestComicNumber</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/testing/xkcd_app/lib/main.dart">testing/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; fetchComic</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ n,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    http.Client httpClient,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    File comicFile,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    File imageFile,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">String</strong>​ imagePath</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">) async</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">{</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Directory dir;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(httpClient == ​<strong class="kw">null</strong>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    httpClient = http.Client();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(comicFile == ​<strong class="kw">null</strong>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    dir = await getTemporaryDirectory();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    comicFile = File(​<em class="string">"</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$n</em>​​<em class="string">.json"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(imageFile == ​<strong class="kw">null</strong>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(dir == ​<strong class="kw">null</strong>​) dir = await getTemporaryDirectory();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    imagePath = ​<em class="string">'</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$n</em>​​<em class="string">.png'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    imageFile = File(imagePath);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    await comicFile.exists() &amp;&amp;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    comicFile.readAsStringSync() != ​<em class="string">""</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ json.decode(comicFile.readAsStringSync());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    comicFile.createSync();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">final</strong>​ comic = json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      await httpClient.read(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<em class="string">'https://xkcd.com/</em>​​<em class="string">$n</em>​​<em class="string">/info.0.json'</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    imageFile.writeAsBytesSync(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      await httpClient.readBytes(comic[​<em class="string">"img"</em>​])</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    comic[​<em class="string">"img"</em>​] = imagePath;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    comicFile.writeAsString(json.encode(comic));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ comic;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e32042">The <span class="cf class">StarredPage</span>’s <span class="cf methodname">_fetchComic</span> is the same as the <span class="cf class">SelectionPage</span>’s, so the same changes apply to it.</p>
<p id="d24e32053">The <span class="cf class">HomeScreen</span>’s <span class="cf methodname">_fetchComic</span> needs similar changes (it’s just like the other, but this time we first worry about finding out the comic number by subtracting the <span class="cf ic">n</span> argument to the latest comic number):</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/testing/xkcd_app/lib/main.dart">testing/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; fetchComic</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">int</strong>​ n,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    http.Client httpClient,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    File comicFile,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    File imageFile,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">String</strong>​ imagePath</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">) async</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">{</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">int</strong>​ comicNumber = latestComic-n;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Directory dir;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(httpClient == ​<strong class="kw">null</strong>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    httpClient = http.Client();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(comicFile == ​<strong class="kw">null</strong>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    dir = await getTemporaryDirectory();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    comicFile = File(​<em class="string">"</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$comicNumber</em>​​<em class="string">.json"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(imageFile == ​<strong class="kw">null</strong>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">if</strong>​(dir == ​<strong class="kw">null</strong>​) dir = await getTemporaryDirectory();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    imagePath = ​<em class="string">'</em>​​<em class="string">${dir.path}</em>​​<em class="string">/</em>​​<em class="string">$comicNumber</em>​​<em class="string">.png'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    imageFile = File(imagePath);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">if</strong>​(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    await comicFile.exists() &amp;&amp;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    comicFile.readAsStringSync() != ​<em class="string">""</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ json.decode(comicFile.readAsStringSync());</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">else</strong>​ {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    comicFile.createSync();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">final</strong>​ comic = json.decode(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      await httpClient.read(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        ​<em class="string">'https://xkcd.com/</em>​​<em class="string">$comicNumber</em>​​<em class="string">/info.0.json'</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    imageFile.writeAsBytesSync(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      await httpClient.readBytes(comic[​<em class="string">"img"</em>​])</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    comic[​<em class="string">"img"</em>​] = imagePath;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    comicFile.writeAsString(json.encode(comic));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">return</strong>​ comic;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table>
<p id="d24e32293">By making the additional arguments that allow us to provide mock objects optional we can call those methods inside the app without being forced to pass the extra arguments and we keep the function as close to the original as possible while allowing for the usage of mock objects.



</p><h3>Writing the Tests</h3>
<p id="d24e32305">We have made the necessary changes and now we need to write the tests for the XKCD app.</p><h3>XKCD App Unit Tests</h3>
<p id="d24e32310">


We need to test whether the app correctly fetches the latest comic number which, in this case, is <span class="emph">2</span>. We also need to test whether both <span class="cf methodname">_fetchComic</span> method run as expected.</p>
<p id="d24e32330">Let’s start by adding the mock classes we defined earlier and importing everything we need</p>
<p id="d24e32332">The last thing we need outside <span class="cf methodname">main</span> is the list of comic data strings, while all of the calls to <span class="cf methodname">when</span> go inside the <span class="cf methodname">main</span> function definition.</p><h4 id="sec.testing.latestcomic">Testing <span class="cf methodname">getLatestComicNumber</span></h4>
<p id="d24e32348">Let’s start by writing a test for <span class="cf methodname">getLatestComicNumber</span>: for it we’ll need to define the mock objects for the latest comic number file and for the http client.</p>
<p id="d24e32353">We need to define behavior for both asynchronous and synchronous calls, since we need the test to work with a different implementation too:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/testing/xkcd_app/test/unit_test.dart">testing/xkcd_app/test/unit_test.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">test(​<em class="string">"get latest comic number test"</em>​, () async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">①</span>​</span></td><td class="codeline">  ​<strong class="kw">var</strong>​ latestComicNumberFile = MyFile();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ latestComicNumberExists = ​<strong class="kw">false</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ latestComicNumberString;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ mockHttp = MockHTTPClient();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">②</span>​</span></td><td class="codeline">  when(mockHttp.read(​<em class="string">'https://xkcd.com/info.0.json'</em>​)).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) =&gt; Future.value(comics[1])</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">③</span>​</span></td><td class="codeline">  when(latestComicNumberFile.createSync()).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestComicNumberExists = ​<strong class="kw">true</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">④</span>​</span></td><td class="codeline">  when(latestComicNumberFile.create()).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestComicNumberExists = ​<strong class="kw">true</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">return</strong>​ Future.value(latestComicNumberFile);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">⑤</span>​</span></td><td class="codeline">  when(latestComicNumberFile.writeAsStringSync(​<em class="string">"2"</em>​)).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestComicNumberExists = ​<strong class="kw">true</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestComicNumberString = ​<em class="string">"2"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">⑥</span>​</span></td><td class="codeline">  when(latestComicNumberFile.writeAsString(​<em class="string">"2"</em>​)).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestComicNumberExists = ​<strong class="kw">true</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestComicNumberString = ​<em class="string">"2"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">return</strong>​ Future.value(latestComicNumberFile);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">⑦</span>​</span></td><td class="codeline">  when(latestComicNumberFile.existsSync()).thenReturn(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    latestComicNumberExists</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">⑧</span>​</span></td><td class="codeline">  when(latestComicNumberFile.exists()).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Future.value(latestComicNumberExists)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">⑨</span>​</span></td><td class="codeline">  when(latestComicNumberFile.readAsStringSync()).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="comment">// if we try to read from a file that doesn't exist we've made a mistake</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">assert</strong>​(latestComicNumberExists, ​<strong class="kw">true</strong>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">return</strong>​ ​<em class="string">"2"</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">⑩</span>​</span></td><td class="codeline">  when(latestComicNumberFile.readAsString()).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">assert</strong>​(latestComicNumberExists, ​<strong class="kw">true</strong>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">return</strong>​ Future.value(latestComicNumberString);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">⑪</span>​</span></td><td class="codeline">  expect(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    await getLatestComicNumber(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      httpClient: mockHttp,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestComicNFile: latestComicNumberFile,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    2</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">});</td></tr></table><dl class="calloutlist"><dt>​<span class="callout-number" style="font-family:Quivira;">①</span>​</dt><dd>
<p id="d24e32641">
      This is where we declare the mock objects and some data they operate on: a mock <span class="cf class">File</span> that uses a <span class="cf keyword">bool</span> to keep track of whether it has been created and a <span class="cf class">String</span> to simulate the storage of a string. We also declare a mock HTTP client.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">②</span>​</dt><dd>
<p id="d24e32653">
      This is the first of our <span class="cf methodname">when</span> calls and it’s the only one for the mock HTTP client: it returns our fake latest comic when we try to access it.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">③</span>​</dt><dd>
<p id="d24e32661">
      Now we need to define the <span class="cf variable">latestComicNumberFile</span>’s behavior: we’ll start with the synchronous method to create the file, which will change the <span class="cf variable">latestComicNumberExists</span> boolean to true. This is going to be important when we try to read from the file or run the <span class="cf methodname">exists</span> or <span class="cf methodname">existsSync</span> methods.
    </p>
<p id="d24e32675">
      In the parentheses we used <span class="cf variable">_</span>, which is meant to be used for unused arguments (it may be used in <span class="cf keyword">catch</span> blocks as well). If we had chosen to use that argument and give it a name instead, it would be an <span class="cf class">Invocation</span>.
    </p>
<p id="d24e32686">
      An invocation has a few properties that are interesting to us: </p><ul><li>
<p id="d24e32690"> <span class="cf variable">namedArguments</span>, which is a <span class="cf class">Map</span> of the named arguments supplied by the caller;</p></li><li>
<p id="d24e32699"> <span class="cf variable">positionalArguments</span>, which is a <span class="cf class">List</span> of the positional arguments supplied by the caller.</p></li></ul></dd><dt>​<span class="callout-number" style="font-family:Quivira;">④</span>​</dt><dd>
<p id="d24e32708">
      We are doing the same thing for the asynchronous method to create files, which is supposed to return the file (in a <span class="cf class">Future</span>, since it is an <span class="cf keyword">async</span> method).
	  
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">⑤</span>​</dt><dd>
<p id="d24e32722">
      At some point <span class="cf methodname">getLatestComicNumber</span> is supposed to try to write the number 2 to a file. We’ll simulate writing it by storing it in <span class="cf variable">latestComicNumberString</span>. We also simulate creating the file at the same time, just like what the real methods to write to files do.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">⑥</span>​</dt><dd>
<p id="d24e32731">
      This is just like the previous one, but asynchronous. We return the file for the same reason we return it in <span class="cf methodname">create</span>.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">⑦</span>​</dt><dd>
<p id="d24e32737">
      <span class="cf methodname">getLatestComicNumber</span> checks whether the file exists at some point, so we need to be able to implement that method too.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">⑧</span>​</dt><dd>
<p id="d24e32743">
      Having mock objects that implement methods that may be used in the method we’re trying to test even if they aren’t used allows the mock object to be used without change for more tests and it makes it so we don’t have to change the test if at some point we change the functions used in the method we’re testing. In this case, we implement both asynchronous and synchronous methods even when we only use one of them.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">⑨</span>​</dt><dd>
<p id="d24e32746">
      This simulates reading from a file. We have an assertion that interrupts execution if we try to read from a file we haven’t yet created (either by running <span class="cf methodname">create</span> or by writing to it.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">⑩</span>​</dt><dd>
<p id="d24e32752">
      The asynchronous version of the previous method.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">⑪</span>​</dt><dd>
<p id="d24e32755">
      Finally we get to <span class="cf methodname">expect</span>, passing the mock HTTP client and file and expecting it to return <span class="emph">2</span>.
    </p></dd></dl><h4>Testing Fetching the Latest Comic</h4>
<p id="d24e32766">The <span class="cf methodname">fetchComic</span> method has an important feature: it isn’t actually defined as <span class="cf methodname">fetchComic</span> but, instead, it’s called <span class="cf methodname">_fetchComic</span>, which makes it private: it’s only accessible within the class itself. It’s good practice to define all class members as private if they aren’t supposed to be accessed from outside the class, but we need to call it directly to perform unit tests on it. This means we need to change its definition from:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; fetchComic</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ n,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    http.Client httpClient,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    File comicFile,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    File imageFile,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">String</strong>​ imagePath</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">) async</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">{</td></tr></table>
<p id="d24e32816">to:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/testing/xkcd_app/lib/main.dart">testing/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">Future&lt;Map&lt;​<strong class="kw">String</strong>​, ​<strong class="kw">dynamic</strong>​&gt;&gt; fetchComic</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ n,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    http.Client httpClient,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    File comicFile,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    File imageFile,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<strong class="kw">String</strong>​ imagePath</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">) async</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">{</td></tr></table>
<p id="d24e32857">This also means that we need to change any call to <span class="cf methodname">_fetchComic</span> to calls to <span class="cf methodname">fetchComic</span>. In this case, it is just one and it is set as the <span class="cf variable">future</span> argument of the <span class="cf class">FutureBuilder</span> in the <span class="cf methodname">build</span> method.</p>
<p id="d24e32874">Given that we also need to test the <span class="cf class">SelectionPage</span>’s and the <span class="cf class">HomeScreen</span>’s <span class="cf methodname">fetchComic</span>, the same changes need to be made to those classes. The <span class="cf class">StarredPage</span>’s <span class="cf methodname">fetchComic</span> is called only inside <span class="cf methodname">_retrieveSavedComics</span> and the <span class="cf class">HomeScreen</span>’s is set as the <span class="cf variable">future</span> of a <span class="cf class">FutureBuilder</span> inside the <span class="cf methodname">build</span> method.</p><p><strong>Testing fetchComic</strong></p>
<p id="d24e32910">This is the code to test the <span class="cf class">SelectionPage</span> <span class="cf methodname">fetchComic</span>’s ability to fetch comic number 2:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/testing/xkcd_app/test/unit_test.dart">testing/xkcd_app/test/unit_test.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">test(​<em class="string">"SelectionPage fetchComic latest"</em>​, () async {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ latestComicFile = MyFile();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ latestComicExists = ​<strong class="kw">false</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">String</strong>​ latestComicString;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ latestImageFile = MyFile();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  Uint8List latestImageData;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ latestImageExists = ​<strong class="kw">false</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ mockHttp = MockHTTPClient();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  when(mockHttp.read(​<em class="string">'https://xkcd.com/2/info.0.json'</em>​)).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) =&gt; Future.value(comics[1])</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  when(mockHttp.readBytes(​<em class="string">"https://example.com/2.png"</em>​)).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) =&gt; Future.value(Uint8List.fromList([2]))</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  when(latestComicFile.createSync()).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestComicExists = ​<strong class="kw">true</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  when(latestComicFile.create()).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestComicExists = ​<strong class="kw">true</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">return</strong>​ Future.value(latestComicFile);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  when(latestComicFile.writeAsStringSync(comics[1])).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestComicExists = ​<strong class="kw">true</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestComicString = comics[1];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  when(latestComicFile.writeAsString(comics[1])).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestComicExists = ​<strong class="kw">true</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestComicString = comics[1];</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">return</strong>​ Future.value(latestComicFile);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  when(latestComicFile.existsSync()).thenReturn(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    latestComicExists</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  when(latestComicFile.exists()).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) =&gt;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Future.value(latestComicExists)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  when(latestComicFile.readAsStringSync()).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="comment">/*</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">       * if we try to read from a file that doesn't</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">       * exist it's because we've made a mistake</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<em class="comment">       */</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">assert</strong>​(latestComicExists, ​<strong class="kw">true</strong>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">return</strong>​ latestComicString;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  when(latestImageFile.readAsBytes()).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">assert</strong>​(latestImageExists, ​<strong class="kw">true</strong>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">return</strong>​ Future.value(latestImageData);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  when(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    latestImageFile.writeAsBytesSync(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      Uint8List.fromList([1])</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestImageExists = ​<strong class="kw">true</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestImageData = Uint8List.fromList([1]);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  when(latestComicFile.writeAsString(comics[1])).thenAnswer(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    (_) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestImageExists = ​<strong class="kw">true</strong>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      latestImageData = Uint8List.fromList([1]);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">return</strong>​ Future.value(latestImageFile);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<strong class="kw">var</strong>​ selPage = SelectionPage();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  expect(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    await selPage.fetchComic(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<em class="string">"2"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      httpClient: mockHttp,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      comicFile: File(​<em class="string">"latestComicFole"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      imageFile: File(​<em class="string">"latestComicFile"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      imagePath: ​<em class="string">"https://example.com/2.png"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    json.decode(comics[1])</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">});</td></tr></table>
<p id="d24e33331">It’s nothing new: we use Mockito to define expected behavior for all functions that may be called by the <span class="cf methodname">fetchComic</span> method to fetch the comic: reading and writing from image and comic files and performing HTTP requests.</p>
<p id="d24e33336">Defining new tests for other <span class="cf methodname">fetchComic</span> methods only requires changes for the <span class="cf class">HomeScreen</span>: it needs an integer for the comic number, which is a number that starts from 0 and can be, at most, 1 less than the latest comic number.</p><p><strong>Grouping Together Tests</strong></p>
<p id="d24e33347">Multiple tests can be grouped together using the <span class="cf methodname">group</span> method, which works exactly like <span class="cf methodname">test</span>:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">group(​<em class="string">"group name"</em>​, () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  test(​<em class="string">"first test in group"</em>​, () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// First test in group</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  test(​<em class="string">"second test in group"</em>​, () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    ​<em class="comment">// Second test in group</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ​<em class="comment">// any other tests you want to add</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">});</td></tr></table>
<p id="d24e33390">For example, we can group all tests that involve <span class="cf methodname">fetchComic</span> methods, or maybe we can group together all tests that fetch a specific comic if you decide to structure tests differently. Inside <span class="cf ic">group</span>s we can, for example, define variables and mock objects that are needed for more than one test, so that they are accessible by all tests in a group but not outside of the group, but you need to keep in mind that the <span class="cf ic">group</span>’s callback closure can’t be <span class="cf ic">async</span>.</p><div class="sidebar"><div class="sidebar-title">More Unit Tests: Comic Starring</div><div class="sidebar-content">
<p id="d24e33407">
    Testing comic starring in the <span class="cf class">StarredPage</span> doesn’t introduce particularly challenging situations, except for the fact that the <span class="cf methodname">retrieveSavedComics</span> method calls <span class="cf methodname">fetchComic</span>, which means that the mock objects need to be passed first to <span class="cf methodname">retrieveSavedComics</span> which will, in turn, pass it to <span class="cf methodname">fetchComic</span>.
  </p>
<p id="d24e33424">
    The overall structure of the test should be the following: the <span class="cf methodname">addToStarred</span> method (in the <span class="cf class">ComicPage</span>) should be called on the same file that will then be used by <span class="cf methodname">retrieveStarredComics</span> to get the starred comics list. The main difference between this test and the <span class="cf methodname">fetchComic</span> test is that this one needs two mock text files: one of them needs to contain the comic file, whereas the other one will store the list of saved comics numbers, so it needs to predict the data it will be asked to store, just like we did earlier for the comic and latest number files.
  </p>
<p id="d24e33438">
    Writing these tests as someone who is trying to understand Flutter will also help you understand the inner workings of our app in more detail and test your own understanding of it. If you can’t write a test for it, you probably don’t understand how it’s working and that means you need to try to first understand how the app works.
  </p></div></div><h3>A Few Words on Widget Testing More Complicated Apps</h3>
<p id="d24e33443">





We have already covered widget testing in the section about testing the calculator, so we won’t have examples of widget tests for the XKCD apps, which would be redundant.</p>
<p id="d24e33463">Widget testing the XKCD app involves testing whether or not the UI actually works, so we don’t actually need to be necessarily design mock objects that perfectly emulate the behavior of the network or file system: we just need to know the UI we need exists and is correctly interacting with our app’s backbone.</p>
<p id="d24e33467">Widget tests rely on mock objects to work, so reducing the scope of these tests to just testing whether the widgets call the functions they are supposed to call is all that should be done in widget tests: doing anything more than that will only make the tests more complicated and make the integration tests partially redundant.</p><h4>Verifying Whether a Method Has Been Called: Mockito’s verify</h4>
<p id="d24e33472">

Mockito includes a function to verify whether or not a method has been called, making it possible to reduce the scope of tests to only verifying whether methods get called instead of necessarily checking whether a given method returns a given value.
For example, if you want the test to fail if <span class="cf methodname">myObj.runMethod()</span> hasn’t been called, you’d add:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">verify(myObj.runMethod());</td></tr></table>
<p id="d24e33499">If you replaced <span class="cf ic">verify</span> with <span class="cf ic">verifyNever</span> you’d have the opposite effect.</p>
<p id="d24e33507">You can also specify the amount of times a method should get called:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">verify(myObj.runMethod()).called(5);</td></tr></table>
<p id="d24e33519">requires the method to have been called 5 times and:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">verify(myObj.runMethod()).called(greaterThan(4));</td></tr></table>
<p id="d24e33532">requires it to have been called <span class="emph">at least</span> 5 times.</p>
<p id="d24e33537">Calling <span class="cf ic">verify(myObj.runMethod()).called(0)</span> will fail. You have to use <span class="cf ic">verifyNever(myObj.runMethod())</span> for that.




</p><h3>XKCD App Integration Test</h3>
<p id="d24e33558">



Integration tests are just like widget tests, but they are run on a real device or emulator by using the <span class="cf ic">flutter_driver</span> package.</p><h4>Modifying the App: Using a TextEditingController</h4>
<p id="d24e33583">Integration testing requires us to make modifications to the app. One of the main modifications is the addition of keys to any widgets we want to be interacting with, especially if they don’t contain text or we need to check the text they contain.</p><p><strong>Meeting an Old Friend Again: The Need for a Key</strong></p>
<p id="d24e33588">


That is because widget testing and integration testing <span class="cf class">Finder</span>s are very similar, but not the same: integration testing uses <span class="cf class">SerializableFinders</span>, which are a lot fewer, and only allow us the following operations:




</p><ul><li>
<p id="d24e33637"><span class="cf methodname">find.byValueKey(value)</span>, which finds object with <span class="cf class">Key</span>s or <span class="cf class">ValueKey</span>s attached to them that are generated using that <span class="cf ic">value</span>.</p></li><li>
<p id="d24e33651"><span class="cf methodname">find.text(text)</span>, which finds <span class="cf class">Text</span> widgets containing the given <span class="cf ic">text</span>.</p></li><li>
<p id="d24e33662"><span class="cf methodname">find.byType(tyoe)</span>, which finds widgets of the given <span class="cf ic">type</span>.</p></li><li>
<p id="d24e33670"><span class="cf methodname">find.byTooltip(tooltip)</span>, which finds widget showing the given <span class="cf ic">tooltip</span> when long-pressed.</p></li><li>
<p id="d24e33678"><span class="cf methodname">find.pageBack</span>, which finds the button to go to the previous page.</p></li></ul>
<p id="d24e33682">This means the best way to find widgets with features that don’t conform to any of the others, we have to equip the widget with a key and use <span class="cf methodname">find.byValueKey</span> to find it.</p>
<p id="d24e33687">The reason why they are so few is because integration tests shouldn’t have access to the app’s resources or the Flutter UI framework’s widgets and classes in general.</p><p><strong>Adding a Button to Submit the TextField’s Input</strong></p>
<p id="d24e33692">Additionally, we need to make a change to the <span class="cf class">SelectionPage</span>: at the moment the user can only sumbit using the number using the submit button on the on-screen keyboard or the <span class="keystroke">Enter</span> key on a physical keyboard. This is, unfortunately, not supported by Flutter’s integration testing infrastructure (at the time of writing), which means we have to create a <span class="cf class">TextEditingController</span> and a separate <span class="cf class">FlatButton</span> to submit the <span class="cf class">TextField</span>’s contents.</p><p><strong>Defining a TextEditingController</strong></p>
<p id="d24e33712">
A <span class="cf class">TextEditingController</span> is a class that stores the data inserted in a <span class="cf class">TextField</span> or a similar widget and makes it possible to access that data from outside the <span class="cf ic">onSubmitted</span> callback we give to the <span class="cf class">TextField</span> itself, allowing us to create a button that opens the comic the user asked for, and giving us something to tap to do that when performing integration tests.</p>
<p id="d24e33735">Let’s declare a <span class="cf class">TextEditingController</span> as a private member variable of the <span class="cf class">SelectionPage</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/testing/xkcd_app/lib/main.dart">testing/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">final</strong>​ TextEditingController _controller = TextEditingController();</td></tr></table><p><strong>Using the TextEditingController</strong></p>
<p id="d24e33752">Let’s pass it as the <span class="cf variable">controller</span> argument to the <span class="cf class">TextField</span>:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/testing/xkcd_app/lib/main.dart">testing/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">TextField(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> controller: _controller,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> decoration: InputDecoration(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   labelText: ​<em class="string">"Insert comic #"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"> ),</td></tr></table><p><strong>Adding the FlatButton</strong></p>
<p id="d24e33778">We now need to turn the <span class="cf class">Center</span> widget in the <span class="cf variable">body</span> of the <span class="cf class">Scaffold</span> into a <span class="cf class">Column</span>, which will also require changing the <span class="cf variable">child</span> argument to <span class="cf variable">children</span>, which needs to be a <span class="cf class">List</span> literal (we need to enclose the <span class="cf class">TextField</span> definition in square brackets, in which we’ll also add the <span class="cf class">FlatButton</span>).</p>
<p id="d24e33808">The <span class="cf class">FlatButton</span> we’re going to add needs a <span class="cf variable">key</span> to be used in integration testing, and it needs to perform the same actions performed by the <span class="cf class">TextField</span>’s <span class="cf variable">onSubmit</span>, but by taking the number of the comic requested by the user from <span class="cf ic">_controller.text</span>. The entire <span class="cf variable">body</span> of the <span class="cf class">Scaffold</span> ends up being the following:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/testing/xkcd_app/lib/main.dart">testing/xkcd_app/lib/main.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">body: Column(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  mainAxisAlignment: MainAxisAlignment.center,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  children: [</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    TextField(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     controller: _controller,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     decoration: InputDecoration(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       labelText: ​<em class="string">"Insert comic #"</em>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     keyboardType: TextInputType.number,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     autofocus: ​<strong class="kw">true</strong>​,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     onSubmitted: (​<strong class="kw">String</strong>​ a) =&gt; Navigator.push(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         builder: (context) =&gt; FutureBuilder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           future: fetchComic(a),</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           builder: (context, snapshot) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             ​<strong class="kw">if</strong>​(snapshot.hasError)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">               ​<strong class="kw">return</strong>​ ErrorPage();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             ​<strong class="kw">if</strong>​(snapshot.hasData)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">               ​<strong class="kw">return</strong>​ ComicPage(snapshot.data);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             ​<strong class="kw">return</strong>​ CircularProgressIndicator();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     key: Key(​<em class="string">"insert comic"</em>​)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   FlatButton(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     key: Key(​<em class="string">"submit comic"</em>​),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     child: Text(​<em class="string">"Open"</em>​.toUpperCase()),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     onPressed: () =&gt; Navigator.push(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       context,</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       MaterialPageRoute(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         builder: (context) =&gt; FutureBuilder(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           future: fetchComic(_controller.text),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           builder: (context, snapshot) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             ​<strong class="kw">if</strong>​(snapshot.hasError)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">               ​<strong class="kw">return</strong>​ ErrorPage();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             ​<strong class="kw">if</strong>​(snapshot.hasData)</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">               ​<strong class="kw">return</strong>​ ComicPage(snapshot.data);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">             ​<strong class="kw">return</strong>​ CircularProgressIndicator();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">           }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">         ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">       ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">     ),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">   )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  ],</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">),</td></tr></table><h4>Using the flutter_driver to Test the Selection Page</h4>
<p id="d24e34023">Integration testing requires a package called <span class="cf ic">flutter_driver</span>. The entire <span class="cf filename">pubspec.yaml</span> file containing all of the dependencies required to test Flutter apps (along with the other dependencies we need to run the XKCD app) is the following:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/testing/xkcd_app/pubspec.yaml">testing/xkcd_app/pubspec.yaml</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">name: ​<em class="string">xkcd_app</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">description: ​<em class="string">An app to display XKCD comics.</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">dependencies:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  http: ​<em class="string">"</em>​​<em class="string">^0.12.0+1"</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  path_provider:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  url_launcher: ​<em class="string">^5.0.2</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  flutter:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    sdk: ​<em class="string">flutter</em>​</td></tr></table><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">dev_dependencies:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  flutter_driver:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    sdk: ​<em class="string">flutter</em>​</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  mockito:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  test:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">flutter:</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  uses-material-design: true</td></tr></table>
<p id="d24e34123">To use it, let’s create a new directory in the root of our app’s source tree called <span class="cf filename">test_driver</span>. Inside it, we need to create a file that will run the app with the Flutter driver extensions enabled, and another that will connect to that running app and perform some tests on it.</p>
<p id="d24e34128">As an example, we’re going to explore how we can interact with the <span class="cf class">SelectionPage</span> and see what it’s possible to do with the Flutter integration testing framework.</p><p><strong>Creating a selectionpage.dart File</strong></p>
<p id="d24e34136">Let’s start by creating a file that enables the Flutter driver extensions:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/testing/xkcd_app/test_driver/selectionpage.dart">testing/xkcd_app/test_driver/selectionpage.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">①</span>​</span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:flutter_driver/driver_extension.dart'</em>​; </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:xkcd_app/main.dart'</em>​ ​<strong class="kw">as</strong>​ app;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:flutter/material.dart'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">main</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">②</span>​</span></td><td class="codeline">  enableFlutterDriverExtension(); </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">③</span>​</span></td><td class="codeline">  runApp( </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    MaterialApp(</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      home: app.SelectionPage(),</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    )</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  );</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><dl class="calloutlist"><dt>​<span class="callout-number" style="font-family:Quivira;">①</span>​</dt><dd>
<p id="d24e34193">
      <span class="emph">package:flutter_driver/driver_extension.dart</span> is the part of <span class="emph">flutter_driver</span> that allows us to enable <span class="emph">driver extensions</span>, which need to be enabled when running an app we want to run integration tests on.
    </p>
<p id="d24e34204">
      We also need to import the app’s <span class="cf filename">main.dart</span> because we need to be able to run the app and we need to import Flutter’s Material Design library because we only want to run the <span class="cf class">SelectionPage</span> in this case so we need access to <span class="cf methodname">runApp</span> and the <span class="cf class">MaterialApp</span> class.
	  
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">②</span>​</dt><dd>
<p id="d24e34224">
      <span class="cf methodname">enableFlutterDriverExtension</span> actually enables the driver extensions. This function is contained in <span class="emph">package:flutter_driver/driver_extension.dart</span>.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">③</span>​</dt><dd>
<p id="d24e34233">
      We want to test the selection page, so we run it just like we run regular app home screens when we build Flutter apps, but selecting the <span class="cf class">SelectionPage</span> instead.
    </p></dd></dl>
<p id="d24e34241">This is the only file that will have access to your app or to Flutter’s UI classes at all. The actual test file mustn’t import any of that.</p><p><strong>Creating a selectionpage_test.dart File</strong></p>
<p id="d24e34246">This file name needs to be the same as the previous one, but with <span class="emph">_test</span> added to the name before the <span class="emph">.dart</span> extension. In this case, it has to be called <span class="cf filename">selectionpage_test.dart</span>.</p>
<p id="d24e34257">This test will be very simple and will simply try to open a comic and check whether it is correctly opened by the app:</p><div class="livecodelozenge"><a href="http://media.pragprog.com/titles/czflutr/code/testing/xkcd_app/test_driver/selectionpage_test.dart">testing/xkcd_app/test_driver/selectionpage_test.dart</a></div><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">①</span>​</span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:flutter_driver/flutter_driver.dart'</em>​; </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">import</strong>​ ​<em class="string">'package:test/test.dart'</em>​;</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">​<strong class="kw">void</strong>​ ​<strong class="kw">main</strong>​() {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  group(​<em class="string">'Selection Page'</em>​, () {</td></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">②</span>​</span></td><td class="codeline">    FlutterDriver driver; </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    SerializableFinder appBarText = find.byValueKey(​<em class="string">"AppBar text"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">③</span>​</span></td><td class="codeline">    setUpAll(() async { </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      driver = await FlutterDriver.connect();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">④</span>​</span></td><td class="codeline">    tearDownAll(() async { </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      ​<strong class="kw">if</strong>​ (driver != ​<strong class="kw">null</strong>​) {</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">        driver.close();</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      }</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">⑤</span>​</span></td><td class="codeline">    test(​<em class="string">'Verify Page is Loaded'</em>​, () async { </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      await driver.waitFor(appBarText);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      expect(await driver.getText(appBarText), ​<em class="string">"Comic selection"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline"/></tr><tr><td class="codeinfo">​<span class="codeprefix">​<span class="callout-number" style="font-family:Quivira;">⑥</span>​</span></td><td class="codeline">    test(​<em class="string">'Open Comic'</em>​, () async { </td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      await driver.tap(find.byValueKey(​<em class="string">"insert comic"</em>​));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      await driver.enterText(​<em class="string">"1"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      await driver.tap(find.byValueKey(​<em class="string">"submit comic"</em>​));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      await driver.waitFor(find.text(​<em class="string">"#1"</em>​));</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">      expect(await driver.getText(appBarText), ​<em class="string">"#1"</em>​);</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">    });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">  });</td></tr><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">}</td></tr></table><dl class="calloutlist"><dt>​<span class="callout-number" style="font-family:Quivira;">①</span>​</dt><dd>
<p id="d24e34415">
      Here we need to import the main <span class="cf filename">flutter_driver.dart</span> file, along with the regular test package.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">②</span>​</dt><dd>
<p id="d24e34421">
      Let’s define some of the variables we are going to use more than once: the <span class="cf class">FlutterDriver</span> we’re going to use to interact with the running Flutter app, and the <span class="cf class">SerializableFinder</span> looking for a <span class="cf class">Key</span> created with the string <span class="emph">AppBar text</span>, that you should add to every <span class="cf class">AppBar</span> <span class="cf class">Text</span> widget in the app.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">③</span>​</dt><dd>
<p id="d24e34443">
      This section is used to connect to the running app when starting the test.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">④</span>​</dt><dd>
<p id="d24e34446">
      Here we disconnect from the app when testing is over.
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">⑤</span>​</dt><dd>
<p id="d24e34449">
      This first test is very simple: we wait for the page to load and then we check that the <span class="cf class">AppBar</span> text is correct (so that we know that the app has loaded the right page).
    </p></dd><dt>​<span class="callout-number" style="font-family:Quivira;">⑥</span>​</dt><dd>
<p id="d24e34455">
      This test is more important: we find the <span class="cf class">TextField</span> to insert the comic, we tap it (to select it, just in case), we enter the text <span class="emph">1</span>, we press the newly created <span class="emph">submit</span> button, wait for the comic page to load, and check that comic number 1 has actually been loaded (the <span class="cf class">AppBar</span> <span class="cf class">Text</span> should be <span class="emph">#1</span>).
    </p></dd></dl>
<p id="d24e34476">
To start the test, run the following command with an emulator or device connected:</p><table class="processedcode"><tr><td class="codeinfo">​<span class="codeprefix"> </span></td><td class="codeline">flutter drive --target=test_driver/selectionpage.dart</td></tr></table>
<p id="d24e34489">and you’ll see the app open and do everything you asked it to do automatically. In the command line, you’ll get the confirmation that all tests have passed.

</p><h3>Testing More</h3>
<p id="d24e34497">
In our integration testing example, we are only testing the <span class="cf class">SelectionPage</span>. That’s because it allows us to combine many interesting <span class="cf ic">flutter_driver</span> features and it doesn’t require repeating the same instructions many times, which would not be very interesting for an example that aims to help you learn new things.</p>
<p id="d24e34509">We haven’t done integration testing on the calculator app, but it may be used to test executing calculation using the keypad, testing both the <span class="cf class">Calculation</span> and the UI, and that is simply a combination of tests we have already done: it is useful on a real app, but you already know how to do that. That’s what integration testing is for, just like the test we wrote for our XKCD app: it tests both the UI and the logic.</p>
<p id="d24e34514">Testing the codebase is essential and should be done as much as possible. When writing your own apps, it’s important you design and write all three kinds of tests for every aspect of the app: our XKCD app needs tests for the <span class="cf class">HomeScreen</span>, for the <span class="cf class">ComicPage</span>, perhaps testing whether the <span class="cf class">ErrorPage</span> is shown when it’s needed. Additionally, more unit tests and widget tests for the basic UI elements are useful (for example, testing the <span class="cf class">AppBar</span> controls on the <span class="cf class">HomeScreen</span>).

</p>
<p id="d24e34535">Code examples of those test cases look a lot like the previous ones, and thus I have not reproduced them here; however, you need to keep in mind the importance of testing.</p><h3>When We Have to Mock and When We Don’t</h3>
<p id="d24e34540">
Testing using mock objects can be repetitive and feels like an useless exercise in pedantry and correctness, often begging the question: <span class="emph">is this really necessary?</span></p>
<p id="d24e34550">Testing software looks like an easy task when no mocking is involved: we just run a method and check whether it returns the correct value, or we simulate user interaction and check whether the app behaves correctly: it’s simple, intuitive, and doesn’t involve writing too many lines of code for simple things.</p>
<p id="d24e34552">Writing mock objects isn’t as simple and straight-forward: we need to consider every single interaction of the app with the outside world and simulate the response of the outside world: it is, in many respects, a chore and it seems to detract from time that could be spent developing a new feature, without actually achieving anything new.</p>
<p id="d24e34554">The problem with mocking is that it’s not just about protecting from unpredictable outside variables: it is about making the tests actually work. Even though the test will actually work correctly if we don’t mock the HTTP client (even though we won’t really be able to test the app’s functionality based on its result), any attempt to call the functions provided by <span class="cf ic">path_provider</span> to access the paths where to store app files will result in exceptions being thrown.</p>
<p id="d24e34559">If we want to know whether the <span class="cf methodname">fetchComic</span> method works, we can’t just make the part that works with files optional: it’s integral to the correct functioning of the app and that means we need to test it. The best way to test it in tests not run inside an emulator is by mocking files, so that’s what we do.</p>
<p id="d24e34564">This use case, as we’ve seen, may be made easier by just using real files on the physical machine that runs the tests: just running the <span class="cf methodname">File</span> constructor will create a file on the machine you’re using to run the tests, and that’s a way to make testing easier, but not really too predictable or controlled, since it relies on the local machine’s file system, which may be inaccessible in case the test is run on a server that doesn’t allow the code to have write access to the file system.</p>
<p id="d24e34569">
Also, an important feature that absolutely requires mock objects even in integration tests is authentication: an app that requires authentication to work makes testing impossible unless tests takes advantage of mocking to overcome the issue of authenticathing.
</p><h4>Mockito Versus Do-It-Yourself Mock Objects</h4>
<p id="d24e34579">

Mockito doesn’t always make it easier to create mock objects: on the contrary, sometimes you might find it easier to just write a class that implements the methods you need. You can make them work by defining those classes as subclasses (<a href="/links/f_0090/f_0090.xhtml#sec.dart.extends">​<em>extends</em>​</a>) or as classes that implement (<a href="/links/f_0090/f_0090.xhtml#sec.dart.implements">​<em>Writing a Class That implements an Interface</em>​</a>) the interface you want to mock.</p></body></html>